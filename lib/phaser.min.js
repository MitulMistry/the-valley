/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.3.0 "Tarabon" - Built: Thu Mar 26 2015 02:36:37
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser
* and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/
(function(){var t=this,n=n||{};n.WEBGL_RENDERER=0;n.CANVAS_RENDERER=1;n.VERSION="v2.2.8";n._UID=0;typeof Float32Array!="undefined"?(n.Float32Array=Float32Array,n.Uint16Array=Uint16Array,n.Uint32Array=Uint32Array,n.ArrayBuffer=ArrayBuffer):(n.Float32Array=Array,n.Uint16Array=Array);n.PI_2=Math.PI*2;n.RAD_TO_DEG=180/Math.PI;n.DEG_TO_RAD=Math.PI/180;n.RETINA_PREFIX="@2x";n.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1};n.DisplayObject=function(){this.position=new n.Point(0,0);this.scale=new n.Point(1,1);this.transformCallback=null;this.transformCallbackContext=null;this.pivot=new n.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this.worldTransform=new n.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new n.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=!1;this._cacheIsDirty=!1};n.DisplayObject.prototype.constructor=n.DisplayObject;n.DisplayObject.prototype.destroy=function(){if(this.children){for(var n=this.children.length;n--;)this.children[n].destroy();this.children=[]}this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.renderable=!1;this._destroyCachedSprite()};Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var n=this;do{if(!n.visible)return!1;n=n.parent}while(n);return!0}});Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1);this._mask=n;this._mask&&(this._mask.isMask=!0)}});Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);this._filterBlock={target:this,filterPasses:r}}this._filters=n}});Object.defineProperty(n.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}});n.DisplayObject.prototype.updateTransform=function(){if(this.parent){var t=this.parent.worldTransform,i=this.worldTransform,r,o,s,u,f,e;this.rotation%n.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,o=this._sr*this.scale.x,s=-this._sr*this.scale.y,u=this._cr*this.scale.y,f=this.position.x,e=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*r+this.pivot.y*s,e-=this.pivot.x*o+this.pivot.y*u),i.a=r*t.a+o*t.c,i.b=r*t.b+o*t.d,i.c=s*t.a+u*t.c,i.d=s*t.b+u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty):(r=this.scale.x,u=this.scale.y,f=this.position.x-this.pivot.x*r,e=this.position.y-this.pivot.y*u,i.a=r*t.a,i.b=r*t.b,i.c=u*t.c,i.d=u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty);this.worldAlpha=this.alpha*this.parent.worldAlpha;this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,i,t)}};n.DisplayObject.prototype.displayObjectUpdateTransform=n.DisplayObject.prototype.updateTransform;n.DisplayObject.prototype.getBounds=function(t){return t=t,n.EmptyRectangle};n.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(n.identityMatrix)};n.DisplayObject.prototype.setStageReference=function(n){this.stage=n};n.DisplayObject.prototype.preUpdate=function(){};n.DisplayObject.prototype.generateTexture=function(t,i,r){var u=this.getLocalBounds(),f=new n.RenderTexture(u.width|0,u.height|0,r,i,t);return n.DisplayObject._tempMatrix.tx=-u.x,n.DisplayObject._tempMatrix.ty=-u.y,f.render(this,n.DisplayObject._tempMatrix),f};n.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};n.DisplayObject.prototype.toGlobal=function(n){return this.displayObjectUpdateTransform(),this.worldTransform.apply(n)};n.DisplayObject.prototype.toLocal=function(n,t){return t&&(n=t.toGlobal(n)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(n)};n.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha;t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)};n.DisplayObject.prototype._generateCachedSprite=function(){var t,r,i;this._cacheAsBitmap=!1;t=this.getLocalBounds();this._cachedSprite?this._cachedSprite.texture.resize(t.width|0,t.height|0):(r=new n.RenderTexture(t.width|0,t.height|0),this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform);i=this._filters;this._filters=null;this._cachedSprite.filters=i;n.DisplayObject._tempMatrix.tx=-t.x;n.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,n.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=!0};n.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};n.DisplayObject.prototype._renderWebGL=function(n){n=n};n.DisplayObject.prototype._renderCanvas=function(n){n=n};Object.defineProperty(n.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.DisplayObjectContainer=function(){n.DisplayObject.call(this);this.children=[]};n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype);n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer;Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(n){var t=this.getLocalBounds().width;this.scale.x=t!==0?n/t:1;this._width=n}});Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(n){var t=this.getLocalBounds().height;this.scale.y=t!==0?n/t:1;this._height=n}});n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)};n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),this.stage&&n.setStageReference(this.stage),n;throw new Error(n+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);};n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.getChildIndex(n),r=this.getChildIndex(t);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t;this.children[r]=n}};n.DisplayObjectContainer.prototype.getChildIndex=function(n){var t=this.children.indexOf(n);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t};n.DisplayObjectContainer.prototype.setChildIndex=function(n,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(n);this.children.splice(i,1);this.children.splice(t,0,n)};n.DisplayObjectContainer.prototype.getChildAt=function(n){if(n<0||n>=this.children.length)throw new Error("getChildAt: Supplied index "+n+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[n]};n.DisplayObjectContainer.prototype.removeChild=function(n){var t=this.children.indexOf(n);if(t!==-1)return this.removeChildAt(t)};n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return this.stage&&t.removeStageReference(),t.parent=undefined,this.children.splice(n,1),t};n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var e=n||0,o=typeof t=="number"?t:this.children.length,i=o-e,r,u,f;if(i>0&&i<=o){for(r=this.children.splice(e,i),u=0;u<r.length;u++)f=r[u],this.stage&&f.removeStageReference(),f.parent=undefined;return r}if(i===0&&this.children.length===0)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range");};n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var n=0,t=this.children.length;n<t;n++)this.children[n].updateTransform()};n.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=n.DisplayObjectContainer.prototype.updateTransform;n.DisplayObjectContainer.prototype.getBounds=function(){var f,l,a,i;if(this.children.length===0)return n.EmptyRectangle;var r=Infinity,u=Infinity,e=-Infinity,o=-Infinity,t,s,h,c=!1;for(f=0,l=this.children.length;f<l;f++)(a=this.children[f],a.visible)&&(c=!0,t=this.children[f].getBounds(),r=r<t.x?r:t.x,u=u<t.y?u:t.y,s=t.width+t.x,h=t.height+t.y,e=e>s?e:s,o=o>h?o:h);return c?(i=this._bounds,i.x=r,i.y=u,i.width=e-r,i.height=o-u,i):n.EmptyRectangle};n.DisplayObjectContainer.prototype.getLocalBounds=function(){var u=this.worldTransform,t,i,r;for(this.worldTransform=n.identityMatrix,t=0,i=this.children.length;t<i;t++)this.children[t].updateTransform();return r=this.getBounds(),this.worldTransform=u,r};n.DisplayObjectContainer.prototype.setStageReference=function(n){this.stage=n;for(var t=0;t<this.children.length;t++)this.children[t].setStageReference(n)};n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var n=0;n<this.children.length;n++)this.children[n].removeStageReference();this.stage=null};n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}var t;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();n.spriteBatch.start()}else for(t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n)}};n.DisplayObjectContainer.prototype._renderCanvas=function(n){if(this.visible!==!1&&this.alpha!==0){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}this._mask&&n.maskManager.pushMask(this._mask,n);for(var t=0;t<this.children.length;t++)this.children[t]._renderCanvas(n);this._mask&&n.maskManager.popMask(n)}};n.Sprite=function(t){n.DisplayObjectContainer.call(this);this.anchor=new n.Point;this.texture=t||n.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL;this.shader=null;this.texture.baseTexture.hasLoaded&&this.onTextureUpdate();this.renderable=!0};n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Sprite.prototype.constructor=n.Sprite;Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Sprite.prototype.setTexture=function(n){this.texture=n;this.cachedTint=16777215};n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)};n.Sprite.prototype.getBounds=function(n){var ut=this.texture.frame.width,ft=this.texture.frame.height,l=ut*(1-this.anchor.x),a=ut*-this.anchor.x,v=ft*(1-this.anchor.y),y=ft*-this.anchor.y,s=n||this.worldTransform,f=s.a,p=s.b,w=s.c,e=s.d,h=s.tx,c=s.ty,r=-Infinity,u=-Infinity,t=Infinity,i=Infinity,o;if(p===0&&w===0)f<0&&(f*=-1),e<0&&(e*=-1),t=f*a+h,r=f*l+h,i=e*y+c,u=e*v+c;else{var b=f*a+w*y+h,k=e*y+p*a+c,d=f*l+w*y+h,g=e*y+p*l+c,nt=f*l+w*v+h,tt=e*v+p*l+c,it=f*a+w*v+h,rt=e*v+p*a+c;t=b<t?b:t;t=d<t?d:t;t=nt<t?nt:t;t=it<t?it:t;i=k<i?k:i;i=g<i?g:i;i=tt<i?tt:i;i=rt<i?rt:i;r=b>r?b:r;r=d>r?d:r;r=nt>r?nt:r;r=it>r?it:r;u=k>u?k:u;u=g>u?g:u;u=tt>u?tt:u;u=rt>u?rt:u}return o=this._bounds,o.x=t,o.width=r-t,o.y=i,o.height=u-i,this._currentBounds=o,o};n.Sprite.prototype._renderWebGL=function(n){var t,i;if(this.visible&&!(this.alpha<=0)&&this.renderable)if(this._mask||this._filters){for(i=n.spriteBatch,this._filters&&(i.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),n.maskManager.pushMask(this.mask,n),i.start()),i.render(this),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n);i.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();i.start()}else for(n.spriteBatch.render(this),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n)};n.Sprite.prototype._renderCanvas=function(t){var i,r,u,f;if(this.visible!==!1&&this.alpha!==0&&this.renderable!==!1&&!(this.texture.crop.width<=0)&&!(this.texture.crop.height<=0)){for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid&&(i=this.texture.baseTexture.resolution/t.resolution,t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR),r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),r=r|0,u=u|0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),this.tint!==16777215?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)),f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};n.Sprite.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new n.Sprite(i)};n.Sprite.fromImage=function(t,i,r){var u=n.Texture.fromImage(t,i,r);return new n.Sprite(u)};n.SpriteBatch=function(t){n.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=!1};n.SpriteBatch.prototype=Object.create(n.DisplayObjectContainer.prototype);n.SpriteBatch.prototype.constructor=n.SpriteBatch;n.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new n.WebGLFastSpriteBatch(t);this.ready=!0};n.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(n.gl),this.fastSpriteBatch.gl!==n.gl&&this.fastSpriteBatch.setContext(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())};n.SpriteBatch.prototype._renderCanvas=function(n){var u,f,e,o,t,s,i,r;if(this.visible&&!(this.alpha<=0)&&this.children.length)for(u=n.context,u.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform(),f=this.worldTransform,e=!0,o=0;o<this.children.length;o++)(t=this.children[o],t.visible)&&(s=t.texture,i=s.frame,u.globalAlpha=this.worldAlpha*t.alpha,t.rotation%(Math.PI*2)==0?(e&&(u.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e=!1),u.drawImage(s.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width*t.scale.x+t.position.x+.5|0,t.anchor.y*-i.height*t.scale.y+t.position.y+.5|0,i.width*t.scale.x,i.height*t.scale.y)):(e||(e=!0),t.displayObjectUpdateTransform(),r=t.worldTransform,n.roundPixels?u.setTransform(r.a,r.b,r.c,r.d,r.tx|0,r.ty|0):u.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),u.drawImage(s.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width+.5|0,t.anchor.y*-i.height+.5|0,i.width,i.height)))};n.Text=function(t,i){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;n.Sprite.call(this,n.Texture.fromCanvas(this.canvas));this.setText(t);this.setStyle(i)};n.Text.prototype=Object.create(n.Sprite.prototype);n.Text.prototype.constructor=n.Text;Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;n.dropShadow=n.dropShadow||!1;n.dropShadowAngle=n.dropShadowAngle||Math.PI/6;n.dropShadowDistance=n.dropShadowDistance||4;n.dropShadowColor=n.dropShadowColor||"black";this.style=n;this.dirty=!0};n.Text.prototype.setText=function(n){this.text=n.toString()||" ";this.dirty=!0};n.Text.prototype.updateText=function(){var o,n,h,c,e,l,t,f,a,v;this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;o=this.text;this.style.wordWrap&&(o=this.wordWrap(this.text));var i=o.split(/(?:\r\n|\r|\n)/),u=[],r=0,s=this.determineFontProperties(this.style.font);for(n=0;n<i.length;n++)h=this.context.measureText(i[n]).width,u[n]=h,r=Math.max(r,h);if(c=r+this.style.strokeThickness,this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.width=(c+this.context.lineWidth)*this.resolution,e=s.fontSize+this.style.strokeThickness,l=e*i.length,this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.style.dropShadow)for(this.context.fillStyle=this.style.dropShadowColor,a=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,v=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,this.style.align==="right"?t+=r-u[n]:this.style.align==="center"&&(t+=(r-u[n])/2),this.style.fill&&this.context.fillText(i[n],t+a,f+v);for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,this.style.align==="right"?t+=r-u[n]:this.style.align==="center"&&(t+=(r-u[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t,f),this.style.fill&&this.context.fillText(i[n],t,f);this.updateTexture()};n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};n.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1);n.Sprite.prototype._renderWebGL.call(this,t)};n.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1);n.Sprite.prototype._renderCanvas.call(this,t)};n.Text.prototype.determineFontProperties=function(t){var r=n.Text.fontPropertiesCache[t],a,i;if(!r){r={};a=n.Text.fontPropertiesCanvas;i=n.Text.fontPropertiesContext;i.font=t;var c=Math.ceil(i.measureText("|MÉq").width),u=Math.ceil(i.measureText("|MÉq").width),l=2*u;u=u*1.4|0;a.width=c;a.height=l;i.fillStyle="#f00";i.fillRect(0,0,c,l);i.font=t;i.textBaseline="alphabetic";i.fillStyle="#000";i.fillText("|MÉq",0,u);for(var v=i.getImageData(0,0,c,l).data,y=v.length,o=c*4,e,s=0,h=!1,f=0;f<u;f++){for(e=0;e<o;e+=4)if(v[s+e]!==255){h=!0;break}if(h)break;else s+=o}for(r.ascent=u-f,s=y-o,h=!1,f=l;f>u;f--){for(e=0;e<o;e+=4)if(v[s+e]!==255){h=!0;break}if(h)break;else s-=o}r.descent=f-u;r.descent+=6;r.fontSize=r.ascent+r.descent;n.Text.fontPropertiesCache[t]=r}return r};n.Text.prototype.wordWrap=function(n){for(var f,r,t,o,s,i="",e=n.split("\n"),u=0;u<e.length;u++){for(f=this.style.wordWrapWidth,r=e[u].split(" "),t=0;t<r.length;t++)o=this.context.measureText(r[t]).width,s=o+this.context.measureText(" ").width,t===0||s>f?(t>0&&(i+="\n"),i+=r[t],f=this.style.wordWrapWidth-o):(f-=s,i+=" "+r[t]);u<e.length-1&&(i+="\n")}return i};n.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.getBounds.call(this,t)};n.Text.prototype.destroy=function(n){this.context=null;this.canvas=null;this.texture.destroy(n===undefined?!0:n)};n.Text.fontPropertiesCache={};n.Text.fontPropertiesCanvas=document.createElement("canvas");n.Text.fontPropertiesContext=n.Text.fontPropertiesCanvas.getContext("2d");n.BitmapText=function(t,i){n.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this.maxWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(t);this.setStyle(i);this.updateText();this.dirty=!1};n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.BitmapText.prototype.setText=function(n){this.text=n||" ";this.dirty=!0};n.BitmapText.prototype.setStyle=function(t){t=t||{};t.align=t.align||"left";this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1];this.fontSize=i.length>=2?parseInt(i[i.length-2],10):n.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=t.tint};n.BitmapText.prototype.updateText=function(){for(var v,e,p,y,k,d,r,w,c=n.BitmapText.fonts[this.fontName],i=new n.Point,s=null,f=[],u=0,l=[],a=0,h=this.fontSize/c.size,o=0,t=0;t<this.text.length;t++){if(v=this.text.charCodeAt(t),o=/(\s)/.test(this.text.charAt(t))?t:o,/(?:\r\n|\r|\n)/.test(this.text.charAt(t))){l.push(i.x);u=Math.max(u,i.x);a++;i.x=0;i.y+=c.lineHeight;s=null;continue}if(o!==-1&&this.maxWidth>0&&i.x*h>this.maxWidth){f.splice(o,t-o);t=o;o=-1;l.push(lastLineWidth);u=Math.max(u,lastLineWidth);a++;i.x=0;i.y+=c.lineHeight;s=null;continue}(e=c.chars[v],e)&&(s&&e.kerning[s]&&(i.x+=e.kerning[s]),f.push({texture:e.texture,line:a,charCode:v,position:new n.Point(i.x+e.xOffset,i.y+e.yOffset)}),i.x+=e.xAdvance,s=v)}for(l.push(i.x),u=Math.max(u,i.x),p=[],t=0;t<=a;t++)y=0,this.style.align==="right"?y=u-l[t]:this.style.align==="center"&&(y=(u-l[t])/2),p.push(y);var g=this.children.length,b=f.length,nt=this.tint||16777215;for(this.textWidth=u*h,this.textHeight=(i.y+c.lineHeight)*h,k=this.textWidth*this.anchor.x,d=this.textHeight*this.anchor.y,t=0;t<b;t++)r=t<g?this.children[t]:this._pool.pop(),r?r.setTexture(f[t].texture):r=new n.Sprite(f[t].texture),r.position.x=(f[t].position.x+p[f[t].line])*h-k,r.position.y=f[t].position.y*h-d,r.scale.x=r.scale.y=h,r.tint=nt,r.parent||this.addChild(r);while(this.children.length>b)w=this.getChildAt(this.children.length-1),this._pool.push(w),this.removeChild(w)};n.BitmapText.prototype.updateTransform=function(){(this.dirty||!this.anchor.equals(this._prevAnchor))&&(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor));n.DisplayObjectContainer.prototype.updateTransform.call(this)};n.BitmapText.fonts={};n.Stage=function(t){n.DisplayObjectContainer.call(this);this.worldTransform=new n.Matrix;this.stage=this;this.setBackgroundColor(t)};n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0;n<this.children.length;n++)this.children[n].updateTransform()};n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0;this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i;this.backgroundColorString="#"+i};n.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]};n.rgb2hex=function(n){return(n[0]*255<<16)+(n[1]*255<<8)+n[2]*255};n.canUseNewCanvasBlendModes=function(){var r,t,n,i;if(typeof document=="undefined")return!1;var u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",f="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",e=new Image;return e.src=u+"AP804Oa6"+f,r=new Image,r.src=u+"/wCKxvRF"+f,t=document.createElement("canvas"),t.width=6,t.height=1,n=t.getContext("2d"),n.globalCompositeOperation="multiply",n.drawImage(e,0,0),n.drawImage(r,2,0),i=n.getImageData(2,0,1,1).data,i[0]===255&&i[1]===0&&i[2]===0};n.getNextPowerOfTwo=function(n){if(n>0&&(n&n-1)==0)return n;for(var t=1;t<n;)t<<=1;return t};n.isPowerOfTwo=function(n,t){return n>0&&(n&n-1)==0&&t>0&&(t&t-1)==0};n.PolyK={};n.PolyK.Triangulate=function(t){var a=!0,e=t.length>>1,o,r,i,u,l,f;if(e<3)return[];for(o=[],r=[],i=0;i<e;i++)r.push(i);for(i=0,u=e;u>3;){var s=r[(i+0)%u],h=r[(i+1)%u],c=r[(i+2)%u],y=t[2*s],p=t[2*s+1],w=t[2*h],b=t[2*h+1],k=t[2*c],d=t[2*c+1],v=!1;if(n.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,l=0;l<u;l++)if((f=r[l],f!==s&&f!==h&&f!==c)&&n.PolyK._PointInTriangle(t[2*f],t[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)o.push(s,h,c),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u)if(a){for(o=[],r=[],i=0;i<e;i++)r.push(i);i=0;u=e;a=!1}else return null}return o.push(r[0],r[1],r[2]),o};n.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1};n.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e};n.initDefaultShaders=function(){};n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)};n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)};n._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return(n.shaderSource(r,u),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))?(window.console.log(n.getShaderInfoLog(r)),null):r};n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),u};n.PixiShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=!0;this.dirty=!0;this.attributes=[];this.init()};n.PixiShader.prototype.constructor=n.PixiShader;n.PixiShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),r;t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms();this.program=i};n.PixiShader.prototype.initUniforms=function(){var i,t,r,n;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,n==="sampler2D"?(t._init=!1,t.value!==null&&this.initSampler2D(t)):n==="mat2"||n==="mat3"||n==="mat4"?(t.glMatrix=!0,t.glValueLength=1,n==="mat2"?t.glFunc=i.uniformMatrix2fv:n==="mat3"?t.glFunc=i.uniformMatrix3fv:n==="mat4"&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength=n==="2f"||n==="2i"?2:n==="3f"||n==="3i"?3:n==="4f"||n==="4i"?4:1)};n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount);n._init=!0;this.textureCount++}};n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],t.glValueLength===1?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):t.glValueLength===2?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):t.glValueLength===3?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):t.glValueLength===4?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):t.type==="sampler2D"&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?n.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))};n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];n.PixiFastShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};n.PixiFastShader.prototype.constructor=n.PixiFastShader;n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.uMatrix=t.getUniformLocation(i,"uMatrix");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord");this.aScale=t.getAttribLocation(i,"aScale");this.aRotation=t.getAttribLocation(i,"aRotation");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=i};n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.StripShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};n.StripShader.prototype.constructor=n.StripShader;n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.PrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};n.PrimitiveShader.prototype.constructor=n.PrimitiveShader;n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.colorAttribute=t.getAttribLocation(i,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.ComplexPrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};n.ComplexPrimitiveShader.prototype.constructor=n.ComplexPrimitiveShader;n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.color=t.getUniformLocation(i,"color");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.WebGLGraphics=function(){};n.WebGLGraphics.renderGraphics=function(t,i){var r=i.gl,s=i.projection,h=i.offset,u=i.shaderManager.primitiveShader,f,o,e;for(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),o=t._webGL[r.id],e=0;e<o.data.length;e++)o.data[e].mode===1?(f=o.data[e],i.stencilManager.pushStencil(t,f,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(f.indices.length-4)*2),i.stencilManager.popStencil(t,f,i)):(f=o.data[e],i.shaderManager.setShader(u),u=i.shaderManager.primitiveShader,r.uniformMatrix3fv(u.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(u.flipY,1),r.uniform2f(u.projectionVector,s.x,-s.y),r.uniform2f(u.offsetVector,-h.x,-h.y),r.uniform3fv(u.tintColor,n.hex2rgb(t.tint)),r.uniform1f(u.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,f.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,f.indices.length,r.UNSIGNED_SHORT,0))};n.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r,s;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),n.WebGLGraphics.graphicsDataPool.push(o);u.data=[];u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.Graphics.POLY?(r.points=r.shape.points.slice(),r.shape.closed&&(r.points[0]!==r.points[r.points.length-2]||r.points[1]!==r.points[r.points.length-1])&&r.points.push(r.points[0],r.points[1]),r.fill&&r.points.length>=6&&(r.points.length<12?(f=n.WebGLGraphics.switchMode(u,0),s=n.WebGLGraphics.buildPoly(r,f),s||(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))):(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))),r.lineWidth>0&&(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildLine(r,f))):(f=n.WebGLGraphics.switchMode(u,0),r.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(r,f):r.type===n.Graphics.CIRC||r.type===n.Graphics.ELIP?n.WebGLGraphics.buildCircle(r,f):r.type===n.Graphics.RREC&&n.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()};n.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||i===1)&&(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r};n.WebGLGraphics.buildRectangle=function(t,i){var s=t.shape,r=s.x,u=s.y,h=s.width,c=s.height,p;if(t.fill){var y=n.hex2rgb(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u);f.push(l,a,v,e);f.push(r+h,u);f.push(l,a,v,e);f.push(r,u+c);f.push(l,a,v,e);f.push(r+h,u+c);f.push(l,a,v,e);w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],n.WebGLGraphics.buildLine(t,i),t.points=p)};n.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.shape,u=l.x,f=l.y,s=l.width,h=l.height,o=l.radius,r=[],b;if(r.push(u,f+o),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.hex2rgb(t.fillColor),y=t.fillAlpha,k=p[0]*y,d=p[1]*y,g=p[2]*y,w=i.points,a=i.indices,v=w.length/6,c=n.PolyK.Triangulate(r),e=0,e=0;e<c.length;e+=3)a.push(c[e]+v),a.push(c[e]+v),a.push(c[e+1]+v),a.push(c[e+2]+v),a.push(c[e+2]+v);for(e=0;e<r.length;e++)w.push(r[e],r[++e],k,d,g,y)}t.lineWidth&&(b=t.points,t.points=r,n.WebGLGraphics.buildLine(t,i),t.points=b)};n.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var h,c,l,a,v,y,p=20,w=[],e=0,s=0;s<=p;s++)e=s/p,h=o(n,i,e),c=o(t,r,e),l=o(i,u,e),a=o(r,f,e),v=o(h,l,e),y=o(c,a,e),w.push(v,y);return w};n.WebGLGraphics.buildCircle=function(t,i){var u=t.shape,c=u.x,l=u.y,e,o,d;t.type===n.Graphics.CIRC?(e=u.radius,o=u.radius):(e=u.width,o=u.height);var a=40,s=Math.PI*2/a,r=0;if(t.fill){var v=n.hex2rgb(t.fillColor),f=t.fillAlpha,w=v[0]*f,b=v[1]*f,k=v[2]*f,y=i.points,p=i.indices,h=y.length/6;for(p.push(h),r=0;r<a+1;r++)y.push(c,l,w,b,k,f),y.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o,w,b,k,f),p.push(h++,h++);p.push(h-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;r<a+1;r++)t.points.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o);n.WebGLGraphics.buildLine(t,i);t.points=d}};n.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,g,ht,ct;if(r.length!==0){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new n.Point(r[0],r[1]);g=new n.Point(r[r.length-2],r[r.length-1]);it.x===g.x&&it.y===g.y&&(r=r.slice(),r.pop(),r.pop(),g=new n.Point(r[r.length-2],r[r.length-1]),ht=g.x+(it.x-g.x)*.5,ct=g.y+(it.y-g.y)*.5,r.unshift(ht,ct),r.push(ht,ct));var s=i.points,lt=i.indices,rt=r.length/2,gt=r.length,at=s.length/6,p=t.lineWidth/2,vt=n.hex2rgb(t.lineColor),l=t.lineAlpha,a=vt[0]*l,v=vt[1]*l,y=vt[2]*l,ut,ft,w,b,e,o,ot,st,u,f,k,d,nt,tt,yt,pt,wt,bt,kt,dt,et,ni,c;for(w=r[0],b=r[1],e=r[2],o=r[3],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(w-u,b-f,a,v,y,l),s.push(w+u,b+f,a,v,y,l),h=1;h<rt-1;h++){if(w=r[(h-1)*2],b=r[(h-1)*2+1],e=r[h*2],o=r[h*2+1],ot=r[(h+1)*2],st=r[(h+1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,k=-(o-st),d=e-ot,c=Math.sqrt(k*k+d*d),k/=c,d/=c,k*=p,d*=p,yt=-f+b-(-f+o),pt=-u+e-(-u+w),wt=(-u+w)*(-f+o)-(-u+e)*(-f+b),bt=-d+st-(-d+o),kt=-k+e-(-k+ot),dt=(-k+ot)*(-d+o)-(-k+e)*(-d+st),et=yt*kt-bt*pt,Math.abs(et)<.1){et+=10.1;s.push(e-u,o-f,a,v,y,l);s.push(e+u,o+f,a,v,y,l);continue}ut=(pt*dt-kt*wt)/et;ft=(bt*wt-yt*dt)/et;ni=(ut-e)*(ut-e)+(ft-o)+(ft-o);ni>19600?(nt=u-k,tt=f-d,c=Math.sqrt(nt*nt+tt*tt),nt/=c,tt/=c,nt*=p,tt*=p,s.push(e-nt,o-tt),s.push(a,v,y,l),s.push(e+nt,o+tt),s.push(a,v,y,l),s.push(e-nt,o-tt),s.push(a,v,y,l),gt++):(s.push(ut,ft),s.push(a,v,y,l),s.push(e-(ut-e),o-(ft-o)),s.push(a,v,y,l))}for(w=r[(rt-2)*2],b=r[(rt-2)*2+1],e=r[(rt-1)*2],o=r[(rt-1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(e-u,o-f),s.push(a,v,y,l),s.push(e+u,o+f),s.push(a,v,y,l),lt.push(at),h=0;h<gt;h++)lt.push(at++);lt.push(at-1)}};n.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,r,a;if(!(u.length<6)){l=i.indices;i.points=u;i.alpha=t.fillAlpha;i.color=n.hex2rgb(t.fillColor);var f=Infinity,e=-Infinity,o=Infinity,s=-Infinity,h,c;for(r=0;r<u.length;r+=2)h=u[r],c=u[r+1],f=h<f?h:f,e=h>e?h:e,o=c<o?c:o,s=c>s?c:s;for(u.push(f,o,e,o,e,s,f,s),a=u.length/2,r=0;r<a;r++)l.push(r)}};n.WebGLGraphics.buildPoly=function(t,i){var e=t.points,f,r;if(!(e.length<6)){var c=i.points,o=i.indices,l=e.length/2,h=n.hex2rgb(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.PolyK.Triangulate(e);if(!u)return!1;for(f=c.length/6,r=0,r=0;r<u.length;r+=3)o.push(u[r]+f),o.push(u[r]+f),o.push(u[r+1]+f),o.push(u[r+2]+f),o.push(u[r+2]+f);for(r=0;r<l;r++)c.push(e[r*2],e[r*2+1],a,v,y,s);return!0}};n.WebGLGraphics.graphicsDataPool=[];n.WebGLGraphicsData=function(n){this.gl=n;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.mode=1;this.alpha=1;this.dirty=!0};n.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};n.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new n.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new n.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=!1};n.glContexts=[];n.instances=[];n.WebGLRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)typeof r[u]=="undefined"&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.defaultRenderer=this);this.type=n.WEBGL_RENDERER;this.resolution=r.resolution;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.preserveDrawingBuffer=r.preserveDrawingBuffer;this.clearBeforeRender=r.clearBeforeRender;this.width=t||800;this.height=i||600;this.view=r.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1);this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer};this.projection=new n.Point;this.offset=new n.Point(0,0);this.shaderManager=new n.WebGLShaderManager;this.spriteBatch=new n.WebGLSpriteBatch;this.maskManager=new n.WebGLMaskManager;this.filterManager=new n.WebGLFilterManager;this.stencilManager=new n.WebGLStencilManager;this.blendModeManager=new n.WebGLBlendModeManager;this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};n.WebGLRenderer.prototype.constructor=n.WebGLRenderer;n.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=n.WebGLRenderer.glContextId++;n.glContexts[this.glContextId]=t;n.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};n.WebGLRenderer.prototype.render=function(n){if(!this.contextLost){this.__stage!==n&&(this.__stage=n);n.updateTransform();var t=this.gl;t.viewport(0,0,this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,null);this.clearBeforeRender&&(this.transparent?t.clearColor(0,0,0,0):t.clearColor(n.backgroundColorSplit[0],n.backgroundColorSplit[1],n.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT));this.renderDisplayObject(n,this.projection)}};n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=r?-1:1;this.renderSession.projection=i;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,r);t._renderWebGL(this.renderSession);this.spriteBatch.end()};n.WebGLRenderer.prototype.resize=function(n,t){this.width=n*this.resolution;this.height=t*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};n.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&n.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}};n.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault();this.contextLost=!0};n.WebGLRenderer.prototype.handleContextRestored=function(){var t,i;this.initContext();for(t in n.TextureCache)i=n.TextureCache[t].baseTexture,i._glTextures=[];this.contextLost=!1};n.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);n.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;n.instances[this.glContextId]=null;n.WebGLRenderer.glContextId--};n.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],n.blendModesWebGL[n.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])};n.WebGLRenderer.glContextId=0;n.WebGLBlendModeManager=function(){this.currentBlendMode=99999};n.WebGLBlendModeManager.prototype.constructor=n.WebGLBlendModeManager;n.WebGLBlendModeManager.prototype.setContext=function(n){this.gl=n};n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0};n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};n.WebGLMaskManager=function(){};n.WebGLMaskManager.prototype.constructor=n.WebGLMaskManager;n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n};n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id].data.length)&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)};n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)};n.WebGLMaskManager.prototype.destroy=function(){this.gl=null};n.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n};n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i);this.stencilStack.length===0&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(t);u=this.count;r.colorMask(!1,!1,!1,!1);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);t.mode===1?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255));r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++};n.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var u=this.gl,e=r.projection,o=r.offset,f;i.mode===1?(f=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(f),u.uniform1f(f.flipY,r.flipY),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform3fv(f.color,i.color),u.uniform1f(f.alpha,t.worldAlpha*i.alpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,8,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(f=r.shaderManager.primitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform1f(f.flipY,r.flipY),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform1f(f.alpha,t.worldAlpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,24,0),u.vertexAttribPointer(f.colorAttribute,4,u.FLOAT,!1,24,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer))};n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;this.stencilStack.pop();this.count--;this.stencilStack.length===0?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),t.mode===1?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))};n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};n.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var n=0;n<this.maxAttibs;n++)this.attribState[n]=!1;this.stack=[]};n.WebGLShaderManager.prototype.constructor=n.WebGLShaderManager;n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new n.PrimitiveShader(t);this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t);this.defaultShader=new n.PixiShader(t);this.fastShader=new n.PixiFastShader(t);this.stripShader=new n.StripShader(t);this.setShader(this.defaultShader)};n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))};n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)};n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};n.WebGLSpriteBatch=function(){var u,r,t,i;for(this.vertSize=5,this.size=2e3,u=this.size*16*this.vertSize,r=this.size*6,this.vertices=new n.ArrayBuffer(u),this.positions=new n.Float32Array(this.vertices),this.colors=new n.Uint32Array(this.vertices),this.indices=new n.Uint16Array(r),this.lastIndexCount=0,t=0,i=0;t<r;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new n.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};n.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var i=new n.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc;i.uniforms={};i.init();this.defaultShader.shaders[t.id]=i};n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};n.WebGLSpriteBatch.prototype.end=function(){this.flush()};n.WebGLSpriteBatch.prototype.render=function(n){var r=n.texture,e,b,k,o,u,s,f,w,nt;if(this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=r.baseTexture),e=r._uvs,e){b=n.anchor.x;k=n.anchor.y;r.trim?(w=r.trim,u=w.x-b*w.width,o=u+r.crop.width,f=w.y-k*w.height,s=f+r.crop.height):(o=r.frame.width*(1-b),u=r.frame.width*-b,s=r.frame.height*(1-k),f=r.frame.height*-k);var t=this.currentBatchSize*4*this.vertSize,d=r.baseTexture.resolution,p=n.worldTransform,h=p.a/d,c=p.b/d,l=p.c/d,a=p.d/d,v=p.tx,y=p.ty,g=this.colors,i=this.positions;this.renderSession.roundPixels?(i[t]=h*u+l*f+v|0,i[t+1]=a*f+c*u+y|0,i[t+5]=h*o+l*f+v|0,i[t+6]=a*f+c*o+y|0,i[t+10]=h*o+l*s+v|0,i[t+11]=a*s+c*o+y|0,i[t+15]=h*u+l*s+v|0,i[t+16]=a*s+c*u+y|0):(i[t]=h*u+l*f+v,i[t+1]=a*f+c*u+y,i[t+5]=h*o+l*f+v,i[t+6]=a*f+c*o+y,i[t+10]=h*o+l*s+v,i[t+11]=a*s+c*o+y,i[t+15]=h*u+l*s+v,i[t+16]=a*s+c*u+y);i[t+2]=e.x0;i[t+3]=e.y0;i[t+7]=e.x1;i[t+8]=e.y1;i[t+12]=e.x2;i[t+13]=e.y2;i[t+17]=e.x3;i[t+18]=e.y3;nt=n.tint;g[t+4]=g[t+9]=g[t+14]=g[t+19]=(nt>>16)+(nt&65280)+((nt&255)<<16)+(n.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=n}};n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var f=t.tilingTexture,r;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture);t._uvs||(t._uvs=new n.TextureUvs);r=t._uvs;t.tilePosition.x%=f.baseTexture.width*t.tileScaleOffset.x;t.tilePosition.y%=f.baseTexture.height*t.tileScaleOffset.y;var o=t.tilePosition.x/(f.baseTexture.width*t.tileScaleOffset.x),s=t.tilePosition.y/(f.baseTexture.height*t.tileScaleOffset.y),it=t.width/f.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),rt=t.height/f.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-o;r.y0=0-s;r.x1=1*it-o;r.y1=0-s;r.x2=1*it-o;r.y2=1*rt-s;r.x3=0-o;r.y3=1*rt-s;var tt=t.tint,h=(tt>>16)+(tt&65280)+((tt&255)<<16)+(t.alpha*255<<24),u=this.positions,c=this.colors,ut=t.width,ft=t.height,et=t.anchor.x,ot=t.anchor.y,l=ut*(1-et),a=ut*-et,v=ft*(1-ot),y=ft*-ot,i=this.currentBatchSize*4*this.vertSize,p=f.baseTexture.resolution,e=t.worldTransform,w=e.a/p,b=e.b/p,k=e.c/p,d=e.d/p,g=e.tx,nt=e.ty;u[i++]=w*a+k*y+g;u[i++]=d*y+b*a+nt;u[i++]=r.x0;u[i++]=r.y0;c[i++]=h;u[i++]=w*l+k*y+g;u[i++]=d*y+b*l+nt;u[i++]=r.x1;u[i++]=r.y1;c[i++]=h;u[i++]=w*l+k*v+g;u[i++]=d*v+b*l+nt;u[i++]=r.x2;u[i++]=r.y2;c[i++]=h;u[i++]=w*a+k*v+g;u[i++]=d*v+b*a+nt;u[i++]=r.x3;u[i++]=r.y3;c[i++]=h;this.sprites[this.currentBatchSize++]=t};n.WebGLSpriteBatch.prototype.flush=function(){var t,i,f,k,u,d,w,b;if(this.currentBatchSize!==0){t=this.gl;this.dirty&&(this.dirty=!1,t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=this.defaultShader.shaders[t.id],f=this.vertSize*4,t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,f,0),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,f,8),t.vertexAttribPointer(i.colorAttribute,4,t.UNSIGNED_BYTE,!0,f,16));this.currentBatchSize>this.size*.5?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(k=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,k));var h,c,l,e=0,a=0,o=null,v=this.renderSession.blendModeManager.currentBlendMode,r=null,y=!1,p=!1,s;for(u=0,d=this.currentBatchSize;u<d;u++)s=this.sprites[u],h=s.texture.baseTexture,c=s.blendMode,l=s.shader||this.defaultShader,y=v!==c,p=r!==l,(o!==h||y||p)&&(this.renderBatch(o,e,a),a=u,e=0,o=h,y&&(v=c,this.renderSession.blendModeManager.setBlendMode(v)),p&&(r=l,i=r.shaders[t.id],i||(i=new n.PixiShader(t),i.fragmentSrc=r.fragmentSrc,i.uniforms=r.uniforms,i.init(),r.shaders[t.id]=i),this.renderSession.shaderManager.setShader(i),i.dirty&&i.syncUniforms(),w=this.renderSession.projection,t.uniform2f(i.projectionVector,w.x,w.y),b=this.renderSession.offset,t.uniform2f(i.offsetVector,b.x,b.y))),e++;this.renderBatch(o,e,a);this.currentBatchSize=0}};n.WebGLSpriteBatch.prototype.renderBatch=function(n,t,i){if(t!==0){var r=this.gl;n._dirty[r.id]?this.renderSession.renderer.updateTexture(n):r.bindTexture(r.TEXTURE_2D,n._glTextures[r.id]);r.drawElements(r.TRIANGLES,t*6,r.UNSIGNED_SHORT,i*12);this.renderSession.drawCount++}};n.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0};n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};n.WebGLFastSpriteBatch=function(t){var f,u,i,r;for(this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize,f=this.size*4*this.vertSize,u=this.maxSize*6,this.vertices=new n.Float32Array(f),this.indices=new n.Uint16Array(u),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,i=0,r=0;i<u;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};n.WebGLFastSpriteBatch.prototype.constructor=n.WebGLFastSpriteBatch;n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)};n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=n.worldTransform.toArray(!0);this.start()};n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.render=function(n){var r=n.children,t=r[0],i,u;if(t.texture._uvs){for(this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode)),i=0,u=r.length;i<u;i++)this.renderSprite(r[i]);this.flush()}};n.WebGLFastSpriteBatch.prototype.renderSprite=function(n){var r,t,h,c,o,u,s,f,i,e;n.visible&&(n.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=n.texture.baseTexture,n.texture._uvs))&&(t=this.vertices,r=n.texture._uvs,h=n.texture.frame.width,c=n.texture.frame.height,n.texture.trim?(e=n.texture.trim,u=e.x-n.anchor.x*e.width,o=u+n.texture.crop.width,f=e.y-n.anchor.y*e.height,s=f+n.texture.crop.height):(o=n.texture.frame.width*(1-n.anchor.x),u=n.texture.frame.width*-n.anchor.x,s=n.texture.frame.height*(1-n.anchor.y),f=n.texture.frame.height*-n.anchor.y),i=this.currentBatchSize*4*this.vertSize,t[i++]=u,t[i++]=f,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x0,t[i++]=r.y1,t[i++]=n.alpha,t[i++]=o,t[i++]=f,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x1,t[i++]=r.y1,t[i++]=n.alpha,t[i++]=o,t[i++]=s,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x2,t[i++]=r.y2,t[i++]=n.alpha,t[i++]=u,t[i++]=s,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x3,t[i++]=r.y3,t[i++]=n.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())};n.WebGLFastSpriteBatch.prototype.flush=function(){var n,t;this.currentBatchSize!==0&&(n=this.gl,this.currentBaseTexture._glTextures[n.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,n),n.bindTexture(n.TEXTURE_2D,this.currentBaseTexture._glTextures[n.id]),this.currentBatchSize>this.size*.5?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(t=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,t)),n.drawElements(n.TRIANGLES,this.currentBatchSize*6,n.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)};n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);i=this.renderSession.projection;n.uniform2f(this.shader.projectionVector,i.x,i.y);n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);t=this.vertSize*4;n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0);n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8);n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16);n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24);n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28);n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36)};n.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};n.WebGLFilterManager.prototype.constructor=n.WebGLFilterManager;n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n;this.texturePool=[];this.initShaderBuffers()};n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n;this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=t};n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds();this.filterStack.push(t);s=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;u=this.texturePool.pop();u?u.resize(this.width,this.height):u=new n.FilterTexture(this.gl,this.width,this.height);r.bindTexture(r.TEXTURE_2D,u.texture);i=t._filterArea;f=s.padding;i.x-=f;i.y-=f;i.width+=f*2;i.height+=f*2;i.x<0&&(i.x=0);i.width>this.width&&(i.width=this.width);i.y<0&&(i.y=0);i.height>this.height&&(i.height=this.height);r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer);r.viewport(0,0,i.width,i.height);e.x=i.width/2;e.y=-i.height/2;o.x=-i.x;o.y=-i.y;r.colorMask(!0,!0,!0,!0);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);t._glFilterTexture=u};n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,s=r._glFilterTexture,p=this.renderSession.projection,w=this.renderSession.offset,f,u,h,b,k,d,y,e,o;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),f=s,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width,this.height)),u.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),h=0;h<r.filterPasses.length-1;h++)b=r.filterPasses[h],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f.texture),this.applyFilterPass(b,i,i.width,i.height),k=f,f=u,u=k;t.enable(t.BLEND);s=f;this.texturePool.push(u)}d=r.filterPasses[r.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var c=this.width,l=this.height,a=0,v=0,g=this.buffer;this.filterStack.length===0?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,c=i.width,l=i.height,a=i.x,v=i.y,g=y._glFilterTexture.frameBuffer);p.x=c/2;p.y=-l/2;w.x=a;w.y=v;i=r._filterArea;e=i.x-a;o=i.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=e;this.vertexArray[1]=o+i.height;this.vertexArray[2]=e+i.width;this.vertexArray[3]=o+i.height;this.vertexArray[4]=e;this.vertexArray[5]=o;this.vertexArray[6]=e+i.width;this.vertexArray[7]=o;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,c*this.renderSession.resolution,l*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,g);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);this.applyFilterPass(d,i,c,l);this.texturePool.push(s);r._glFilterTexture=null};n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(),t.shaders[f.id]=e);this.renderSession.shaderManager.setShader(e);f.uniform2f(e.projectionVector,r/2,-u/2);f.uniform2f(e.offsetVector,0,0);t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);this.renderSession.drawCount++};n.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new n.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new n.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new n.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null;n.deleteBuffer(this.vertexBuffer);n.deleteBuffer(this.uvBuffer);n.deleteBuffer(this.colorBuffer);n.deleteBuffer(this.indexBuffer)};n.FilterTexture=function(t,i,r,u){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();u=u||n.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(i,r)};n.FilterTexture.prototype.constructor=n.FilterTexture;n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)};n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n;this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}};n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer);n.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};n.CanvasBuffer=function(n,t){this.width=n;this.height=t;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=n;this.canvas.height=t};n.CanvasBuffer.prototype.constructor=n.CanvasBuffer;n.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n;this.height=this.canvas.height=t};n.CanvasMaskManager=function(){};n.CanvasMaskManager.prototype.constructor=n.CanvasMaskManager;n.CanvasMaskManager.prototype.pushMask=function(t,i){var f=i.context;f.save();var e=t.alpha,r=t.worldTransform,u=i.resolution;f.setTransform(r.a*u,r.b*u,r.c*u,r.d*u,r.tx*u,r.ty*u);n.CanvasGraphics.renderGraphicsMask(t,f);f.clip();t.worldAlpha=e};n.CanvasMaskManager.prototype.popMask=function(n){n.context.restore()};n.CanvasTinter=function(){};n.CanvasTinter.getTintedTexture=function(t,i){var f=t.texture,r=n.CanvasTinter.canvas||document.createElement("canvas"),u;return n.CanvasTinter.tintMethod(f,i,r),n.CanvasTinter.convertTintToImage?(u=new Image,u.src=r.toDataURL()):n.CanvasTinter.canvas=null,r};n.CanvasTinter.tintWithMultiply=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width;i.height=r.height;u.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="multiply";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithOverlay=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width;i.height=r.height;u.globalCompositeOperation="copy";u.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithPerPixel=function(t,i,r){var o=r.getContext("2d"),u=t.crop,f,s;r.width=u.width;r.height=u.height;o.globalCompositeOperation="copy";o.drawImage(t.baseTexture.source,u.x,u.y,u.width,u.height,0,0,u.width,u.height);var h=n.hex2rgb(i),l=h[0],a=h[1],v=h[2],c=o.getImageData(0,0,u.width,u.height),e=c.data;for(f=0;f<e.length;f+=4)e[f+0]*=l,e[f+1]*=a,e[f+2]*=v,n.CanvasTinter.canHandleAlpha||(s=e[f+3],e[f+0]/=255/s,e[f+1]/=255/s,e[f+2]/=255/s);o.putImageData(c,0,0)};n.CanvasTinter.roundColor=function(t){var r=n.CanvasTinter.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/r*r),i[1]=Math.min(255,i[1]/r*r),i[2]=Math.min(255,i[2]/r*r),n.rgb2hex(i)};n.CanvasTinter.checkInverseAlpha=function(){var i=new n.CanvasBuffer(2,1),t,r;return i.context.fillStyle="rgba(10, 20, 30, 0.5)",i.context.fillRect(0,0,1,1),t=i.context.getImageData(0,0,1,1),i.context.putImageData(t,1,0),r=i.context.getImageData(1,0,1,1),r.data[0]===t.data[0]&&r.data[1]===t.data[1]&&r.data[2]===t.data[2]&&r.data[3]===t.data[3]};n.CanvasTinter.cacheStepsPerColorChannel=8;n.CanvasTinter.convertTintToImage=!1;n.CanvasTinter.canHandleAlpha=n.CanvasTinter.checkInverseAlpha();n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes();n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel;n.CanvasRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)typeof r[u]=="undefined"&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.defaultRenderer=this);this.type=n.CANVAS_RENDERER;this.resolution=r.resolution;this.clearBeforeRender=r.clearBeforeRender;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.width=t||800;this.height=i||600;this.width*=this.resolution;this.height*=this.resolution;this.view=r.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new n.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};this.mapBlendModes();this.resize(t,i);"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")};n.CanvasRenderer.prototype.constructor=n.CanvasRenderer;n.CanvasRenderer.prototype.render=function(t){t.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=n.blendModes.NORMAL;this.context.globalCompositeOperation=n.blendModesCanvas[n.blendModes.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(t)};n.CanvasRenderer.prototype.destroy=function(n){typeof n=="undefined"&&(n=!0);n&&this.view.parent&&this.view.parent.removeChild(this.view);this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};n.CanvasRenderer.prototype.resize=function(n,t){this.width=n*this.resolution;this.height=t*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")};n.CanvasRenderer.prototype.renderDisplayObject=function(n,t){this.renderSession.context=t||this.context;this.renderSession.resolution=this.resolution;n._renderCanvas(this.renderSession)};n.CanvasRenderer.prototype.mapBlendModes=function(){n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen",n.blendModesCanvas[n.blendModes.OVERLAY]="overlay",n.blendModesCanvas[n.blendModes.DARKEN]="darken",n.blendModesCanvas[n.blendModes.LIGHTEN]="lighten",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="color-dodge",n.blendModesCanvas[n.blendModes.COLOR_BURN]="color-burn",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="hard-light",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="soft-light",n.blendModesCanvas[n.blendModes.DIFFERENCE]="difference",n.blendModesCanvas[n.blendModes.EXCLUSION]="exclusion",n.blendModesCanvas[n.blendModes.HUE]="hue",n.blendModesCanvas[n.blendModes.SATURATION]="saturation",n.blendModesCanvas[n.blendModes.COLOR]="color",n.blendModesCanvas[n.blendModes.LUMINOSITY]="luminosity"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over",n.blendModesCanvas[n.blendModes.OVERLAY]="source-over",n.blendModesCanvas[n.blendModes.DARKEN]="source-over",n.blendModesCanvas[n.blendModes.LIGHTEN]="source-over",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="source-over",n.blendModesCanvas[n.blendModes.COLOR_BURN]="source-over",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.DIFFERENCE]="source-over",n.blendModesCanvas[n.blendModes.EXCLUSION]="source-over",n.blendModesCanvas[n.blendModes.HUE]="source-over",n.blendModesCanvas[n.blendModes.SATURATION]="source-over",n.blendModesCanvas[n.blendModes.COLOR]="source-over",n.blendModesCanvas[n.blendModes.LUMINOSITY]="source-over"))};n.CanvasGraphics=function(){};n.CanvasGraphics.renderGraphics=function(t,i){var h=t.worldAlpha,d,f,b;for(t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),d=0;d<t.graphicsData.length;d++){var r=t.graphicsData[d],u=r.shape,p=r._fillTint,w=r._lineTint;if(i.lineWidth=r.lineWidth,r.type===n.Graphics.POLY){for(i.beginPath(),f=u.points,i.moveTo(f[0],f[1]),b=1;b<f.length/2;b++)i.lineTo(f[b*2],f[b*2+1]);u.closed&&i.lineTo(f[0],f[1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RECT)(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fillRect(u.x,u.y,u.width,u.height)),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.strokeRect(u.x,u.y,u.width,u.height));else if(r.type===n.Graphics.CIRC)i.beginPath(),i.arc(u.x,u.y,u.radius,0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke());else if(r.type===n.Graphics.ELIP){var g=u.width*2,nt=u.height*2,v=u.x-g/2,k=u.y-nt/2;i.beginPath();var ft=.5522848,tt=g/2*ft,it=nt/2*ft,rt=v+g,ut=k+nt,y=v+g/2,c=k+nt/2;i.moveTo(v,c);i.bezierCurveTo(v,c-it,y-tt,k,y,k);i.bezierCurveTo(y+tt,k,rt,c-it,rt,c);i.bezierCurveTo(rt,c+it,y+tt,ut,y,ut);i.bezierCurveTo(y-tt,ut,v,c+it,v,c);i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RREC){var e=u.x,o=u.y,l=u.width,a=u.height,s=u.radius,et=Math.min(l,a)/2|0;s=s>et?et:s;i.beginPath();i.moveTo(e,o+s);i.lineTo(e,o+a-s);i.quadraticCurveTo(e,o+a,e+s,o+a);i.lineTo(e+l-s,o+a);i.quadraticCurveTo(e+l,o+a,e+l,o+a-s);i.lineTo(e+l,o+s);i.quadraticCurveTo(e+l,o,e+l-s,o);i.lineTo(e+s,o);i.quadraticCurveTo(e,o,e,o+s);i.closePath();(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}}};n.CanvasGraphics.renderGraphicsMask=function(t,i){var it=t.graphicsData.length,w,s,r,e,y;if(it!==0)for(i.beginPath(),w=0;w<it;w++)if(s=t.graphicsData[w],r=s.shape,s.type===n.Graphics.POLY){for(e=r.points,i.moveTo(e[0],e[1]),y=1;y<e.length/2;y++)i.lineTo(e[y*2],e[y*2+1]);e[0]===e[e.length-2]&&e[1]===e[e.length-1]&&i.closePath()}else if(s.type===n.Graphics.RECT)i.rect(r.x,r.y,r.width,r.height),i.closePath();else if(s.type===n.Graphics.CIRC)i.arc(r.x,r.y,r.radius,0,2*Math.PI),i.closePath();else if(s.type===n.Graphics.ELIP){var b=r.width*2,k=r.height*2,a=r.x-b/2,p=r.y-k/2,rt=.5522848,d=b/2*rt,g=k/2*rt,nt=a+b,tt=p+k,v=a+b/2,h=p+k/2;i.moveTo(a,h);i.bezierCurveTo(a,h-g,v-d,p,v,p);i.bezierCurveTo(v+d,p,nt,h-g,nt,h);i.bezierCurveTo(nt,h+g,v+d,tt,v,tt);i.bezierCurveTo(v-d,tt,a,h+g,a,h);i.closePath()}else if(s.type===n.Graphics.RREC){var u=r.x,f=r.y,c=r.width,l=r.height,o=r.radius,ut=Math.min(c,l)/2|0;o=o>ut?ut:o;i.moveTo(u,f+o);i.lineTo(u,f+l-o);i.quadraticCurveTo(u,f+l,u+o,f+l);i.lineTo(u+c-o,f+l);i.quadraticCurveTo(u+c,f+l,u+c,f+l-o);i.lineTo(u+c,f+o);i.quadraticCurveTo(u+c,f,u+c-o,f);i.lineTo(u+o,f);i.quadraticCurveTo(u,f,u,f+o);i.closePath()}};n.CanvasGraphics.updateGraphicsTint=function(n){var t;if(n.tint!==16777215){var f=(n.tint>>16&255)/255,e=(n.tint>>8&255)/255,o=(n.tint&255)/255;for(t=0;t<n.graphicsData.length;t++){var i=n.graphicsData[t],r=i.fillColor|0,u=i.lineColor|0;i._fillTint=((r>>16&255)/255*f*255<<16)+((r>>8&255)/255*e*255<<8)+(r&255)/255*o*255;i._lineTint=((u>>16&255)/255*f*255<<16)+((u>>8&255)/255*e*255<<8)+(u&255)/255*o*255}}};n.Graphics=function(){n.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=n.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new n.Rectangle(0,0,1,1);this.dirty=!0;this.webGLDirty=!1;this.cachedSpriteDirty=!1};n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Graphics.prototype.constructor=n.Graphics;n.Graphics.prototype.lineStyle=function(t,i,r){return this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=r===undefined?1:r,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new n.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this};n.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new n.Polygon([t,i])),this};n.Graphics.prototype.lineTo=function(n,t){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(n,t),this.dirty=!0,this};n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var o,s,h,u,e;this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);h=20;u=this.currentPath.shape.points;u.length===0&&this.moveTo(0,0);var c=u[u.length-2],l=u[u.length-1],f=0;for(e=1;e<=h;++e)f=e/h,o=c+(n-c)*f,s=l+(t-l)*f,u.push(o+(n+(i-n)*f-o)*f,s+(t+(r-t)*f-s)*f);return this.dirty=!0,this};n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){var l;this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var y=20,o,h,a,c,v,s=this.currentPath.shape.points,p=s[s.length-2],w=s[s.length-1],e=0;for(l=1;l<=y;++l)e=l/y,o=1-e,h=o*o,a=h*o,c=e*e,v=c*e,s.push(a*p+3*h*e*n+3*o*c*i+v*u,a*w+3*h*e*t+3*o*c*r+v*f);return this.dirty=!0,this};n.Graphics.prototype.arcTo=function(n,t,i,r,u){this.currentPath?this.currentPath.shape.points.length===0&&this.currentPath.shape.points.push(n,t):this.moveTo(n,t);var f=this.currentPath.shape.points,g=f[f.length-2],nt=f[f.length-1],e=nt-t,o=g-n,s=r-t,h=i-n,a=Math.abs(e*h-o*s);if(a<1e-8||u===0)(f[f.length-2]!==n||f[f.length-1]!==t)&&f.push(n,t);else{var p=e*e+o*o,w=s*s+h*h,b=e*s+o*h,c=u*Math.sqrt(p)/a,l=u*Math.sqrt(w)/a,k=c*b/p,d=l*b/w,v=c*h+l*o,y=c*s+l*e,tt=o*(l+k),it=e*(l+k),rt=h*(c+d),ut=s*(c+d),ft=Math.atan2(it-y,tt-v),et=Math.atan2(ut-y,rt-v);this.arc(v+n,y+t,u,ft,et,o*s>h*e)}return this.dirty=!0,this};n.Graphics.prototype.arc=function(n,t,i,r,u,f){var o,h,l,a,e;if(r===u||(typeof f=="undefined"&&(f=!1),!f&&u<=r?u+=Math.PI*2:f&&r<=u&&(r+=Math.PI*2),o=f?(r-u)*-1:u-r,h=Math.ceil(Math.abs(o)/(Math.PI*2))*40,o===0))return this;l=n+Math.cos(r)*i;a=t+Math.sin(r)*i;f&&this.filling?this.moveTo(n,t):this.moveTo(l,a);var k=this.currentPath.shape.points,s=o/(h*2),d=s*2,v=Math.cos(s),y=Math.sin(s),c=h-1,g=c%1/c;for(e=0;e<=c;e++){var nt=e+g*e,p=s+r+d*nt,w=Math.cos(p),b=-Math.sin(p);k.push((v*w+y*b)*i+n,(v*-b+y*w)*i+t)}return this.dirty=!0,this};n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=t===undefined?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this};n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};n.Graphics.prototype.drawRect=function(t,i,r,u){return this.drawShape(new n.Rectangle(t,i,r,u)),this};n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.drawShape(new n.RoundedRectangle(t,i,r,u,f)),this};n.Graphics.prototype.drawCircle=function(t,i,r){return this.drawShape(new n.Circle(t,i,r)),this};n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.drawShape(new n.Ellipse(t,i,r,u)),this};n.Graphics.prototype.drawPolygon=function(n){var t=n,i;if(!Array.isArray(t))for(t=new Array(arguments.length),i=0;i<t.length;++i)t[i]=arguments[i];return this.drawShape(new Phaser.Polygon(t)),this};n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this};n.Graphics.prototype.generateTexture=function(t,i){t=t||1;var r=this.getBounds(),u=new n.CanvasBuffer(r.width*t,r.height*t),f=n.Texture.fromCanvas(u.canvas,i);return f.baseTexture.resolution=t,u.context.scale(t,t),u.context.translate(-r.x,-r.y),n.CanvasGraphics.renderGraphics(this,u.context),f};n.Graphics.prototype._renderWebGL=function(t){var r,i;if(this.visible!==!1&&this.alpha!==0&&this.isMask!==!0){if(this._cacheAsBitmap){(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1);this._cachedSprite.worldAlpha=this.worldAlpha;n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);return}if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode&&(t.spriteBatch.currentBlendMode=this.blendMode,r=n.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(r[0],r[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),n.WebGLGraphics.renderGraphics(this,t),this.children.length){for(t.spriteBatch.start(),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};n.Graphics.prototype._renderCanvas=function(t){var u,i,r,f;if(this.isMask!==!0){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap){(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1);this._cachedSprite.alpha=this.alpha;n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);return}for(u=t.context,i=this.worldTransform,this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,u.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),r=t.resolution,u.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r),n.CanvasGraphics.renderGraphics(this,u),f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};n.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return n.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,s=e.x,h=e.width+e.x,c=e.y,l=e.height+e.y,o=t||this.worldTransform,a=o.a,v=o.b,y=o.c,p=o.d,w=o.tx,b=o.ty,rt=a*h+y*l+w,ut=p*l+v*h+b,k=a*s+y*l+w,d=p*l+v*s+b,g=a*s+y*c+w,nt=p*c+v*s+b,tt=a*h+y*c+w,it=p*c+v*h+b,u=rt,f=ut,i=rt,r=ut;i=k<i?k:i;i=g<i?g:i;i=tt<i?tt:i;r=d<r?d:r;r=nt<r?nt:r;r=it<r?it:r;u=k>u?k:u;u=g>u?g:u;u=tt>u?tt:u;f=d>f?d:f;f=nt>f?nt:f;f=it>f?it:f;this._bounds.x=i;this._bounds.width=u-i;this._bounds.y=r;this._bounds.height=f-r;this._currentBounds=this._bounds}return this._currentBounds};n.Graphics.prototype.containsPoint=function(n){var r,t,i;for(this.worldTransform.applyInverse(n,tempPoint),r=this.graphicsData,t=0;t<r.length;t++)if((i=r[t],i.fill)&&i.shape&&i.shape.contains(tempPoint.x,tempPoint.y))return!0;return!1};n.Graphics.prototype.updateLocalBounds=function(){var u=Infinity,e=-Infinity,f=Infinity,o=-Infinity,s,a,t,i,h,c,y,l,v;if(this.graphicsData.length)for(y=0;y<this.graphicsData.length;y++){var w=this.graphicsData[y],p=w.type,r=w.lineWidth;if(s=w.shape,p===n.Graphics.RECT||p===n.Graphics.RREC)t=s.x-r/2,i=s.y-r/2,h=s.width+r,c=s.height+r,u=t<u?t:u,e=t+h>e?t+h:e,f=i<f?i:f,o=i+c>o?i+c:o;else if(p===n.Graphics.CIRC)t=s.x,i=s.y,h=s.radius+r/2,c=s.radius+r/2,u=t-h<u?t-h:u,e=t+h>e?t+h:e,f=i-c<f?i-c:f,o=i+c>o?i+c:o;else if(p===n.Graphics.ELIP)t=s.x,i=s.y,h=s.width+r/2,c=s.height+r/2,u=t-h<u?t-h:u,e=t+h>e?t+h:e,f=i-c<f?i-c:f,o=i+c>o?i+c:o;else for(a=s.points,l=0;l<a.length;l++)a[l]instanceof Phaser.Point?(t=a[l].x,i=a[l].y):(t=a[l],i=a[l+1],l<a.length-1&&l++),u=t-r<u?t-r:u,e=t+r>e?t+r:e,f=i-r<f?i-r:f,o=i+r>o?i+r:o}else u=0,e=0,f=0,o=0;v=this.boundsPadding;this._localBounds.x=u-v;this._localBounds.width=e-u+v*2;this._localBounds.y=f-v;this._localBounds.height=o-f+v*2};n.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds(),i,r;this._cachedSprite?this._cachedSprite.buffer.resize(t.width,t.height):(i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas),this._cachedSprite=new n.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};n.Graphics.prototype.updateCachedSpriteTexture=function(){var i=this._cachedSprite,n=i.texture,t=i.buffer.canvas;n.baseTexture.width=t.width;n.baseTexture.height=t.height;n.crop.width=n.frame.width=t.width;n.crop.height=n.frame.height=t.height;i._width=t.width;i._height=t.height;n.baseTexture.dirty()};n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};n.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop();this.currentPath=null;t instanceof n.Polygon&&t.flatten();var i=new n.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===n.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i};Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n;this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});n.GraphicsData=function(n,t,i,r,u,f,e){this.lineWidth=n;this.lineColor=t;this.lineAlpha=i;this._lineTint=t;this.fillColor=r;this.fillAlpha=u;this._fillTint=r;this.fill=f;this.shape=e;this.type=e.type};n.GraphicsData.prototype.constructor=n.GraphicsData;n.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};n.Strip=function(t){n.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new n.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new n.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new n.Float32Array([1,1,1,1]);this.indices=new n.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=n.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=n.Strip.DrawModes.TRIANGLE_STRIP};n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Strip.prototype.constructor=n.Strip;n.Strip.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())};n.Strip.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer();this._indexBuffer=t.createBuffer();this._uvBuffer=t.createBuffer();this._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)};n.Strip.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader,e=this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0));i.uniform2f(r.projectionVector,u.x,-u.y);i.uniform2f(r.offsetVector,-f.x,-f.y);i.uniform1f(r.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer));i.drawElements(e,this.indices.length,i.UNSIGNED_SHORT,0)};n.Strip.prototype._renderCanvas=function(t){var r=t.context,i=this.worldTransform;t.roundPixels?r.setTransform(i.a,i.b,i.c,i.d,i.tx|0,i.ty|0):r.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(r):this._renderCanvasTriangles(r)};n.Strip.prototype._renderCanvasTriangleStrip=function(n){var r=this.vertices,u=this.uvs,f=r.length/2,t,i;for(this.count++,t=0;t<f-2;t++)i=t*2,this._renderCanvasDrawTriangle(n,r,u,i,i+2,i+4)};n.Strip.prototype._renderCanvasTriangles=function(n){var r=this.vertices,u=this.uvs,i=this.indices,f=i.length,t;for(this.count++,t=0;t<f;t+=3){var e=i[t]*2,o=i[t+1]*2,s=i[t+2]*2;this._renderCanvasDrawTriangle(n,r,u,e,o,s)}};n.Strip.prototype._renderCanvasDrawTriangle=function(n,t,i,r,u,f){var ot=this.texture.baseTexture.source,rt=this.texture.width,ut=this.texture.height,h=t[r],c=t[u],l=t[f],a=t[r+1],v=t[u+1],y=t[f+1],p=i[r]*rt,w=i[u]*rt,b=i[f]*rt,k=i[r+1]*ut,d=i[u+1]*ut,g=i[f+1]*ut;if(this.canvasPadding>0){var ft=this.canvasPadding/this.worldTransform.a,et=this.canvasPadding/this.worldTransform.d,nt=(h+c+l)/3,tt=(a+v+y)/3,o=h-nt,s=a-tt,e=Math.sqrt(o*o+s*s);h=nt+o/e*(e+ft);a=tt+s/e*(e+et);o=c-nt;s=v-tt;e=Math.sqrt(o*o+s*s);c=nt+o/e*(e+ft);v=tt+s/e*(e+et);o=l-nt;s=y-tt;e=Math.sqrt(o*o+s*s);l=nt+o/e*(e+ft);y=tt+s/e*(e+et)}n.save();n.beginPath();n.moveTo(h,a);n.lineTo(c,v);n.lineTo(l,y);n.closePath();n.clip();var it=p*d+k*b+w*g-d*b-k*w-p*g,st=h*d+k*l+c*g-d*l-k*c-h*g,ht=p*c+h*b+w*l-c*b-h*w-p*l,ct=p*d*l+k*c*b+h*w*g-h*d*b-k*w*l-p*c*g,lt=a*d+k*y+v*g-d*y-k*v-a*g,at=p*v+a*b+w*y-v*b-a*w-p*y,vt=p*d*y+k*v*b+a*w*g-a*d*b-k*w*y-p*v*g;n.transform(st/it,lt/it,ht/it,at/it,ct/it,vt/it);n.drawImage(ot,0,0);n.restore()};n.Strip.prototype.renderStripFlat=function(n){var t=this.context,i=n.vertices,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;u<f-2;u++){var r=u*2,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h);t.lineTo(o,c);t.lineTo(s,l)}t.fillStyle="#FF0000";t.fill();t.closePath()};n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};n.Strip.prototype.getBounds=function(t){for(var i,r=t||this.worldTransform,y=r.a,p=r.b,w=r.c,b=r.d,k=r.tx,d=r.ty,o=-Infinity,f=-Infinity,u=Infinity,e=Infinity,l=this.vertices,s=0,g=l.length;s<g;s+=2){var a=l[s],v=l[s+1],h=y*a+w*v+k,c=b*v+p*a+d;u=h<u?h:u;e=c<e?c:e;o=h>o?h:o;f=c>f?c:f}return u===-Infinity||f===Infinity?n.EmptyRectangle:(i=this._bounds,i.x=u,i.width=o-u,i.y=e,i.height=f-e,this._currentBounds=i,i)};n.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};n.Rope=function(t,i){n.Strip.call(this,t);this.points=i;this.vertices=new n.Float32Array(i.length*4);this.uvs=new n.Float32Array(i.length*4);this.colors=new n.Float32Array(i.length*2);this.indices=new n.Uint16Array(i.length*2);this.refresh()};n.Rope.prototype=Object.create(n.Strip.prototype);n.Rope.prototype.constructor=n.Rope;n.Rope.prototype.refresh=function(){var u=this.points,o,s,n,r,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;i<o;i++)s=u[i],n=i*4,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=i*2,e[n]=1,e[n+1]=1,n=i*2,f[n]=n,f[n+1]=n+1,h=s}};n.Rope.prototype.updateTransform=function(){var u=this.points,o,s,t,f,h,r,e,c,l,a,i;if(!(u.length<1)){for(o=u[0],t={x:0,y:0},this.count-=.2,f=this.vertices,h=u.length,i=0;i<h;i++)r=u[i],e=i*4,s=i<u.length-1?u[i+1]:r,t.y=-(s.x-o.x),t.x=s.y-o.y,c=(1-i/(h-1))*10,c>1&&(c=1),l=Math.sqrt(t.x*t.x+t.y*t.y),a=this.texture.height/2,t.x/=l,t.y/=l,t.x*=a,t.y*=a,f[e]=r.x+t.x,f[e+1]=r.y+t.y,f[e+2]=r.x-t.x,f[e+3]=r.y-t.y,o=r;n.DisplayObjectContainer.prototype.updateTransform.call(this)}};n.Rope.prototype.setTexture=function(n){this.texture=n};n.TilingSprite=function(t,i,r){n.Sprite.call(this,t);this._width=i||100;this._height=r||100;this.tileScale=new n.Point(1,1);this.tileScaleOffset=new n.Point(1,1);this.tilePosition=new n.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL};n.TilingSprite.prototype=Object.create(n.Sprite.prototype);n.TilingSprite.prototype.constructor=n.TilingSprite;Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}});Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}});n.TilingSprite.prototype.setTexture=function(n){this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215)};n.TilingSprite.prototype._renderWebGL=function(n){if(this.visible!==!1&&this.alpha!==0){var t,i;for(this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(n.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):n.spriteBatch.renderTilingSprite(this),t=0,i=this.children.length;t<i;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop();this._filters&&n.filterManager.popFilter();this._mask&&n.maskManager.popMask(this._mask,n);n.spriteBatch.start()}};n.TilingSprite.prototype._renderCanvas=function(t){var i,u,o,s,f,r,e;if(this.visible!==!1&&this.alpha!==0){if(i=t.context,this._mask&&t.maskManager.pushMask(this._mask,t),i.globalAlpha=this.worldAlpha,u=this.worldTransform,f=t.resolution,i.setTransform(u.a*f,u.b*f,u.c*f,u.d*f,u.tx*f,u.ty*f),!this.__tilePattern||this.refreshTexture)if(this.generateTilingTexture(!1),this.tilingTexture)this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat");else return;for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),r=this.tilePosition,e=this.tileScale,r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,i.scale(e.x,e.y),i.translate(r.x+this.anchor.x*-this._width,r.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-r.x,-r.y,this._width/e.x,this._height/e.y),i.scale(1/e.x,1/e.y),i.translate(-r.x+this.anchor.x*this._width,-r.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t),o=0,s=this.children.length;o<s;o++)this.children[o]._renderCanvas(t)}};n.TilingSprite.prototype.getBounds=function(){var rt=this._width,ut=this._height,e=rt*(1-this.anchor.x),o=rt*-this.anchor.x,s=ut*(1-this.anchor.y),h=ut*-this.anchor.y,f=this.worldTransform,c=f.a,l=f.b,a=f.c,v=f.d,y=f.tx,p=f.ty,w=c*o+a*h+y,b=v*h+l*o+p,k=c*e+a*h+y,d=v*h+l*e+p,g=c*e+a*s+y,nt=v*s+l*e+p,tt=c*o+a*s+y,it=v*s+l*o+p,i=-Infinity,r=-Infinity,n=Infinity,t=Infinity,u;return n=w<n?w:n,n=k<n?k:n,n=g<n?g:n,n=tt<n?tt:n,t=b<t?b:t,t=d<t?d:t,t=nt<t?nt:t,t=it<t?it:t,i=w>i?w:i,i=k>i?k:i,i=g>i?g:i,i=tt>i?tt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,r=it>r?it:r,u=this._bounds,u.x=n,u.width=i-n,u.y=t,u.height=r-t,this._currentBounds=u,u};n.TilingSprite.prototype.onTextureUpdate=function(){};n.TilingSprite.prototype.generateTilingTexture=function(t){var e;if(this.texture.baseTexture.hasLoaded){var i=this.originalTexture||this.texture,f=i.frame,r,u,s=f.width!==i.baseTexture.width||f.height!==i.baseTexture.height,o=!1;t?(i.crop?(r=n.getNextPowerOfTwo(i.crop.width),u=n.getNextPowerOfTwo(i.crop.height)):(r=n.getNextPowerOfTwo(f.width),u=n.getNextPowerOfTwo(f.height)),o=!0):s&&(i.crop?(r=i.crop.width,u=i.crop.height):(r=f.width,u=f.height),o=!0);o?(this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(r,u),this.tilingTexture.baseTexture.width=r,this.tilingTexture.baseTexture.height=u,this.tilingTexture.needsUpdate=!0):(e=new n.CanvasBuffer(r,u),this.tilingTexture=n.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0),e.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,r,u),this.tileScaleOffset.x=f.width/r,this.tileScaleOffset.y=f.height/u):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i);this.refreshTexture=!1;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=!0}};n.TilingSprite.prototype.destroy=function(){n.Sprite.prototype.destroy.call(this);this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};n.BaseTextureCache={};n.BaseTextureCacheIdGenerator=0;n.BaseTexture=function(t,i){(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=n._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t)&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.imageUrl=null,this._powerOf2=!1)};n.BaseTexture.prototype.constructor=n.BaseTexture;n.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId];this.source=null;this.unloadFromGPU()};n.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1;this.source.src=null;this.source.src=n};n.BaseTexture.prototype.dirty=function(){for(var n=0;n<this._glTextures.length;n++)this._dirty[n]=!0};n.BaseTexture.prototype.unloadFromGPU=function(){var t,i,r;for(this.dirty(),t=this._glTextures.length-1;t>=0;t--)i=this._glTextures[t],r=n.glContexts[t],r&&i&&r.deleteTexture(i);this._glTextures.length=0;this.dirty()};n.BaseTexture.fromImage=function(t,i,r){var u=n.BaseTextureCache[t],f;return i===undefined&&t.indexOf("data:")===-1&&(i=!0),u||(f=new Image,i&&(f.crossOrigin=""),f.src=t,u=new n.BaseTexture(f,r),u.imageUrl=t,n.BaseTextureCache[t]=u,t.indexOf(n.RETINA_PREFIX+".")!==-1&&(u.resolution=2)),u};n.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.BaseTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r};n.TextureCache={};n.FrameCache={};n.TextureSilentFail=!1;n.TextureCacheIdGenerator=0;n.Texture=function(t,i,r,u){this.noFrame=!1;i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1));t instanceof n.Texture&&(t=t.baseTexture);this.baseTexture=t;this.frame=i;this.trim=u;this.valid=!1;this.requiresUpdate=!1;this._uvs=null;this.width=0;this.height=0;this.crop=r||new n.Rectangle(0,0,1,1);t.hasLoaded&&(this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i))};n.Texture.prototype.constructor=n.Texture;n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height));this.setFrame(this.frame)};n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy();this.valid=!1};n.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!n.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1;return}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&this._updateUvs()};n.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.width)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.width)/i;this._uvs.y2=(t.y+t.height)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.height)/r};n.Texture.fromImage=function(t,i,r){var u=n.TextureCache[t];return u||(u=new n.Texture(n.BaseTexture.fromImage(t,i,r)),n.TextureCache[t]=u),u};n.Texture.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i};n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)};n.Texture.addTextureToCache=function(t,i){n.TextureCache[i]=t};n.Texture.removeTextureFromCache=function(t){var i=n.TextureCache[t];return delete n.TextureCache[t],delete n.BaseTextureCache[t],i};n.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};n.RenderTexture=function(t,i,r,u,f){if(this.width=t||100,this.height=i||100,this.resolution=f||1,this.frame=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=u||n.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,n.Texture.call(this,this.baseTexture,new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=r||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var e=this.renderer.gl;this.baseTexture._dirty[e.id]=!1;this.textureBuffer=new n.FilterTexture(e,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[e.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new n.Point(this.width*.5,-this.height*.5)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0;this._updateUvs()};n.RenderTexture.prototype=Object.create(n.Texture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=t,this.height=i,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=i*this.resolution,r&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===n.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid)&&this.textureBuffer.resize(this.width,this.height)};n.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===n.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};n.RenderTexture.prototype.renderWebGL=function(n,t,i){var r,e,u,o,f;if(this.valid){for(r=n.worldTransform,r.identity(),r.translate(0,this.projection.y*2),t&&r.append(t),r.scale(1,-1),n.worldAlpha=1,e=n.children,u=0,o=e.length;u<o;u++)e[u].updateTransform();f=this.renderer.gl;f.viewport(0,0,this.width*this.resolution,this.height*this.resolution);f.bindFramebuffer(f.FRAMEBUFFER,this.textureBuffer.frameBuffer);i&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(n,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=!0}};n.RenderTexture.prototype.renderCanvas=function(n,t,i){var u,f,r,e,o,s;if(this.valid){for(u=n.worldTransform,u.identity(),t&&u.append(t),n.worldAlpha=1,f=n.children,r=0,e=f.length;r<e;r++)f[r].updateTransform();i&&this.textureBuffer.clear();o=this.textureBuffer.context;s=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(n,o);this.renderer.resolution=s}};n.RenderTexture.prototype.getImage=function(){var n=new Image;return n.src=this.getBase64(),n};n.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};n.RenderTexture.prototype.getCanvas=function(){var u,f;if(this.renderer.type===n.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,e=new Uint8Array(4*i*r);return t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,e),t.bindFramebuffer(t.FRAMEBUFFER,null),u=new n.CanvasBuffer(i,r),f=u.context.getImageData(0,0,i,r),f.data.set(e),u.context.putImageData(f,0,0),u.canvas}return this.textureBuffer.canvas};n.AbstractFilter=function(n,t){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=t||{};this.fragmentSrc=n||[]};n.AbstractFilter.prototype.constructor=n.AbstractFilter;n.AbstractFilter.prototype.syncUniforms=function(){for(var n=0,t=this.shaders.length;n<t;n++)this.shaders[n].dirty=!0};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.PIXI=n):typeof define!="undefined"&&define.amd?define("PIXI",function(){return t.PIXI=n}()):t.PIXI=n}).call(this);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
(function(){function t(n,t){this._scaleFactor=n;this._deltaMode=t;this.originalEvent=null}var s=this,n,o,r,h,c,l;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n=n||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};
/**
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Function.prototype.bind||(Function.prototype.bind=function(){var n=Array.prototype.slice;return function(t){function r(){var u=f.concat(n.call(arguments));i.apply(this instanceof r?this:t,u)}var i=this,f=n.call(arguments,1);if(typeof i!="function")throw new TypeError;return r.prototype=function u(n){return n&&(u.prototype=n),(this instanceof u)?void 0:new u}(i.prototype),r}}());Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"});Array.prototype.forEach||(Array.prototype.forEach=function(n){"use strict";var i,r,u,t;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),r=i.length>>>0,typeof n!="function")throw new TypeError;for(u=arguments.length>=2?arguments[1]:void 0,t=0;t<r;t++)t in i&&n.call(u,i[t],t,i)});typeof Uint32Array!="function"&&typeof Uint32Array!="object"&&(o=function(n){window[n]=function(n){var t;if(typeof n=="number")for(Array.call(this,n),this.length=n,t=0;t<this.length;t++)this[t]=0;else for(Array.call(this,n.length),this.length=n.length,t=0;t<this.length;t++)this[t]=n[t]};window[n].prototype=[];window[n].constructor=window[n]},o("Uint32Array"),o("Int16Array"));window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils={getProperty:function(n,t){for(var i=t.split("."),f=i.pop(),e=i.length,r=1,u=i[0];r<e&&(n=n[u]);)u=i[r],r++;return n?n[f]:null},setProperty:function(n,t,i){for(var r=t.split("."),e=r.pop(),o=r.length,u=1,f=r[0];u<o&&(n=n[f]);)f=r[u],u++;return n&&(n[e]=i),n},chanceRoll:function(n){return typeof n=="undefined"&&(n=50),n>0&&Math.random()*100<=n},randomChoice:function(n,t){return Math.random()<.5?n:t},transposeArray:function(t){return n.ArrayUtils.transposeMatrix(t)},rotateArray:function(t,i){return n.ArrayUtils.rotateMatrix(t,i)},shuffle:function(t){return n.ArrayUtils.shuffle(t)},parseDimension:function(n,t){var r=0,i=0;return typeof n=="string"?n.substr(-1)==="%"?(r=parseInt(n,10)/100,i=t===0?window.innerWidth*r:window.innerHeight*r):i=parseInt(n,10):i=n,i},pad:function(n,t,i,r){var t,i,r,u,f,e;if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=" "),typeof r=="undefined"&&(r=3),u=0,t+1>=n.length)switch(r){case 1:n=new Array(t+1-n.length).join(i)+n;break;case 3:f=Math.ceil((u=t-n.length)/2);e=u-f;n=new Array(e+1).join(i)+n+new Array(f+1).join(i);break;default:n=n+new Array(t+1-n.length).join(i)}return n},isPlainObject:function(n){if(typeof n!="object"||n.nodeType||n===n.window)return!1;try{if(n.constructor&&!{}.hasOwnProperty.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,f,r,i,o,s,t=arguments[0]||{},u=1,c=arguments.length,h=!1;for(typeof t=="boolean"&&(h=t,t=arguments[1]||{},u=2),c===u&&(t=this,--u);u<c;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(h&&i&&(n.Utils.isPlainObject(i)||(o=Array.isArray(i)))?(o?(o=!1,s=r&&Array.isArray(r)?r:[]):s=r&&n.Utils.isPlainObject(r)?r:{},t[f]=n.Utils.extend(h,s,i)):i!==undefined&&(t[f]=i));return t},mixinPrototype:function(n,t,i){var e,f,u,r;for(typeof i=="undefined"&&(i=!1),e=Object.keys(t),f=0;f<e.length;f++)if(u=e[f],r=t[u],!i&&u in n)continue;else r&&(typeof r.get=="function"||typeof r.set=="function")?typeof r.clone=="function"?n[u]=r.clone():Object.defineProperty(n,u,r):n[u]=r},mixin:function(t,i){var r,u,f;if(!t||typeof t!="object")return i;for(r in t)(u=t[r],u.childNodes||u.cloneNode)||(f=typeof t[r],i[r]=t[r]&&f==="object"?typeof i[r]===f?n.Utils.mixin(t[r],i[r]):n.Utils.mixin(t[r],new u.constructor):t[r]);return i}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Circle=function(t,i,r){t=t||0;i=i||0;r=r||0;this.x=t;this.y=i;this._diameter=r;this._radius=0;r>0&&(this._radius=r*.5);this.type=n.CIRCLE};n.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},getBounds:function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(n,t,i){return this.x=n,this.y=t,this._diameter=i,this._radius=i*.5,this},copyFrom:function(n){return this.setTo(n.x,n.y,n.diameter)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.diameter=this._diameter,n},distance:function(t,i){var r=n.Math.distance(this.x,this.y,t.x,t.y);return i?Math.round(r):r},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,i){return n.Circle.contains(this,t,i)},circumferencePoint:function(t,i,r){return n.Circle.circumferencePoint(this,t,i,r)},offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};n.Circle.prototype.constructor=n.Circle;Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(n){n>0&&(this._diameter=n,this._radius=n*.5)}});Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(n){n>0&&(this._radius=n,this._diameter=n*2)}});Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(n){n>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-n}});Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(n){n<this.x?(this._radius=0,this._diameter=0):this.radius=n-this.x}});Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(n){n>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-n}});Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(n){n<this.y?(this._radius=0,this._diameter=0):this.radius=n-this.y}});Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}});Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(n){n===!0&&this.setTo(0,0,0)}});n.Circle.contains=function(n,t,i){if(n.radius>0&&t>=n.left&&t<=n.right&&i>=n.top&&i<=n.bottom){var r=(n.x-t)*(n.x-t),u=(n.y-i)*(n.y-i);return r+u<=n.radius*n.radius}return!1};n.Circle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.diameter==t.diameter};n.Circle.intersects=function(t,i){return n.Math.distance(t.x,t.y,i.x,i.y)<=t.radius+i.radius};n.Circle.circumferencePoint=function(t,i,r,u){return typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=new n.Point),r===!0&&(i=n.Math.degToRad(i)),u.x=t.x+t.radius*Math.cos(i),u.y=t.y+t.radius*Math.sin(i),u};n.Circle.intersectsRectangle=function(n,t){var r=Math.abs(n.x-t.x-t.halfWidth),o=t.halfWidth+n.radius,i,u;if(r>o||(i=Math.abs(n.y-t.y-t.halfHeight),u=t.halfHeight+n.radius,i>u))return!1;if(r<=t.halfWidth||i<=t.halfHeight)return!0;var f=r-t.halfWidth,e=i-t.halfHeight,s=f*f,h=e*e,c=n.radius*n.radius;return s+h<=c};PIXI.Circle=n.Circle;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Chad Engler <chad@pantherdev.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Ellipse=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.x=t;this.y=i;this.width=r;this.height=u;this.type=n.ELLIPSE};n.Ellipse.prototype={setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},getBounds:function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,i){return n.Ellipse.contains(this,t,i)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};n.Ellipse.prototype.constructor=n.Ellipse;Object.defineProperty(n.Ellipse.prototype,"left",{get:function(){return this.x},set:function(n){this.x=n}});Object.defineProperty(n.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<this.x?0:n-this.x}});Object.defineProperty(n.Ellipse.prototype,"top",{get:function(){return this.y},set:function(n){this.y=n}});Object.defineProperty(n.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<this.y?0:n-this.y}});Object.defineProperty(n.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Ellipse.contains=function(n,t,i){if(n.width<=0||n.height<=0)return!1;var r=(t-n.x)/n.width-.5,u=(i-n.y)/n.height-.5;return r*=r,u*=u,r+u<.25};PIXI.Ellipse=n.Ellipse;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Line=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.start=new n.Point(t,i);this.end=new n.Point(r,u);this.type=n.LINE};n.Line.prototype={setTo:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(i,r),this},fromSprite:function(n,t,i){return(typeof i=="undefined"&&(i=!1),i)?this.setTo(n.center.x,n.center.y,t.center.x,t.center.y):this.setTo(n.x,n.y,t.x,t.y)},fromAngle:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(n+Math.cos(i)*r,t+Math.sin(i)*r),this},intersects:function(t,i,r){return n.Line.intersectsPoints(this.start,this.end,t.start,t.end,i,r)},reflect:function(t){return n.Line.reflect(this,t)},pointOnLine:function(n,t){return(n-this.start.x)*(this.end.y-this.start.y)==(this.end.x-this.start.x)*(t-this.start.y)},pointOnSegment:function(n,t){var i=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),u=Math.min(this.start.y,this.end.y),f=Math.max(this.start.y,this.end.y);return this.pointOnLine(n,t)&&n>=i&&n<=r&&t>=u&&t<=f},coordinatesOnLine:function(n,t){var h,c;typeof n=="undefined"&&(n=1);typeof t=="undefined"&&(t=[]);var i=Math.round(this.start.x),r=Math.round(this.start.y),u=Math.round(this.end.x),f=Math.round(this.end.y),e=Math.abs(u-i),o=Math.abs(f-r),l=i<u?1:-1,a=r<f?1:-1,s=e-o;for(t.push([i,r]),h=1;!(i==u&&r==f);)c=s<<1,c>-o&&(s-=o,i+=l),c<e&&(s+=e,r+=a),h%n==0&&t.push([i,r]),h++;return t},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}};Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(n.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(n.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(n.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(n.Line.prototype,"normalAngle",{get:function(){return n.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});n.Line.intersectsPoints=function(t,i,r,u,f,e){typeof f=="undefined"&&(f=!0);typeof e=="undefined"&&(e=new n.Point);var s=i.y-t.y,h=u.y-r.y,c=t.x-i.x,l=r.x-u.x,a=i.x*t.y-t.x*i.y,v=u.x*r.y-r.x*u.y,o=s*l-h*c;if(o===0)return null;if(e.x=(c*v-l*a)/o,e.y=(h*a-s*v)/o,f){var y=(u.y-r.y)*(i.x-t.x)-(u.x-r.x)*(i.y-t.y),p=((u.x-r.x)*(t.y-r.y)-(u.y-r.y)*(t.x-r.x))/y,w=((i.x-t.x)*(t.y-r.y)-(i.y-t.y)*(t.x-r.x))/y;return p>=0&&p<=1&&w>=0&&w<=1?e:null}return e};n.Line.intersects=function(t,i,r,u){return n.Line.intersectsPoints(t.start,t.end,i.start,i.end,r,u)};n.Line.reflect=function(n,t){return 2*t.normalAngle-3.1415926535897931-n.angle};n.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.type=n.MATRIX};n.Matrix.prototype.fromArray=function(n){this.a=n[0];this.b=n[1];this.c=n[3];this.d=n[4];this.tx=n[2];this.ty=n[5]};n.Matrix.prototype.toArray=function(n){this.array||(this.array=new PIXI.Float32Array(9));var t=this.array;return n?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t};n.Matrix.prototype.apply=function(t,i){i=i||new n.Point;var r=t.x,u=t.y;return i.x=this.a*r+this.c*u+this.tx,i.y=this.b*r+this.d*u+this.ty,i};n.Matrix.prototype.applyInverse=function(t,i){i=i||new n.Point;var r=1/(this.a*this.d+this.c*-this.b),u=t.x,f=t.y;return i.x=this.d*r*u+-this.c*r*f+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*f+-this.b*r*u+(-this.ty*this.a+this.tx*this.b)*r,i};n.Matrix.prototype.translate=function(n,t){return this.tx+=n,this.ty+=t,this};n.Matrix.prototype.scale=function(n,t){return this.a*=n,this.d*=t,this.c*=n,this.b*=t,this.tx*=n,this.ty*=t,this};n.Matrix.prototype.rotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.a,u=this.c,f=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=u*t-this.d*i,this.d=u*i+this.d*t,this.tx=f*t-this.ty*i,this.ty=f*i+this.ty*t,this};n.Matrix.prototype.append=function(n){var t=this.a,i=this.b,r=this.c,u=this.d;return this.a=n.a*t+n.b*r,this.b=n.a*i+n.b*u,this.c=n.c*t+n.d*r,this.d=n.c*i+n.d*u,this.tx=n.tx*t+n.ty*r+this.tx,this.ty=n.tx*i+n.ty*u+this.ty,this};n.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};n.identityMatrix=new n.Matrix;PIXI.Matrix=n.Matrix;PIXI.identityMatrix=n.identityMatrix;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Point=function(t,i){t=t||0;i=i||0;this.x=t;this.y=i;this.type=n.POINT};n.Point.prototype={copyFrom:function(n){return this.setTo(n.x,n.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(n,t){return this.x=n||0,this.y=t||(t!==0?this.x:0),this},set:function(n,t){return this.x=n||0,this.y=t||(t!==0?this.x:0),this},add:function(n,t){return this.x+=n,this.y+=t,this},subtract:function(n,t){return this.x-=n,this.y-=t,this},multiply:function(n,t){return this.x*=n,this.y*=t,this},divide:function(n,t){return this.x/=n,this.y/=t,this},clampX:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this},clampY:function(t,i){return this.y=n.Math.clamp(this.y,t,i),this},clamp:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this.y=n.Math.clamp(this.y,t,i),this},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(n){return n.x=this.x,n.y=this.y,n},distance:function(t,i){return n.Point.distance(this,t,i)},equals:function(n){return n.x===this.x&&n.y===this.y},angle:function(t,i){return typeof i=="undefined"&&(i=!1),i?n.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},rotate:function(t,i,r,u,f){return n.Point.rotate(this,t,i,r,u,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(n){return this.normalize().multiply(n,n)},normalize:function(){if(!this.isZero()){var n=this.getMagnitude();this.x/=n;this.y/=n}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(n){return this.x*n.x+this.y*n.y},cross:function(n){return this.x*n.y-this.y*n.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};n.Point.prototype.constructor=n.Point;n.Point.add=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x+i.x,r.y=t.y+i.y,r};n.Point.subtract=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x-i.x,r.y=t.y-i.y,r};n.Point.multiply=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x*i.x,r.y=t.y*i.y,r};n.Point.divide=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x/i.x,r.y=t.y/i.y,r};n.Point.equals=function(n,t){return n.x===t.x&&n.y===t.y};n.Point.angle=function(n,t){return Math.atan2(n.y-t.y,n.x-t.x)};n.Point.negative=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(-t.x,-t.y)};n.Point.multiplyAdd=function(t,i,r,u){return typeof u=="undefined"&&(u=new n.Point),u.setTo(t.x+i.x*r,t.y+i.y*r)};n.Point.interpolate=function(t,i,r,u){return typeof u=="undefined"&&(u=new n.Point),u.setTo(t.x+(i.x-t.x)*r,t.y+(i.y-t.y)*r)};n.Point.perp=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(-t.y,t.x)};n.Point.rperp=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(t.y,-t.x)};n.Point.distance=function(t,i,r){var u=n.Math.distance(t.x,t.y,i.x,i.y);return r?Math.round(u):u};n.Point.project=function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.dot(i)/i.getMagnitudeSq();return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.projectUnit=function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.dot(i);return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.normalRightHand=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(t.y*-1,t.x)};n.Point.normalize=function(t,i){typeof i=="undefined"&&(i=new n.Point);var r=t.getMagnitude();return r!==0&&i.setTo(t.x/r,t.y/r),i};n.Point.rotate=function(t,i,r,u,f,e){f=f||!1;e=e||null;f&&(u=n.Math.degToRad(u));e===null&&(e=Math.sqrt((i-t.x)*(i-t.x)+(r-t.y)*(r-t.y)));var o=u+Math.atan2(t.y-r,t.x-i);return t.setTo(i+e*Math.cos(o),r+e*Math.sin(o))};n.Point.centroid=function(t,i){var r,u;if(typeof i=="undefined"&&(i=new n.Point),Object.prototype.toString.call(t)!=="[object Array]")throw new Error("Phaser.Point. Parameter 'points' must be an array");if(r=t.length,r<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(r===1)return i.copyFrom(t[0]),i;for(u=0;u<r;u++)n.Point.add(i,t[u],i);return i.divide(r,r),i};n.Point.parse=function(t,i,r){i=i||"x";r=r||"y";var u=new n.Point;return t[i]&&(u.x=parseInt(t[i],10)),t[r]&&(u.y=parseInt(t[r],10)),u};PIXI.Point=n.Point;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Adrien Brault <adrien.brault@gmail.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Polygon=function(){this.area=0;this._points=[];arguments.length>0&&this.setTo.apply(this,arguments);this.closed=!0;this.type=n.POLYGON};n.Polygon.prototype={toNumberArray:function(n){typeof n=="undefined"&&(n=[]);for(var t=0;t<this._points.length;t++)typeof this._points[t]=="number"?(n.push(this._points[t]),n.push(this._points[t+1]),t++):(n.push(this._points[t].x),n.push(this._points[t].y));return n},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(t){var i=this._points.slice();return typeof t=="undefined"||t===null?t=new n.Polygon(i):t.setTo(i),t},contains:function(n,t){for(var o=this._points.length,u=!1,i=-1,f=o-1;++i<o;f=i){var s=this._points[i].x,r=this._points[i].y,h=this._points[f].x,e=this._points[f].y;(r<=t&&t<e||e<=t&&t<r)&&n<(h-s)*(t-r)/(e-r)+s&&(u=!u)}return u},setTo:function(n){var r,t,u,i;if(this.area=0,this._points=[],arguments.length>0){for(Array.isArray(n)||(n=Array.prototype.slice.call(arguments)),r=Number.MAX_VALUE,t=0,u=n.length;t<u;t++)typeof n[t]=="number"?(i=new PIXI.Point(n[t],n[t+1]),t++):i=new PIXI.Point(n[t].x,n[t].y),this._points.push(i),i.y<r&&(r=i.y);this.calculateArea(r)}return this},calculateArea:function(n){for(var i,r,u,f,t=0,e=this._points.length;t<e;t++)i=this._points[t],r=t===e-1?this._points[0]:this._points[t+1],u=(i.y-n+(r.y-n))/2,f=i.x-r.x,this.area+=u*f;return this.area}};n.Polygon.prototype.constructor=n.Polygon;Object.defineProperty(n.Polygon.prototype,"points",{get:function(){return this._points},set:function(n){n!=null?this.setTo(n):this.setTo()}});PIXI.Polygon=n.Polygon;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rectangle=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.x=t;this.y=i;this.width=r;this.height=u;this.type=n.RECTANGLE};n.Rectangle.prototype={offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},scale:function(n,t){return typeof t=="undefined"&&(t=n),this.width*=n,this.height*=t,this},centerOn:function(n,t){return this.centerX=n,this.centerY=t,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},inflate:function(t,i){return n.Rectangle.inflate(this,t,i)},size:function(t){return n.Rectangle.size(this,t)},clone:function(t){return n.Rectangle.clone(this,t)},contains:function(t,i){return n.Rectangle.contains(this,t,i)},containsRect:function(t){return n.Rectangle.containsRect(t,this)},equals:function(t){return n.Rectangle.equals(this,t)},intersection:function(t,i){return n.Rectangle.intersection(this,t,i)},intersects:function(t){return n.Rectangle.intersects(this,t)},intersectsRaw:function(t,i,r,u,f){return n.Rectangle.intersectsRaw(this,t,i,r,u,f)},union:function(t,i){return n.Rectangle.union(this,t,i)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<=this.y?0:n-this.y}});Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(n){this.right=n.x;this.bottom=n.y}});Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(n){this.width=n>=this.right?0:this.right-n;this.x=n}});Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<=this.x?0:n-this.x}});Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(n){this.x=n-this.halfWidth}});Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(n){this.y=n-this.halfHeight}});Object.defineProperty(n.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(n.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(n){n>=this.bottom?(this.height=0,this.y=n):this.height=this.bottom-n}});Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(n){this.x=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"topRight",{get:function(){return new n.Point(this.x+this.width,this.y)},set:function(n){this.right=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Rectangle.prototype.constructor=n.Rectangle;n.Rectangle.inflate=function(n,t,i){return n.x-=t,n.width+=2*t,n.y-=i,n.height+=2*i,n};n.Rectangle.inflatePoint=function(t,i){return n.Rectangle.inflate(t,i.x,i.y)};n.Rectangle.size=function(t,i){return typeof i=="undefined"||i===null?i=new n.Point(t.width,t.height):i.setTo(t.width,t.height),i};n.Rectangle.clone=function(t,i){return typeof i=="undefined"||i===null?i=new n.Rectangle(t.x,t.y,t.width,t.height):i.setTo(t.x,t.y,t.width,t.height),i};n.Rectangle.contains=function(n,t,i){return n.width<=0||n.height<=0?!1:t>=n.x&&t<n.right&&i>=n.y&&i<n.bottom};n.Rectangle.containsRaw=function(n,t,i,r,u,f){return u>=n&&u<n+i&&f>=t&&f<t+r};n.Rectangle.containsPoint=function(t,i){return n.Rectangle.contains(t,i.x,i.y)};n.Rectangle.containsRect=function(n,t){return n.volume>t.volume?!1:n.x>=t.x&&n.y>=t.y&&n.right<t.right&&n.bottom<t.bottom};n.Rectangle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.width==t.width&&n.height==t.height};n.Rectangle.sameDimensions=function(n,t){return n.width===t.width&&n.height===t.height};n.Rectangle.intersection=function(t,i,r){return typeof r=="undefined"&&(r=new n.Rectangle),n.Rectangle.intersects(t,i)&&(r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.width=Math.min(t.right,i.right)-r.x,r.height=Math.min(t.bottom,i.bottom)-r.y),r};n.Rectangle.intersects=function(n,t){return n.width<=0||n.height<=0||t.width<=0||t.height<=0?!1:!(n.right<t.x||n.bottom<t.y||n.x>t.right||n.y>t.bottom)};n.Rectangle.intersectsRaw=function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=0),!(t>n.right+f||i<n.left-f||r>n.bottom+f||u<n.top-f)};n.Rectangle.union=function(t,i,r){return typeof r=="undefined"&&(r=new n.Rectangle),r.setTo(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.right,i.right)-Math.min(t.left,i.left),Math.max(t.bottom,i.bottom)-Math.min(t.top,i.top))};n.Rectangle.aabb=function(t,i){typeof i=="undefined"&&(i=new n.Rectangle);var f=Number.MIN_VALUE,r=Number.MAX_VALUE,e=Number.MIN_VALUE,u=Number.MAX_VALUE;return t.forEach(function(n){n.x>f&&(f=n.x);n.x<r&&(r=n.x);n.y>e&&(e=n.y);n.y<u&&(u=n.y)}),i.setTo(r,u,f-r,e-u),i};PIXI.Rectangle=n.Rectangle;PIXI.EmptyRectangle=new n.Rectangle(0,0,0,0);n.RoundedRectangle=function(t,i,r,u,f){this.x=t||0;this.y=i||0;this.width=r||0;this.height=u||0;this.radius=f||20;this.type=n.ROUNDEDRECTANGLE};n.RoundedRectangle.prototype.clone=function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};n.RoundedRectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1};n.RoundedRectangle.prototype.constructor=n.RoundedRectangle;PIXI.RoundedRectangle=n.RoundedRectangle;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Camera=function(t,i,r,u,f,e){this.game=t;this.world=t.world;this.id=0;this.view=new n.Rectangle(r,u,f,e);this.screenView=new n.Rectangle(r,u,f,e);this.bounds=new n.Rectangle(r,u,f,e);this.deadzone=null;this.visible=!0;this.roundPx=!0;this.atLimit={x:!1,y:!1};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this._targetPosition=new n.Point;this._edge=0;this._position=new n.Point};n.Camera.FOLLOW_LOCKON=0;n.Camera.FOLLOW_PLATFORMER=1;n.Camera.FOLLOW_TOPDOWN=2;n.Camera.FOLLOW_TOPDOWN_TIGHT=3;n.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(t,i){var r,f,u;typeof i=="undefined"&&(i=n.Camera.FOLLOW_LOCKON);this.target=t;switch(i){case n.Camera.FOLLOW_PLATFORMER:f=this.width/8;u=this.height/3;this.deadzone=new n.Rectangle((this.width-f)/2,(this.height-u)/2-u*.25,f,u);break;case n.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(n){this.setPosition(Math.round(n.x-this.view.halfWidth),Math.round(n.y-this.view.halfHeight))},focusOnXY:function(n,t){this.setPosition(Math.round(n-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget();this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);this.target.parent&&this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d);this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x);this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width);this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top);this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(n,t){this.view.x=n;this.view.y=t;this.bounds&&this.checkBounds()},setSize:function(n,t){this.view.width=n;this.view.height=t},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};n.Camera.prototype.constructor=n.Camera;Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(n){this.view.x=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(n){this.view.y=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(n){typeof n.x!="undefined"&&(this.view.x=n.x);typeof n.y!="undefined"&&(this.view.y=n.y);this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(n){this.view.width=n}});Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(n){this.view.height=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};n.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};n.State.prototype.constructor=n.State;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.StateManager=function(n,t){this.game=n;this.states={};this._pendingState=null;typeof t!="undefined"&&t!==null&&(this._pendingState=t);this._clearWorld=!1;this._clearCache=!1;this._created=!1;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this._pendingState!==null&&typeof this._pendingState!="string"&&this.add("default",this._pendingState,!0)},add:function(t,i,r){typeof r=="undefined"&&(r=!1);var u;return i instanceof n.State?u=i:typeof i=="object"?(u=i,u.game=this.game):typeof i=="function"&&(u=new i(this.game)),this.states[t]=u,r&&(this.game.isBooted?this.start(t):this._pendingState=t),u},remove:function(n){this.current===n&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[n]},start:function(n,t,i){typeof t=="undefined"&&(t=!0);typeof i=="undefined"&&(i=!1);this.checkState(n)&&(this._pendingState=n,this._clearWorld=t,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(n,t){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=!1);this._pendingState=this.current;this._clearWorld=n;this._clearCache=t;arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current!==this._pendingState)return;this._pendingState=null;this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy()))},checkState:function(n){if(this.states[n]){var t=!1;return((this.states[n].preload||this.states[n].create||this.states[n].update||this.states[n].render)&&(t=!0),t===!1)?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+n),!1},link:function(n){this.states[n].game=this.game;this.states[n].add=this.game.add;this.states[n].make=this.game.make;this.states[n].camera=this.game.camera;this.states[n].cache=this.game.cache;this.states[n].input=this.game.input;this.states[n].load=this.game.load;this.states[n].math=this.game.math;this.states[n].sound=this.game.sound;this.states[n].scale=this.game.scale;this.states[n].state=this;this.states[n].stage=this.game.stage;this.states[n].time=this.game.time;this.states[n].tweens=this.game.tweens;this.states[n].world=this.game.world;this.states[n].particles=this.game.particles;this.states[n].rnd=this.game.rnd;this.states[n].physics=this.game.physics;this.states[n].key=n},unlink:function(n){this.states[n]&&(this.states[n].game=null,this.states[n].add=null,this.states[n].make=null,this.states[n].camera=null,this.states[n].cache=null,this.states[n].input=null,this.states[n].load=null,this.states[n].math=null,this.states[n].sound=null,this.states[n].scale=null,this.states[n].state=null,this.states[n].stage=null,this.states[n].time=null,this.states[n].tweens=null,this.states[n].world=null,this.states[n].particles=null,this.states[n].rnd=null,this.states[n].physics=null)},setCurrentState:function(n){this.callbackContext=this.states[n];this.link(n);this.onInitCallback=this.states[n].init||this.dummy;this.onPreloadCallback=this.states[n].preload||null;this.onLoadRenderCallback=this.states[n].loadRender||null;this.onLoadUpdateCallback=this.states[n].loadUpdate||null;this.onCreateCallback=this.states[n].create||null;this.onUpdateCallback=this.states[n].update||null;this.onPreRenderCallback=this.states[n].preRender||null;this.onRenderCallback=this.states[n].render||null;this.onResizeCallback=this.states[n].resize||null;this.onPausedCallback=this.states[n].paused||null;this.onResumedCallback=this.states[n].resumed||null;this.onPauseUpdateCallback=this.states[n].pauseUpdate||null;this.onShutDownCallback=this.states[n].shutdown||this.dummy;this.current!==""&&this.game.physics.reset();this.current=n;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);n===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(n){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,n)},resize:function(n,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,n,t)},render:function(){this._created&&this.onRenderCallback?this.game.renderType===n.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};n.StateManager.prototype.constructor=n.StateManager;
/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Signal=function(){};n.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(n,t){if(typeof n!="function")throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));},_registerListener:function(t,i,r,u){var e=this._indexOfListener(t,r),f;if(e!==-1){if(f=this._bindings[e],f.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.");}else f=new n.SignalBinding(this,t,i,r,u),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(n){this._bindings||(this._bindings=[]);var t=this._bindings.length;do t--;while(this._bindings[t]&&n._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,n)},_indexOfListener:function(n,t){if(!this._bindings)return-1;typeof t=="undefined"&&(t=null);for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r._listener===n&&r.context===t)return i;return-1},has:function(n,t){return this._indexOfListener(n,t)!==-1},add:function(n,t,i){return this.validateListener(n,"add"),this._registerListener(n,!1,t,i)},addOnce:function(n,t,i){return this.validateListener(n,"addOnce"),this._registerListener(n,!0,t,i)},remove:function(n,t){this.validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},removeAll:function(n){if(typeof n=="undefined"&&(n=null),this._bindings){for(var t=this._bindings.length;t--;)n?this._bindings[t].context===n&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();n||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var i=Array.prototype.slice.call(arguments),n=this._bindings.length,t;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice();this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(i)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(n.Signal.prototype,"boundDispatch",{get:function(){var n=this;return this._boundDispatch||(this._boundDispatch=function(){return n.dispatch.apply(n,arguments)})}});n.Signal.prototype.constructor=n.Signal;
/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SignalBinding=function(n,t,i,r,u){this._listener=t;i&&(this._isOnce=!0);r!=null&&(this.context=r);this._signal=n;u&&(this._priority=u)};n.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,callCount:0,active:!0,params:null,execute:function(n){var t,i;return this.active&&!!this._listener&&(i=this.params?this.params.concat(n):n,t=this._listener.apply(this.context,i),this.callCount++,this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};n.SignalBinding.prototype.constructor=n.SignalBinding;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Filter=function(t,i,r){var u,f;if(this.game=t,this.type=n.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new n.Point,u=new Date,this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[u.getFullYear(),u.getMonth(),u.getDate(),u.getHours()*3600+u.getMinutes()*60+u.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},i)for(f in i)this.uniforms[f]=i[f];this.fragmentSrc=r||[]};n.Filter.prototype={init:function(){},setResolution:function(n,t){this.uniforms.resolution.value.x=n;this.uniforms.resolution.value.y=t},update:function(n){if(typeof n!="undefined"){var t=n.x/this.game.width,i=1-n.y/this.game.height;(t!==this.prevPoint.x||i!==this.prevPoint.y)&&(this.uniforms.mouse.value.x=t.toFixed(2),this.uniforms.mouse.value.y=i.toFixed(2),this.prevPoint.set(t,i))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};n.Filter.prototype.constructor=n.Filter;Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(n){this.uniforms.resolution.value.x=n}});Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(n){this.uniforms.resolution.value.y=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Plugin=function(n,t){typeof t=="undefined"&&(t=null);this.game=n;this.parent=t;this.active=!1;this.visible=!1;this.hasPreUpdate=!1;this.hasUpdate=!1;this.hasPostUpdate=!1;this.hasRender=!1;this.hasPostRender=!1};n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=!1;this.visible=!1}};n.Plugin.prototype.constructor=n.Plugin;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.PluginManager=function(n){this.game=n;this.plugins=[];this._len=0;this._i=0};n.PluginManager.prototype={add:function(n){var i=Array.prototype.splice.call(arguments,1),t=!1;return typeof n=="function"?n=new n(this.game,this):(n.game=this.game,n.parent=this),typeof n.preUpdate=="function"&&(n.hasPreUpdate=!0,t=!0),typeof n.update=="function"&&(n.hasUpdate=!0,t=!0),typeof n.postUpdate=="function"&&(n.hasPostUpdate=!0,t=!0),typeof n.render=="function"&&(n.hasRender=!0,t=!0),typeof n.postRender=="function"&&(n.hasPostRender=!0,t=!0),t?((n.hasPreUpdate||n.hasUpdate||n.hasPostUpdate)&&(n.active=!0),(n.hasRender||n.hasPostRender)&&(n.visible=!0),this._len=this.plugins.push(n),typeof n.init=="function"&&n.init.apply(n,i),n):null},remove:function(n){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===n){n.destroy();this.plugins.splice(this._i,1);this._len--;return}},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0;this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};n.PluginManager.prototype.constructor=n.PluginManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Stage=function(n){this.game=n;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;n.config&&this.parseConfig(n.config)};n.Stage.prototype=Object.create(PIXI.Stage.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.parseConfig=function(n){n.disableVisibilityChange&&(this.disableVisibilityChange=n.disableVisibilityChange);n.backgroundColor&&(this.backgroundColor=n.backgroundColor)};n.Stage.prototype.boot=function(){n.DOM.getOffset(this.game.canvas,this.offset);n.Canvas.setUserSelect(this.game.canvas,"none");n.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};n.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var n=0;n<this.children.length;n++)this.children[n].preUpdate()};n.Stage.prototype.update=function(){for(var n=this.children.length;n--;)this.children[n].update()};n.Stage.prototype.postUpdate=function(){var n;if(this.game.world.camera.target)for(this.game.world.camera.target.postUpdate(),this.game.world.camera.update(),n=this.children.length;n--;)this.children[n]!==this.game.world.camera.target&&this.children[n].postUpdate();else for(this.game.world.camera.update(),n=this.children.length;n--;)this.children[n].postUpdate()};n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0;n<this.children.length;n++)this.children[n].updateTransform()};n.Stage.prototype.checkVisibility=function(){this._hiddenVar=document.webkitHidden!==undefined?"webkitvisibilitychange":document.mozHidden!==undefined?"mozvisibilitychange":document.msHidden!==undefined?"msvisibilitychange":document.hidden!==undefined?"visibilitychange":null;var t=this;this._onChange=function(n){return t.visibilityChange(n)};this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"resume"})}))};n.Stage.prototype.visibilityChange=function(n){if(n.type==="pagehide"||n.type==="blur"||n.type==="pageshow"||n.type==="focus"){n.type==="pagehide"||n.type==="blur"?this.game.focusLoss(n):(n.type==="pageshow"||n.type==="focus")&&this.game.focusGain(n);return}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||n.type==="pause"?this.game.gamePaused(n):this.game.gameResumed(n))};n.Stage.prototype.setBackgroundColor=function(t){var i=n.Color.valueToColor(t);this._backgroundColor=n.Color.getColor(i.r,i.g,i.b);this.backgroundColorSplit=[i.r/255,i.g/255,i.b/255];this.backgroundColorString=n.Color.RGBtoString(i.r,i.g,i.b,255,"#")};n.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(n){this.game.transparent||this.setBackgroundColor(n)}});Object.defineProperty(n.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(n){PIXI.scaleModes.DEFAULT=n?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Group=function(t,i,r,u,f,e){typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!1);typeof e=="undefined"&&(e=n.Physics.ARCADE);this.game=t;typeof i=="undefined"&&(i=t.world);this.name=r||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);u?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):i&&(i.addChild(this),this.z=i.children.length);this.type=n.GROUP;this.physicsType=n.GROUP;this.alive=!0;this.exists=!0;this.ignoreDestroy=!1;this.classType=n.Sprite;this.scale=new n.Point(1,1);this.cursor=null;this.enableBody=f;this.enableBodyDebug=!1;this.physicsBodyType=e;this.onDestroy=new n.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new n.Point;this._hash=[];this._sortProperty="z"};n.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Group.prototype.constructor=n.Group;n.Group.RETURN_NONE=0;n.Group.RETURN_TOTAL=1;n.Group.RETURN_CHILD=2;n.Group.SORT_ASCENDING=-1;n.Group.SORT_DESCENDING=1;n.Group.prototype.add=function(n,t){if(typeof t=="undefined"&&(t=!1),n.parent!==this){if(this.enableBody&&this.game.physics.enable(n,this.physicsBodyType),this.addChild(n),this._hash.push(n),n.z=this.children.length,!t&&n.events)n.events.onAddedToGroup$dispatch(n,this);this.cursor===null&&(this.cursor=n)}return n};n.Group.prototype.addMultiple=function(n,t){if(Array.isArray(n))for(var i=0;i<n.length;i++)this.add(n[i],t);return n};n.Group.prototype.addAt=function(n,t,i){if(typeof i=="undefined"&&(i=!1),n.parent!==this){if(this.enableBody&&this.game.physics.enable(n,this.physicsBodyType),this.addChildAt(n,t),this._hash.push(n),this.updateZ(),!i&&n.events)n.events.onAddedToGroup$dispatch(n,this);this.cursor===null&&(this.cursor=n)}return n};n.Group.prototype.getAt=function(n){return n<0||n>=this.children.length?-1:this.getChildAt(n)};n.Group.prototype.create=function(n,t,i,r,u){typeof u=="undefined"&&(u=!0);var f=new this.classType(this.game,n,t,i,r);if(this.enableBody&&this.game.physics.enable(f,this.physicsBodyType,this.enableBodyDebug),f.exists=u,f.visible=u,f.alive=u,this.addChild(f),this._hash.push(f),f.z=this.children.length,f.events)f.events.onAddedToGroup$dispatch(f,this);return this.cursor===null&&(this.cursor=f),f};n.Group.prototype.createMultiple=function(n,t,i,r){typeof r=="undefined"&&(r=!1);for(var u=0;u<n;u++)this.create(0,0,t,i,r)};n.Group.prototype.updateZ=function(){for(var n=this.children.length;n--;)this.children[n].z=n};n.Group.prototype.resetCursor=function(n){return typeof n=="undefined"&&(n=0),n>this.children.length-1&&(n=0),this.cursor?(this.cursorIndex=n,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};n.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor};n.Group.prototype.previous=function(){if(this.cursor)return this.cursorIndex===0?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor};n.Group.prototype.swap=function(n,t){this.swapChildren(n,t);this.updateZ()};n.Group.prototype.bringToTop=function(n){return n.parent===this&&this.getIndex(n)<this.children.length&&(this.remove(n,!1,!0),this.add(n,!0)),n};n.Group.prototype.sendToBack=function(n){return n.parent===this&&this.getIndex(n)>0&&(this.remove(n,!1,!0),this.addAt(n,0,!0)),n};n.Group.prototype.moveUp=function(n){if(n.parent===this&&this.getIndex(n)<this.children.length-1){var i=this.getIndex(n),t=this.getAt(i+1);t&&this.swap(n,t)}return n};n.Group.prototype.moveDown=function(n){if(n.parent===this&&this.getIndex(n)>0){var i=this.getIndex(n),t=this.getAt(i-1);t&&this.swap(n,t)}return n};n.Group.prototype.xy=function(n,t,i){if(n<0||n>this.children.length)return-1;this.getChildAt(n).x=t;this.getChildAt(n).y=i};n.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};n.Group.prototype.getIndex=function(n){return this.children.indexOf(n)};n.Group.prototype.replace=function(t,i){var r=this.getIndex(t);if(r!==-1)return i.parent&&(i.parent instanceof n.Group?i.parent.remove(i):i.parent.removeChild(i)),this.remove(t),this.addAt(i,r),t};n.Group.prototype.hasProperty=function(n,t){var i=t.length;return i===1&&t[0]in n?!0:i===2&&t[0]in n&&t[1]in n[t[0]]||i===3&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]||i===4&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]&&t[3]in n[t[0]][t[1]][t[2]]?!0:!1};n.Group.prototype.setProperty=function(n,t,i,r,u){if(typeof u=="undefined"&&(u=!1),r=r||0,!this.hasProperty(n,t)&&(!u||r>0))return!1;var f=t.length;return f===1?r===0?n[t[0]]=i:r==1?n[t[0]]+=i:r==2?n[t[0]]-=i:r==3?n[t[0]]*=i:r==4&&(n[t[0]]/=i):f===2?r===0?n[t[0]][t[1]]=i:r==1?n[t[0]][t[1]]+=i:r==2?n[t[0]][t[1]]-=i:r==3?n[t[0]][t[1]]*=i:r==4&&(n[t[0]][t[1]]/=i):f===3?r===0?n[t[0]][t[1]][t[2]]=i:r==1?n[t[0]][t[1]][t[2]]+=i:r==2?n[t[0]][t[1]][t[2]]-=i:r==3?n[t[0]][t[1]][t[2]]*=i:r==4&&(n[t[0]][t[1]][t[2]]/=i):f===4&&(r===0?n[t[0]][t[1]][t[2]][t[3]]=i:r==1?n[t[0]][t[1]][t[2]][t[3]]+=i:r==2?n[t[0]][t[1]][t[2]][t[3]]-=i:r==3?n[t[0]][t[1]][t[2]][t[3]]*=i:r==4&&(n[t[0]][t[1]][t[2]][t[3]]/=i)),!0};n.Group.prototype.checkProperty=function(t,i,r,u){return(typeof u=="undefined"&&(u=!1),!n.Utils.getProperty(t,i)&&u)?!1:n.Utils.getProperty(t,i)!==r?!1:!0};n.Group.prototype.set=function(n,t,i,r,u,f,e){return typeof e=="undefined"&&(e=!1),t=t.split("."),typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=!1),(r===!1||r&&n.alive)&&(u===!1||u&&n.visible)?this.setProperty(n,t,i,f,e):void 0};n.Group.prototype.setAll=function(n,t,i,r,u,f){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof f=="undefined"&&(f=!1);n=n.split(".");u=u||0;for(var e=0;e<this.children.length;e++)(!i||i&&this.children[e].alive)&&(!r||r&&this.children[e].visible)&&this.setProperty(this.children[e],n,t,u,f)};n.Group.prototype.setAllChildren=function(t,i,r,u,f,e){typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);typeof e=="undefined"&&(e=!1);f=f||0;for(var o=0;o<this.children.length;o++)(!r||r&&this.children[o].alive)&&(!u||u&&this.children[o].visible)&&(this.children[o]instanceof n.Group?this.children[o].setAllChildren(t,i,r,u,f,e):this.setProperty(this.children[o],t.split("."),i,f,e))};n.Group.prototype.checkAll=function(n,t,i,r,u){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);for(var f=0;f<this.children.length;f++)if((!i||i&&this.children[f].alive)&&(!r||r&&this.children[f].visible)&&!this.checkProperty(this.children[f],n,t,u))return!1;return!0};n.Group.prototype.addAll=function(n,t,i,r){this.setAll(n,t,i,r,1)};n.Group.prototype.subAll=function(n,t,i,r){this.setAll(n,t,i,r,2)};n.Group.prototype.multiplyAll=function(n,t,i,r){this.setAll(n,t,i,r,3)};n.Group.prototype.divideAll=function(n,t,i,r){this.setAll(n,t,i,r,4)};n.Group.prototype.callAllExists=function(n,t){var r,i;if(arguments.length>2)for(r=[],i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=0;i<this.children.length;i++)this.children[i].exists===t&&this.children[i][n]&&this.children[i][n].apply(this.children[i],r)};n.Group.prototype.callbackFromArray=function(n,t,i){if(i==1){if(n[t[0]])return n[t[0]]}else if(i==2){if(n[t[0]][t[1]])return n[t[0]][t[1]]}else if(i==3){if(n[t[0]][t[1]][t[2]])return n[t[0]][t[1]][t[2]]}else if(i==4){if(n[t[0]][t[1]][t[2]][t[3]])return n[t[0]][t[1]][t[2]][t[3]]}else if(n[t])return n[t];return!1};n.Group.prototype.callAll=function(n,t){var e,o,u,r,f,i;if(typeof n!="undefined"){if(n=n.split("."),e=n.length,typeof t=="undefined"||t===null||t===""?t=null:typeof t=="string"&&(t=t.split("."),o=t.length),arguments.length>2)for(u=[],i=2;i<arguments.length;i++)u.push(arguments[i]);for(r=null,f=null,i=0;i<this.children.length;i++)r=this.callbackFromArray(this.children[i],n,e),t&&r?(f=this.callbackFromArray(this.children[i],t,o),r&&r.apply(f,u)):r&&r.apply(this.children[i],u)}};n.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var n=this.children.length;n--;)this.children[n].preUpdate();return!0};n.Group.prototype.update=function(){for(var n=this.children.length;n--;)this.children[n].update()};n.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var n=this.children.length;n--;)this.children[n].postUpdate()};n.Group.prototype.filter=function(t,i){for(var u=-1,e=this.children.length,f=[],r;++u<e;)r=this.children[u],(!i||i&&r.exists)&&t(r,u,this.children)&&f.push(r);return new n.ArraySet(f)};n.Group.prototype.forEach=function(n,t,i){var u,r;if(typeof i=="undefined"&&(i=!1),arguments.length<=3)for(r=0;r<this.children.length;r++)(!i||i&&this.children[r].exists)&&n.call(t,this.children[r]);else{for(u=[null],r=3;r<arguments.length;r++)u.push(arguments[r]);for(r=0;r<this.children.length;r++)(!i||i&&this.children[r].exists)&&(u[0]=this.children[r],n.apply(t,u))}};n.Group.prototype.forEachExists=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("exists",!0,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.forEachAlive=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("alive",!0,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.forEachDead=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("alive",!1,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.sort=function(t,i){this.children.length<2||(typeof t=="undefined"&&(t="z"),typeof i=="undefined"&&(i=n.Group.SORT_ASCENDING),this._sortProperty=t,i===n.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())};n.Group.prototype.customSort=function(n,t){this.children.length<2||(this.children.sort(n.bind(t)),this.updateZ())};n.Group.prototype.ascendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?-1:n[this._sortProperty]>t[this._sortProperty]?1:n.z<t.z?-1:1};n.Group.prototype.descendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?1:n[this._sortProperty]>t[this._sortProperty]?-1:0};n.Group.prototype.iterate=function(t,i,r,u,f,e){var s,o;if(r===n.Group.RETURN_TOTAL&&this.children.length===0)return 0;for(s=0,o=0;o<this.children.length;o++)if(this.children[o][t]===i&&(s++,u&&(e?(e[0]=this.children[o],u.apply(f,e)):u.call(f,this.children[o])),r===n.Group.RETURN_CHILD))return this.children[o];return r===n.Group.RETURN_TOTAL?s:null};n.Group.prototype.getFirstExists=function(t){return typeof t!="boolean"&&(t=!0),this.iterate("exists",t,n.Group.RETURN_CHILD)};n.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,n.Group.RETURN_CHILD)};n.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,n.Group.RETURN_CHILD)};n.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]};n.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]};n.Group.prototype.countLiving=function(){return this.iterate("alive",!0,n.Group.RETURN_TOTAL)};n.Group.prototype.countDead=function(){return this.iterate("alive",!1,n.Group.RETURN_TOTAL)};n.Group.prototype.getRandom=function(t,i){return this.children.length===0?null:(t=t||0,i=i||this.children.length,n.ArrayUtils.getRandomItem(this.children,t,i))};n.Group.prototype.remove=function(n,t,i){if(typeof t=="undefined"&&(t=!1),typeof i=="undefined"&&(i=!1),this.children.length===0||this.children.indexOf(n)===-1)return!1;if(!i&&n.events&&!n.destroyPhase)n.events.onRemovedFromGroup$dispatch(n,this);var r=this.removeChild(n),u=this._hash.indexOf(r);return u!==-1&&this._hash.splice(u,1),this.updateZ(),this.cursor===n&&this.next(),t&&r&&r.destroy(!0),!0};n.Group.prototype.removeAll=function(n,t){if(typeof n=="undefined"&&(n=!1),typeof t=="undefined"&&(t=!1),this.children.length!==0){do{if(!t&&this.children[0].events)this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var i=this.removeChild(this.children[0]),r=this._hash.indexOf(i);r!==-1&&this._hash.splice(r,1);n&&i&&i.destroy(!0)}while(this.children.length>0);this._hash=[];this.cursor=null}};n.Group.prototype.removeBetween=function(n,t,i,r){var u,f,e;if(typeof t=="undefined"&&(t=this.children.length-1),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=!1),this.children.length!==0){if(n>t||n<0||t>this.children.length)return!1;for(u=t;u>=n;){if(!r&&this.children[u].events)this.children[u].events.onRemovedFromGroup$dispatch(this.children[u],this);f=this.removeChild(this.children[u]);e=this._hash.indexOf(f);e!==-1&&this._hash.splice(e,1);i&&f&&f.destroy(!0);this.cursor===this.children[u]&&(this.cursor=null);u--}this.updateZ()}};n.Group.prototype.destroy=function(n,t){this.game===null||this.ignoreDestroy||(typeof n=="undefined"&&(n=!0),typeof t=="undefined"&&(t=!1),this.onDestroy.dispatch(this,n,t),this.removeAll(n),this.cursor=null,this.filters=null,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(n.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,n.Group.RETURN_TOTAL)}});Object.defineProperty(n.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.World=function(t){n.Group.call(this,t,null,"__world",!1);this.bounds=new n.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=!1;this._width=t.width;this._height=t.height};n.World.prototype=Object.create(n.Group.prototype);n.World.prototype.constructor=n.World;n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};n.World.prototype.setBounds=function(n,t,i,r){this._definedSize=!0;this._width=i;this._height=r;this.bounds.setTo(n,t,i,r);this.x=n;this.y=t;this.camera.bounds&&this.camera.bounds.setTo(n,t,Math.max(i,this.game.width),Math.max(r,this.game.height));this.game.physics.setBoundsToWorld()};n.World.prototype.resize=function(n,t){this._definedSize&&(n<this._width&&(n=this._width),t<this._height&&(t=this._height));this.bounds.width=n;this.bounds.height=t;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};n.World.prototype.shutdown=function(){this.destroy(!0,!0)};n.World.prototype.wrap=function(n,t,i,r,u){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=!0);i?(n.getBounds(),r&&(n.x+n._currentBounds.width<this.bounds.x?n.x=this.bounds.right:n.x>this.bounds.right&&(n.x=this.bounds.left)),u&&(n.y+n._currentBounds.height<this.bounds.top?n.y=this.bounds.bottom:n.y>this.bounds.bottom&&(n.y=this.bounds.top))):(r&&n.x+t<this.bounds.x?n.x=this.bounds.right+t:r&&n.x-t>this.bounds.right&&(n.x=this.bounds.left-t),u&&n.y+t<this.bounds.top?n.y=this.bounds.bottom+t:u&&n.y-t>this.bounds.bottom&&(n.y=this.bounds.top-t))};Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(n){n<this.game.width&&(n=this.game.width);this.bounds.width=n;this._width=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(n){n<this.game.height&&(n=this.game.height);this.bounds.height=n;this._height=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}});Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexGrid=function(t,i,r){this.game=t.game;this.manager=t;this.width=i;this.height=r;this.boundsCustom=new n.Rectangle(0,0,i,r);this.boundsFluid=new n.Rectangle(0,0,i,r);this.boundsFull=new n.Rectangle(0,0,i,r);this.boundsNone=new n.Rectangle(0,0,i,r);this.positionCustom=new n.Point(0,0);this.positionFluid=new n.Point(0,0);this.positionFull=new n.Point(0,0);this.positionNone=new n.Point(0,0);this.scaleCustom=new n.Point(1,1);this.scaleFluid=new n.Point(1,1);this.scaleFluidInversed=new n.Point(1,1);this.scaleFull=new n.Point(1,1);this.scaleNone=new n.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=i/r;this.ratioV=r/i;this.multiplier=0;this.layers=[]};n.FlexGrid.prototype={setSize:function(t,i){this.width=t;this.height=i;this.ratioH=t/i;this.ratioV=i/t;this.scaleNone=new n.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,i,r,u){typeof u=="undefined"&&(u=!0);this.customWidth=t;this.customHeight=i;this.boundsCustom.width=t;this.boundsCustom.height=i;var f=new n.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return u&&this.game.world.add(f),this.layers.push(f),typeof r!="undefined"&&!0&&f.addMultiple(r),f},createFluidLayer:function(t,i){typeof i=="undefined"&&(i=!0);var r=new n.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return i&&this.game.world.add(r),this.layers.push(r),typeof t!="undefined"&&!0&&r.addMultiple(t),r},createFullLayer:function(t){var i=new n.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},createFixedLayer:function(t){var i=new n.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},reset:function(){for(var n=this.layers.length;n--;)this.layers[n].persist||(this.layers[n].position=null,this.layers[n].scale=null,this.layers.slice(n,1))},onResize:function(n,t){this.ratioH=n/t;this.ratioV=t/n;this.refresh(n,t)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(n){this.manager.scaleSprite(n);n.x=this.manager.bounds.centerX;n.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}};n.FlexGrid.prototype.constructor=n.FlexGrid;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexLayer=function(t,i,r,u){n.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1);this.manager=t.manager;this.grid=t;this.persist=!1;this.position=i;this.bounds=r;this.scale=u;this.topLeft=r.topLeft;this.topMiddle=new n.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new n.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};n.FlexLayer.prototype=Object.create(n.Group.prototype);n.FlexLayer.prototype.constructor=n.FlexLayer;n.FlexLayer.prototype.resize=function(){};n.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ScaleManager=function(t,i,r){this.game=t;this.dom=n.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new n.Point;this.forceLandscape=!1;this.forcePortrait=!1;this.incorrectOrientation=!1;this._pageAlignHorizontally=!1;this._pageAlignVertically=!1;this.maxIterations=5;this.onOrientationChange=new n.Signal;this.enterLandscape=new n.Signal;this.enterPortrait=new n.Signal;this.enterIncorrectOrientation=new n.Signal;this.leaveIncorrectOrientation=new n.Signal;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new n.Signal;this.onFullScreenChange=new n.Signal;this.onFullScreenError=new n.Signal;this.enterFullScreen=new n.Signal;this.leaveFullScreen=new n.Signal;this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new n.Point(1,1);this.scaleFactorInversed=new n.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new n.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""};this._scaleMode=n.ScaleManager.NO_SCALE;this._fullScreenScaleMode=n.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new n.Point(1,1);this.trackParentInterval=2e3;this.onSizeChange=new n.Signal;this.onResize=null;this.onResizeContext=null;this._fullScreenRestore=null;this._gameSize=new n.Rectangle;this._userScaleFactor=new n.Point(1,1);this._userScaleTrim=new n.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new n.Rectangle;this._tempBounds=new n.Rectangle;this._lastReportedCanvasSize=new n.Rectangle;this._lastReportedGameSize=new n.Rectangle;t.config&&this.parseConfig(t.config);this.setupScale(i,r)};n.ScaleManager.EXACT_FIT=0;n.ScaleManager.NO_SCALE=1;n.ScaleManager.SHOW_ALL=2;n.ScaleManager.RESIZE=3;n.ScaleManager.USER_SCALE=4;n.ScaleManager.prototype={boot:function(){var t=this.compatibility,i;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(t.scrollTo=this.game.device.android&&!this.game.device.chrome?new n.Point(0,1):new n.Point(0,0));this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");i=this;this._orientationChange=function(n){return i.orientationChange(n)};this._windowResize=function(n){return i.windowResize(n)};window.addEventListener("orientationchange",this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(n){return i.fullScreenChange(n)},this._fullScreenError=function(n){return i.fullScreenError(n)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.grid=new n.FlexGrid(this,this.width,this.height)},parseConfig:function(n){n.scaleMode&&(this.scaleMode=n.scaleMode);n.fullScreenScaleMode&&(this.fullScreenScaleMode=n.fullScreenScaleMode);n.fullScreenTarget&&(this.fullScreenTarget=n.fullScreenTarget)},setupScale:function(t,i){var e,r=new n.Rectangle,u,f;this.game.parent!==""&&(typeof this.game.parent=="string"?e=document.getElementById(this.game.parent):this.game.parent&&this.game.parent.nodeType===1&&(e=this.game.parent));e?(this.parentNode=e,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),r.width=this._parentBounds.width,r.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,r.width=this.dom.visualBounds.width,r.height=this.dom.visualBounds.height,this.offset.set(0,0));u=0;f=0;typeof t=="number"?u=t:(this.parentScaleFactor.x=parseInt(t,10)/100,u=r.width*this.parentScaleFactor.x);typeof i=="number"?f=i:(this.parentScaleFactor.y=parseInt(i,10)/100,f=r.height*this.parentScaleFactor.y);this._gameSize.setTo(0,0,u,f);this.updateDimensions(u,f,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,i){this._gameSize.setTo(0,0,t,i);this.currentScaleMode!==n.ScaleManager.RESIZE&&this.updateDimensions(t,i,!0);this.queueUpdate(!0)},setUserScale:function(n,t,i,r){this._userScaleFactor.setTo(n,t);this._userScaleTrim.setTo(i|0,r|0);this.queueUpdate(!0)},setResizeCallback:function(n,t){this.onResize=n;this.onResizeContext=t},signalSizeChange:function(){if(!n.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!n.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width,i=this.height;this._lastReportedCanvasSize.setTo(0,0,t,i);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(t,i);this.onSizeChange.dispatch(this,t,i);this.currentScaleMode===n.ScaleManager.RESIZE&&(this.game.state.resize(t,i),this.game.load.resize(t,i))}},setMinMax:function(n,t,i,r){this.minWidth=n;this.minHeight=t;typeof i!="undefined"&&(this.maxWidth=i);typeof r!="undefined"&&(this.maxHeight=r)},preUpdate:function(){var t,r;if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var u=this._parentBounds.width,f=this._parentBounds.height,i=this.getParentBounds(this._parentBounds),e=i.width!==u||i.height!==f,o=this.updateOrientationState();(e||o)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,i),this.updateLayout(),this.signalSizeChange());r=this._updateThrottle*2;this._updateThrottle<t&&(r=Math.min(t,this._updateThrottleReset));this._updateThrottle=n.Math.clamp(r,25,this.trackParentInterval);this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(n,t,i){this.width=n*this.parentScaleFactor.x;this.height=t*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(n,t){typeof t=="undefined"&&(t=!1);this.forceLandscape=n;this.forcePortrait=t;this.queueUpdate(!0)},classifyOrientation:function(n){return n==="portrait-primary"||n==="portrait-secondary"?"portrait":n==="landscape-primary"||n==="landscape-secondary"?"landscape":null},updateOrientationState:function(){var i=this.screenOrientation,r=this.incorrectOrientation,n,t;return this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait,n=i!==this.screenOrientation,t=r!==this.incorrectOrientation,n&&(this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0)),t&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(n||t)&&this.onOrientationChange.dispatch(this,i,r),n||t},orientationChange:function(n){this.event=n;this.queueUpdate(!0)},windowResize:function(n){this.event=n;this.queueUpdate(!0)},scrollTop:function(){var n=this.compatibility.scrollTo;n&&window.scrollTo(n.x,n.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode,i;if(t===n.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px");this.incorrectOrientation?this.setMaximum():t===n.ScaleManager.EXACT_FIT?this.setExactFit():t===n.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():t===n.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===n.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y);this.compatibility.canExpandParent||t!==n.ScaleManager.SHOW_ALL&&t!==n.ScaleManager.USER_SCALE||(i=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,i.width),this.height=Math.min(this.height,i.height));this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(t){var i=t||new n.Rectangle,o=this.boundingParent,f=this.dom.visualBounds,s=this.dom.layoutBounds,r,u,e;return o?(r=o.getBoundingClientRect(),i.setTo(r.left,r.top,r.width,r.height),u=this.windowConstraints,u.right&&(e=u.right==="layout"?s:f,i.right=Math.min(i.right,e.width)),u.bottom&&(e=u.bottom==="layout"?s:f,i.bottom=Math.min(i.bottom,e.height))):i.setTo(0,0,f.width,f.height),i.setTo(Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)),i},alignCanvas:function(n,t){var r=this.getParentBounds(this._tempBounds),f=this.game.canvas,i=this.margin,e,o,u,s;n&&(i.left=i.right=0,e=f.getBoundingClientRect(),this.width<r.width&&!this.incorrectOrientation&&(o=e.left-r.x,u=r.width/2-this.width/2,u=Math.max(u,0),s=u-o,i.left=Math.round(s)),f.style.marginLeft=i.left+"px",i.left!==0&&(i.right=-(r.width-e.width-i.left),f.style.marginRight=i.right+"px"));t&&(i.top=i.bottom=0,e=f.getBoundingClientRect(),this.height<r.height&&!this.incorrectOrientation&&(o=e.top-r.y,u=r.height/2-this.height/2,u=Math.max(u,0),s=u-o,i.top=Math.round(s)),f.style.marginTop=i.top+"px",i.top!==0&&(i.bottom=-(r.height-e.height-i.top),f.style.marginBottom=i.bottom+"px"));i.x=i.left;i.y=i.top},reflowGame:function(){this.resetCanvas("","");var n=this.getParentBounds(this._tempBounds);this.updateDimensions(n.width,n.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=n.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=n.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(n,t){typeof n=="undefined"&&(n=this.width+"px");typeof t=="undefined"&&(t=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom="");i.style.width=n;i.style.height=t},queueUpdate:function(n){n&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=this._updateThrottleReset},reset:function(n){n&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(n){var i=this.getParentBounds(this._tempBounds),r=i.width,u=i.height,t;t=n?Math.max(u/this.game.height,r/this.game.width):Math.min(u/this.game.height,r/this.game.width);this.width=Math.round(this.game.width*t);this.height=Math.round(this.game.height*t)},setExactFit:function(){var n=this.getParentBounds(this._tempBounds);(this.width=n.width,this.height=n.height,this.isFullScreen)||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var n=document.createElement("div");return n.style.margin="0",n.style.padding="0",n.style.background="#000",n},startFullScreen:function(t,i){var e,u,r,o,f,s;if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){e=this;setTimeout(function(){e.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"&&(u=this.game.input,u.activePointer&&u.activePointer!==u.mousePointer&&(i||i!==!1))){u.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1]);return}return typeof t!="undefined"&&this.game.renderType===n.CANVAS&&(this.game.stage.smoothed=t),r=this.fullScreenTarget,r||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),r=this._createdFullScreenTarget),o={targetElement:r},this.onFullScreenInit.dispatch(this,o),this._createdFullScreenTarget&&(f=this.game.canvas,s=f.parentNode,s.insertBefore(r,f),r.appendChild(f)),this.game.device.fullscreenKeyboard?r[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):r[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return!this.isFullScreen||!this.compatibility.supportsFullScreen?!1:(document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var n=this._createdFullScreenTarget,t;n&&n.parentNode&&(t=n.parentNode,t.insertBefore(this.game.canvas,n),t.removeChild(n));this._createdFullScreenTarget=null},prepScreenMode:function(t){var r=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?(r||this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT)&&i!==this.game.canvas&&(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(n){this.event=n;this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0),this.enterFullScreen.dispatch(this.width,this.height)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0),this.leaveFullScreen.dispatch(this.width,this.height));this.onFullScreenChange.dispatch(this)},fullScreenError:function(n){this.event=n;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(n,t,i,r){if(typeof t=="undefined"&&(t=this.width),typeof i=="undefined"&&(i=this.height),typeof r=="undefined"&&(r=!1),n.scale.set(1),n.width<=0||n.height<=0||t<=0||i<=0)return n;var e=t,o=n.height*t/n.width,f=n.width*i/n.height,s=i,u=f>t;return u=u?r:!r,u?(n.width=Math.floor(e),n.height=Math.floor(o)):(n.width=Math.floor(f),n.height=Math.floor(s)),n},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}};n.ScaleManager.prototype.constructor=n.ScaleManager;n.ScaleManager.prototype.checkResize=n.ScaleManager.prototype.windowResize;n.ScaleManager.prototype.checkOrientation=n.ScaleManager.prototype.orientationChange;n.ScaleManager.prototype.setScreenSize=n.ScaleManager.prototype.updateLayout;n.ScaleManager.prototype.setSize=n.ScaleManager.prototype.reflowCanvas;n.ScaleManager.prototype.checkOrientationState=function(){var n=this.updateOrientationState();return n&&this.refresh(),n};Object.defineProperty(n.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&!this._createdFullScreenTarget)return null;var n=this.game.canvas&&this.game.canvas.parentNode;return n||null}});Object.defineProperty(n.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(n){return n!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=n),this._scaleMode}});Object.defineProperty(n.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(n){return n!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=n,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=n),this._fullScreenScaleMode}});Object.defineProperty(n.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(n.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(n){n!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=n,this.queueUpdate(!0))}});Object.defineProperty(n.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(n){n!==this._pageAlignVertically&&(this._pageAlignVertically=n,this.queueUpdate(!0))}});Object.defineProperty(n.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(n.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(n.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(n.ScaleManager.prototype,"orientation",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"?0:90}});Object.defineProperty(n.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(n.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Game=function(t,i,r,u,f,e,o,s){return this.id=n.GAMES.push(this)-1,this.config=null,this.physicsConfig=s,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=n.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=n.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new n.Signal,this.forceSingleUpdate=!1,this._nextFpsNotification=0,arguments.length===1&&typeof arguments[0]=="object"?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},typeof t!="undefined"&&(this._width=t),typeof i!="undefined"&&(this._height=i),typeof r!="undefined"&&(this.renderType=r),typeof u!="undefined"&&(this.parent=u),typeof e!="undefined"&&(this.transparent=e),typeof o!="undefined"&&(this.antialias=o),this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new n.StateManager(this,f)),this.device.whenReady(this.boot,this),this};n.Game.prototype={parseConfig:function(t){var i,r;this.config=t;typeof t.enableDebug=="undefined"&&(this.config.enableDebug=!0);t.width&&(this._width=t.width);t.height&&(this._height=t.height);t.renderer&&(this.renderType=t.renderer);t.parent&&(this.parent=t.parent);t.transparent&&(this.transparent=t.transparent);t.antialias&&(this.antialias=t.antialias);t.resolution&&(this.resolution=t.resolution);t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer);t.physicsConfig&&(this.physicsConfig=t.physicsConfig);i=[(Date.now()*Math.random()).toString()];t.seed&&(i=t.seed);this.rnd=new n.RandomDataGenerator(i);r=null;t.state&&(r=t.state);this.state=new n.StateManager(this,r)},boot:function(){this.isBooted||(this.onPause=new n.Signal,this.onResume=new n.Signal,this.onBlur=new n.Signal,this.onFocus=new n.Signal,this.isBooted=!0,this.math=n.Math,this.scale=new n.ScaleManager(this,this._width,this._height),this.stage=new n.Stage(this),this.setUpRenderer(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.make=new n.GameObjectCreator(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics(this,this.physicsConfig),this.particles=new n.Particles(this),this.plugins=new n.PluginManager(this),this.net=new n.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new n.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new n.RequestAnimationFrame(this,this.config.forceSetTimeOut):new n.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(window.PhaserGlobal&&(!window.PhaserGlobal||window.PhaserGlobal.stopFocus)||window.focus()),this.raf.start())},showDebugHeader:function(){var i,r;if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var e=n.VERSION,t="Canvas",u="HTML Audio",f=1;if(this.renderType===n.WEBGL?(t="WebGL",f++):this.renderType==n.HEADLESS&&(t="Headless"),this.device.webAudio&&(u="WebAudio",f++),this.device.chrome){for(i=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+u+"  %c %c %c http://phaser.io %c♥%c♥%c♥","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"],r=0;r<3;r++)r<f?i.push("color: #ff2424; background: #fff"):i.push("color: #959595; background: #fff");console.log.apply(console,i)}else window.console&&console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+u+" | http://phaser.io")}},setUpRenderer:function(){if(this.canvas=this.config.canvasID?n.Canvas.create(this.width,this.height,this.config.canvasID):n.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===n.CANVAS?!0:!1),this.renderType===n.HEADLESS||this.renderType===n.CANVAS||this.renderType===n.AUTO&&this.device.webGL===!1)if(this.device.canvas)this.renderType===n.AUTO&&(this.renderType=n.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:!0}),this.context=this.renderer.context;else throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");else this.renderType=n.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.context=null;this.renderType!==n.HEADLESS&&(this.stage.smoothed=this.antialias,n.Canvas.addToDOM(this.canvas,this.parent,!1),n.Canvas.setTouchAction(this.canvas))},update:function(n){var i,t;if(this.time.update(n),this._kickstart){this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=!1;return}if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{for(i=this.time.slowMotion*1e3/this.time.desiredFps,this._deltaTime+=Math.max(Math.min(i*3,this.time.elapsed),0),t=0,this.updatesThisFrame=Math.floor(this._deltaTime/i),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=i;)if(this._deltaTime-=i,this.currentUpdateID=t,this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),t++,this.forceSingleUpdate&&t===1)break;t>this._lastCount?this._spiraling++:t<this._lastCount&&(this._spiraling=0);this._lastCount=t;this.updateRender(this._deltaTime/i)}},updateLogic:function(n){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.world.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(n),this.plugins.preUpdate(n),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(n),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate())},updateRender:function(n){this.lockRender||(this.state.preRender(n),this.renderer.render(this.stage),this.plugins.render(n),this.state.render(n),this.plugins.postRender(n))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.stepping=!1;this.pendingStep=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=!1;this.renderer.destroy(!1);n.Canvas.removeFromDOM(this.canvas);n.GAMES[this.id]=null},gamePaused:function(n){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(n))},gameResumed:function(n){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(n))},focusLoss:function(n){this.onBlur.dispatch(n);this.stage.disableVisibilityChange||this.gamePaused(n)},focusGain:function(n){this.onFocus.dispatch(n);this.stage.disableVisibilityChange||this.gameResumed(n)}};n.Game.prototype.constructor=n.Game;Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(n){n===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=!0;this.multiInputOverride=n.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=!1;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=!1;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new n.ArraySet;this._localPoint=new n.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};n.Input.MOUSE_OVERRIDES_TOUCH=0;n.Input.TOUCH_OVERRIDES_MOUSE=1;n.Input.MOUSE_TOUCH_COMBINE=2;n.Input.MAX_POINTERS=10;n.Input.prototype={boot:function(){this.mousePointer=new n.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new n.Mouse(this.game);this.touch=new n.Touch(this.game);this.mspointer=new n.MSPointer(this.game);n.Keyboard&&(this.keyboard=new n.Keyboard(this.game));n.Gamepad&&(this.gamepad=new n.Gamepad(this.game));this.onDown=new n.Signal;this.onUp=new n.Signal;this.onTap=new n.Signal;this.onHold=new n.Signal;this.scale=new n.Point(1,1);this.speed=new n.Point;this.position=new n.Point;this._oldPosition=new n.Point;this.circle=new n.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0;this.keyboard&&this.keyboard.start();var t=this;this._onClickTrampoline=function(n){t.onClickTrampoline(n)};this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(n,t){return this.moveCallbacks.push({callback:n,context:t})-1},deleteMoveCallback:function(n){this.moveCallbacks[n]&&this.moveCallbacks.splice(n,1)},addPointer:function(){if(this.pointers.length>=n.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: only "+n.Input.MAX_POINTERS+" pointer allowed"),null;var i=this.pointers.length+1,t=new n.Pointer(this.game,i);return this.pointers.push(t),this["pointer"+i]=t,t},update:function(){if(this.keyboard&&this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var n=0;n<this.pointers.length;n++)this.pointers[n].update();this._pollCounter=0},reset:function(t){if(this.game.isBooted&&!this.resetLocked){typeof t=="undefined"&&(t=!1);this.mousePointer.reset();this.keyboard&&this.keyboard.reset(t);this.gamepad&&this.gamepad.reset();for(var i=0;i<this.pointers.length;i++)this.pointers[i].reset();this.currentPointers=0;this.game.canvas.style.cursor!=="none"&&(this.game.canvas.style.cursor="inherit");t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(n,t){this._oldPosition.setTo(n,t);this.speed.setTo(0,0)},startPointer:function(n){var t,i;if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(n);if(!this.pointer2.active)return this.pointer2.start(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],!i.active)return i.start(n);return null},updatePointer:function(n){var t,i;if(this.pointer1.active&&this.pointer1.identifier===n.identifier)return this.pointer1.move(n);if(this.pointer2.active&&this.pointer2.identifier===n.identifier)return this.pointer2.move(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],i.active&&i.identifier===n.identifier)return i.move(n);return null},stopPointer:function(n){var t,i;if(this.pointer1.active&&this.pointer1.identifier===n.identifier)return this.pointer1.stop(n);if(this.pointer2.active&&this.pointer2.identifier===n.identifier)return this.pointer2.stop(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],i.active&&i.identifier===n.identifier)return i.stop(n);return null},countActivePointers:function(n){var t,i,r;for(typeof n=="undefined"&&(n=this.pointers.length),t=n,i=0;i<this.pointers.length&&t>0;i++)r=this.pointers[i],r.active&&t--;return this.currentPointers=n-t,n-t},getPointer:function(n){var t,i;for(typeof n=="undefined"&&(n=!1),t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.active===n)return i;return null},getPointerFromIdentifier:function(n){for(var i,t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.identifier===n)return i;return null},getPointerFromId:function(n){for(var i,t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.pointerId===n)return i;return null},getLocalPosition:function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.worldTransform,f=1/(u.a*u.d+u.c*-u.b);return r.setTo(u.d*f*i.x+-u.c*f*i.y+(u.ty*u.c-u.tx*u.d)*f,u.a*f*i.y+-u.b*f*i.x+(-u.ty*u.a+u.tx*u.b)*f)},hitTest:function(t,i,r){var f,h,u,c;if(!t.worldVisible)return!1;if(this.getLocalPosition(t,i,this._localPoint),r.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(t instanceof n.TileSprite){var e=t.width,o=t.height,s=-e*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+e&&(f=-o*t.anchor.y,this._localPoint.y>=f&&this._localPoint.y<f+o))return!0}else if(t instanceof PIXI.Sprite){var e=t.texture.frame.width,o=t.texture.frame.height,s=-e*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+e&&(f=-o*t.anchor.y,this._localPoint.y>=f&&this._localPoint.y<f+o))return!0}else if(t instanceof n.Graphics)for(u=0;u<t.graphicsData.length;u++)if((h=t.graphicsData[u],h.fill)&&h.shape&&h.shape.contains(this._localPoint.x,this._localPoint.y))return!0;for(u=0,c=t.children.length;u<c;u++)if(this.hitTest(t.children[u],i,r))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};n.Input.prototype.constructor=n.Input;Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(n){this._x=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(n){this._y=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(n.Input.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Mouse=function(t){this.game=t;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=!1;this.button=-1;this.wheelDelta=0;this.enabled=!0;this.locked=!1;this.stopOnGameOut=!1;this.pointerLock=new n.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};n.Mouse.NO_BUTTON=-1;n.Mouse.LEFT_BUTTON=0;n.Mouse.MIDDLE_BUTTON=1;n.Mouse.RIGHT_BUTTON=2;n.Mouse.WHEEL_UP=1;n.Mouse.WHEEL_DOWN=-1;n.Mouse.prototype={start:function(){var n,i;this.game.device.android&&this.game.device.chrome===!1||this._onMouseDown===null&&(n=this,this._onMouseDown=function(t){return n.onMouseDown(t)},this._onMouseMove=function(t){return n.onMouseMove(t)},this._onMouseUp=function(t){return n.onMouseUp(t)},this._onMouseUpGlobal=function(t){return n.onMouseUpGlobal(t)},this._onMouseOut=function(t){return n.onMouseOut(t)},this._onMouseOver=function(t){return n.onMouseOver(t)},this._onMouseWheel=function(t){return n.onMouseWheel(t)},this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0)),i=this.game.device.wheelEvent,i&&(this.game.canvas.addEventListener(i,this._onMouseWheel,!0),i==="mousewheel"?this._wheelEvent=new t(-1/40,1):i==="DOMMouseScroll"&&(this._wheelEvent=new t(1,1))))},onMouseDown:function(n){(this.event=n,this.capture&&n.preventDefault(),this.button=n.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&(n.identifier=0,this.game.input.mousePointer.start(n))},onMouseMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&(n.identifier=0,this.game.input.mousePointer.move(n))},onMouseUp:function(t){(this.event=t,this.capture&&t.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled)&&(t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.game.input.mousePointer.withinGame||(this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseOut:function(n){(this.event=n,this.capture&&n.preventDefault(),this.game.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&this.stopOnGameOut&&(n.identifier=0,this.game.input.mousePointer.stop(n))},onMouseWheel:function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t));this.event=t;this.capture&&t.preventDefault();this.wheelDelta=n.Math.clamp(-t.deltaY,-1,1);this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},onMouseOver:function(n){this.event=n;this.capture&&n.preventDefault();this.game.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,n);!this.game.input.enabled||!this.enabled},requestPointerLock:function(){var n,t;this.game.device.pointerLock&&(n=this.game.canvas,n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock(),t=this,this._pointerLockChange=function(n){return t.pointerLockChange(n)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0))},pointerLockChange:function(n){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,n)):(this.locked=!1,this.pointerLock.dispatch(!1,n))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0);var n=this.game.device.wheelEvent;n&&this.game.canvas.removeEventListener(n,this._onMouseWheel,!0);window.removeEventListener("mouseup",this._onMouseUpGlobal,!0);document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}};n.Mouse.prototype.constructor=n.Mouse;Object.defineProperty(n.Mouse.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});t.prototype={};t.prototype.constructor=t;t.prototype.bindEvent=function(n){var r,i;if(!t._stubsGenerated&&n){r=function(n){return function(){var t=this.originalEvent[n];return typeof t!="function"?t:t.bind(this.originalEvent)}};for(i in n)i in t.prototype||Object.defineProperty(t.prototype,i,{get:r(i)});t._stubsGenerated=!0}return this.originalEvent=n,this};Object.defineProperties(t.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.MSPointer=function(n){this.game=n;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=!0;this.button=-1;this.event=null;this.enabled=!0;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};n.MSPointer.prototype={start:function(){if(this._onMSPointerDown===null){var n=this;this.game.device.mspointer&&(this._onMSPointerDown=function(t){return n.onPointerDown(t)},this._onMSPointerMove=function(t){return n.onPointerMove(t)},this._onMSPointerUp=function(t){return n.onPointerUp(t)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(n){(this.event=n,this.capture&&n.preventDefault(),this.button=n.button,this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&(n.identifier=n.pointerId,this.game.input.startPointer(n))},onPointerMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&(n.identifier=n.pointerId,this.game.input.updatePointer(n))},onPointerUp:function(t){(this.event=t,this.capture&&t.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled)&&(t.identifier=t.pointerId,this.game.input.stopPointer(t))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};n.MSPointer.prototype.constructor=n.MSPointer;Object.defineProperty(n.MSPointer.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Pointer=function(t,i){this.game=t;this.id=i;this.type=n.POINTER;this.exists=!0;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=!1;this._history=[];this._nextDrop=0;this._stateReset=!1;this.withinGame=!1;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=!1;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=!1;this.dirty=!1;this.position=new n.Point;this.positionDown=new n.Point;this.positionUp=new n.Point;this.circle=new n.Circle(0,0,44);i===0&&(this.isMouse=!0);this._clickTrampolines=null;this._trampolineTargetObject=null};n.Pointer.prototype={start:function(t){return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,typeof t.button!="undefined"&&(this.button=t.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,t),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(t,i){if(!this.game.input.pollLocked){if(typeof i=="undefined"&&(i=!1),typeof t.button!="undefined"&&(this.button=t.button),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&this.game.input.mouse.locked&&!i&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var r=this.game.input.moveCallbacks.length;r--;)this.game.input.moveCallbacks[r].callback.call(this.game.input.moveCallbacks[r].context,this,this.x,this.y,i);return this.targetObject!==null&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(i),this}},processInteractiveObjects:function(n){for(var r=Number.MAX_VALUE,u=-1,i=null,t=this.game.input.interactiveItems.first;t;)t.checked=!1,t.validForInput(u,r,!1)&&(t.checked=!0,(n&&t.checkPointerDown(this,!0)||!n&&t.checkPointerOver(this,!0))&&(r=t.sprite.renderOrderID,u=t.priorityID,i=t)),t=this.game.input.interactiveItems.next;for(t=this.game.input.interactiveItems.first;t;)!t.checked&&t.validForInput(u,r,!0)&&(n&&t.checkPointerDown(this,!1)||!n&&t.checkPointerOver(this,!1))&&(r=t.sprite.renderOrderID,u=t.priorityID,i=t),t=this.game.input.interactiveItems.next;return i===null?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):this.targetObject===null?(this.targetObject=i,i._pointerOverHandler(this)):this.targetObject===i?i.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=i,this.targetObject._pointerOverHandler(this)),this.targetObject!==null},leave:function(n){this.withinGame=!1;this.move(n,!1)},stop:function(t){if(this._stateReset&&this.withinGame){t.preventDefault();return}return this.timeUp=this.game.time.time,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.onUp.dispatch(this,t),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this},justPressed:function(n){return n=n||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+n>this.game.time.time},justReleased:function(n){return n=n||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+n>this.game.time.time},addClickTrampoline:function(n,t,i,r){var u,f;if(this.isDown){for(u=this._clickTrampolines=this._clickTrampolines||[],f=0;f<u.length;f++)if(u[f].name===n){u.splice(f,1);break}u.push({name:n,targetObject:this.targetObject,callback:t,callbackContext:i,callbackArgs:r})}},processClickTrampolines:function(){var i=this._clickTrampolines,t,n;if(i){for(t=0;t<i.length;t++)n=i[t],n.targetObject===this._trampolineTargetObject&&n.callback.apply(n.callbackContext,n.callbackArgs);this._clickTrampolines=null;this._trampolineTargetObject=null}},reset:function(){this.isMouse===!1&&(this.active=!1);this.pointerId=null;this.identifier=null;this.dirty=!1;this.isDown=!1;this.isUp=!0;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};n.Pointer.prototype.constructor=n.Pointer;Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Touch=function(n){this.game=n;this.enabled=!0;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=!0;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};n.Touch.prototype={start:function(){if(this._onTouchStart===null){var n=this;this.game.device.touch&&(this._onTouchStart=function(t){return n.onTouchStart(t)},this._onTouchMove=function(t){return n.onTouchMove(t)},this._onTouchEnd=function(t){return n.onTouchEnd(t)},this._onTouchEnter=function(t){return n.onTouchEnter(t)},this._onTouchLeave=function(t){return n.onTouchLeave(t)},this._onTouchCancel=function(t){return n.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(n){n.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(n){if(this.event=n,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.startPointer(n.changedTouches[t])}},onTouchCancel:function(n){if(this.event=n,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])}},onTouchEnter:function(n){(this.event=n,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&this.preventDefault&&n.preventDefault()},onTouchLeave:function(n){this.event=n;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault()},onTouchMove:function(n){this.event=n;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.updatePointer(n.changedTouches[t])},onTouchEnd:function(n){this.event=n;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}};n.Touch.prototype.constructor=n.Touch;Object.defineProperty(n.Touch.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=!1;this.checked=!1;this.priorityID=0;this.useHandCursor=!1;this._setHandCursor=!1;this.isDragged=!1;this.allowHorizontalDrag=!0;this.allowVerticalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnDrag=!1;this.snapOnRelease=!1;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=!1;this.pixelPerfectClick=!1;this.pixelPerfectAlpha=255;this.draggable=!1;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=!1;this.scaleLayer=!1;this.dragOffset=new n.Point;this.dragFromCenter=!1;this.dragStartPoint=new n.Point;this._dragPoint=new n.Point;this._dragPhase=!1;this._wasEnabled=!1;this._tempPoint=new n.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};n.InputHandler.prototype={start:function(t,i){if(t=t||0,typeof i=="undefined"&&(i=!1),this.enabled===!1){this.game.input.interactiveItems.add(this);this.useHandCursor=i;this.priorityID=t;for(var r=0;r<10;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point;this.enabled=!0;this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;this.flagged=!1;for(var n=0;n<10;n++)this._pointerData[n]={id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(n,t,i){return(typeof i=="undefined"&&(i=!0),this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID)?!1:!i&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>n||this.priorityID===n&&this.sprite.renderOrderID<t?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(n){return n=n||0,this._pointerData[n].x},pointerY:function(n){return n=n||0,this._pointerData[n].y},pointerDown:function(n){return n=n||0,this._pointerData[n].isDown},pointerUp:function(n){return n=n||0,this._pointerData[n].isUp},pointerTimeDown:function(n){return n=n||0,this._pointerData[n].timeDown},pointerTimeUp:function(n){return n=n||0,this._pointerData[n].timeUp},pointerOver:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOver)return!0}else return this._pointerData[n].isOver;return!1},pointerOut:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOut)return!0}else return this._pointerData[n].isOut;return!1},pointerTimeOver:function(n){return n=n||0,this._pointerData[n].timeOver},pointerTimeOut:function(n){return n=n||0,this._pointerData[n].timeOut},pointerDragged:function(n){return n=n||0,this._pointerData[n].isDragged},checkPointerDown:function(n,t){return!n.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(typeof t=="undefined"&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(n,t){return!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(typeof t=="undefined"&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(n,t,i){var n,t,r;if(this.sprite.texture.baseTexture.source){if(n===null&&t===null&&(this.game.input.getLocalPosition(this.sprite,i,this._tempPoint),n=this._tempPoint.x,t=this._tempPoint.y),this.sprite.anchor.x!==0&&(n-=-this.sprite.texture.frame.width*this.sprite.anchor.x),this.sprite.anchor.y!==0&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),n+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(n-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y,n<this.sprite.texture.crop.x||n>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom))return this._dx=n,this._dy=t,!1;if(this._dx=n,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,n,t,1,1,0,0,1,1),r=this.game.input.hitContext.getImageData(0,0,1,1),r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(n){if(this.sprite!==null&&this.sprite.parent!==undefined)return!this.enabled||!this.sprite.visible||!this.sprite.parent.visible?(this._pointerOutHandler(n),!1):this.draggable&&this._draggedPointerID===n.id?this.updateDrag(n):this._pointerData[n.id].isOver?this.checkPointerOver(n)?(this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,!0):(this._pointerOutHandler(n),!1):void 0},_pointerOverHandler:function(n){if(this.sprite!==null&&(this._pointerData[n.id].isOver===!1||n.dirty)&&(this._pointerData[n.id].isOver=!0,this._pointerData[n.id].isOut=!1,this._pointerData[n.id].timeOver=this.game.time.time,this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events))this.sprite.events.onInputOver$dispatch(this.sprite,n)},_pointerOutHandler:function(n){if(this.sprite!==null&&(this._pointerData[n.id].isOver=!1,this._pointerData[n.id].isOut=!0,this._pointerData[n.id].timeOut=this.game.time.time,this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events))this.sprite.events.onInputOut$dispatch(this.sprite,n)},_touchedHandler:function(n){if(this.sprite!==null){if(this._pointerData[n.id].isDown===!1&&this._pointerData[n.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,n))return;if(this._pointerData[n.id].isDown=!0,this._pointerData[n.id].isUp=!1,this._pointerData[n.id].timeDown=this.game.time.time,this.sprite&&this.sprite.events)this.sprite.events.onInputDown$dispatch(this.sprite,n);n.dirty=!0;this.draggable&&this.isDragged===!1&&this.startDrag(n);this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(n){if(this.sprite!==null&&this._pointerData[n.id].isDown&&n.isUp){if(this._pointerData[n.id].isDown=!1,this._pointerData[n.id].isUp=!0,this._pointerData[n.id].timeUp=this.game.time.time,this._pointerData[n.id].downDuration=this._pointerData[n.id].timeUp-this._pointerData[n.id].timeDown,this.checkPointerOver(n)){if(this.sprite&&this.sprite.events)this.sprite.events.onInputUp$dispatch(this.sprite,n,!0)}else{if(this.sprite&&this.sprite.events)this.sprite.events.onInputUp$dispatch(this.sprite,n,!1);this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)}n.dirty=!0;this.draggable&&this.isDragged&&this._draggedPointerID===n.id&&this.stopDrag(n)}},updateDrag:function(n){if(n.isUp)return this.stopDrag(n),!1;var t=this.globalToLocalX(n.x)+this._dragPoint.x+this.dragOffset.x,i=this.globalToLocalY(n.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=t),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=i),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=t),this.allowVerticalDrag&&(this.sprite.y=i),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0},justOver:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOver&&this.overDuration(n)<t},justOut:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOut&&this.game.time.time-this._pointerData[n].timeOut<t},justPressed:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isDown&&this.downDuration(n)<t},justReleased:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isUp&&this.game.time.time-this._pointerData[n].timeUp<t},overDuration:function(n){return(n=n||0,this._pointerData[n].isOver)?this.game.time.time-this._pointerData[n].timeOver:-1},downDuration:function(n){return(n=n||0,this._pointerData[n].isDown)?this.game.time.time-this._pointerData[n].timeDown:-1},enableDrag:function(t,i,r,u,f,e){typeof t=="undefined"&&(t=!1);typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=255);typeof f=="undefined"&&(f=null);typeof e=="undefined"&&(e=null);this._dragPoint=new n.Point;this.draggable=!0;this.bringToTop=i;this.dragOffset=new n.Point;this.dragFromCenter=t;this.pixelPerfectClick=r;this.pixelPerfectAlpha=u;f&&(this.boundsRect=f);e&&(this.boundsSprite=e)},disableDrag:function(){if(this._pointerData)for(var n=0;n<10;n++)this._pointerData[n].isDragged=!1;this.draggable=!1;this.isDragged=!1;this._draggedPointerID=-1},startDrag:function(n){var i=this.sprite.x,r=this.sprite.y,t;this.isDragged=!0;this._draggedPointerID=n.id;this._pointerData[n.id].isDragged=!0;this.sprite.fixedToCamera?this.dragFromCenter?(this.sprite.centerOn(n.x,n.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y):(this.dragFromCenter&&(t=this.sprite.getBounds(),this.sprite.x=this.globalToLocalX(n.x)+(this.sprite.x-t.centerX),this.sprite.y=this.globalToLocalY(n.y)+(this.sprite.y-t.centerY)),this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(n.x),this.sprite.y-this.globalToLocalY(n.y)));this.updateDrag(n);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(i,r);this.sprite.events.onDragStart$dispatch(this.sprite,n,i,r)},globalToLocalX:function(n){return this.scaleLayer&&(n-=this.game.scale.grid.boundsFluid.x,n*=this.game.scale.grid.scaleFluidInversed.x),n},globalToLocalY:function(n){return this.scaleLayer&&(n-=this.game.scale.grid.boundsFluid.y,n*=this.game.scale.grid.scaleFluidInversed.y),n},stopDrag:function(n){this.isDragged=!1;this._draggedPointerID=-1;this._pointerData[n.id].isDragged=!1;this._dragPhase=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop$dispatch(this.sprite,n);this.checkPointerOver(n)===!1&&this._pointerOutHandler(n)},setDragLock:function(n,t){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=!0);this.allowHorizontalDrag=n;this.allowVerticalDrag=t},enableSnap:function(n,t,i,r,u,f){typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=0);this.snapX=n;this.snapY=t;this.snapOffsetX=u;this.snapOffsetY=f;this.snapOnDrag=i;this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1;this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}};n.InputHandler.prototype.constructor=n.InputHandler;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!=-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this)]};n.Gamepad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback,this.callbackContext=n)},start:function(){if(!this._active){this._active=!0;var n=this;this._onGamepadConnected=function(t){return n.onGamepadConnected(t)};this._onGamepadDisconnected=function(t){return n.onGamepadDisconnected(t)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(n){var t=n.gamepad;this._rawPads.push(t);this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(n){var t=n.gamepad;for(var i in this._rawPads)this._rawPads[i].index===t.index&&this._rawPads.splice(i,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){var t,h,n,r,i,f,o,u,s,e;if(navigator.getGamepads?t=navigator.getGamepads():navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.webkitGamepads&&(t=navigator.webkitGamepads()),t){for(this._rawPads=[],h=!1,n=0;n<t.length;n++)if(typeof t[n]!==this._prevRawGamepadTypes[n]&&(h=!0,this._prevRawGamepadTypes[n]=typeof t[n]),t[n]&&this._rawPads.push(t[n]),n===3)break;if(h){for(r={rawIndices:{},padIndices:{}},f=0;f<this._gamepads.length;f++)if(i=this._gamepads[f],i.connected)for(o=0;o<this._rawPads.length;o++)this._rawPads[o].index===i.index&&(r.rawIndices[i.index]=!0,r.padIndices[f]=!0);for(u=0;u<this._gamepads.length;u++)if(i=this._gamepads[u],!r.padIndices[u])for(this._rawPads.length<1&&i.disconnect(),s=0;s<this._rawPads.length;s++){if(r.padIndices[u])break;if(e=this._rawPads[s],e)if(r.rawIndices[e.index]){i.disconnect();continue}else i.connect(e),r.rawIndices[e.index]=!0,r.padIndices[u]=!0;else i.disconnect()}}}},setDeadZones:function(n){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=n},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].reset()},justPressed:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justPressed(n,t)===!0)return!0;return!1},justReleased:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justReleased(n,t)===!0)return!0;return!1},isDown:function(n){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(n)===!0)return!0;return!1},destroy:function(){this.stop();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].destroy()}};n.Gamepad.prototype.constructor=n.Gamepad;Object.defineProperty(n.Gamepad.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});n.Gamepad.BUTTON_0=0;n.Gamepad.BUTTON_1=1;n.Gamepad.BUTTON_2=2;n.Gamepad.BUTTON_3=3;n.Gamepad.BUTTON_4=4;n.Gamepad.BUTTON_5=5;n.Gamepad.BUTTON_6=6;n.Gamepad.BUTTON_7=7;n.Gamepad.BUTTON_8=8;n.Gamepad.BUTTON_9=9;n.Gamepad.BUTTON_10=10;n.Gamepad.BUTTON_11=11;n.Gamepad.BUTTON_12=12;n.Gamepad.BUTTON_13=13;n.Gamepad.BUTTON_14=14;n.Gamepad.BUTTON_15=15;n.Gamepad.AXIS_0=0;n.Gamepad.AXIS_1=1;n.Gamepad.AXIS_2=2;n.Gamepad.AXIS_3=3;n.Gamepad.AXIS_4=4;n.Gamepad.AXIS_5=5;n.Gamepad.AXIS_6=6;n.Gamepad.AXIS_7=7;n.Gamepad.AXIS_8=8;n.Gamepad.AXIS_9=9;n.Gamepad.XBOX360_A=0;n.Gamepad.XBOX360_B=1;n.Gamepad.XBOX360_X=2;n.Gamepad.XBOX360_Y=3;n.Gamepad.XBOX360_LEFT_BUMPER=4;n.Gamepad.XBOX360_RIGHT_BUMPER=5;n.Gamepad.XBOX360_LEFT_TRIGGER=6;n.Gamepad.XBOX360_RIGHT_TRIGGER=7;n.Gamepad.XBOX360_BACK=8;n.Gamepad.XBOX360_START=9;n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;n.Gamepad.XBOX360_DPAD_LEFT=14;n.Gamepad.XBOX360_DPAD_RIGHT=15;n.Gamepad.XBOX360_DPAD_UP=12;n.Gamepad.XBOX360_DPAD_DOWN=13;n.Gamepad.XBOX360_STICK_LEFT_X=0;n.Gamepad.XBOX360_STICK_LEFT_Y=1;n.Gamepad.XBOX360_STICK_RIGHT_X=2;n.Gamepad.XBOX360_STICK_RIGHT_Y=3;n.Gamepad.PS3XC_X=0;n.Gamepad.PS3XC_CIRCLE=1;n.Gamepad.PS3XC_SQUARE=2;n.Gamepad.PS3XC_TRIANGLE=3;n.Gamepad.PS3XC_L1=4;n.Gamepad.PS3XC_R1=5;n.Gamepad.PS3XC_L2=6;n.Gamepad.PS3XC_R2=7;n.Gamepad.PS3XC_SELECT=8;n.Gamepad.PS3XC_START=9;n.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;n.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;n.Gamepad.PS3XC_DPAD_UP=12;n.Gamepad.PS3XC_DPAD_DOWN=13;n.Gamepad.PS3XC_DPAD_LEFT=14;n.Gamepad.PS3XC_DPAD_RIGHT=15;n.Gamepad.PS3XC_STICK_LEFT_X=0;n.Gamepad.PS3XC_STICK_LEFT_Y=1;n.Gamepad.PS3XC_STICK_RIGHT_X=2;n.Gamepad.PS3XC_STICK_RIGHT_Y=3;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SinglePad=function(n,t){this.game=n;this.index=null;this.connected=!1;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=t;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};n.SinglePad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback)},getButton:function(n){return this._buttons[n]?this._buttons[n]:null},pollStatus:function(){var n,t,i,r;if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(n=0;n<this._buttonsLen;n++)t=isNaN(this._rawPad.buttons[n])?this._rawPad.buttons[n].value:this._rawPad.buttons[n],t!==this._buttons[n].value&&(t===1?this.processButtonDown(n,t):t===0?this.processButtonUp(n,t):this.processButtonFloat(n,t));for(i=0;i<this._axesLen;i++)r=this._rawPad.axes[i],r>0&&r>this.deadZone||r<0&&r<-this.deadZone?this.processAxisChange(i,r):this.processAxisChange(i,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var u=!this.connected,i,r;for(this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length,i=0;i<this._axesLen;i++)this._axes[i]=t.axes[i];for(r in t.buttons)r=parseInt(r,10),this._buttons[r]=new n.GamepadButton(this,r);u&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);u&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,i=this.index,n;for(this.connected=!1,this.index=null,this._rawPad=undefined,n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,i);t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=undefined;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(n,t){this._axes[n]!==t&&(this._axes[n]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,n,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,n,t))},processButtonDown:function(n,t){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,n,t,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonDown(t)},processButtonUp:function(n,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,n,t,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonUp(t)},processButtonFloat:function(n,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,n,t,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonFloat(t)},axis:function(n){return this._axes[n]?this._axes[n]:!1},isDown:function(n){return this._buttons[n]?this._buttons[n].isDown:!1},isUp:function(n){return this._buttons[n]?this._buttons[n].isUp:!1},justReleased:function(n,t){if(this._buttons[n])return this._buttons[n].justReleased(t)},justPressed:function(n,t){if(this._buttons[n])return this._buttons[n].justPressed(t)},buttonValue:function(n){return this._buttons[n]?this._buttons[n].value:null},reset:function(){for(var n=0;n<this._axes.length;n++)this._axes[n]=0}};n.SinglePad.prototype.constructor=n.SinglePad;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GamepadButton=function(t,i){this.pad=t;this.game=t.game;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=i;this.onDown=new n.Signal;this.onUp=new n.Signal;this.onFloat=new n.Signal};n.GamepadButton.prototype={processButtonDown:function(n){this.isDown=!0;this.isUp=!1;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this.value=n;this.onDown.dispatch(this,n)},processButtonUp:function(n){this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.value=n;this.onUp.dispatch(this,n)},processButtonFloat:function(n){this.value=n;this.onFloat.dispatch(this,n)},justPressed:function(n){return n=n||250,this.isDown===!0&&this.timeDown+n>this.game.time.time},justReleased:function(n){return n=n||250,this.isUp===!0&&this.timeUp+n>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};n.GamepadButton.prototype.constructor=n.GamepadButton;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Key=function(t,i){this.game=t;this._enabled=!0;this.event=null;this.isDown=!1;this.isUp=!0;this.altKey=!1;this.ctrlKey=!1;this.shiftKey=!1;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=i;this.onDown=new n.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new n.Signal;this._justDown=!1;this._justUp=!1};n.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(n){this._enabled&&((this.event=n,this.isDown)||(this.altKey=n.altKey,this.ctrlKey=n.ctrlKey,this.shiftKey=n.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(n){this._enabled&&((this.event=n,this.isUp)||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(n){typeof n=="undefined"&&(n=!0);this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this._enabled=!0;this._justDown=!1;this._justUp=!1;n&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(n){return typeof n=="undefined"&&(n=50),this.isDown&&this.duration<n},upDuration:function(n){return typeof n=="undefined"&&(n=50),!this.isDown&&this.game.time.time-this.timeUp<n}};Object.defineProperty(n.Key.prototype,"justDown",{get:function(){var n=this._justDown;return this._justDown=!1,n}});Object.defineProperty(n.Key.prototype,"justUp",{get:function(){var n=this._justUp;return this._justUp=!1,n}});Object.defineProperty(n.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(n){n=!!n;n!==this._enabled&&(n||this.reset(!1),this._enabled=n)}});n.Key.prototype.constructor=n.Key;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Keyboard=function(n){this.game=n;this.enabled=!0;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};n.Keyboard.prototype={addCallbacks:function(n,t,i,r){this.callbackContext=n;typeof t!="undefined"&&(this.onDownCallback=t);typeof i!="undefined"&&(this.onUpCallback=i);typeof r!="undefined"&&(this.onPressCallback=r)},addKey:function(t){return this._keys[t]||(this._keys[t]=new n.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},removeKey:function(n){this._keys[n]&&(this._keys[n]=null,this.removeKeyCapture(n))},createCursorKeys:function(){return{up:this.addKey(n.Keyboard.UP),down:this.addKey(n.Keyboard.DOWN),left:this.addKey(n.Keyboard.LEFT),right:this.addKey(n.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&this._onKeyDown===null){var n=this;this._onKeyDown=function(t){return n.processKeyDown(t)};this._onKeyUp=function(t){return n.processKeyUp(t)};this._onKeyPress=function(t){return n.processKeyPress(t)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",this._onKeyUp,!1);window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(n){if(typeof n=="object")for(var t in n)this._capture[n[t]]=!0;else this._capture[n]=!0},removeKeyCapture:function(n){delete this._capture[n]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){(this.event=t,this.game.input.enabled&&this.enabled)&&(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new n.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyDown(t),this._k=t.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t))},processKeyPress:function(n){(this.pressEvent=n,this.game.input.enabled&&this.enabled)&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(n.charCode),n)},processKeyUp:function(t){(this.event=t,this.game.input.enabled&&this.enabled)&&(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new n.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t))},reset:function(n){typeof n=="undefined"&&(n=!0);this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(n)},downDuration:function(n,t){return this._keys[n]?this._keys[n].downDuration(t):null},upDuration:function(n,t){return this._keys[n]?this._keys[n].upDuration(t):null},isDown:function(n){return this._keys[n]?this._keys[n].isDown:null}};Object.defineProperty(n.Keyboard.prototype,"disabled",{get:function(){return!this.enabled},set:function(n){this.enabled=!n}});Object.defineProperty(n.Keyboard.prototype,"lastChar",{get:function(){return this.event.charCode===32?"":String.fromCharCode(this.pressEvent.charCode)}});Object.defineProperty(n.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});n.Keyboard.prototype.constructor=n.Keyboard;n.Keyboard.A="A".charCodeAt(0);n.Keyboard.B="B".charCodeAt(0);n.Keyboard.C="C".charCodeAt(0);n.Keyboard.D="D".charCodeAt(0);n.Keyboard.E="E".charCodeAt(0);n.Keyboard.F="F".charCodeAt(0);n.Keyboard.G="G".charCodeAt(0);n.Keyboard.H="H".charCodeAt(0);n.Keyboard.I="I".charCodeAt(0);n.Keyboard.J="J".charCodeAt(0);n.Keyboard.K="K".charCodeAt(0);n.Keyboard.L="L".charCodeAt(0);n.Keyboard.M="M".charCodeAt(0);n.Keyboard.N="N".charCodeAt(0);n.Keyboard.O="O".charCodeAt(0);n.Keyboard.P="P".charCodeAt(0);n.Keyboard.Q="Q".charCodeAt(0);n.Keyboard.R="R".charCodeAt(0);n.Keyboard.S="S".charCodeAt(0);n.Keyboard.T="T".charCodeAt(0);n.Keyboard.U="U".charCodeAt(0);n.Keyboard.V="V".charCodeAt(0);n.Keyboard.W="W".charCodeAt(0);n.Keyboard.X="X".charCodeAt(0);n.Keyboard.Y="Y".charCodeAt(0);n.Keyboard.Z="Z".charCodeAt(0);n.Keyboard.ZERO="0".charCodeAt(0);n.Keyboard.ONE="1".charCodeAt(0);n.Keyboard.TWO="2".charCodeAt(0);n.Keyboard.THREE="3".charCodeAt(0);n.Keyboard.FOUR="4".charCodeAt(0);n.Keyboard.FIVE="5".charCodeAt(0);n.Keyboard.SIX="6".charCodeAt(0);n.Keyboard.SEVEN="7".charCodeAt(0);n.Keyboard.EIGHT="8".charCodeAt(0);n.Keyboard.NINE="9".charCodeAt(0);n.Keyboard.NUMPAD_0=96;n.Keyboard.NUMPAD_1=97;n.Keyboard.NUMPAD_2=98;n.Keyboard.NUMPAD_3=99;n.Keyboard.NUMPAD_4=100;n.Keyboard.NUMPAD_5=101;n.Keyboard.NUMPAD_6=102;n.Keyboard.NUMPAD_7=103;n.Keyboard.NUMPAD_8=104;n.Keyboard.NUMPAD_9=105;n.Keyboard.NUMPAD_MULTIPLY=106;n.Keyboard.NUMPAD_ADD=107;n.Keyboard.NUMPAD_ENTER=108;n.Keyboard.NUMPAD_SUBTRACT=109;n.Keyboard.NUMPAD_DECIMAL=110;n.Keyboard.NUMPAD_DIVIDE=111;n.Keyboard.F1=112;n.Keyboard.F2=113;n.Keyboard.F3=114;n.Keyboard.F4=115;n.Keyboard.F5=116;n.Keyboard.F6=117;n.Keyboard.F7=118;n.Keyboard.F8=119;n.Keyboard.F9=120;n.Keyboard.F10=121;n.Keyboard.F11=122;n.Keyboard.F12=123;n.Keyboard.F13=124;n.Keyboard.F14=125;n.Keyboard.F15=126;n.Keyboard.COLON=186;n.Keyboard.EQUALS=187;n.Keyboard.UNDERSCORE=189;n.Keyboard.QUESTION_MARK=191;n.Keyboard.TILDE=192;n.Keyboard.OPEN_BRACKET=219;n.Keyboard.BACKWARD_SLASH=220;n.Keyboard.CLOSED_BRACKET=221;n.Keyboard.QUOTES=222;n.Keyboard.BACKSPACE=8;n.Keyboard.TAB=9;n.Keyboard.CLEAR=12;n.Keyboard.ENTER=13;n.Keyboard.SHIFT=16;n.Keyboard.CONTROL=17;n.Keyboard.ALT=18;n.Keyboard.CAPS_LOCK=20;n.Keyboard.ESC=27;n.Keyboard.SPACEBAR=32;n.Keyboard.PAGE_UP=33;n.Keyboard.PAGE_DOWN=34;n.Keyboard.END=35;n.Keyboard.HOME=36;n.Keyboard.LEFT=37;n.Keyboard.UP=38;n.Keyboard.RIGHT=39;n.Keyboard.DOWN=40;n.Keyboard.INSERT=45;n.Keyboard.DELETE=46;n.Keyboard.HELP=47;n.Keyboard.NUM_LOCK=144;n.Keyboard.PLUS=43;n.Keyboard.MINUS=45;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component=function(){};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Angle=function(){};n.Component.Angle.prototype={angle:{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Animation=function(){};n.Component.Animation.prototype={play:function(n,t,i,r){if(this.animations)return this.animations.play(n,t,i,r)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.AutoCull=function(){};n.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Bounds=function(){};n.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.BringToTop=function(){};n.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this};n.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this};n.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this};n.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Core=function(){};n.Component.Core.install=function(t){var i,r,u;for(n.Utils.mixinPrototype(this,n.Component.Core.prototype),this.components={},i=0;i<t.length;i++)r=t[i],u=!1,r==="Destroy"&&(u=!0),n.Utils.mixinPrototype(this,n.Component[r].prototype,u),this.components[r]=!0};n.Component.Core.init=function(t,i,r,u,f){this.game=t;this.key=u;this.position.set(i,r);this.world=new n.Point(i,r);this.previousPosition=new n.Point(i,r);this.events=new n.Events(this);this._bounds=new n.Rectangle;this.components.PhysicsBody&&(this.body=this.body);this.components.Animation&&(this.animations=new n.AnimationManager(this));this.components.LoadTexture&&u!==null&&this.loadTexture(u,f);this.components.FixedToCamera&&(this.cameraOffset=new n.Point(i,r))};n.Component.Core.preUpdate=function(){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++);this.animations&&this.animations.update();this.body&&this.body.preUpdate();for(var n=0;n<this.children.length;n++)this.children[n].preUpdate();return!0};n.Component.Core.prototype={game:null,name:"",components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===n.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.key instanceof n.BitmapData&&this.key.render();this.components.PhysicsBody&&n.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&n.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Crop=function(){};n.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,i){typeof i=="undefined"&&(i=!1);t?(i&&this.cropRect!==null?this.cropRect.setTo(t.x,t.y,t.width,t.height):this.cropRect=i&&this.cropRect===null?new n.Rectangle(t.x,t.y,t.width,t.height):t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){this._crop=n.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-t,u=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t;this.texture.crop.y=i;this.texture.crop.width=r;this.texture.crop.height=u;this.texture.frame.width=Math.min(r,this.cropRect.width);this.texture.frame.height=Math.min(u,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Delta=function(){};n.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Destroy=function(){};n.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t){if(this.game!==null&&!this.destroyPhase){if(typeof t=="undefined"&&(t=!0),this.destroyPhase=!0,this.events)this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this._crop&&(this._crop=null);this._frame&&(this._frame=null);this.alive=!1;this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this.renderable=!1;this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this.destroyPhase=!1}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Events=function(n){this.parent=n};n.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragStop&&this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};n.Events.prototype.constructor=n.Events;for(r in n.Events.prototype)n.Events.prototype.hasOwnProperty(r)&&r.indexOf("on")===0&&n.Events.prototype[r]===null&&function(t,i){"use strict";Object.defineProperty(n.Events.prototype,t,{get:function(){return this[i]||(this[i]=new n.Signal)}});n.Events.prototype[t+"$dispatch"]=function(){return this[i]?this[i].dispatch.apply(this[i],arguments):null}}(r,"_"+r);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.FixedToCamera=function(){};n.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};n.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(n){n?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new n.Point};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Health=function(){};n.Component.Health.prototype={health:1,damage:function(n){return this.alive&&(this.health-=n,this.health<=0&&this.kill()),this}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InCamera=function(){};n.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InputEnabled=function(){};n.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InWorld=function(){};n.Component.InWorld.preUpdate=function(){if((this.autoCull||this.checkWorldBounds)&&(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull&&(this.game.world.camera.view.intersects(this._bounds)?(this.renderable=!0,this.game.world.camera.totalInView++):this.renderable=!1),this.checkWorldBounds))if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=!1;this.events.onEnterBounds$dispatch(this)}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=!0;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill)return this.kill(),!1}return!0};n.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.LifeSpan=function(){};n.Component.LifeSpan.preUpdate=function(){return this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)?(this.kill(),!1):!0};n.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(n){if(typeof n=="undefined"&&(n=1),this.alive=!0,this.exists=!0,this.visible=!0,typeof this.health=="number"&&(this.health=n),this.events)this.events.onRevived$dispatch(this);return this},kill:function(){if(this.alive=!1,this.exists=!1,this.visible=!1,this.events)this.events.onKilled$dispatch(this);return this}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.LoadTexture=function(){};n.Component.LoadTexture.prototype={_frame:null,loadTexture:function(t,i,r){i=i||0;(r||typeof r=="undefined")&&this.animations&&this.animations.stop();this.key=t;var u=!0,e=!this.texture.baseTexture.scaleMode,f=!1;n.RenderTexture&&t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t),f=!0):n.BitmapData&&t instanceof n.BitmapData?(this.setTexture(t.texture),this.game.cache.getFrameData(t.key,n.Cache.BITMAPDATA)&&(u=!this.animations.loadFrameData(this.game.cache.getFrameData(t.key,n.Cache.BITMAPDATA),i))):t instanceof PIXI.Texture?this.setTexture(t):t===null||typeof t=="undefined"?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):typeof t!="string"||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),u=!this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]));f||this.texture.baseTexture.dirty();u&&(this._frame=n.Rectangle.clone(this.texture.frame));e||(this.texture.baseTexture.scaleMode=1)},setFrame:function(n){this._frame=n;this.texture.frame.x=n.x;this.texture.frame.y=n.y;this.texture.frame.width=n.width;this.texture.frame.height=n.height;this.texture.crop.x=n.x;this.texture.crop.y=n.y;this.texture.crop.width=n.width;this.texture.crop.height=n.height;n.trimmed?(this.texture.trim?(this.texture.trim.x=n.spriteSourceSizeX,this.texture.trim.y=n.spriteSourceSizeY,this.texture.trim.width=n.sourceSizeW,this.texture.trim.height=n.sourceSizeH):this.texture.trim={x:n.spriteSourceSizeX,y:n.spriteSourceSizeY,width:n.sourceSizeW,height:n.sourceSizeH},this.texture.width=n.sourceSizeW,this.texture.height=n.sourceSizeH,this.texture.frame.width=n.sourceSizeW,this.texture.frame.height=n.sourceSizeH):!n.trimmed&&this.texture.trim&&(this.texture.trim=null);this.cropRect&&this.updateCrop();this.tint!==16777215&&(this.cachedTint=-1);this.texture._updateUvs()},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(n){this.animations.frame=n}},frameName:{get:function(){return this.animations.frameName},set:function(n){this.animations.frameName=n}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Overlap=function(){};n.Component.Overlap.prototype={overlap:function(t){return n.Rectangle.intersects(this.getBounds(),t.getBounds())}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.PhysicsBody=function(){};n.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this._exists||!this.parent.exists)?(this.renderOrderID=-1,!1):!0};n.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};n.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(n){this.position.x=n;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(n){this.position.y=n;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Reset=function(){};n.Component.Reset.prototype.reset=function(n,t,i){return typeof i=="undefined"&&(i=1),this.world.set(n,t),this.position.set(n,t),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(n,t,!1,!1),this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.ScaleMinMax=function(){};n.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(n){this.scaleMin&&(n.a<this.scaleMin.x&&(n.a=this.scaleMin.x),n.d<this.scaleMin.y&&(n.d=this.scaleMin.y));this.scaleMax&&(n.a>this.scaleMax.x&&(n.a=this.scaleMax.x),n.d>this.scaleMax.y&&(n.d=this.scaleMax.y))},setScaleMinMax:function(t,i,r,u){typeof i=="undefined"?i=r=u=t:typeof r=="undefined"&&(r=u=i,i=t);t===null?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,i):this.scaleMin=new n.Point(t,i);r===null?this.scaleMax=null:this.scaleMax?this.scaleMax.set(r,u):this.scaleMax=new n.Point(r,u)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Smoothed=function(){};n.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(n){n?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectFactory=function(n){this.game=n;this.world=this.game.world};n.GameObjectFactory.prototype={existing:function(n){return this.world.add(n)},image:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),f.add(new n.Image(this.game,t,i,r,u))},sprite:function(n,t,i,r,u){return typeof u=="undefined"&&(u=this.world),u.create(n,t,i,r)},tween:function(n){return this.game.tweens.create(n)},group:function(t,i,r,u,f){return new n.Group(this.game,t,i,r,u,f)},physicsGroup:function(t,i,r,u){return new n.Group(this.game,i,r,u,!0,t)},spriteBatch:function(t,i,r){return typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i="group"),typeof r=="undefined"&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},audioSprite:function(n){return this.game.sound.addSprite(n)},tileSprite:function(t,i,r,u,f,e,o){return typeof o=="undefined"&&(o=this.world),o.add(new n.TileSprite(this.game,t,i,r,u,f,e))},rope:function(t,i,r,u,f,e){return typeof e=="undefined"&&(e=this.world),e.add(new n.Rope(this.game,t,i,r,u,f))},text:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),f.add(new n.Text(this.game,t,i,r,u))},button:function(t,i,r,u,f,e,o,s,h,c){return typeof c=="undefined"&&(c=this.world),c.add(new n.Button(this.game,t,i,r,u,f,e,o,s,h))},graphics:function(t,i,r){return typeof r=="undefined"&&(r=this.world),r.add(new n.Graphics(this.game,t,i))},emitter:function(t,i,r){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,t,i,r))},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f,e){return typeof e=="undefined"&&(e=this.world),e.add(new n.BitmapText(this.game,t,i,r,u,f))},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());typeof u=="undefined"&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},bitmapData:function(t,i,r,u){typeof u=="undefined"&&(u=!1);(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t},plugin:function(n){return this.game.plugins.add(n)}};n.GameObjectFactory.prototype.constructor=n.GameObjectFactory;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectCreator=function(n){this.game=n;this.world=this.game.world};n.GameObjectCreator.prototype={image:function(t,i,r,u){return new n.Image(this.game,t,i,r,u)},sprite:function(t,i,r,u){return new n.Sprite(this.game,t,i,r,u)},tween:function(t){return new n.Tween(t,this.game,this.game.tweens)},group:function(t,i,r,u,f){return new n.Group(this.game,null,i,r,u,f)},spriteBatch:function(t,i,r){return typeof i=="undefined"&&(i="group"),typeof r=="undefined"&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},audioSprite:function(n){return this.game.sound.addSprite(n)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},tileSprite:function(t,i,r,u,f,e){return new n.TileSprite(this.game,t,i,r,u,f,e)},rope:function(t,i,r,u,f){return new n.Rope(this.game,t,i,r,u,f)},text:function(t,i,r,u){return new n.Text(this.game,t,i,r,u)},button:function(t,i,r,u,f,e,o,s,h){return new n.Button(this.game,t,i,r,u,f,e,o,s,h)},graphics:function(t,i){return new n.Graphics(this.game,t,i)},emitter:function(t,i,r){return new n.Particles.Arcade.Emitter(this.game,t,i,r)},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f){return new n.BitmapText(this.game,t,i,r,u,f)},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());typeof u=="undefined"&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},bitmapData:function(t,i,r,u){typeof u=="undefined"&&(u=!1);(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t}};n.GameObjectCreator.prototype.constructor=n.GameObjectCreator;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sprite=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.SPRITE;this.physicsType=n.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);n.Component.Core.init.call(this,t,i,r,u,f)};n.Sprite.prototype=Object.create(PIXI.Sprite.prototype);n.Sprite.prototype.constructor=n.Sprite;n.Component.Core.install.call(n.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);n.Sprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Sprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Sprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Sprite.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Sprite.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Image=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.IMAGE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);n.Component.Core.init.call(this,t,i,r,u,f)};n.Image.prototype=Object.create(PIXI.Sprite.prototype);n.Image.prototype.constructor=n.Image;n.Component.Core.install.call(n.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]);n.Image.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Image.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()?this.preUpdateCore():!1};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TileSprite=function(t,i,r,u,f,e,o){i=i||0;r=r||0;u=u||256;f=f||256;e=e||null;o=o||null;this.type=n.TILESPRITE;this._scroll=new n.Point;PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,u,f);n.Component.Core.init.call(this,t,i,r,e,o)};n.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);n.TileSprite.prototype.constructor=n.TileSprite;n.Component.Core.install.call(n.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);n.TileSprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.TileSprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.TileSprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.TileSprite.prototype.preUpdateCore=n.Component.Core.preUpdate;n.TileSprite.prototype.preUpdate=function(){return(this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld())?!1:this.preUpdateCore()};n.TileSprite.prototype.autoScroll=function(n,t){this._scroll.set(n,t)};n.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};n.TileSprite.prototype.destroy=function(t){n.Component.Destroy.prototype.destroy.call(this,t);PIXI.TilingSprite.prototype.destroy.call(this)};n.TileSprite.prototype.reset=function(t,i){return n.Component.Reset.prototype.reset.call(this,t,i),this.tilePosition.x=0,this.tilePosition.y=0,this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd, Richard Davey
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rope=function(t,i,r,u,f,e){this.points=[];this.points=e;this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.ROPE;this._scroll=new n.Point;PIXI.Rope.call(this,u,this.points);n.Component.Core.init.call(this,t,i,r,u,f)};n.Rope.prototype=Object.create(PIXI.Rope.prototype);n.Rope.prototype.constructor=n.Rope;n.Component.Core.install.call(n.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);n.Rope.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Rope.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Rope.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Rope.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Rope.prototype.preUpdate=function(){return(this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld())?!1:this.preUpdateCore()};n.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};n.Rope.prototype.reset=function(t,i){return n.Component.Reset.prototype.reset.call(this,t,i),this.tilePosition.x=0,this.tilePosition.y=0,this};Object.defineProperty(n.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(n){n&&typeof n=="function"?(this._hasUpdateAnimation=!0,this._updateAnimation=n):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(n.Rope.prototype,"segments",{get:function(){for(var f=[],t,i,r,e,o,s,h,c,u=0;u<this.points.length;u++)t=u*4,i=this.verticies[t],r=this.verticies[t+1],e=this.verticies[t+4],o=this.verticies[t+3],s=n.Math.difference(i,e),h=n.Math.difference(r,o),i+=this.world.x,r+=this.world.y,c=new n.Rectangle(i,r,s,h),f.push(c);return f}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Button=function(t,i,r,u,f,e,o,s,h,c){i=i||0;r=r||0;u=u||null;f=f||null;e=e||this;n.Image.call(this,t,i,r,u,s);this.type=n.BUTTON;this.physicsType=n.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new n.Signal;this.onInputOut=new n.Signal;this.onInputDown=new n.Signal;this.onInputUp=new n.Signal;this.onOverMouseOnly=!1;this.freezeFrames=!1;this.forceOut=!1;this.inputEnabled=!0;this.input.start(0,!0);this.setFrames(o,s,h,c);f!==null&&this.onInputUp.add(f,e);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};n.Button.prototype=Object.create(n.Image.prototype);n.Button.prototype.constructor=n.Button;var u="Over",i="Out",f="Down",e="Up";n.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};n.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1};n.Button.prototype.setStateFrame=function(n,t,i){var r="_on"+n+"Frame";t!=null?(this[r]=t,i&&this.changeStateFrame(n)):this[r]=null};n.Button.prototype.changeStateFrame=function(n){if(this.freezeFrames)return!1;var i="_on"+n+"Frame",t=this[i];return typeof t=="string"?(this.frameName=t,!0):typeof t=="number"?(this.frame=t,!0):!1};n.Button.prototype.setFrames=function(n,t,r,o){this.setStateFrame(u,n,this.input.pointerOver());this.setStateFrame(i,t,!this.input.pointerOver());this.setStateFrame(f,r,this.input.pointerDown());this.setStateFrame(e,o,this.input.pointerUp())};n.Button.prototype.setStateSound=function(t,i,r){var u="on"+t+"Sound",f="on"+t+"SoundMarker";i instanceof n.Sound||i instanceof n.AudioSprite?(this[u]=i,this[f]=typeof r=="string"?r:""):(this[u]=null,this[f]="")};n.Button.prototype.playStateSound=function(n){var u="on"+n+"Sound",t=this[u],i,r;return t?(i="on"+n+"SoundMarker",r=this[i],t.play(r),!0):!1};n.Button.prototype.setSounds=function(n,t,r,o,s,h,c,l){this.setStateSound(u,n,t);this.setStateSound(i,s,h);this.setStateSound(f,r,o);this.setStateSound(e,c,l)};n.Button.prototype.setOverSound=function(n,t){this.setStateSound(u,n,t)};n.Button.prototype.setOutSound=function(n,t){this.setStateSound(i,n,t)};n.Button.prototype.setDownSound=function(n,t){this.setStateSound(f,n,t)};n.Button.prototype.setUpSound=function(n,t){this.setStateSound(e,n,t)};n.Button.prototype.onInputOverHandler=function(n,t){t.justReleased()||(this.changeStateFrame(u),!this.onOverMouseOnly||t.isMouse)&&(this.playStateSound(u),this.onInputOver&&this.onInputOver.dispatch(this,t))};n.Button.prototype.onInputOutHandler=function(n,t){this.changeStateFrame(i);this.playStateSound(i);this.onInputOut&&this.onInputOut.dispatch(this,t)};n.Button.prototype.onInputDownHandler=function(n,t){this.changeStateFrame(f);this.playStateSound(f);this.onInputDown&&this.onInputDown.dispatch(this,t)};n.Button.prototype.onInputUpHandler=function(n,t,r){if(this.playStateSound(e),this.onInputUp&&this.onInputUp.dispatch(this,t,r),!this.freezeFrames)if(this.forceOut)this.changeStateFrame(i);else{var f=this.changeStateFrame(e);f||(r?this.changeStateFrame(u):this.changeStateFrame(i))}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SpriteBatch=function(t,i,r,u){(typeof i=="undefined"||i===null)&&(i=t.world);PIXI.SpriteBatch.call(this);n.Group.call(this,t,i,r,u);this.type=n.SPRITEBATCH};n.SpriteBatch.prototype=n.Utils.extend(!0,n.SpriteBatch.prototype,n.Group.prototype,PIXI.SpriteBatch.prototype);n.SpriteBatch.prototype.constructor=n.SpriteBatch;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particle=function(t,i,r,u,f){n.Sprite.call(this,t,i,r,u,f);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};n.Particle.prototype=Object.create(n.Sprite.prototype);n.Particle.prototype.constructor=n.Particle;n.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)};n.Particle.prototype.onEmit=function(){};n.Particle.prototype.setAlphaData=function(n){this.alphaData=n;this._a=n.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};n.Particle.prototype.setScaleData=function(n){this.scaleData=n;this._s=n.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};n.Particle.prototype.reset=function(t,i,r){return n.Component.Reset.prototype.reset.call(this,t,i,r),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapData=function(t,i,r,u){typeof r=="undefined"&&(r=256);typeof u=="undefined"&&(u=256);this.game=t;this.key=i;this.width=r;this.height=u;this.canvas=n.Canvas.create(r,u,"",!0);this.context=this.canvas.getContext("2d",{alpha:!0});this.ctx=this.context;this.imageData=this.context.getImageData(0,0,r,u);this.data=this.imageData.data;this.pixels=null;this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data;this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,r,u,"bitmapData",t.rnd.uuid());this.texture.frame=this.textureFrame;this.type=n.BITMAPDATA;this.disableTextureUpload=!1;this.dirty=!1;this.cls=this.clear;this._image=null;this._pos=new n.Point;this._size=new n.Point;this._scale=new n.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new n.Point;this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new n.Circle};n.BitmapData.prototype={add:function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)n[t].loadTexture&&n[t].loadTexture(this);else n.loadTexture(this);return this},load:function(n){if(typeof n=="string"&&(n=this.game.cache.getImage(n)),n)this.resize(n.width,n.height),this.cls();else return;return this.draw(n),this.update(),this},clear:function(){return this.context.clearRect(0,0,this.width,this.height),this.dirty=!0,this},fill:function(n,t,i,r){return typeof r=="undefined"&&(r=1),this.context.fillStyle="rgba("+n+","+t+","+i+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(n,t){return(n!==this.width||t!==this.height)&&(this.width=n,this.height=t,this.canvas.width=n,this.canvas.height=t,this.baseTexture.width=n,this.baseTexture.height=t,this.textureFrame.width=n,this.textureFrame.height=t,this.texture.width=n,this.texture.height=t,this.texture.crop.width=n,this.texture.crop.height=t,this.update(),this.dirty=!0),this},update:function(n,t,i,r){return typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=this.width),typeof r=="undefined"&&(r=this.height),this.imageData=this.context.getImageData(n,t,i,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,i,r,u,f,e){var s,h;typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=this.width);typeof e=="undefined"&&(e=this.height);var a=r+f,v=u+e,c=n.Color.createColor(),o={r:0,g:0,b:0,a:0},l=!1;for(s=u;s<v;s++)for(h=r;h<a;h++)n.Color.unpackPixel(this.getPixel32(h,s),c),o=t.call(i,c,h,s),o!==!1&&o!==null&&o!==undefined&&(this.setPixel32(h,s,o.r,o.g,o.b,o.a,!1),l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(n,t,i,r,u,f){var e,o;typeof i=="undefined"&&(i=0);typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=this.width);typeof f=="undefined"&&(f=this.height);var l=i+u,a=r+f,s=0,h=0,c=!1;for(e=r;e<a;e++)for(o=i;o<l;o++)s=this.getPixel32(o,e),h=n.call(t,s,o,e),h!==s&&(this.pixels[e*this.width+o]=h,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,i,r,u,f,e,o,s,h){var a=0,v=0,y=this.width,p=this.height,w=n.Color.packPixel(t,i,r,u),c,l;for(h!==undefined&&h instanceof n.Rectangle&&(a=h.x,v=h.y,y=h.width,p=h.height),c=0;c<p;c++)for(l=0;l<y;l++)this.getPixel32(a+l,v+c)===w&&this.setPixel32(a+l,v+c,f,e,o,s,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,i,r,u){var f,e,o;if((typeof t=="undefined"||t===null)&&(t=!1),(typeof i=="undefined"||i===null)&&(i=!1),(typeof r=="undefined"||r===null)&&(r=!1),t||i||r){for(typeof u=="undefined"&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),t&&(f.h=t),i&&(f.s=i),r&&(f.l=r),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,i,r,u){var f,e,o;if((typeof t=="undefined"||t===null)&&(t=!1),(typeof i=="undefined"||i===null)&&(i=!1),(typeof r=="undefined"||r===null)&&(r=!1),t||i||r){for(typeof u=="undefined"&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),t&&(f.h=this.game.math.wrap(f.h+t,0,1)),i&&(f.s=this.game.math.limitValue(f.s+i,0,1)),r&&(f.l=this.game.math.limitValue(f.l+r,0,1)),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,i,r,u,f,e,o){return typeof o=="undefined"&&(o=!0),t>=0&&t<=this.width&&i>=0&&i<=this.height&&(this.pixels[i*this.width+t]=n.Device.LITTLE_ENDIAN?e<<24|f<<16|u<<8|r:r<<24|u<<16|f<<8|e,o&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(n,t,i,r,u,f){return this.setPixel32(n,t,i,r,u,255,f)},getPixel:function(t,i,r){r||(r=n.Color.createColor());var u=~~(t+i*this.width);return u*=4,r.r=this.data[u],r.g=this.data[++u],r.b=this.data[++u],r.a=this.data[++u],r},getPixel32:function(n,t){if(n>=0&&n<=this.width&&t>=0&&t<=this.height)return this.pixels[t*this.width+n]},getPixelRGB:function(t,i,r,u,f){return n.Color.unpackPixel(this.getPixel32(t,i),r,u,f)},getPixels:function(n){return this.context.getImageData(n.x,n.y,n.width,n.height)},getFirstPixel:function(t){typeof t=="undefined"&&(t=0);var u=n.Color.createColor(),i=0,r=0,f=1,e=!1;t===1?(f=-1,r=this.height):t===3&&(f=-1,i=this.width);do n.Color.unpackPixel(this.getPixel32(i,r),u),t===0||t===1?(i++,i===this.width&&(i=0,r+=f,(r>=this.height||r<=0)&&(e=!0))):(t===2||t===3)&&(r++,r===this.height&&(r=0,i+=f,(i>=this.width||i<=0)&&(e=!0)));while(u.a===0&&!e);return u.x=i,u.y=r,u},getBounds:function(t){return(typeof t=="undefined"&&(t=new n.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width)?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(n,t,i,r,u,f){u=u||1;f=f||1;var e=this.game.add.image(n,t,this);return e.anchor.set(i,r),e.scale.set(u,f),e},copy:function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){if((typeof t=="undefined"||t===null)&&(t=this),this._image=t,t instanceof n.Sprite||t instanceof n.Image||t instanceof n.Text)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,this._image=t.texture.baseTexture.source,(typeof e=="undefined"||e===null)&&(e=t.x),(typeof o=="undefined"||o===null)&&(o=t.y),t.texture.trim&&(e+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),t.tint!==16777215&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof n.BitmapData)this._image=t.canvas;else if(typeof t=="string"){if(t=this.game.cache.getImage(t),t===null)return;this._image=t}this._size.set(this._image.width,this._image.height)}if((typeof i=="undefined"||i===null)&&(i=0),(typeof r=="undefined"||r===null)&&(r=0),u&&(this._size.x=u),f&&(this._size.y=f),(typeof e=="undefined"||e===null)&&(e=i),(typeof o=="undefined"||o===null)&&(o=r),(typeof s=="undefined"||s===null)&&(s=this._size.x),(typeof h=="undefined"||h===null)&&(h=this._size.y),typeof c=="number"&&(this._rotate=c),typeof l=="number"&&(this._anchor.x=l),typeof a=="number"&&(this._anchor.y=a),typeof v=="number"&&(this._scale.x=v),typeof y=="number"&&(this._scale.y=y),typeof p=="number"&&(this._alpha.current=p),typeof w=="undefined"&&(w=null),typeof b=="undefined"&&(b=!1),!(this._alpha.current<=0)&&this._scale.x!==0&&this._scale.y!==0&&this._size.x!==0&&this._size.y!==0)return this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,w&&(this.context.globalCompositeOperation=w),b&&(e|=0,o|=0),this.context.translate(e,o),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),this.context.drawImage(this._image,this._pos.x+i,this._pos.y+r,this._size.x,this._size.y,-s*this._anchor.x,-h*this._anchor.y,s,h),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(n,t,i,r,u,f,e){return this.copy(n,t.x,t.y,t.width,t.height,i,r,t.width,t.height,0,0,0,1,1,u,f,e)},draw:function(n,t,i,r,u,f,e){return this.copy(n,null,null,null,null,t,i,r,u,null,null,null,null,null,null,f,e)},drawGroup:function(n,t,i){return n.total>0&&n.forEachExists(this.copy,this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,t,i),this},shadow:function(n,t,i,r){typeof n=="undefined"||n===null?this.context.shadowColor="rgba(0,0,0,0)":(this.context.shadowColor=n,this.context.shadowBlur=t||5,this.context.shadowOffsetX=i||10,this.context.shadowOffsetY=r||10)},alphaMask:function(n,t,i,r){return typeof r=="undefined"||r===null?this.draw(t).blendSourceAtop():this.draw(t,r.x,r.y,r.width,r.height).blendSourceAtop(),typeof i=="undefined"||i===null?this.draw(n).blendReset():this.draw(n,i.x,i.y,i.width,i.height).blendReset(),this},extract:function(n,t,i,r,u,f,e,o,s){return typeof u=="undefined"&&(u=255),typeof f=="undefined"&&(f=!1),typeof e=="undefined"&&(e=t),typeof o=="undefined"&&(o=i),typeof s=="undefined"&&(s=r),f&&n.resize(this.width,this.height),this.processPixelRGB(function(f,h,c){return f.r===t&&f.g===i&&f.b===r&&n.setPixel32(h,c,e,o,s,u,!1),!1},this),n.context.putImageData(n.imageData,0,0),n.dirty=!0,n},rect:function(n,t,i,r,u){return typeof u!="undefined"&&(this.context.fillStyle=u),this.context.fillRect(n,t,i,r),this},text:function(n,t,i,r,u,f){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=0);typeof r=="undefined"&&(r="14px Courier");typeof u=="undefined"&&(u="rgb(255,255,255)");typeof f=="undefined"&&(f=!0);var e=this.context.font;this.context.font=r;f&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(n,t+1,i+1));this.context.fillStyle=u;this.context.fillText(n,t,i);this.context.font=e},circle:function(n,t,i,r){return typeof r!="undefined"&&(this.context.fillStyle=r),this.context.beginPath(),this.context.arc(n,t,i,0,Math.PI*2,!1),this.context.closePath(),this.context.fill(),this},textureLine:function(t,i,r){if(typeof r=="undefined"&&(r="repeat-x"),typeof i!="string"||(i=this.game.cache.getImage(i),i)){var u=t.length;return r==="no-repeat"&&u>i.width&&(u=i.width),this.context.fillStyle=this.context.createPattern(i,r),this._circle=new n.Circle(t.start.x,t.start.y,i.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),this.context.save(),this.context.translate(this._pos.x,this._pos.y),this.context.rotate(t.angle),this.context.fillRect(0,0,u,i.height),this.context.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation="source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation="destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation="darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation="difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}};Object.defineProperty(n.BitmapData.prototype,"smoothed",{get:function(){n.Canvas.getSmoothingEnabled(this.context)},set:function(t){n.Canvas.setSmoothingEnabled(this.context,t)}});n.BitmapData.getTransform=function(n,t,i,r,u,f){return typeof n!="number"&&(n=0),typeof t!="number"&&(t=0),typeof i!="number"&&(i=1),typeof r!="number"&&(r=1),typeof u!="number"&&(u=0),typeof f!="number"&&(f=0),{sx:i,sy:r,scaleX:i,scaleY:r,skewX:u,skewY:f,translateX:n,translateY:t,tx:n,ty:t}};n.BitmapData.prototype.constructor=n.BitmapData;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Graphics=function(t,i,r){i=i||0;r=r||0;this.type=n.GRAPHICS;this.physicsType=n.SPRITE;PIXI.Graphics.call(this);n.Component.Core.init.call(this,t,i,r,"",null)};n.Graphics.prototype=Object.create(PIXI.Graphics.prototype);n.Graphics.prototype.constructor=n.Graphics;n.Component.Core.install.call(n.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);n.Graphics.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Graphics.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Graphics.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Graphics.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Graphics.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.Graphics.prototype.destroy=function(t){this.clear();n.Component.Destroy.prototype.destroy.call(this,t)};n.Graphics.prototype.drawTriangle=function(t,i){var r;if(typeof i=="undefined"&&(i=!1),r=new n.Polygon(t),i){var u=new n.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),f=new n.Point(t[1].x-t[0].x,t[1].y-t[0].y),e=new n.Point(t[1].x-t[2].x,t[1].y-t[2].y),o=e.cross(f);u.dot(o)>0&&this.drawPolygon(r)}else this.drawPolygon(r)};n.Graphics.prototype.drawTriangles=function(t,i,r){typeof r=="undefined"&&(r=!1);var e=new n.Point,o=new n.Point,s=new n.Point,f=[],u;if(i)if(t[0]instanceof n.Point)for(u=0;u<i.length/3;u++)f.push(t[i[u*3]]),f.push(t[i[u*3+1]]),f.push(t[i[u*3+2]]),f.length===3&&(this.drawTriangle(f,r),f=[]);else for(u=0;u<i.length;u++)e.x=t[i[u]*2],e.y=t[i[u]*2+1],f.push(e.copyTo({})),f.length===3&&(this.drawTriangle(f,r),f=[]);else if(t[0]instanceof n.Point)for(u=0;u<t.length/3;u++)this.drawTriangle([t[u*3],t[u*3+1],t[u*3+2]],r);else for(u=0;u<t.length/6;u++)e.x=t[u*6+0],e.y=t[u*6+1],o.x=t[u*6+2],o.y=t[u*6+3],s.x=t[u*6+4],s.y=t[u*6+5],this.drawTriangle([e,o,s],r)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RenderTexture=function(t,i,r,u,f,e){typeof u=="undefined"&&(u="");typeof f=="undefined"&&(f=n.scaleModes.DEFAULT);typeof e=="undefined"&&(e=1);this.game=t;this.key=u;this.type=n.RENDERTEXTURE;this.matrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,i,r,this.game.renderer,f,e);this.render=n.RenderTexture.prototype.render};n.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.renderXY=function(n,t,i,r){this.matrix.tx=t;this.matrix.ty=i;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(n,this.matrix,r):this.renderCanvas(n,this.matrix,r)};n.RenderTexture.prototype.render=function(n,t,i){this.matrix.tx=t.x;this.matrix.ty=t.y;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(n,this.matrix,i):this.renderCanvas(n,this.matrix,i)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Text=function(t,i,r,u,f){i=i||0;r=r||0;u=u||" ";f=f||{};u=u.length===0?" ":u.toString();this.type=n.TEXT;this.physicsType=n.SPRITE;this.padding=new n.Point;this._text=u;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this.colors=[];this.setStyle(f);PIXI.Text.call(this,u,this.style);n.Component.Core.init.call(this,t,i,r,"",null);u!==" "&&this.updateText()};n.Text.prototype=Object.create(PIXI.Text.prototype);n.Text.prototype.constructor=n.Text;n.Component.Core.install.call(n.Text.prototype,["Angle","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","Overlap","PhysicsBody","Reset","Smoothed"]);n.Text.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Text.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Text.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Text.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Text.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.Text.prototype.update=function(){};n.Text.prototype.destroy=function(t){this.texture.destroy(!0);this.canvas&&this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);n.Component.Destroy.prototype.destroy.call(this,t)};n.Text.prototype.setShadow=function(n,t,i,r){typeof n=="undefined"&&(n=0);typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i="rgba(0, 0, 0, 1)");typeof r=="undefined"&&(r=0);this.style.shadowOffsetX=n;this.style.shadowOffsetY=t;this.style.shadowColor=i;this.style.shadowBlur=r;this.dirty=!0};n.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.backgroundColor=n.backgroundColor||null;n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;n.shadowOffsetX=n.shadowOffsetX||0;n.shadowOffsetY=n.shadowOffsetY||0;n.shadowColor=n.shadowColor||"rgba(0,0,0,0)";n.shadowBlur=n.shadowBlur||0;var t=this.fontToComponents(n.font);n.fontStyle&&(t.fontStyle=n.fontStyle);n.fontVariant&&(t.fontVariant=n.fontVariant);n.fontWeight&&(t.fontWeight=n.fontWeight);n.fontSize&&(typeof n.fontSize=="number"&&(n.fontSize=n.fontSize+"px"),t.fontSize=n.fontSize);this._fontComponents=t;n.font=this.componentsToFont(this._fontComponents);this.style=n;this.dirty=!0};n.Text.prototype.updateText=function(){var o,n,h,l,v,r,f;this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;o=this.text;this.style.wordWrap&&(o=this.runWordWrap(this.text));var t=o.split(/(?:\r\n|\r|\n)/),s=[],u=0,c=this.determineFontProperties(this.style.font);for(n=0;n<t.length;n++)h=this.context.measureText(t[n]).width+this.padding.x,s[n]=h,u=Math.max(u,h);l=u+this.style.strokeThickness;this.canvas.width=l*this.resolution;var e=c.fontSize+this.style.strokeThickness+this.padding.y,a=e*t.length,i=this._lineSpacing;for(i<0&&Math.abs(i)>e&&(i=-e),i!==0&&(v=i*(t.length-1),a+=v),this.canvas.height=a*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,n=0;n<t.length;n++)r=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+c.ascent,n>0&&(f+=i*n),this.style.align==="right"?r+=u-s[n]:this.style.align==="center"&&(r+=(u-s[n])/2),this.colors.length>0?this.updateLine(t[n],r,f):(this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[n],r,f),this.style.fill&&this.context.fillText(t[n],r,f));this.updateTexture()};n.Text.prototype.updateLine=function(n,t,i){for(var u,r=0;r<n.length;r++)u=n[r],this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount],this.context.strokeStyle=this.colors[this._charCount]),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(u,t,i),this.style.fill&&this.context.fillText(u,t,i),t+=this.context.measureText(u).width,this._charCount++};n.Text.prototype.clearColors=function(){this.colors=[];this.dirty=!0};n.Text.prototype.addColor=function(n,t){this.colors[t]=n;this.dirty=!0};n.Text.prototype.runWordWrap=function(n){for(var f,r,t,o,s,i="",e=n.split("\n"),u=0;u<e.length;u++){for(f=this.style.wordWrapWidth,r=e[u].split(" "),t=0;t<r.length;t++)o=this.context.measureText(r[t]).width,s=o+this.context.measureText(" ").width,s>f?(t>0&&(i+="\n"),i+=r[t]+" ",f=this.style.wordWrapWidth-o):(f-=s,i+=r[t]+" ");u<e.length-1&&(i+="\n")}return i};n.Text.prototype.updateFont=function(n){var t=this.componentsToFont(n);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())};n.Text.prototype.fontToComponents=function(n){var t=n.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);return t?{font:n,fontStyle:t[1]||"normal",fontVariant:t[2]||"normal",fontWeight:t[3]||"normal",fontSize:t[4]||"medium",fontFamily:t[5]}:(console.warn("Phaser.Text - unparsable CSS font: "+n),{font:n})};n.Text.prototype.componentsToFont=function(n){var i=[],t;return t=n.fontStyle,t&&t!=="normal"&&i.push(t),t=n.fontVariant,t&&t!=="normal"&&i.push(t),t=n.fontWeight,t&&t!=="normal"&&i.push(t),t=n.fontSize,t&&t!=="medium"&&i.push(t),t=n.fontFamily,t&&i.push(t),i.length||i.push(n.font),i.join(" ")};Object.defineProperty(n.Text.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||" ",this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(n.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(n){n=n||"bold 20pt Arial";this._fontComponents=this.fontToComponents(n);this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(n){n=n||"Arial";n=n.trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(n)||/['",]/.exec(n)||(n="'"+n+"'");this._fontComponents.fontFamily=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontSize",{get:function(){var n=this._fontComponents.fontSize;return n&&/(?:^0$|px$)/.exec(n)?parseInt(n,10):n},set:function(n){n=n||"0";typeof n=="number"&&(n=n+"px");this._fontComponents.fontSize=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontWeight=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontStyle=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontVariant=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(n){n!==this.style.fill&&(this.style.fill=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"align",{get:function(){return this.style.align},set:function(n){n!==this.style.align&&(this.style.align=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(n){n!==this.style.stroke&&(this.style.stroke=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(n){n!==this.style.strokeThickness&&(this.style.strokeThickness=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(n){n!==this.style.wordWrap&&(this.style.wordWrap=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(n){n!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(n){n!==this._lineSpacing&&(this._lineSpacing=parseFloat(n),this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(n.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(n){n!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(n){n!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(n){n!==this.style.shadowColor&&(this.style.shadowColor=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(n){n!==this.style.shadowBlur&&(this.style.shadowBlur=n,this.dirty=!0)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapText=function(t,i,r,u,f,e){i=i||0;r=r||0;u=u||"";f=f||"";e=e||32;this.type=n.BITMAPTEXT;this.physicsType=n.SPRITE;this._text=f;this._font=u;this._fontSize=e;this._align="left";this._tint=16777215;this._tw=0;this._th=0;PIXI.BitmapText.call(this,f);n.Component.Core.init.call(this,t,i,r,"",null)};n.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.Component.Core.install.call(n.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);n.BitmapText.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.BitmapText.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.BitmapText.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.BitmapText.prototype.preUpdateCore=n.Component.Core.preUpdate;n.BitmapText.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.BitmapText.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this);n.Component.FixedToCamera.postUpdate.call(this);this.body&&(this.textWidth!==this._tw||this.textHeight!==this._th)&&(this.body.setSize(this.textWidth,this.textHeight),this._tw=this.textWidth,this._th=this.textHeight)};n.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=!0};Object.defineProperty(n.BitmapText.prototype,"align",{get:function(){return this._align},set:function(n){n!==this._align&&(this._align=n,this.setStyle())}});Object.defineProperty(n.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(n){n!==this._tint&&(this._tint=n,this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"font",{get:function(){return this._font},set:function(n){n!==this._font&&(this._font=n.trim(),this.fontName=this._font,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){n=parseInt(n,10);n!==this._fontSize&&(this._fontSize=n,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||" ",this.dirty=!0)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RetroFont=function(t,i,r,u,f,e,o,s,h,c){var l,p,w;if(!t.cache.checkImageKey(i))return!1;(typeof e=="undefined"||e===null)&&(e=t.cache.getImage(i).width/r);this.characterWidth=r;this.characterHeight=u;this.characterSpacingX=o||0;this.characterSpacingY=s||0;this.characterPerRow=e;this.offsetX=h||0;this.offsetY=c||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(i);this._text="";this.grabData=[];this.frameData=new n.FrameData;var a=this.offsetX,v=this.offsetY,y=0;for(l=0;l<f.length;l++)p=t.rnd.uuid(),w=this.frameData.addFrame(new n.Frame(l,a,v,this.characterWidth,this.characterHeight,"",p)),this.grabData[f.charCodeAt(l)]=w.index,PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:a,y:v,width:this.characterWidth,height:this.characterHeight}),y++,y==this.characterPerRow?(y=0,a=this.offsetX,v+=this.characterHeight+this.characterSpacingY):a+=this.characterWidth+this.characterSpacingX;t.cache.updateFrameData(i,this.frameData);this.stamp=new n.Image(t,0,0,i,0);n.RenderTexture.call(this,t,100,100,"",n.scaleModes.NEAREST);this.type=n.RETROFONT};n.RetroFont.prototype=Object.create(n.RenderTexture.prototype);n.RetroFont.prototype.constructor=n.RetroFont;n.RetroFont.ALIGN_LEFT="left";n.RetroFont.ALIGN_RIGHT="right";n.RetroFont.ALIGN_CENTER="center";n.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";n.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";n.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";n.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";n.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";n.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";n.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";n.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";n.RetroFont.prototype.setFixedWidth=function(n,t){typeof t=="undefined"&&(t="left");this.fixedWidth=n;this.align=t};n.RetroFont.prototype.setText=function(n,t,i,r,u,f){this.multiLine=t||!1;this.customSpacingX=i||0;this.customSpacingY=r||0;this.align=u||"left";this.autoUpperCase=f?!1:!0;n.length>0&&(this.text=n)};n.RetroFont.prototype.buildRetroFontText=function(){var t=0,u=0,i,r;if(this.clear(),this.multiLine)for(i=this._text.split("\n"),this.fixedWidth>0?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0),r=0;r<i.length;r++){switch(this.align){case n.RetroFont.ALIGN_LEFT:t=0;break;case n.RetroFont.ALIGN_RIGHT:t=this.width-i[r].length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:t=this.width/2-i[r].length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2}t<0&&(t=0);this.pasteLine(i[r],t,u,this.customSpacingX);u+=this.characterHeight+this.customSpacingY}else{this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0);switch(this.align){case n.RetroFont.ALIGN_LEFT:t=0;break;case n.RetroFont.ALIGN_RIGHT:t=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2}this.textureBuffer.clear();this.pasteLine(this._text,t,0,this.customSpacingX)}};n.RetroFont.prototype.pasteLine=function(t,i,r,u){for(var e=new n.Point,f=0;f<t.length;f++)if(t.charAt(f)==" ")i+=this.characterWidth+u;else if(this.grabData[t.charCodeAt(f)]>=0&&(this.stamp.frame=this.grabData[t.charCodeAt(f)],e.set(i,r),this.render(this.stamp,e,!1),i+=this.characterWidth+u,i>this.width))break};n.RetroFont.prototype.getLongestLine=function(){var i=0,t,n;if(this._text.length>0)for(t=this._text.split("\n"),n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length);return i};n.RetroFont.prototype.removeUnsupportedCharacters=function(n){for(var t,u,i="",r=0;r<this._text.length;r++)t=this._text[r],u=t.charCodeAt(0),(this.grabData[u]>=0||!n&&t==="\n")&&(i=i.concat(t));return i};n.RetroFont.prototype.updateOffset=function(n,t){if(this.offsetX!==n||this.offsetY!==t){for(var u=n-this.offsetX,f=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),r=i.length;r--;)i[r].x+=u,i[r].y+=f,PIXI.TextureCache[i[r].uuid].frame.x=i[r].x,PIXI.TextureCache[i[r].uuid].frame.y=i[r].y;this.buildRetroFontText()}};Object.defineProperty(n.RetroFont.prototype,"text",{get:function(){return this._text},set:function(n){var t;t=this.autoUpperCase?n.toUpperCase():n;t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(n.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(n){this.stamp.smoothed=n;this.buildRetroFontText()}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Device=function(){this.deviceReadyAt=0;this.initialized=!1;this.desktop=!1;this.iOS=!1;this.cocoonJS=!1;this.cocoonJSApp=!1;this.cordova=!1;this.node=!1;this.nodeWebkit=!1;this.ejecta=!1;this.crosswalk=!1;this.android=!1;this.chromeOS=!1;this.linux=!1;this.macOS=!1;this.windows=!1;this.windowsPhone=!1;this.canvas=!1;this.canvasBitBltShift=null;this.webGL=!1;this.file=!1;this.fileSystem=!1;this.localStorage=!1;this.worker=!1;this.css3D=!1;this.pointerLock=!1;this.typedArray=!1;this.vibration=!1;this.getUserMedia=!1;this.quirksMode=!1;this.touch=!1;this.mspointer=!1;this.wheelEvent=null;this.arora=!1;this.chrome=!1;this.epiphany=!1;this.firefox=!1;this.ie=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.mobileSafari=!1;this.midori=!1;this.opera=!1;this.safari=!1;this.webApp=!1;this.silk=!1;this.audioData=!1;this.webAudio=!1;this.ogg=!1;this.opus=!1;this.mp3=!1;this.wav=!1;this.m4a=!1;this.webm=!1;this.iPhone=!1;this.iPhone4=!1;this.iPad=!1;this.pixelRatio=0;this.littleEndian=!1;this.LITTLE_ENDIAN=!1;this.support32bit=!1;this.fullscreen=!1;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=!1};n.Device=new n.Device;n.Device.onInitialized=new n.Signal;n.Device.whenReady=function(n,t,i){var r=this._readyCheck,u,f;this.deviceReadyAt||!r?n.call(t,this):r._monitor||i?(r._queue=r._queue||[],r._queue.push([n,t])):(r._monitor=r.bind(this),r._queue=r._queue||[],r._queue.push([n,t]),u=typeof window.cordova!="undefined",f=navigator.isCocoonJS,document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(r._monitor,0):u&&!f?document.addEventListener("deviceready",r._monitor,!1):(document.addEventListener("DOMContentLoaded",r._monitor,!1),window.addEventListener("load",r._monitor,!1)))};n.Device._readyCheck=function(){var n=this._readyCheck,t,i,r;if(document.body){if(!this.deviceReadyAt){for(this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",n._monitor),document.removeEventListener("DOMContentLoaded",n._monitor),window.removeEventListener("load",n._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);t=n._queue.shift();)i=t[0],r=t[1],i.call(r,this);this._readyCheck=null;this._initialize=null;this.onInitialized=null}}else window.setTimeout(n._monitor,20)};n.Device._initialize=function(){function t(){var t=navigator.userAgent,i;/Playstation Vita/.test(t)?n.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?n.kindle=!0:/Android/.test(t)?n.android=!0:/CrOS/.test(t)?n.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?n.iOS=!0:/Linux/.test(t)?n.linux=!0:/Mac OS/.test(t)?n.macOS=!0:/Windows/.test(t)&&(n.windows=!0,/Windows Phone/i.test(t)&&(n.windowsPhone=!0));i=/Silk/.test(t);(n.windows||n.macOS||n.linux&&!i||n.chromeOS)&&(n.desktop=!0);(n.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(n.desktop=!1)}function i(){n.canvas=!!window.CanvasRenderingContext2D||n.cocoonJS;try{n.localStorage=!!localStorage.getItem}catch(t){n.localStorage=!1}n.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;n.fileSystem=!!window.requestFileSystem;n.webGL=function(){try{var n=document.createElement("canvas");return n.screencanvas=!1,!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();n.webGL=!!n.webGL;n.worker=!!window.Worker;n.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;n.quirksMode=document.compatMode==="CSS1Compat"?!1:!0;n.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);!n.iOS&&(n.ie||n.firefox||n.chrome)&&(n.canvasBitBltShift=!0);(n.safari||n.mobileSafari)&&(n.canvasBitBltShift=!1)}function r(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(n.touch=!0);(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(n.mspointer=!0);n.cocoonJS||("onwheel"in window||n.ie&&"WheelEvent"in window?n.wheelEvent="wheel":"onmousewheel"in window?n.wheelEvent="mousewheel":n.firefox&&"MouseScrollEvent"in window&&(n.wheelEvent="DOMMouseScroll"))}function u(){for(var i,r=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],u=document.createElement("div"),t=0;t<r.length;t++)if(u[r[t]]){n.fullscreen=!0;n.requestFullscreen=r[t];break}if(i=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"],n.fullscreen)for(t=0;t<i.length;t++)if(document[i[t]]){n.cancelFullscreen=i[t];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(n.fullscreenKeyboard=!0)}function f(){var t=navigator.userAgent;if(/Arora/.test(t)?n.arora=!0:/Chrome/.test(t)?n.chrome=!0:/Epiphany/.test(t)?n.epiphany=!0:/Firefox/.test(t)?n.firefox=!0:/AppleWebKit/.test(t)&&n.iOS?n.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(n.ie=!0,n.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?n.midori=!0:/Opera/.test(t)?n.opera=!0:/Safari/.test(t)?n.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(n.ie=!0,n.trident=!0,n.tridentVersion=parseInt(RegExp.$1,10),n.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(n.silk=!0),navigator.standalone&&(n.webApp=!0),typeof cordova!="undefined"&&(n.cordova=!0),typeof process!="undefined"&&typeof require!="undefined"&&(n.node=!0),n.node)try{n.nodeWebkit=typeof require("nw.gui")!="undefined"}catch(i){n.nodeWebkit=!1}if(navigator.isCocoonJS&&(n.cocoonJS=!0),n.cocoonJS)try{n.cocoonJSApp=typeof CocoonJS!="undefined"}catch(i){n.cocoonJSApp=!1}typeof ejecta!="undefined"&&(n.ejecta=!0);/Crosswalk/.test(t)&&(n.crosswalk=!0)}function e(){n.audioData=!!window.Audio;n.webAudio=!!(window.AudioContext||window.webkitAudioContext);var t=document.createElement("audio"),i=!1;try{(i=!!t.canPlayType)&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(n.ogg=!0),(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,""))&&(n.opus=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(n.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(n.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(n.m4a=!0),t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(n.webm=!0))}catch(r){}}function o(){n.pixelRatio=window.devicePixelRatio||1;n.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;n.iPhone4=n.pixelRatio==2&&n.iPhone;n.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;n.typedArray=typeof Int8Array!="undefined"?!0:!1;typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint32Array!="undefined"&&(n.littleEndian=s(),n.LITTLE_ENDIAN=n.littleEndian);n.support32bit=typeof ArrayBuffer!="undefined"&&typeof Uint8ClampedArray!="undefined"&&typeof Int32Array!="undefined"&&n.littleEndian!==null&&h();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(n.vibration=!0)}function s(){var t=new ArrayBuffer(4),n=new Uint8Array(t),i=new Uint32Array(t);return(n[0]=161,n[1]=178,n[2]=195,n[3]=212,i[0]==3569595041)?!0:i[0]==2712847316?!1:null}function h(){var t,n,i;return typeof Uint8ClampedArray=="undefined"?!1:(t=document.createElement("canvas"),n=t.getContext("2d"),!n)?!1:(i=n.createImageData(1,1),i.data instanceof Uint8ClampedArray)}function c(){var t=document.createElement("p"),i,u={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},r;document.body.insertBefore(t,null);for(r in u)t.style[r]!==undefined&&(t.style[r]="translate3d(1px,1px,1px)",i=window.getComputedStyle(t).getPropertyValue(u[r]));document.body.removeChild(t);n.css3D=i!==undefined&&i.length>0&&i!=="none"}var n=this;t();e();f();c();o();i();u();r()};n.Device.canPlayAudio=function(n){return n=="mp3"&&this.mp3?!0:n=="ogg"&&(this.ogg||this.opus)||n=="m4a"&&this.m4a||n=="opus"&&this.opus||n=="wav"&&this.wav||n=="webm"&&this.webm?!0:!1};n.Device.isConsoleOpen=function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1};n.Device.isAndroidStockBrowser=function(){var n=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return n&&n[1]<537};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.DOM={getOffset:function(t,i){i=i||new n.Point;var r=t.getBoundingClientRect(),u=n.DOM.scrollY,f=n.DOM.scrollX,e=document.documentElement.clientTop,o=document.documentElement.clientLeft;return i.x=r.left+f-o,i.y=r.top+u-e,i},getBounds:function(n,t){return typeof t=="undefined"&&(t=0),n=n&&!n.nodeType?n[0]:n,n&&n.nodeType===1?this.calibrate(n.getBoundingClientRect(),t):!1},calibrate:function(n,t){t=+t||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=n.right+t)-(i.left=n.left-t),i.height=(i.bottom=n.bottom+t)-(i.top=n.top-t),i},getAspectRatio:function(n){n=null==n?this.visualBounds:1===n.nodeType?this.getBounds(n):n;var t=n.width,i=n.height;return typeof t=="function"&&(t=t.call(n)),typeof i=="function"&&(i=i.call(n)),t/i},inLayoutViewport:function(n,t){var i=this.getBounds(n,t);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(n){var r=window.screen,u=r.orientation||r.mozOrientation||r.msOrientation,t,i;if(u&&typeof u.type=="string")return u.type;if(typeof u=="string")return u;if(t="portrait-primary",i="landscape-primary",n==="screen")return r.height>r.width?t:i;if(n==="viewport")return this.visualBounds.height>this.visualBounds.width?t:i;if(n==="window.orientation"&&typeof window.orientation=="number")return window.orientation===0||window.orientation===180?t:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return t;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?t:i},visualBounds:new n.Rectangle,layoutBounds:new n.Rectangle,documentBounds:new n.Rectangle};n.Device.whenReady(function(t){var u=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},f=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop},e,i,r;Object.defineProperty(n.DOM,"scrollX",{get:u});Object.defineProperty(n.DOM,"scrollY",{get:f});Object.defineProperty(n.DOM.visualBounds,"x",{get:u});Object.defineProperty(n.DOM.visualBounds,"y",{get:f});Object.defineProperty(n.DOM.layoutBounds,"x",{value:0});Object.defineProperty(n.DOM.layoutBounds,"y",{value:0});e=t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;e?(i=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},r=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(n.DOM.visualBounds,"width",{get:i}),Object.defineProperty(n.DOM.visualBounds,"height",{get:r}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:i}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:r})):(Object.defineProperty(n.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(n.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:function(){var n=document.documentElement.clientWidth,t=window.innerWidth;return n<t?t:n}}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:function(){var n=document.documentElement.clientHeight,t=window.innerHeight;return n<t?t:n}}));Object.defineProperty(n.DOM.documentBounds,"x",{value:0});Object.defineProperty(n.DOM.documentBounds,"y",{value:0});Object.defineProperty(n.DOM.documentBounds,"width",{get:function(){var n=document.documentElement;return Math.max(n.clientWidth,n.offsetWidth,n.scrollWidth)}});Object.defineProperty(n.DOM.documentBounds,"height",{get:function(){var n=document.documentElement;return Math.max(n.clientHeight,n.offsetHeight,n.scrollHeight)}})},null,!0);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Canvas={create:function(n,t,i){n=n||256;t=t||256;var r=document.createElement("canvas");return typeof i=="string"&&i!==""&&(r.id=i),r.width=n,r.height=t,r.style.display="block",r},setBackgroundColor:function(n,t){return t=t||"rgb(0,0,0)",n.style.backgroundColor=t,n},setTouchAction:function(n,t){return t=t||"none",n.style.msTouchAction=t,n.style["ms-touch-action"]=t,n.style["touch-action"]=t,n},setUserSelect:function(n,t){return t=t||"none",n.style["-webkit-touch-callout"]=t,n.style["-webkit-user-select"]=t,n.style["-khtml-user-select"]=t,n.style["-moz-user-select"]=t,n.style["-ms-user-select"]=t,n.style["user-select"]=t,n.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",n},addToDOM:function(n,t,i){var r;return typeof i=="undefined"&&(i=!0),t&&(typeof t=="string"?r=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(r=t)),r||(r=document.body),i&&r.style&&(r.style.overflow="hidden"),r.appendChild(n),n},removeFromDOM:function(n){n.parentNode&&n.parentNode.removeChild(n)},setTransform:function(n,t,i,r,u,f,e){return n.setTransform(r,f,e,u,t,i),n},setSmoothingEnabled:function(n,t){return n.imageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t,n.oImageSmoothingEnabled=t,n.webkitImageSmoothingEnabled=t,n.msImageSmoothingEnabled=t,n},getSmoothingEnabled:function(n){return n.imageSmoothingEnabled||n.mozImageSmoothingEnabled||n.oImageSmoothingEnabled||n.webkitImageSmoothingEnabled||n.msImageSmoothingEnabled},setImageRenderingCrisp:function(n){return n.style["image-rendering"]="optimizeSpeed",n.style["image-rendering"]="crisp-edges",n.style["image-rendering"]="-moz-crisp-edges",n.style["image-rendering"]="-webkit-optimize-contrast",n.style["image-rendering"]="optimize-contrast",n.style["image-rendering"]="pixelated",n.style.msInterpolationMode="nearest-neighbor",n},setImageRenderingBicubic:function(n){return n.style["image-rendering"]="auto",n.style.msInterpolationMode="bicubic",n}};n.Canvas.getOffset=n.DOM.getOffset;n.Canvas.getAspectRatio=n.DOM.getAspectRatio;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RequestAnimationFrame=function(n,t){var r,i;for(typeof t=="undefined"&&(t=!1),this.game=n,this.isRunning=!1,this.forceSetTimeOut=t,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;i++)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._onLoop=null;this._timeOutID=null};n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var n=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return n.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return n.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(n){this.game.update(Math.floor(n));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}};n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Math={PI2:Math.PI*2,fuzzyEqual:function(n,t,i){return typeof i=="undefined"&&(i=.0001),Math.abs(n-t)<i},fuzzyLessThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n<t+i},fuzzyGreaterThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n>t-i},fuzzyCeil:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.ceil(n-t)},fuzzyFloor:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.floor(n+t)},average:function(){for(var t=0,n=0;n<arguments.length;n++)t+=+arguments[n];return t/arguments.length},truncate:function(n){return Math.trunc(n)},shear:function(n){return n%1},snapTo:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.round(n/t),i+n)},snapToFloor:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.floor(n/t),i+n)},snapToCeil:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.ceil(n/t),i+n)},snapToInArray:function(t,i,r){return typeof r=="undefined"&&(r=!0),r&&i.sort(),n.ArrayUtils.findClosest(t,i)},roundTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.round(n*r)/r},floorTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.floor(n*r)/r},ceilTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.ceil(n*r)/r},interpolateFloat:function(n,t,i){return(t-n)*i+n},angleBetween:function(n,t,i,r){return Math.atan2(r-t,i-n)},angleBetweenY:function(n,t,i,r){return Math.atan2(i-n,r-t)},angleBetweenPoints:function(n,t){return Math.atan2(t.y-n.y,t.x-n.x)},angleBetweenPointsY:function(n,t){return Math.atan2(t.x-n.x,t.y-n.y)},reverseAngle:function(n){return this.normalizeAngle(n+Math.PI,!0)},normalizeAngle:function(n){return n=n%(2*Math.PI),n>=0?n:n+2*Math.PI},normalizeLatitude:function(t){return n.Math.clamp(t,-90,90)},normalizeLongitude:function(t){return n.Math.wrap(t,-180,180)},chanceRoll:function(t){return n.Utils.chanceRoll(t)},numberArray:function(t,i){return n.ArrayUtils.numberArray(t,i)},numberArrayStep:function(t,i,r){return n.ArrayUtils.numberArrayStep(t,i,r)},maxAdd:function(n,t,i){return Math.min(n+t,i)},minSub:function(n,t,i){return Math.max(n-t,i)},wrap:function(n,t,i){var u=i-t,r;return u<=0?0:(r=(n-t)%u,r<0&&(r+=u),r+t)},wrapValue:function(n,t,i){return n=Math.abs(n),t=Math.abs(t),i=Math.abs(i),(n+t)%i},limitValue:function(t,i,r){return n.Math.clamp(t,i,r)},randomSign:function(){return n.Utils.randomChoice(-1,1)},isOdd:function(n){return n&1},isEven:function(n){return!(n&1)},min:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]<n[i]&&(i=t);return n[i]},max:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]>n[i]&&(i=t);return n[i]},minProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]<t[r][n]&&(r=i);return t[r][n]},maxProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]>t[r][n]&&(r=i);return t[r][n]},wrapAngle:function(n,t){return t?this.wrap(n,-Math.PI,Math.PI):this.wrap(n,-180,180)},angleLimit:function(n,t,i){var r=n;return n>i?r=i:n<t&&(r=t),r},linearInterpolation:function(n,t){var i=n.length-1,r=i*t,u=Math.floor(r);return t<0?this.linear(n[0],n[1],r):t>1?this.linear(n[i],n[i-1],i-r):this.linear(n[u],n[u+1>i?i:u+1],r-u)},bezierInterpolation:function(n,t){for(var u=0,r=n.length-1,i=0;i<=r;i++)u+=Math.pow(1-t,r-i)*Math.pow(t,i)*n[i]*this.bernstein(r,i);return u},catmullRomInterpolation:function(n,t){var i=n.length-1,u=i*t,r=Math.floor(u);return n[0]===n[i]?(t<0&&(r=Math.floor(u=i*(1+t))),this.catmullRom(n[(r-1+i)%i],n[r],n[(r+1)%i],n[(r+2)%i],u-r)):t<0?n[0]-(this.catmullRom(n[0],n[0],n[1],n[1],-u)-n[0]):t>1?n[i]-(this.catmullRom(n[i],n[i],n[i-1],n[i-1],u-i)-n[i]):this.catmullRom(n[r?r-1:0],n[r],n[i<r+1?i:r+1],n[i<r+2?i:r+2],u-r)},linear:function(n,t,i){return(t-n)*i+n},bernstein:function(n,t){return this.factorial(n)/this.factorial(t)/this.factorial(n-t)},factorial:function(n){if(n===0)return 1;for(var t=n;--n;)t*=n;return t},catmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t},difference:function(n,t){return Math.abs(n-t)},getRandom:function(t,i,r){return n.ArrayUtils.getRandomItem(t,i,r)},removeRandom:function(t,i,r){return n.ArrayUtils.removeRandomItem(t,i,r)},floor:function(n){return Math.trunc(n)},ceil:function(t){return n.Math.roundAwayFromZero(t)},roundAwayFromZero:function(n){return n>0?Math.ceil(n):Math.floor(n)},sinCosGenerator:function(n,t,i,r){var u;typeof t=="undefined"&&(t=1);typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=1);var f=t,e=i,o=r*Math.PI/n,s=[],h=[];for(u=0;u<n;u++)e-=f*o,f+=e*o,s[u]=e,h[u]=f;return{sin:h,cos:s,length:n}},shift:function(n){var t=n.shift();return n.push(t),t},shuffleArray:function(t){return n.ArrayUtils.shuffle(t)},distance:function(n,t,i,r){var u=n-i,f=t-r;return Math.sqrt(u*u+f*f)},distancePow:function(n,t,i,r,u){return typeof u=="undefined"&&(u=2),Math.sqrt(Math.pow(i-n,u)+Math.pow(r-t,u))},distanceRounded:function(t,i,r,u){return Math.round(n.Math.distance(t,i,r,u))},clamp:function(n,t,i){return n<t?t:n>i?i:n},clampBottom:function(n,t){return n<t?t:n},within:function(n,t,i){return Math.abs(n-t)<=i},mapLinear:function(n,t,i,r,u){return r+(n-t)*(u-r)/(i-t)},smoothstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*(3-2*n)},smootherstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*n*(n*(n*6-15)+10)},sign:function(n){return n<0?-1:n>0?1:0},percent:function(n,t,i){return typeof i=="undefined"&&(i=0),n>t||i>t?1:n<i||i>n?0:(n-i)/t}};h=Math.PI/180;c=180/Math.PI;n.Math.degToRad=function(n){return n*h};n.Math.radToDeg=function(n){return n*c};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RandomDataGenerator=function(n){typeof n=="undefined"&&(n=[]);this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(n)};n.RandomDataGenerator.prototype={rnd:function(){var n=2091639*this.s0+this.c*23283064365386963e-26;return this.c=n|0,this.s0=this.s1,this.s1=this.s2,this.s2=n-this.c,this.s2},sow:function(n){var t,i;if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,n)for(t=0;t<n.length&&n[t]!=null;t++)i=n[t],this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)},hash:function(n){var i,r,t;for(t=4022871197,n=n.toString(),r=0;r<n.length;r++)t+=n.charCodeAt(r),i=.025196032824169379*t,t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296;return(t>>>0)*23283064365386963e-26},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*11102230246251565e-32},real:function(){return this.integer()+this.frac()},integerInRange:function(n,t){return Math.floor(this.realInRange(0,t-n+1)+n)},between:function(n,t){return this.integerInRange(n,t)},realInRange:function(n,t){return this.frac()*(t-n)+n},normal:function(){return 1-2*this.frac()},uuid:function(){for(var n="",t="",t=n="";n++<36;t+=~n%5|n*3&4?(n^15?8^this.frac()*(n^20?16:4):4).toString(16):"-");return t},pick:function(n){return n[this.integerInRange(0,n.length-1)]},weightedPick:function(n){return n[~~(Math.pow(this.frac(),2)*(n.length-1))]},timestamp:function(n,t){return this.realInRange(n||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}};n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator;
/**
 * @author       Timo Hausmann
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
n.QuadTree=function(n,t,i,r,u,f,e){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(n,t,i,r,u,f,e)};n.QuadTree.prototype={reset:function(n,t,i,r,u,f,e){this.maxObjects=u||10;this.maxLevels=f||4;this.level=e||0;this.bounds={x:Math.round(n),y:Math.round(t),width:i,height:r,subWidth:Math.floor(i/2),subHeight:Math.floor(r/2),right:Math.round(n)+Math.floor(i/2),bottom:Math.round(t)+Math.floor(r/2)};this.objects.length=0;this.nodes.length=0},populate:function(n){n.forEach(this.populateHandler,this,!0)},populateHandler:function(n){n.body&&n.exists&&this.insert(n.body)},split:function(){this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(n){var i=0,t;if(this.nodes[0]!=null&&(t=this.getIndex(n),t!==-1)){this.nodes[t].insert(n);return}if(this.objects.push(n),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(this.nodes[0]==null&&this.split();i<this.objects.length;)t=this.getIndex(this.objects[i]),t!==-1?this.nodes[t].insert(this.objects.splice(i,1)[0]):i++},getIndex:function(n){var t=-1;return n.x<this.bounds.right&&n.right<this.bounds.right?n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=1:n.y>this.bounds.bottom&&(t=2):n.x>this.bounds.right&&(n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=0:n.y>this.bounds.bottom&&(t=3)),t},retrieve:function(t){var i,r;if(t instanceof n.Rectangle)i=this.objects,r=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects;r=this.getIndex(t.body)}return this.nodes[0]&&(r!==-1?i=i.concat(this.nodes[r].retrieve(t)):(i=i.concat(this.nodes[0].retrieve(t)),i=i.concat(this.nodes[1].retrieve(t)),i=i.concat(this.nodes[2].retrieve(t)),i=i.concat(this.nodes[3].retrieve(t)))),i},clear:function(){this.objects.length=0;for(var n=this.nodes.length;n--;)this.nodes[n].clear(),this.nodes.splice(n,1);this.nodes.length=0}};n.QuadTree.prototype.constructor=n.QuadTree;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Net=function(n){this.game=n};n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(n){return window.location.hostname.indexOf(n)!==-1},updateQueryString:function(n,t,i,r){var u,f,o,e;if(typeof i=="undefined"&&(i=!1),(typeof r=="undefined"||r==="")&&(r=window.location.href),u="",f=new RegExp("([?|&])"+n+"=.*?(&|#|$)(.*)","gi"),f.test(r)?u=typeof t!="undefined"&&t!==null?r.replace(f,"$1"+n+"="+t+"$2$3"):r.replace(f,"$1$3").replace(/(&|\?)$/,""):typeof t!="undefined"&&t!==null?(o=r.indexOf("?")!==-1?"&":"?",e=r.split("#"),r=e[0]+o+n+"="+t,e[1]&&(r+="#"+e[1]),u=r):u=r,i)window.location.href=u;else return u},getQueryString:function(n){var i,r,u,t;typeof n=="undefined"&&(n="");i={};r=location.search.substring(1).split("&");for(u in r)if(t=r[u].split("="),t.length>1){if(n&&n==this.decodeURI(t[0]))return this.decodeURI(t[1]);i[this.decodeURI(t[0])]=this.decodeURI(t[1])}return i},decodeURI:function(n){return decodeURIComponent(n.replace(/\+/g," "))}};n.Net.prototype.constructor=n.Net;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TweenManager=function(t){this.game=t;this._tweens=[];this._add=[];this.easeMap={Power0:n.Easing.Power0,Power1:n.Easing.Power1,Power2:n.Easing.Power2,Power3:n.Easing.Power3,Power4:n.Easing.Power4,Linear:n.Easing.Linear.None,Quad:n.Easing.Quadratic.Out,Cubic:n.Easing.Cubic.Out,Quart:n.Easing.Quartic.Out,Quint:n.Easing.Quintic.Out,Sine:n.Easing.Sinusoidal.Out,Expo:n.Easing.Exponential.Out,Circ:n.Easing.Circular.Out,Elastic:n.Easing.Elastic.Out,Back:n.Easing.Back.Out,Bounce:n.Easing.Bounce.Out,"Quad.easeIn":n.Easing.Quadratic.In,"Cubic.easeIn":n.Easing.Cubic.In,"Quart.easeIn":n.Easing.Quartic.In,"Quint.easeIn":n.Easing.Quintic.In,"Sine.easeIn":n.Easing.Sinusoidal.In,"Expo.easeIn":n.Easing.Exponential.In,"Circ.easeIn":n.Easing.Circular.In,"Elastic.easeIn":n.Easing.Elastic.In,"Back.easeIn":n.Easing.Back.In,"Bounce.easeIn":n.Easing.Bounce.In,"Quad.easeOut":n.Easing.Quadratic.Out,"Cubic.easeOut":n.Easing.Cubic.Out,"Quart.easeOut":n.Easing.Quartic.Out,"Quint.easeOut":n.Easing.Quintic.Out,"Sine.easeOut":n.Easing.Sinusoidal.Out,"Expo.easeOut":n.Easing.Exponential.Out,"Circ.easeOut":n.Easing.Circular.Out,"Elastic.easeOut":n.Easing.Elastic.Out,"Back.easeOut":n.Easing.Back.Out,"Bounce.easeOut":n.Easing.Bounce.Out,"Quad.easeInOut":n.Easing.Quadratic.InOut,"Cubic.easeInOut":n.Easing.Cubic.InOut,"Quart.easeInOut":n.Easing.Quartic.InOut,"Quint.easeInOut":n.Easing.Quintic.InOut,"Sine.easeInOut":n.Easing.Sinusoidal.InOut,"Expo.easeInOut":n.Easing.Exponential.InOut,"Circ.easeInOut":n.Easing.Circular.InOut,"Elastic.easeInOut":n.Easing.Elastic.InOut,"Back.easeInOut":n.Easing.Back.InOut,"Bounce.easeInOut":n.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var n=0;n<this._tweens.length;n++)this._tweens[n].pendingDelete=!0;this._add=[]},removeFrom:function(t,i){var r,u;if(typeof i=="undefined"&&(i=!0),Array.isArray(t))for(r=0,u=t.length;r<u;r++)this.removeFrom(t[r]);else if(t.type===n.GROUP&&i)for(r=0,u=t.children.length;r<u;r++)this.removeFrom(t.children[r]);else{for(r=0,u=this._tweens.length;r<u;r++)t===this._tweens[r].target&&this.remove(this._tweens[r]);for(r=0,u=this._add.length;r<u;r++)t===this._add[r].target&&this.remove(this._add[r])}},add:function(n){n._manager=this;this._add.push(n)},create:function(t){return new n.Tween(t,this.game,this)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(n),t!==-1&&(this._add[t].pendingDelete=!0))},update:function(){var i=this._add.length,t=this._tweens.length,n;if(t===0&&i===0)return!1;for(n=0;n<t;)this._tweens[n].update(this.game.time.time)?n++:(this._tweens.splice(n,1),t--);return i>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(n){return this._tweens.some(function(t){return t.target===n})},_pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._pause()},_resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._resume()},pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].pause()},resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].resume(!0)}};n.TweenManager.prototype.constructor=n.TweenManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tween=function(t,i,r){this.game=i;this.target=t;this.manager=r;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new n.Signal;this.onLoop=new n.Signal;this.onRepeat=new n.Signal;this.onChildComplete=new n.Signal;this.onComplete=new n.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=!1};n.Tween.prototype={to:function(t,i,r,u,f,e,o){return(typeof i=="undefined"&&(i=1e3),typeof r=="undefined"&&(r=n.Easing.Default),typeof u=="undefined"&&(u=!1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),typeof o=="undefined"&&(o=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning)?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push(new n.TweenData(this).to(t,i,r,f,e,o)),u&&this.start(),this)},from:function(t,i,r,u,f,e,o){return(typeof i=="undefined"&&(i=1e3),typeof r=="undefined"&&(r=n.Easing.Default),typeof u=="undefined"&&(u=!1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),typeof o=="undefined"&&(o=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning)?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push(new n.TweenData(this).from(t,i,r,f,e,o)),u&&this.start(),this)},start:function(n){var i,t;if(typeof n=="undefined"&&(n=0),this.game===null||this.target===null||this.timeline.length===0||this.isRunning)return this;for(t=0;t<this.timeline.length;t++)for(i in this.timeline[t].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(t=0;t<this.timeline.length;t++)this.timeline[t].loadValues();return this.manager.add(this),this.isRunning=!0,(n<0||n>this.timeline.length-1)&&(n=0),this.current=n,this.timeline[this.current].start(),this.onStart.dispatch(this.target,this),this},stop:function(n){return typeof n=="undefined"&&(n=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,n&&(this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(n,t,i){if(this.timeline.length===0)return this;if(typeof i=="undefined"&&(i=0),i===-1)for(var r=0;r<this.timeline.length;r++)this.timeline[r][n]=t;else this.timeline[i][n]=t;return this},delay:function(n,t){return this.updateTweenData("delay",n,t)},repeat:function(n,t,i){return typeof t=="undefined"&&(t=0),this.updateTweenData("repeatCounter",n,i),this.updateTweenData("repeatDelay",t,i)},repeatDelay:function(n,t){return this.updateTweenData("repeatDelay",n,t)},yoyo:function(n,t,i){return typeof t=="undefined"&&(t=0),this.updateTweenData("yoyo",n,i),this.updateTweenData("yoyoDelay",t,i)},yoyoDelay:function(n,t){return this.updateTweenData("yoyoDelay",n,t)},easing:function(n,t){return typeof n=="string"&&this.manager.easeMap[n]&&(n=this.manager.easeMap[n]),this.updateTweenData("easingFunction",n,t)},interpolation:function(t,i,r){return typeof i=="undefined"&&(i=n.Math),this.updateTweenData("interpolationFunction",t,r),this.updateTweenData("interpolationContext",i,r)},repeatAll:function(n){return typeof n=="undefined"&&(n=0),this.repeatCounter=n,this},chain:function(){for(var n=arguments.length;n--;)n>0?arguments[n-1].chainedTween=arguments[n]:this.chainedTween=arguments[n];return this},loop:function(n){return typeof n=="undefined"&&(n=!0),n?this.repeatAll(-1):this.repeatCounter=0,this},onUpdateCallback:function(n,t){return this._onUpdateCallback=n,this._onUpdateCallbackContext=t,this},pause:function(){this.isPaused=!0;this._codePaused=!0;this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1;this._codePaused=!1;for(var n=0;n<this.timeline.length;n++)this.timeline[n].isRunning||(this.timeline[n].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){var i,r;return this.pendingDelete?!1:this.isPaused?!0:(i=this.timeline[this.current].update(t),i===n.TweenData.PENDING)?!0:i===n.TweenData.RUNNING?(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning):i===n.TweenData.LOOPED?(this.onLoop.dispatch(this.target,this),!0):i===n.TweenData.COMPLETE?(r=!1,this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,r=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,r=!0)),r?this.repeatCounter===-1?(this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)):void 0},generateData:function(n,t){var r,i;if(this.game===null||this.target===null)return null;for(typeof t=="undefined"&&(t=[]),i=0;i<this.timeline.length;i++)for(r in this.timeline[i].vEnd)this.properties[r]=this.target[r]||0,Array.isArray(this.properties[r])||(this.properties[r]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)t=t.concat(this.timeline[i].generateData(n));return t}};Object.defineProperty(n.Tween.prototype,"totalDuration",{get:function(){for(var t=0,n=0;n<this.timeline.length;n++)t+=this.timeline[n].duration;return t}});n.Tween.prototype.constructor=n.Tween;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TweenData=function(t){this.parent=t;this.game=t.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1e3;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.interpolate=!1;this.yoyo=!1;this.yoyoDelay=0;this.inReverse=!1;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=n.Easing.Default;this.interpolationFunction=n.Math.linearInterpolation;this.interpolationContext=n.Math;this.isRunning=!1;this.isFrom=!1};n.TweenData.PENDING=0;n.TweenData.RUNNING=1;n.TweenData.LOOPED=2;n.TweenData.COMPLETE=3;n.TweenData.prototype={to:function(n,t,i,r,u,f){return this.vEnd=n,this.duration=t,this.easingFunction=i,this.delay=r,this.repeatCounter=u,this.yoyo=f,this.isFrom=!1,this},from:function(n,t,i,r,u,f){return this.vEnd=n,this.duration=t,this.easingFunction=i,this.delay=r,this.repeatCounter=u,this.yoyo=f,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=this.delay>0?!1:!0,this.isFrom)for(var n in this.vStartCache)this.vStart[n]=this.vEndCache[n],this.vEnd[n]=this.vStartCache[n],this.parent.target[n]=this.vStart[n];return this.value=0,this.yoyoCounter=0,this},loadValues:function(){for(var n in this.parent.properties){if(this.vStart[n]=this.parent.properties[n],Array.isArray(this.vEnd[n])){if(this.vEnd[n].length===0)continue;this.vEnd[n]=[this.vStart[n]].concat(this.vEnd[n])}typeof this.vEnd[n]!="undefined"?(typeof this.vEnd[n]=="string"&&(this.vEnd[n]=this.vStart[n]+parseFloat(this.vEnd[n],10)),this.parent.properties[n]=this.vEnd[n]):this.vEnd[n]=this.vStart[n];this.vStartCache[n]=this.vStart[n];this.vEndCache[n]=this.vEnd[n]}return this},update:function(){var t,r,i;if(this.isRunning){if(this.game.time.time<this.startTime)return n.TweenData.RUNNING}else if(this.game.time.time>=this.startTime)this.isRunning=!0;else return n.TweenData.PENDING;this.parent.reverse?(this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(t in this.vEnd)r=this.vStart[t],i=this.vEnd[t],this.parent.target[t]=Array.isArray(i)?this.interpolationFunction.call(this.interpolationContext,i,this.value):r+(i-r)*this.value;return!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0?this.repeat():n.TweenData.RUNNING},generateData:function(n){var u,i,f,r,e;this.dt=this.parent.reverse?this.duration:0;var t=[],o=!1,s=1e3/n;do{this.parent.reverse?(this.dt-=s,this.dt=Math.max(this.dt,0)):(this.dt+=s,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);u={};for(i in this.vEnd)f=this.vStart[i],r=this.vEnd[i],u[i]=Array.isArray(r)?this.interpolationFunction(r,this.value):f+(r-f)*this.value;t.push(u);(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0)&&(o=!0)}while(!o);return this.yoyo&&(e=t.slice(),e.reverse(),t=t.concat(e)),t},repeat:function(){var t;if(this.yoyo){if(this.inReverse&&this.repeatCounter===0)return n.TweenData.COMPLETE;this.inReverse=!this.inReverse}else if(this.repeatCounter===0)return n.TweenData.COMPLETE;if(this.inReverse)for(t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,n.TweenData.LOOPED}};n.TweenData.prototype.constructor=n.TweenData;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return n===0?0:n===1?1:1-Math.cos(n*Math.PI/2)},Out:function(n){return n===0?0:n===1?1:Math.sin(n*Math.PI/2)},InOut:function(n){return n===0?0:n===1?1:.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(t){return t<.5?n.Easing.Bounce.In(t*2)*.5:n.Easing.Bounce.Out(t*2-1)*.5+.5}}};n.Easing.Default=n.Easing.Linear.None;n.Easing.Power0=n.Easing.Linear.None;n.Easing.Power1=n.Easing.Quadratic.Out;n.Easing.Power2=n.Easing.Cubic.Out;n.Easing.Power3=n.Easing.Quartic.Out;n.Easing.Power4=n.Easing.Quintic.Out;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Time=function(t){this.game=t;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=0;this.physicsElapsedMS=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=!1;this.frames=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new n.Timer(this.game,!1);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=!1;this._timers=[]};n.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(n){return this._timers.push(n),n},create:function(t){typeof t=="undefined"&&(t=!0);var i=new n.Timer(this.game,t);return this._timers.push(i),i},removeAll:function(){for(var n=0;n<this._timers.length;n++)this._timers[n].destroy();this._timers=[];this.events.removeAll()},update:function(n){var r=this.time,t,i;if(this.time=Date.now(),this.elapsedMS=this.time-r,this.prevTime=this.now,this.now=n,this.elapsed=this.now-this.prevTime,this.timeToCall=Math.floor(Math.max(0,1e3/this.desiredFps-(this.timeCallExpected-n))),this.timeCallExpected=n+this.timeToCall,this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=this.desiredFps*2&&(this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5,this._frameCount=0,this._elapsedAccumulator=0),this.physicsElapsed=1/this.desiredFps,this.physicsElapsedMS=this.physicsElapsed*1e3,this.advancedTiming&&(this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),!this.game.paused)for(this.events.update(this.time),t=0,i=this._timers.length;t<i;)this._timers[t].update(this.time)?t++:(this._timers.splice(t,1),i--)},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();for(var n=this._timers.length;n--;)this._timers[n]._pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();for(var n=this._timers.length;n--;)this._timers[n]._resume()},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(n){return this.time-n},elapsedSecondsSince:function(n){return(this.time-n)*.001},reset:function(){this._started=this.time;this.removeAll()}};n.Time.prototype.constructor=n.Time;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Timer=function(t,i){typeof i=="undefined"&&(i=!0);this.game=t;this.running=!1;this.autoDestroy=i;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new n.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=!1;this._codePaused=!1;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};n.Timer.MINUTE=6e4;n.Timer.SECOND=1e3;n.Timer.HALF=500;n.Timer.QUARTER=250;n.Timer.prototype={create:function(t,i,r,u,f,e){var o,s;return t=Math.round(t),o=t,o+=this._now===0?this.game.time.time:this._now,s=new n.TimerEvent(this,t,o,r,i,u,f,e),this.events.push(s),this.order(),this.expired=!1,s},add:function(n,t,i){return this.create(n,!1,0,t,i,Array.prototype.splice.call(arguments,3))},repeat:function(n,t,i,r){return this.create(n,!1,t,i,r,Array.prototype.splice.call(arguments,4))},loop:function(n,t,i){return this.create(n,!0,0,t,i,Array.prototype.splice.call(arguments,3))},start:function(n){if(!this.running){this._started=this.game.time.time+(n||0);this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(n){this.running=!1;typeof n=="undefined"&&(n=!0);n&&(this.events.length=0)},remove:function(n){for(var t=0;t<this.events.length;t++)if(this.events[t]===n)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(n,t){return n.tick<t.tick?-1:n.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(n){if(this.paused)return!0;if(this.elapsed=n-this._now,this._now=n,this.elapsed>this.timeCap&&this.adjustEvents(n-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running)if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;else break;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&((this._codePaused=!0,this.paused)||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(n){for(var i,r,t=0;t<this.events.length;t++)this.events[t].pendingDelete||(i=this.events[t].tick-n,i<0&&(i=0),this.events[t].tick=this._now+i);r=this.nextTick-n;this.nextTick=r<0?this._now:this._now+r},resume:function(){if(this.paused){var n=this.game.time.time;this._pauseTotal+=n-this._now;this._now=n;this.adjustEvents(this._pauseStarted);this.paused=!1;this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.events=[];this._len=0;this._i=0}};Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this.running?this.ms*.001:0}});n.Timer.prototype.constructor=n.Timer;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TimerEvent=function(n,t,i,r,u,f,e,o){this.timer=n;this.delay=t;this.tick=i;this.repeatCount=r-1;this.loop=u;this.callback=f;this.callbackContext=e;this.args=o;this.pendingDelete=!1};n.TimerEvent.prototype.constructor=n.TimerEvent;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationManager=function(n){this.sprite=n;this.game=n.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]};n.AnimationManager.prototype={loadFrameData:function(n,t){if(typeof n=="undefined")return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(n);return this._frameData=n,typeof t=="undefined"||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(n,t){if(this._frameData=n.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return typeof t=="undefined"||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(t,i,r,u,f){return i=i||[],r=r||60,typeof u=="undefined"&&(u=!1),typeof f=="undefined"&&(f=i&&typeof i[0]=="number"?!0:!1),this._outputFrames.length=0,this._frameData.getFrameIndexes(i,f,this._outputFrames),this._anims[t]=new n.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,r,u),this.currentAnim=this._anims[t],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(n,t){typeof t=="undefined"&&(t=!0);for(var i=0;i<n.length;i++)if(t===!0){if(n[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(n[i])===!1)return!1;return!0},play:function(n,t,i,r){if(this._anims[n])return this.currentAnim===this._anims[n]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,i,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[n],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,i,r))},stop:function(n,t){typeof t=="undefined"&&(t=!1);typeof n=="string"?this._anims[n]&&(this.currentAnim=this._anims[n],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(n){this.currentAnim&&(this.currentAnim.next(n),this.currentFrame=this.currentAnim.currentFrame)},previous:function(n){this.currentAnim&&(this.currentAnim.previous(n),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(n){return typeof n=="string"&&this._anims[n]?this._anims[n]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){for(var n in this._anims)this._anims.hasOwnProperty(n)&&this._anims[n].destroy();this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};n.AnimationManager.prototype.constructor=n.AnimationManager;Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(n){this.currentAnim.paused=n}});Object.defineProperty(n.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}});Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(n){typeof n=="number"&&this._frameData&&this._frameData.getFrame(n)!==null&&(this.currentFrame=this._frameData.getFrame(n),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}});Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(n){typeof n=="string"&&this._frameData.getFrameByName(n)!==null?(this.currentFrame=this._frameData.getFrameByName(n),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Animation=function(t,i,r,u,f,e,o){typeof o=="undefined"&&(o=!1);this.game=t;this._parent=i;this._frameData=u;this.name=r;this._frames=[];this._frames=this._frames.concat(f);this.delay=1e3/e;this.loop=o;this.loopCount=0;this.killOnComplete=!1;this.isFinished=!1;this.isPlaying=!1;this.isPaused=!1;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new n.Signal;this.onUpdate=null;this.onComplete=new n.Signal;this.onLoop=new n.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};n.Animation.prototype={play:function(n,t,i){typeof n=="number"&&(this.delay=1e3/n);typeof t=="boolean"&&(this.loop=t);typeof i!="undefined"&&(this.killOnComplete=i);this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.updateCurrentFrame(!1);this._parent.events.onAnimationStart$dispatch(this._parent,this);return this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(n,t){var r,i;if(typeof t=="undefined"&&(t=!1),typeof n=="string")for(i=0;i<this._frames.length;i++)this._frameData.getFrame(this._frames[i]).name===n&&(r=i);else if(typeof n=="number")if(t)r=n;else for(i=0;i<this._frames.length;i++)this._frames[i]===r&&(r=i);r&&(this._frameIndex=r-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(n,t){if(typeof n=="undefined"&&(n=!1),typeof t=="undefined"&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,n&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){if(this.isPaused)return!1;if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){if(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);return this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)}return this.complete(),!1}return this.updateCurrentFrame(!0)}return!1},updateCurrentFrame:function(n){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&n?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(n){typeof n=="undefined"&&(n=1);var t=this._frameIndex+n;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1);t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(n){typeof n=="undefined"&&(n=1);var t=this._frameIndex-n;t<0&&(this.loop?t=this._frames.length+t:t++);t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(n){this._frameData=n;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};n.Animation.prototype.constructor=n.Animation;Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(n){this.isPaused=n;n?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}});Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(n){this.currentFrame=this._frameData.getFrame(this._frames[n]);this.currentFrame!==null&&(this._frameIndex=n,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(n.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(n){n>=1&&(this.delay=1e3/n)}});Object.defineProperty(n.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){t&&this.onUpdate===null?this.onUpdate=new n.Signal:t||this.onUpdate===null||(this.onUpdate.dispose(),this.onUpdate=null)}});n.Animation.generateFrameNames=function(t,i,r,u,f){var s,o,e;if(typeof u=="undefined"&&(u=""),s=[],o="",i<r)for(e=i;e<=r;e++)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);else for(e=i;e>=r;e--)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);return s};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Frame=function(t,i,r,u,f,e,o){this.index=t;this.x=i;this.y=r;this.width=u;this.height=f;this.name=e;this.uuid=o;this.centerX=Math.floor(u/2);this.centerY=Math.floor(f/2);this.distance=n.Math.distance(0,0,u,f);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=u;this.sourceSizeH=f;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};n.Frame.prototype={setTrim:function(n,t,i,r,u,f,e){this.trimmed=n;n&&(this.sourceSizeW=t,this.sourceSizeH=i,this.centerX=Math.floor(t/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=u,this.spriteSourceSizeW=f,this.spriteSourceSizeH=e)},clone:function(){var i=new n.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var t in this)this.hasOwnProperty(t)&&(i[t]=this[t]);return i},getRect:function(t){return typeof t=="undefined"?t=new n.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}};n.Frame.prototype.constructor=n.Frame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FrameData=function(){this._frames=[];this._frameNames=[]};n.FrameData.prototype={addFrame:function(n){return n.index=this._frames.length,this._frames.push(n),n.name!==""&&(this._frameNames[n.name]=n.index),n},getFrame:function(n){return n>=this._frames.length&&(n=0),this._frames[n]},getFrameByName:function(n){return typeof this._frameNames[n]=="number"?this._frames[this._frameNames[n]]:null},checkFrameName:function(n){return this._frameNames[n]==null?!1:!0},clone:function(){for(var r,t=new n.FrameData,i=0;i<this._frames.length;i++)t._frames.push(this._frames[i].clone());for(r in this._frameNames)this._frameNames.hasOwnProperty(r)&&t._frameNames.push(this._frameNames[r]);return t},getFrameRange:function(n,t,i){typeof i=="undefined"&&(i=[]);for(var r=n;r<=t;r++)i.push(this._frames[r]);return i},getFrames:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0;r<this._frames.length;r++)i.push(this._frames[r]);else for(r=0,u=n.length;r<u;r++)t?i.push(this.getFrame(n[r])):i.push(this.getFrameByName(n[r]));return i},getFrameIndexes:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0,u=this._frames.length;r<u;r++)i.push(this._frames[r].index);else for(r=0,u=n.length;r<u;r++)t?i.push(n[r]):this.getFrameByName(n[r])&&i.push(this.getFrameByName(n[r]).index);return i}};n.FrameData.prototype.constructor=n.FrameData;Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationParser={spriteSheet:function(t,i,r,u,f,e,o){var a=t.cache.getImage(i),s,h,l,p;if(a==null)return null;s=a.width;h=a.height;r<=0&&(r=Math.floor(-s/Math.min(-1,r)));u<=0&&(u=Math.floor(-h/Math.min(-1,u)));var b=Math.floor((s-e)/(r+o)),k=Math.floor((h-e)/(u+o)),v=b*k;if(f!==-1&&(v=f),s===0||h===0||s<r||h<u||v===0)return console.warn("Phaser.AnimationParser.spriteSheet: '"+i+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;var w=new n.FrameData,c=e,y=e;for(l=0;l<v;l++)p=t.rnd.uuid(),w.addFrame(new n.Frame(l,c,y,r,u,"",p)),PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:c,y:y,width:r,height:u}),c+=r+o,c+r>s&&(c=e,y+=u+o);return w},JSONData:function(t,i,r){var e,f,s,u,o;if(!i.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(i);return}for(e=new n.FrameData,f=i.frames,u=0;u<f.length;u++)o=t.rnd.uuid(),s=e.addFrame(new n.Frame(u,f[u].frame.x,f[u].frame.y,f[u].frame.w,f[u].frame.h,f[u].filename,o)),PIXI.TextureCache[o]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:f[u].frame.x,y:f[u].frame.y,width:f[u].frame.w,height:f[u].frame.h}),f[u].trimmed&&s.setTrim(f[u].trimmed,f[u].sourceSize.w,f[u].sourceSize.h,f[u].spriteSourceSize.x,f[u].spriteSourceSize.y,f[u].spriteSourceSize.w,f[u].spriteSourceSize.h);return e},JSONDataHash:function(t,i,r){var u,e;if(!i.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(i);return}var o=new n.FrameData,f=i.frames,s,h=0;for(u in f)e=t.rnd.uuid(),s=o.addFrame(new n.Frame(h,f[u].frame.x,f[u].frame.y,f[u].frame.w,f[u].frame.h,u,e)),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:f[u].frame.x,y:f[u].frame.y,width:f[u].frame.w,height:f[u].frame.h}),f[u].trimmed&&s.setTrim(f[u].trimmed,f[u].sourceSize.w,f[u].sourceSize.h,f[u].spriteSourceSize.x,f[u].spriteSourceSize.y,f[u].spriteSourceSize.w,f[u].spriteSourceSize.h),h++;return o},XMLData:function(t,i,r){var c,l,p,a,w,u,v,y,e,o,s,h,b,k,f;if(!i.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}for(c=new n.FrameData,l=i.getElementsByTagName("SubTexture"),f=0;f<l.length;f++)a=t.rnd.uuid(),u=l[f].attributes,w=u.name.value,v=parseInt(u.x.value,10),y=parseInt(u.y.value,10),e=parseInt(u.width.value,10),o=parseInt(u.height.value,10),s=null,h=null,u.frameX&&(s=Math.abs(parseInt(u.frameX.value,10)),h=Math.abs(parseInt(u.frameY.value,10)),b=parseInt(u.frameWidth.value,10),k=parseInt(u.frameHeight.value,10)),p=c.addFrame(new n.Frame(f,v,y,e,o,w,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:v,y:y,width:e,height:o}),(s!==null||h!==null)&&p.setTrim(!0,e,o,s,h,b,k);return c}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Cache=function(t){this.game=t;this.autoResolveURL=!1;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new n.Signal;this._cacheMap=[];this._cacheMap[n.Cache.CANVAS]=this._canvases;this._cacheMap[n.Cache.IMAGE]=this._images;this._cacheMap[n.Cache.TEXTURE]=this._textures;this._cacheMap[n.Cache.SOUND]=this._sounds;this._cacheMap[n.Cache.TEXT]=this._text;this._cacheMap[n.Cache.PHYSICS]=this._physics;this._cacheMap[n.Cache.TILEMAP]=this._tilemaps;this._cacheMap[n.Cache.BINARY]=this._binary;this._cacheMap[n.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[n.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[n.Cache.JSON]=this._json;this._cacheMap[n.Cache.XML]=this._xml};n.Cache.CANVAS=1;n.Cache.IMAGE=2;n.Cache.TEXTURE=3;n.Cache.SOUND=4;n.Cache.TEXT=5;n.Cache.PHYSICS=6;n.Cache.TILEMAP=7;n.Cache.BINARY=8;n.Cache.BITMAPDATA=9;n.Cache.BITMAPFONT=10;n.Cache.JSON=11;n.Cache.XML=12;n.Cache.prototype={addCanvas:function(n,t,i){this._canvases[n]={canvas:t,context:i}},addBinary:function(n,t){this._binary[n]=t},addBitmapData:function(t,i,r){return i.key=t,typeof r=="undefined"&&(r=new n.FrameData,r.addFrame(i.textureFrame)),this._bitmapDatas[t]={data:i,frameData:r},i},addRenderTexture:function(t,i){var r=new n.Frame(0,0,0,i.width,i.height,"","");this._textures[t]={texture:i,frame:r}},addSpriteSheet:function(t,i,r,u,f,e,o,s){this._images[t]={url:i,data:r,frameWidth:u,frameHeight:f,margin:o,spacing:s};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);this._images[t].frameData=n.AnimationParser.spriteSheet(this.game,t,u,f,e,o,s);this._resolveURL(i,this._images[t])},addTilemap:function(n,t,i,r){this._tilemaps[n]={url:t,data:i,format:r};this._resolveURL(t,this._tilemaps[n])},addTextureAtlas:function(t,i,r,u,f){this._images[t]={url:i,data:r};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);f==n.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[t].frameData=n.AnimationParser.JSONData(this.game,u,t):f==n.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[t].frameData=n.AnimationParser.JSONDataHash(this.game,u,t):f==n.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[t].frameData=n.AnimationParser.XMLData(this.game,u,t));this._resolveURL(i,this._images[t])},addBitmapFont:function(t,i,r,u,f,e){this._images[t]={url:i,data:r};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);n.LoaderParser.bitmapFont(this.game,u,t,f,e);this._bitmapFont[t]=PIXI.BitmapText.fonts[t];this._resolveURL(i,this._bitmapFont[t])},addPhysicsData:function(n,t,i,r){this._physics[n]={url:t,data:i,format:r};this._resolveURL(t,this._physics[n])},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:t};this._images.__default.frame=new n.Frame(0,0,0,32,32,"","");this._images.__default.frameData=new n.FrameData;this._images.__default.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(t);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:t};this._images.__missing.frame=new n.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new n.FrameData;this._images.__missing.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(t);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(n,t,i){this._text[n]={url:t,data:i};this._resolveURL(t,this._text[n])},addJSON:function(n,t,i){this._json[n]={url:t,data:i};this._resolveURL(t,this._json[n])},addXML:function(n,t,i){this._xml[n]={url:t,data:i};this._resolveURL(t,this._xml[n])},addImage:function(t,i,r){this.checkImageKey(t)&&this.removeImage(t);this._images[t]={url:i,data:r};this._images[t].frame=new n.Frame(0,0,0,r.width,r.height,t,this.game.rnd.uuid());this._images[t].frameData=new n.FrameData;this._images[t].frameData.addFrame(new n.Frame(0,0,0,r.width,r.height,i,this.game.rnd.uuid()));PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);this._resolveURL(i,this._images[t])},addSound:function(n,t,i,r,u){r=r||!0;u=u||!1;var f=!1;u&&(f=!0);this._sounds[n]={url:t,data:i,isDecoding:!1,decoded:f,webAudio:r,audioTag:u,locked:this.game.sound.touchLocked};this._resolveURL(t,this._sounds[n])},reloadSound:function(n){var t=this;this._sounds[n]&&(this._sounds[n].data.src=this._sounds[n].url,this._sounds[n].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(n)},!1),this._sounds[n].data.load())},reloadSoundComplete:function(n){this._sounds[n]&&(this._sounds[n].locked=!1,this.onSoundUnlock.dispatch(n))},updateSound:function(n,t,i){this._sounds[n]&&(this._sounds[n][t]=i)},decodedSound:function(n,t){this._sounds[n].data=t;this._sounds[n].decoded=!0;this._sounds[n].isDecoding=!1},getCanvas:function(n){return this._canvases[n]?this._canvases[n].canvas:(console.warn('Phaser.Cache.getCanvas: Invalid key: "'+n+'"'),null)},getBitmapData:function(n){return this._bitmapDatas[n]?this._bitmapDatas[n].data:(console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+n+'"'),null)},getBitmapFont:function(n){return this._bitmapFont[n]?this._bitmapFont[n]:(console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+n+'"'),null)},getPhysicsData:function(n,t,i){var r,u;if(typeof t=="undefined"||t===null){if(this._physics[n])return this._physics[n].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+n+'"')}else if(this._physics[n]&&this._physics[n].data[t])if(r=this._physics[n].data[t],r&&i){for(u in r)if(u=r[u],u.fixtureKey===i)return u;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+n+'"')}else return r;else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+n+" / "+t+'"');return null},checkKey:function(n,t){return this._cacheMap[n][t]?!0:!1},checkCanvasKey:function(t){return this.checkKey(n.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(n.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(n.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(n.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(n.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(n.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(n.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(n.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(n.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(n.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(n.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(n.Cache.XML,t)},checkURL:function(n){return this._urlMap[this._resolveURL(n)]?!0:!1},getImage:function(n){return this._images[n]?this._images[n].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+n+'"'),null)},getTilemapData:function(n){return this._tilemaps[n]?this._tilemaps[n]:(console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+n+'"'),null)},getFrameData:function(t,i){return(typeof i=="undefined"&&(i=n.Cache.IMAGE),this._cacheMap[i][t])?this._cacheMap[i][t].frameData:null},updateFrameData:function(n,t){this._images[n]&&(this._images[n].frameData=t)},getFrameByIndex:function(n,t){return this._images[n]?this._images[n].frameData.getFrame(t):null},getFrameByName:function(n,t){return this._images[n]?this._images[n].frameData.getFrameByName(t):null},getFrame:function(n){return this._images[n]?this._images[n].frame:null},getTextureFrame:function(n){return this._textures[n]?this._textures[n].frame:null},getRenderTexture:function(n){return this._textures[n]?this._textures[n]:(console.warn('Phaser.Cache.getTexture: Invalid key: "'+n+'"'),null)},getTexture:function(n){if(this._textures[n])return this._textures[n];console.warn('Phaser.Cache.getTexture: Invalid key: "'+n+'"')},getSound:function(n){return this._sounds[n]?this._sounds[n]:(console.warn('Phaser.Cache.getSound: Invalid key: "'+n+'"'),null)},getSoundData:function(n){return this._sounds[n]?this._sounds[n].data:(console.warn('Phaser.Cache.getSoundData: Invalid key: "'+n+'"'),null)},isSoundDecoded:function(n){if(this._sounds[n])return this._sounds[n].decoded},isSoundReady:function(n){return this._sounds[n]&&this._sounds[n].decoded&&this.game.sound.touchLocked===!1},getFrameCount:function(n){return this._images[n]?this._images[n].frameData.total:0},getText:function(n){return this._text[n]?this._text[n].data:(console.warn('Phaser.Cache.getText: Invalid key: "'+n+'"'),null)},getJSON:function(n){return this._json[n]?this._json[n].data:(console.warn('Phaser.Cache.getJSON: Invalid key: "'+n+'"'),null)},getXML:function(n){return this._xml[n]?this._xml[n].data:(console.warn('Phaser.Cache.getXML: Invalid key: "'+n+'"'),null)},getBinary:function(n){return this._binary[n]?this._binary[n]:(console.warn('Phaser.Cache.getBinary: Invalid key: "'+n+'"'),null)},getURL:function(n){var n=this._resolveURL(n);return n?this._urlMap[n]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+n+'" or Cache.autoResolveURL was false'),null)},getUrl:function(n){return this.getURL(n)},getKeys:function(t){var i=null,u,r;switch(t){case n.Cache.CANVAS:i=this._canvases;break;case n.Cache.IMAGE:i=this._images;break;case n.Cache.TEXTURE:i=this._textures;break;case n.Cache.SOUND:i=this._sounds;break;case n.Cache.TEXT:i=this._text;break;case n.Cache.PHYSICS:i=this._physics;break;case n.Cache.TILEMAP:i=this._tilemaps;break;case n.Cache.BINARY:i=this._binary;break;case n.Cache.BITMAPDATA:i=this._bitmapDatas;break;case n.Cache.BITMAPFONT:i=this._bitmapFont;break;case n.Cache.JSON:i=this._json;break;case n.Cache.XML:i=this._xml}if(i){u=[];for(r in i)r!=="__default"&&r!=="__missing"&&u.push(r);return u}},removeCanvas:function(n){delete this._canvases[n]},removeImage:function(n,t){typeof t=="undefined"&&(t=!0);delete this._images[n];t&&PIXI.BaseTextureCache[n].destroy()},removeSound:function(n){delete this._sounds[n]},removeText:function(n){delete this._text[n]},removeJSON:function(n){delete this._json[n]},removeXML:function(n){delete this._xml[n]},removePhysics:function(n){delete this._physics[n]},removeTilemap:function(n){delete this._tilemaps[n]},removeBinary:function(n){delete this._binary[n]},removeBitmapData:function(n){delete this._bitmapDatas[n]},removeBitmapFont:function(n){delete this._bitmapFont[n]},_resolveURL:function(n,t){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+n,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",t&&(this._urlMap[this._urlTemp]=t),this._urlTemp):null},destroy:function(){var i,t;for(var n in this._images)n!=="__default"&&n!=="__missing"&&delete this._images[n];for(i=[this._canvases,this._sounds,this._text,this._json,this._xml,this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont],t=0;t<i.length;t++)for(n in i[t])delete i[t][n];this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};n.Cache.prototype.constructor=n.Cache;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Loader=function(t){this.game=t;this.resetLocked=!1;this.isLoading=!1;this.hasLoaded=!1;this.preloadSprite=null;this.crossOrigin=!1;this.baseURL="";this.onLoadStart=new n.Signal;this.onLoadComplete=new n.Signal;this.onPackComplete=new n.Signal;this.onFileStart=new n.Signal;this.onFileComplete=new n.Signal;this.onFileError=new n.Signal;this.useXDomainRequest=!1;this._warnedAboutXDomainRequest=!1;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;n.Loader.TEXTURE_ATLAS_JSON_HASH=1;n.Loader.TEXTURE_ATLAS_XML_STARLING=2;n.Loader.PHYSICS_LIME_CORONA_JSON=3;n.Loader.PHYSICS_PHASER_JSON=4;n.Loader.prototype={setPreloadSprite:function(t,i){i=i||0;this.preloadSprite={sprite:t,direction:i,width:t.width,height:t.height,rect:null};this.preloadSprite.rect=i===0?new n.Rectangle(0,0,1,t.height):new n.Rectangle(0,0,t.width,1);t.crop(this.preloadSprite.rect);t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(n,t){return this.getAssetIndex(n,t)>-1},getAssetIndex:function(n,t){for(var i,u=-1,r=0;r<this._fileList.length;r++)if(i=this._fileList[r],i.type===n&&i.key===t&&(u=r,!i.loaded&&!i.loading))break;return u},getAsset:function(n,t){var i=this.getAssetIndex(n,t);return i>-1?{index:i,file:this._fileList[i]}:!1},reset:function(n,t){(typeof t=="undefined"&&(t=!1),this.resetLocked)||(n&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,t&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(n,t,i,r,u){var e={type:n,key:t,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1},o,f,s;if(r)for(o in r)e[o]=r[o];f=this.getAssetIndex(n,t);u&&f>-1?(s=this._fileList[f],s.loading||s.loaded?(this._fileList.push(e),this._totalFileCount++):this._fileList[f]=e):f===-1&&(this._fileList.push(e),this._totalFileCount++)},replaceInFileList:function(n,t,i,r){return this.addToFileList(n,t,i,r,!0)},pack:function(n,t,i,r){var e,u,f;if(typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),!t&&!i)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;for(e={type:"packfile",key:n,url:t,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:r},i&&(typeof i=="string"&&(i=JSON.parse(i)),e.data=i||{},e.loaded=!0),u=0;u<this._fileList.length+1;u++)if(f=this._fileList[u],!f||!f.loaded&&!f.loading&&f.type!=="packfile"){this._fileList.splice(u,1,e);this._totalPackCount++;break}return this},image:function(n,t,i){return typeof i=="undefined"&&(i=!1),this.addToFileList("image",n,t,undefined,i),this},text:function(n,t,i){return typeof i=="undefined"&&(i=!1),this.addToFileList("text",n,t,undefined,i),this},json:function(n,t,i){return typeof i=="undefined"&&(i=!1),this.addToFileList("json",n,t,undefined,i),this},xml:function(n,t,i){return typeof i=="undefined"&&(i=!1),this.addToFileList("xml",n,t,undefined,i),this},script:function(n,t,i,r){return typeof i=="undefined"&&(i=!1),i!==!1&&typeof r=="undefined"&&(r=i),this.addToFileList("script",n,t,{syncPoint:!0,callback:i,callbackContext:r}),this},binary:function(n,t,i,r){return typeof i=="undefined"&&(i=!1),i!==!1&&typeof r=="undefined"&&(r=i),this.addToFileList("binary",n,t,{callback:i,callbackContext:r}),this},spritesheet:function(n,t,i,r,u,f,e){return typeof u=="undefined"&&(u=-1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),this.addToFileList("spritesheet",n,t,{frameWidth:i,frameHeight:r,frameMax:u,margin:f,spacing:e}),this},audio:function(n,t,i){return typeof i=="undefined"&&(i=!0),typeof t=="string"&&(t=[t]),this.addToFileList("audio",n,t,{buffer:null,autoDecode:i}),this},audiosprite:function(n,t,i,r,u){return typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=!0),this.audio(n,t,u),i?this.json(n+"-audioatlas",i):r?(typeof r=="string"&&(r=JSON.parse(r)),this.game.cache.addJSON(n+"-audioatlas","",r)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this},tilemap:function(t,i,r,u){if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=n.Tilemap.CSV),!i&&!r)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(r){switch(u){case n.Tilemap.TILED_JSON:typeof r=="string"&&(r=JSON.parse(r))}this.game.cache.addTilemap(t,null,r,u)}else this.addToFileList("tilemap",t,i,{format:u});return this},physics:function(t,i,r,u){return(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=n.Physics.LIME_CORONA_JSON),!i&&!r)?(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this):(r?(typeof r=="string"&&(r=JSON.parse(r)),this.game.cache.addPhysicsData(t,null,r,u)):this.addToFileList("physics",t,i,{format:u}),this)},bitmapFont:function(n,t,i,r,u,f){if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=0),typeof f=="undefined"&&(f=0),i)this.addToFileList("bitmapfont",n,t,{xmlURL:i,xSpacing:u,ySpacing:f});else if(typeof r=="string"){var e=this.parseXml(r);if(!e)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",n,t,{xmlURL:null,xmlData:e,xSpacing:u,ySpacing:f})}return this},atlasJSONArray:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,i,r,u,f){if(typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=null),typeof f=="undefined"&&(f=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),r)this.addToFileList("textureatlas",t,i,{atlasURL:r,format:f});else{switch(f){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof u=="string"&&(u=JSON.parse(u));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof u=="string"){var e=this.parseXml(u);if(!e)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");u=e}}this.addToFileList("textureatlas",t,i,{atlasURL:null,atlasData:u,format:f})}return this},withSyncPoint:function(n,t){this._withSyncPointDepth++;try{n.call(t||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(n,t){var i=this.getAsset(n,t);return i&&(i.file.syncPoint=!0),this},removeFile:function(n,t){var i=this.getAsset(n,t);i&&(i.loaded||i.loading||this._fileList.splice(i.index,1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){var r,u,i,t,f;if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(!0);return}for(i=0;i<this._flightQueue.length;i++)t=this._flightQueue[i],(t.loaded||t.error)&&(this._flightQueue.splice(i,1),i--,t.loading=!1,t.requestUrl=null,t.requestObject=null,t.error&&this.onFileError.dispatch(t.key,t),t.type!=="packfile"?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,t.key,!t.error,this._loadedFileCount,this._totalFileCount)):t.type==="packfile"&&t.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(t.key,!t.error,this._loadedPackCount,this._totalPackCount)));for(r=!1,u=this.enableParallel?n.Math.clamp(this.maxParallelDownloads,1,12):1,i=this._processingHead;i<this._fileList.length;i++)if(t=this._fileList[i],t.type==="packfile"&&!t.error&&t.loaded&&i===this._processingHead&&(this.processPack(t),this._loadedPackCount++,this.onPackComplete.dispatch(t.key,!t.error,this._loadedPackCount,this._totalPackCount)),t.loaded||t.error?i===this._processingHead&&(this._processingHead=i+1):!t.loading&&this._flightQueue.length<u&&(t.type!=="packfile"||t.data?r||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(t),t.loading=!0,this.onFileStart.dispatch(this.progress,t.key,t.url),this.loadFile(t)):(this._flightQueue.push(t),t.loading=!0,this.loadFile(t))),!t.loaded&&t.syncPoint&&(r=!0),this._flightQueue.length>=u||r&&this._loadedPackCount===this._totalPackCount)break;this.updateProgress();this._processingHead>=this._fileList.length?this.finishedLoading():this._flightQueue.length||(console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled"),f=this,setTimeout(function(){f.finishedLoading(!0)},2e3))},finishedLoading:function(n){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,n||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.reset(),this.game.state.loadComplete())},asyncComplete:function(n,t){typeof t=="undefined"&&(t="");n.loaded=!0;n.error=!!t;t&&(n.errorMessage=t,console.warn("Phaser.Loader - "+n.type+"["+n.key+"]: "+t));this.processLoadQueue()},processPack:function(t){var u=t.data[t.key],r,i;if(!u){console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key");return}for(r=0;r<u.length;r++){i=u[r];switch(i.type){case"image":this.image(i.key,i.url,i.overwrite);break;case"text":this.text(i.key,i.url,i.overwrite);break;case"json":this.json(i.key,i.url,i.overwrite);break;case"xml":this.xml(i.key,i.url,i.overwrite);break;case"script":this.script(i.key,i.url,i.callback,t.callbackContext||this);break;case"binary":this.binary(i.key,i.url,i.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(i.key,i.url,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"audio":this.audio(i.key,i.urls,i.autoDecode);break;case"audiosprite":this.audio(i.key,i.urls,i.jsonURL);break;case"tilemap":this.tilemap(i.key,i.url,i.data,n.Tilemap[i.format]);break;case"physics":this.physics(i.key,i.url,i.data,n.Loader[i.format]);break;case"bitmapFont":this.bitmapFont(i.key,i.textureURL,i.xmlURL,i.xmlData,i.xSpacing,i.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasXML":this.atlasXML(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlas":this.atlas(i.key,i.textureURL,i.atlasURL,i.atlasData,n.Loader[i.format])}}},transformUrl:function(n){return this.baseURL+n},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url);t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"no supported audio URL specified");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===n.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===n.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(n){var t=this;n.data=new Image;n.data.name=n.key;this.crossOrigin&&(n.data.crossOrigin=this.crossOrigin);n.data.onload=function(){n.data.onload&&(n.data.onload=null,n.data.onerror=null,t.fileComplete(n))};n.data.onerror=function(){n.data.onload&&(n.data.onload=null,n.data.onerror=null,t.fileError(n))};n.data.src=this.transformUrl(n.url,n);n.data.complete&&n.data.width&&n.data.height&&(n.data.onload=null,n.data.onerror=null,this.fileComplete(n))},loadAudioTag:function(t){var r=this,i;this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t)):(t.data=new Audio,t.data.name=t.key,i=function(){t.data.removeEventListener("canplaythrough",i,!1);t.data.onerror=null;n.GAMES[r.game.id].load.fileComplete(t)},t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1);t.data.onerror=null;r.fileError(t)},t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.load())},xhrLoad:function(n,t,i,r,u){var f,e;if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(n,t,i,r,u);return}f=new XMLHttpRequest;f.open("GET",t,!0);f.responseType=i;u=u||this.fileError;e=this;f.onload=function(){try{return r.call(e,n,f)}catch(t){e.hasLoaded?window.console&&console.error(t):e.asyncComplete(n,t.message||"Exception")}};f.onerror=function(){try{return u.call(e,n,f)}catch(t){e.hasLoaded?window.console&&console.error(t):e.asyncComplete(n,t.message||"Exception")}};n.requestObject=f;n.requestUrl=t;f.send()},xhrLoadWithXDR:function(n,t,i,r,u){var f,e;!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)&&(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));f=new window.XDomainRequest;f.open("GET",t,!0);f.responseType=i;f.timeout=3e3;u=u||this.fileError;e=this;f.onerror=function(){try{return u.call(e,n,f)}catch(t){e.asyncComplete(n,t.message||"Exception")}};f.ontimeout=function(){try{return u.call(e,n,f)}catch(t){e.asyncComplete(n,t.message||"Exception")}};f.onprogress=function(){};f.onload=function(){try{return r.call(e,n,f)}catch(t){e.asyncComplete(n,t.message||"Exception")}};n.requestObject=f;n.requestUrl=t;setTimeout(function(){f.send()},0)},getAudioURL:function(n){for(var t,r,u,i=0;i<n.length;i++){if(t=n[i],t.uri)t=t.uri,r=t.type;else{if(t.indexOf("blob:")===0||t.indexOf("data:")===0)return t;t.indexOf("?")>=0&&(t=t.substr(0,t.indexOf("?")));u=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1);r=u.toLowerCase()}if(this.game.device.canPlayAudio(r))return n[i]}return null},fileError:function(n,t,i){var u=n.requestUrl||this.transformUrl(n.url,n),r="error loading asset from URL "+u;!i&&t&&(i=t.status);i&&(r=r+" ("+i+")");this.asyncComplete(n,r)},fileComplete:function(t,i){var u=!0,r;switch(t.type){case"packfile":r=JSON.parse(i.responseText);t.data=r||{};break;case"image":this.game.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.game.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(t.atlasURL==null)this.game.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(u=!1,t.format==n.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==n.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else if(t.format==n.Loader.TEXTURE_ATLAS_XML_STARLING)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete);else throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);break;case"bitmapfont":t.xmlURL?(u=!1,this.xhrLoad(t,this.transformUrl(t.xmlURL,t),"text",this.xmlLoadComplete)):this.game.cache.addBitmapFont(t.key,t.url,t.data,t.xmlData,t.xSpacing,t.ySpacing);break;case"audio":this.game.sound.usingWebAudio?(t.data=i.response,this.game.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.game.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=i.responseText;this.game.cache.addText(t.key,t.url,t.data);break;case"physics":r=JSON.parse(i.responseText);this.game.cache.addPhysicsData(t.key,t.url,r,t.format);break;case"script":t.data=document.createElement("script");t.data.language="javascript";t.data.type="text/javascript";t.data.defer=!1;t.data.text=i.responseText;document.head.appendChild(t.data);t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,i.responseText));break;case"binary":t.data=t.callback?t.callback.call(t.callbackContext,t.key,i.response):i.response;this.game.cache.addBinary(t.key,t.data)}u&&this.asyncComplete(t)},jsonLoadComplete:function(n,t){var i=JSON.parse(t.responseText);n.type==="tilemap"?this.game.cache.addTilemap(n.key,n.url,i,n.format):n.type==="json"?this.game.cache.addJSON(n.key,n.url,i):this.game.cache.addTextureAtlas(n.key,n.url,n.data,i,n.format);this.asyncComplete(n)},csvLoadComplete:function(n,t){var i=t.responseText;this.game.cache.addTilemap(n.key,n.url,i,n.format);this.asyncComplete(n)},xmlLoadComplete:function(n,t){var u=t.responseText,i=this.parseXml(u),r;if(!i){r=t.responseType||t.contentType;console.warn("Phaser.Loader - "+n.key+": invalid XML ("+r+")");this.asyncComplete(n,"invalid XML");return}n.type==="bitmapfont"?this.game.cache.addBitmapFont(n.key,n.url,n.data,i,n.xSpacing,n.ySpacing):n.type==="textureatlas"?this.game.cache.addTextureAtlas(n.key,n.url,n.data,i,n.format):n.type==="xml"&&this.game.cache.addXML(n.key,n.url,i);this.asyncComplete(n)},parseXml:function(n){var t,i;try{window.DOMParser?(i=new DOMParser,t=i.parseFromString(n,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n))}catch(r){t=null}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length?t:null},updateProgress:function(){this.preloadSprite&&(this.preloadSprite.direction===0?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(n.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return n.Math.clamp(t||0,0,100)}});Object.defineProperty(n.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});n.Loader.prototype.constructor=n.Loader;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LoaderParser={bitmapFont:function(n,t,i,r,u){var o={},h=t.getElementsByTagName("info")[0],a=t.getElementsByTagName("common")[0],e,f,c,l,s;for(o.font=h.getAttribute("face"),o.size=parseInt(h.getAttribute("size"),10),o.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+u,o.chars={},e=t.getElementsByTagName("char"),f=0;f<e.length;f++)c=parseInt(e[f].getAttribute("id"),10),l=new PIXI.Rectangle(parseInt(e[f].getAttribute("x"),10),parseInt(e[f].getAttribute("y"),10),parseInt(e[f].getAttribute("width"),10),parseInt(e[f].getAttribute("height"),10)),o.chars[c]={xOffset:parseInt(e[f].getAttribute("xoffset"),10),yOffset:parseInt(e[f].getAttribute("yoffset"),10),xAdvance:parseInt(e[f].getAttribute("xadvance"),10)+r,kerning:{},texture:PIXI.TextureCache[i]=new PIXI.Texture(PIXI.BaseTextureCache[i],l)};for(s=t.getElementsByTagName("kerning"),f=0;f<s.length;f++){var v=parseInt(s[f].getAttribute("first"),10),y=parseInt(s[f].getAttribute("second"),10),p=parseInt(s[f].getAttribute("amount"),10);o.chars[y].kerning[v]=p}PIXI.BitmapText.fonts[i]=o}};
/**
 * @author       Jeremy Dowell <jeremy@codevinsky.com>
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
n.AudioSprite=function(n,t){var r,i,u;this.game=n;this.key=t;this.config=this.game.cache.getJSON(t+"-audioatlas");this.autoplayKey=null;this.autoplay=!1;this.sounds={};for(r in this.config.spritemap)i=this.config.spritemap[r],u=this.game.add.sound(this.key),u.addMarker(r,i.start,i.end-i.start,null,i.loop),this.sounds[r]=u;this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])};n.AudioSprite.prototype={play:function(n,t){return typeof t=="undefined"&&(t=1),this.sounds[n].play(n,null,t)},stop:function(n){if(n)this.sounds[n].stop();else for(var t in this.sounds)this.sounds[t].stop()},get:function(n){return this.sounds[n]}};n.AudioSprite.prototype.constructor=n.AudioSprite;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sound=function(t,i,r,u,f){typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=t.sound.connectToMaster);this.game=t;this.name=i;this.key=i;this.loop=u;this.volume=r;this.markers={};this.context=null;this.autoplay=!1;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=!1;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=!1;this.override=!1;this.allowMultiple=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,f&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(i)&&this.game.cache.isSoundReady(i)?(this._sound=this.game.cache.getSoundData(i),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this));this.onDecoded=new n.Signal;this.onPlay=new n.Signal;this.onPause=new n.Signal;this.onResume=new n.Signal;this.onLoop=new n.Signal;this.onStop=new n.Signal;this.onMute=new n.Signal;this.onMarkerComplete=new n.Signal;this.onFadeComplete=new n.Signal;this._volume=r;this._buffer=null;this._muted=!1;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._muteVolume=0;this._tempLoop=0;this._paused=!1;this._onDecodedEventDispatched=!1};n.Sound.prototype={soundHasUnlocked:function(n){n===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(n,t,i,r,u){typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=!1);this.markers[n]={name:n,start:t,stop:t+i,volume:r,duration:i,durationMS:i*1e3,loop:u}},removeMarker:function(n){delete this.markers[n]},onEndedHandler:function(){this.isPlaying=!1;this.stop()},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0);this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.currentMarker===""?(this.currentTime=0,this.startTime=this.game.time.time):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.currentMarker!==""&&this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},loopFull:function(n){this.play(null,0,n,!0)},play:function(n,t,i,r,u){if((typeof n=="undefined"||n===!1||n===null)&&(n=""),typeof u=="undefined"&&(u=!0),this.isPlaying&&!this.allowMultiple&&!u&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||u))if(this.usingWebAudio)if(typeof this._sound.stop=="undefined")this._sound.noteOff(0);else try{this._sound.stop(0)}catch(f){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(n===""&&Object.keys(this.markers).length>0)return this;if(n!=="")if(this.currentMarker=n,this.markers[n])this.position=this.markers[n].start,this.volume=this.markers[n].volume,this.loop=this.markers[n].loop,this.duration=this.markers[n].duration,this.durationMS=this.markers[n].durationMS,typeof i!="undefined"&&(this.volume=i),typeof r!="undefined"&&(this.loop=r),this._tempMarker=n,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else return this;else t=t||0,typeof i=="undefined"&&(i=this._volume),typeof r=="undefined"&&(r=this.loop),this.position=t,this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=n,this._tempPosition=t,this._tempVolume=i,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._buffer===null&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&n===""&&(this._sound.loop=!0),this.loop||n!==""||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(this.totalDuration*1e3)),typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&n===""?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)?(this._sound.play(),this.totalDuration=this._sound.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(n,t,i,r){n=n||"";t=t||0;i=i||1;typeof r=="undefined"&&(r=!1);this.play(n,t,i,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this.onPause.dispatch(this),this.stop())},resume:function(){var n,t;this.paused&&this._sound&&(this.usingWebAudio?(n=this.position+this.pausedPosition/1e3,this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||this.currentMarker!==""||(this._sound.onended=this.onEndedHandler.bind(this)),t=this.duration-this.pausedPosition/1e3,typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,n,t):this._sound.start(0,n,t)):this._sound.play(),this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this))},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if(typeof this._sound.stop=="undefined")this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.pendingPlayback=!1;this.isPlaying=!1;var n=this.currentMarker;this.currentMarker!==""&&this.onMarkerComplete.dispatch(this.currentMarker,this);this.currentMarker="";this.fadeTween!==null&&this.fadeTween.stop();this.paused||this.onStop.dispatch(this,n)},fadeIn:function(n,t,i){(typeof t=="undefined"&&(t=!1),typeof i=="undefined"&&(i=this.currentMarker),this.paused)||(this.play(i,0,0,t),this.fadeTo(n,1))},fadeOut:function(n){this.fadeTo(n,0)},fadeTo:function(t,i){if(this.isPlaying&&!this.paused&&i!==this.volume){if(typeof t=="undefined"&&(t=1e3),typeof i=="undefined"){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:i},t,n.Easing.Linear.None,!0);this.fadeTween.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);this.volume===0&&this.stop()},destroy:function(n){typeof n=="undefined"&&(n=!0);this.stop();n?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}};n.Sound.prototype.constructor=n.Sound;Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(n){n=n||null;n?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume));this.onMute.dispatch(this)}});Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(n){this.usingWebAudio?(this._volume=n,this.gainNode.gain.value=n):this.usingAudioTag&&this._sound&&n>=0&&n<=1&&(this._volume=n,this._sound.volume=n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SoundManager=function(t){this.game=t;this.onSoundDecode=new n.Signal;this._codeMuted=!1;this._muted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new n.ArraySet;this._watching=!1;this._watchCallback=null;this._watchContext=null;this.context=null;this.usingWebAudio=!0;this.usingAudioTag=!1;this.noAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32};n.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0){this.usingWebAudio=!1;this.noAudio=!0;return}if(window.PhaserGlobal.disableWebAudio===!0){this.usingWebAudio=!1;this.usingAudioTag=!0;this.noAudio=!1;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(!window.AudioContext){if(!!window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(n){this.context=null;this.usingWebAudio=!1;this.noAudio=!0}}else try{this.context=new window.AudioContext}catch(n){this.context=null;this.usingWebAudio=!1;this.noAudio=!0}!window.Audio||this.context!==null||(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1);this.context!==null&&(this.masterGain=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var n=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=n;this._unlockSource.connect(this.context.destination);typeof this._unlockSource.start=="undefined"?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},stopAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].stop()},pauseAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].pause()},resumeAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].resume()},decode:function(n,t){var i,r;t=t||null;i=this.game.cache.getSoundData(n);i&&this.game.cache.isSoundDecoded(n)===!1&&(this.game.cache.updateSound(n,"isDecoding",!0),r=this,this.context.decodeAudioData(i,function(i){i&&(r.game.cache.decodedSound(n,i),r.onSoundDecode.dispatch(n,t))}))},setDecodedCallback:function(t,i,r){typeof t=="string"&&(t=[t]);this._watchList.reset();for(var u=0;u<t.length;u++)t[u]instanceof n.Sound?this.game.cache.isSoundDecoded(t[u].key)||this._watchList.add(t[u].key):this.game.cache.isSoundDecoded(t[u])||this._watchList.add(t[u]);this._watchList.total===0?(this._watching=!1,i.call(r)):(this._watching=!0,this._watchCallback=i,this._watchContext=r)},update:function(){var t,n;for(this.touchLocked&&this.game.device.webAudio&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null),t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(n=this._watchList.first;n;)this.game.cache.isSoundDecoded(n)&&this._watchList.remove(n),n=this._watchList.next;this._watchList.total===0&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},add:function(t,i,r,u){typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=this.connectToMaster);var f=new n.Sound(this.game,t,i,r,u);return this._sounds.push(f),f},addSprite:function(t){return new n.AudioSprite(this.game,t)},remove:function(n){for(var t=this._sounds.length;t--;)if(this._sounds[t]===n)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeByKey:function(n){for(var t=this._sounds.length,i=0;t--;)this._sounds[t].key===n&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),i++);return i},play:function(n,t,i){var r=this.add(n,t,i);return r.play(),r},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!1)}},destroy:function(){this.stopAll();for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].destroy();this._sounds=[];this.onSoundDecode.dispose();this.context&&window.PhaserGlobal&&(window.PhaserGlobal.audioContext=this.context)}};n.SoundManager.prototype.constructor=n.SoundManager;Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(n){if(n=n||null,n){if(this._muted)return;this._codeMuted=!0;this.setMute()}else{if(!this._muted)return;this._codeMuted=!1;this.unsetMute()}}});Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(n){if(this._volume=n,this.usingWebAudio)this.masterGain.gain.value=n;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils.Debug=function(n){this.game=n;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=!0;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=!1};n.Utils.Debug.prototype={boot:function(){this.game.renderType===n.CANVAS?this.context=this.game.context:(this.bmd=this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=n.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height);this.sprite&&this.bmd.clear()},start:function(n,t,i,r){typeof n!="number"&&(n=0);typeof t!="number"&&(t=0);i=i||"rgb(255,255,255)";typeof r=="undefined"&&(r=0);this.currentX=n;this.currentY=t;this.currentColor=i;this.currentAlpha=this.context.globalAlpha;this.columnWidth=r;this.dirty=!0;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(){for(var t=this.currentX,n=0;n<arguments.length;n++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[n],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[n],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sound: "+n.key+" Locked: "+n.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(n.key)+" Pending Playback: "+n.pendingPlayback);this.line("Decoded: "+n.isDecoded+" Decoding: "+n.isDecoding);this.line("Total Duration: "+n.totalDuration+" Playing: "+n.isPlaying);this.line("Time: "+n.currentTime);this.line("Volume: "+n.volume+" Muted: "+n.mute);this.line("WebAudio: "+n.usingWebAudio+" Audio: "+n.usingAudioTag);n.currentMarker!==""&&(this.line("Marker: "+n.currentMarker+" Duration: "+n.duration+" (ms: "+n.durationMS+")"),this.line("Start: "+n.markers[n.currentMarker].start+" Stop: "+n.markers[n.currentMarker].stop),this.line("Position: "+n.position));this.stop()},cameraInfo:function(n,t,i,r){this.start(t,i,r);this.line("Camera ("+n.width+" x "+n.height+")");this.line("X: "+n.x+" Y: "+n.y);n.bounds&&this.line("Bounds x: "+n.bounds.x+" Y: "+n.bounds.y+" w: "+n.bounds.width+" h: "+n.bounds.height);this.line("View x: "+n.view.x+" Y: "+n.view.y+" w: "+n.view.width+" h: "+n.view.height);this.line("Total in view: "+n.totalInView);this.stop()},timer:function(n,t,i,r){this.start(t,i,r);this.line("Timer (running: "+n.running+" expired: "+n.expired+")");this.line("Next Tick: "+n.next+" Duration: "+n.duration);this.line("Paused: "+n.paused+" Length: "+n.length);this.stop()},pointer:function(n,t,i,r,u){n!=null&&(typeof t=="undefined"&&(t=!1),i=i||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",t!==!0||n.isUp!==!0)&&(this.start(n.x,n.y-100,u),this.context.beginPath(),this.context.arc(n.x,n.y,n.circle.radius,0,Math.PI*2),this.context.fillStyle=n.active?i:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(n.positionDown.x,n.positionDown.y),this.context.lineTo(n.position.x,n.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+n.id+" Active: "+n.active),this.line("World X: "+n.worldX+" World Y: "+n.worldY),this.line("Screen X: "+n.x+" Screen Y: "+n.y),this.line("Duration: "+n.duration+" ms"),this.line("is Down: "+n.isDown+" is Up: "+n.isUp),this.stop())},spriteInputInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite Input: ("+n.width+" x "+n.height+")");this.line("x: "+n.input.pointerX().toFixed(1)+" y: "+n.input.pointerY().toFixed(1));this.line("over: "+n.input.pointerOver()+" duration: "+n.input.overDuration().toFixed(0));this.line("down: "+n.input.pointerDown()+" duration: "+n.input.downDuration().toFixed(0));this.line("just over: "+n.input.justOver()+" just out: "+n.input.justOut());this.stop()},key:function(n,t,i,r){this.start(t,i,r,150);this.line("Key:",n.keyCode,"isDown:",n.isDown);this.line("justDown:",n.justDown,"justUp:",n.justUp);this.line("Time Down:",n.timeDown.toFixed(0),"duration:",n.duration.toFixed(0));this.stop()},inputInfo:function(n,t,i){this.start(n,t,i);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(n,t,i){var r=n.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,t,i)},ropeSegments:function(n,t,i){var r=n.segments;r.forEach(function(n){this.rectangle(n,t,i)},this)},spriteInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite:  ("+n.width+" x "+n.height+") anchor: "+n.anchor.x+" x "+n.anchor.y);this.line("x: "+n.x.toFixed(1)+" y: "+n.y.toFixed(1));this.line("angle: "+n.angle.toFixed(1)+" rotation: "+n.rotation.toFixed(1));this.line("visible: "+n.visible+" in camera: "+n.inCamera);this.line("bounds x: "+n._bounds.x.toFixed(1)+" y: "+n._bounds.y.toFixed(1)+" w: "+n._bounds.width.toFixed(1)+" h: "+n._bounds.height.toFixed(1));this.stop()},spriteCoords:function(n,t,i,r){this.start(t,i,r,100);n.name&&this.line(n.name);this.line("x:",n.x.toFixed(2),"y:",n.y.toFixed(2));this.line("pos x:",n.position.x.toFixed(2),"pos y:",n.position.y.toFixed(2));this.line("world x:",n.world.x.toFixed(2),"world y:",n.world.y.toFixed(2));this.stop()},lineInfo:function(n,t,i,r){this.start(t,i,r,80);this.line("start.x:",n.start.x.toFixed(2),"start.y:",n.start.y.toFixed(2));this.line("end.x:",n.end.x.toFixed(2),"end.y:",n.end.y.toFixed(2));this.line("length:",n.length.toFixed(2),"angle:",n.angle);this.stop()},pixel:function(n,t,i,r){r=r||2;this.start();this.context.fillStyle=i;this.context.fillRect(n,t,r,r);this.stop()},geom:function(t,i,r,u){typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=0);i=i||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=i;this.context.strokeStyle=i;t instanceof n.Rectangle||u===1?r?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof n.Circle||u===2?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,!1),this.context.closePath(),r?this.context.fill():this.context.stroke()):t instanceof n.Point||u===3?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof n.Line||u===4)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke());this.stop()},rectangle:function(n,t,i){typeof i=="undefined"&&(i=!0);t=t||"rgba(0, 255, 0, 0.4)";this.start();i?(this.context.fillStyle=t,this.context.fillRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height)):(this.context.strokeStyle=t,this.context.strokeRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height));this.stop()},text:function(n,t,i,r,u){r=r||"rgb(255,255,255)";u=u||"16px Courier";this.start();this.context.font=u;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(n,t+1,i+1));this.context.fillStyle=r;this.context.fillText(n,t,i);this.stop()},quadTree:function(n,t){var r,i;if(t=t||"rgba(255,0,0,0.3)",this.start(),r=n.bounds,n.nodes.length===0)for(this.context.strokeStyle=t,this.context.strokeRect(r.x,r.y,r.width,r.height),this.text("size: "+n.objects.length,r.x+4,r.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",i=0;i<n.objects.length;i++)this.context.strokeRect(n.objects[i].x,n.objects[i].y,n.objects[i].width,n.objects[i].height);else for(i=0;i<n.nodes.length;i++)this.quadTree(n.nodes[i]);this.stop()},body:function(t,i,r){t.body&&(this.start(),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.render(this.context,t.body,i,r):t.body.type===n.Physics.NINJA?n.Physics.Ninja.Body.render(this.context,t.body,i,r):t.body.type===n.Physics.BOX2D&&n.Physics.Box2D.renderBody(this.context,t.body,i),this.stop())},bodyInfo:function(t,i,r,u){t.body&&(this.start(i,r,u,210),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===n.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(t,i){this.start();n.Physics.Box2D.renderBody(this.context,t,i);this.stop()}};n.Utils.Debug.prototype.constructor=n.Utils.Debug;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ArraySet=function(n){this.position=0;this.list=n||[]};n.ArraySet.prototype={add:function(n){return this.exists(n)||this.list.push(n),n},getIndex:function(n){return this.list.indexOf(n)},getByKey:function(n,t){for(var i=this.list.length;i--;)if(this.list[i][n]===t)return this.list[i];return null},exists:function(n){return this.list.indexOf(n)>-1},reset:function(){this.list.length=0},remove:function(n){var t=this.list.indexOf(n);if(t>-1)return this.list.splice(t,1),n},setAll:function(n,t){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][n]=t)},callAll:function(n){for(var i=Array.prototype.splice.call(arguments,1),t=this.list.length;t--;)this.list[t]&&this.list[t][n]&&this.list[t][n].apply(this.list[t],i)},removeAll:function(n){var t,i;for(typeof n=="undefined"&&(n=!1),t=this.list.length;t--;)this.list[t]&&(i=this.remove(this.list[t]),n&&i.destroy());this.position=0;this.list=[]}};Object.defineProperty(n.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(n.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}});Object.defineProperty(n.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}});n.ArraySet.prototype.constructor=n.ArraySet;n.ArrayList=n.ArraySet;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ArrayUtils={getRandomItem:function(n,t,i){if(n==null)return null;typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=n.length);var r=t+Math.floor(Math.random()*i);return n[r]===undefined?null:n[r]},removeRandomItem:function(n,t,i){var r,u;return n==null?null:(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=n.length),r=t+Math.floor(Math.random()*i),r<n.length?(u=n.splice(r,1),u[0]===undefined?null:u[0]):null)},shuffle:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},transposeMatrix:function(n){for(var i,u=n.length,f=n[0].length,r=new Array(f),t=0;t<f;t++)for(r[t]=new Array(u),i=u-1;i>-1;i--)r[t][i]=n[i][t];return r},rotateMatrix:function(t,i){if(typeof i!="string"&&(i=(i%360+360)%360),i===90||i===-270||i==="rotateLeft")t=n.ArrayUtils.transposeMatrix(t),t=t.reverse();else if(i===-90||i===270||i==="rotateRight")t=t.reverse(),t=n.ArrayUtils.transposeMatrix(t);else if(Math.abs(i)===180||i==="rotate180"){for(var r=0;r<t.length;r++)t[r].reverse();t=t.reverse()}return t},findClosest:function(n,t){var i,r,u;if(t.length){if(t.length===1||n<t[0])return t[0]}else return NaN;for(i=1;t[i]<n;)i++;return r=t[i-1],u=i<t.length?t[i]:Number.POSITIVE_INFINITY,u-n<=n-r?u:r},rotate:function(n){var t=n.shift();return n.push(t),t},numberArray:function(n,t){for(var r=[],i=n;i<=t;i++)r.push(i);return r},numberArrayStep:function(t,i,r){var u;t=+t||0;u=typeof i;(u==="number"||u==="string")&&r&&r[i]===t&&(i=r=null);r=r==null?1:+r||0;i===null?(i=t,t=0):i=+i||0;for(var f=-1,e=Math.max(n.Math.roundAwayFromZero((i-t)/(r||1)),0),o=new Array(e);++f<e;)o[f]=t,t+=r;return o}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Color={packPixel:function(t,i,r,u){return n.Device.LITTLE_ENDIAN?(u<<24|r<<16|i<<8|t)>>>0:(t<<24|i<<16|r<<8|u)>>>0},unpackPixel:function(t,i,r,u){return(typeof i=="undefined"||i===null)&&(i=n.Color.createColor()),(typeof r=="undefined"||r===null)&&(r=!1),(typeof u=="undefined"||u===null)&&(u=!1),n.Device.LITTLE_ENDIAN?(i.a=(t&4278190080)>>>24,i.b=(t&16711680)>>>16,i.g=(t&65280)>>>8,i.r=t&255):(i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255),i.color=t,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a/255+")",r&&n.Color.RGBtoHSL(i.r,i.g,i.b,i),u&&n.Color.RGBtoHSV(i.r,i.g,i.b,i),i},fromRGBA:function(t,i){return i||(i=n.Color.createColor()),i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",i},toRGBA:function(n,t,i,r){return n<<24|t<<16|i<<8|r},RGBtoHSL:function(t,i,r,u){var e,f,o;return u||(u=n.Color.createColor(t,i,r,1)),t/=255,i/=255,r/=255,e=Math.min(t,i,r),f=Math.max(t,i,r),u.h=0,u.s=0,u.l=(f+e)/2,f!==e&&(o=f-e,u.s=u.l>.5?o/(2-f-e):o/(f+e),f===t?u.h=(i-r)/o+(i<r?6:0):f===i?u.h=(r-t)/o+2:f===r&&(u.h=(t-i)/o+4),u.h/=6),u},HSLtoRGB:function(t,i,r,u){if(u?(u.r=r,u.g=r,u.b=r):u=n.Color.createColor(r,r,r),i!==0){var f=r<.5?r*(1+i):r+i-r*i,e=2*r-f;u.r=n.Color.hueToColor(e,f,t+1/3);u.g=n.Color.hueToColor(e,f,t);u.b=n.Color.hueToColor(e,f,t-1/3)}return u.r=Math.floor(u.r*255|0),u.g=Math.floor(u.g*255|0),u.b=Math.floor(u.b*255|0),n.Color.updateColor(u),u},RGBtoHSV:function(t,i,r,u){u||(u=n.Color.createColor(t,i,r,255));t/=255;i/=255;r/=255;var o=Math.min(t,i,r),f=Math.max(t,i,r),e=f-o;return u.h=0,u.s=f===0?0:e/f,u.v=f,f!==o&&(f===t?u.h=(i-r)/e+(i<r?6:0):f===i?u.h=(r-t)/e+2:f===r&&(u.h=(t-i)/e+4),u.h/=6),u},HSVtoRGB:function(t,i,r,u){typeof u=="undefined"&&(u=n.Color.createColor(0,0,0,1,t,i,0,r));var f,e,o,l=Math.floor(t*6),a=t*6-l,s=r*(1-i),h=r*(1-a*i),c=r*(1-(1-a)*i);switch(l%6){case 0:f=r;e=c;o=s;break;case 1:f=h;e=r;o=s;break;case 2:f=s;e=r;o=c;break;case 3:f=s;e=h;o=r;break;case 4:f=c;e=s;o=r;break;case 5:f=r;e=s;o=h}return u.r=Math.floor(f*255),u.g=Math.floor(e*255),u.b=Math.floor(o*255),n.Color.updateColor(u),u},hueToColor:function(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n},createColor:function(t,i,r,u,f,e,o,s){var h={r:t||0,g:i||0,b:r||0,a:u||1,h:f||0,s:e||0,l:o||0,v:s||0,color:0,color32:0,rgba:""};return h.color=n.Color.getColor(h.r,h.g,h.b),h.color32=n.Color.getColor32(h.a,h.r,h.g,h.b),n.Color.updateColor(h)},updateColor:function(n){return n.rgba="rgba("+n.r.toString()+","+n.g.toString()+","+n.b.toString()+","+n.a.toString()+")",n},getColor32:function(n,t,i,r){return n<<24|t<<16|i<<8|r},getColor:function(n,t,i){return n<<16|t<<8|i},RGBtoString:function(t,i,r,u,f){return typeof u=="undefined"&&(u=255),typeof f=="undefined"&&(f="#"),f==="#"?"#"+(16777216+(t<<16)+(i<<8)+r).toString(16).slice(1):"0x"+n.Color.componentToHex(u)+n.Color.componentToHex(t)+n.Color.componentToHex(i)+n.Color.componentToHex(r)},hexToRGB:function(t){var i=n.Color.hexToColor(t);if(i)return n.Color.getColor32(i.a,i.r,i.g,i.b)},hexToColor:function(t,i){var r;if(t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,i,r){return t+t+i+i+r+r}),r=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),r){var u=parseInt(r[1],16),f=parseInt(r[2],16),e=parseInt(r[3],16);i?(i.r=u,i.g=f,i.b=e):i=n.Color.createColor(u,f,e)}return i},webToColor:function(t,i){i||(i=n.Color.createColor());var r=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return r&&(i.r=parseInt(r[1],10),i.g=parseInt(r[2],10),i.b=parseInt(r[3],10),i.a=r[4]!==undefined?parseFloat(r[4]):1),i},valueToColor:function(t,i){if(i||(i=n.Color.createColor()),typeof t=="string")return t.indexOf("rgb")===0?n.Color.webToColor(t,i):(i.a=1,n.Color.hexToColor(t,i));if(typeof t=="number"){var r=n.Color.getRGB(t);return i.r=r.r,i.g=r.g,i.b=r.b,i.a=r.a/255,i}return i},componentToHex:function(n){var t=n.toString(16);return t.length==1?"0"+t:t},HSVColorWheel:function(t,i){var u,r;for(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),u=[],r=0;r<=359;r++)u.push(n.Color.HSVtoRGB(r/359,t,i));return u},HSLColorWheel:function(t,i){var u,r;for(typeof t=="undefined"&&(t=.5),typeof i=="undefined"&&(i=.5),u=[],r=0;r<=359;r++)u.push(n.Color.HSLtoRGB(r/359,t,i));return u},interpolateColor:function(t,i,r,u,f){typeof f=="undefined"&&(f=255);var e=n.Color.getRGB(t),o=n.Color.getRGB(i),s=(o.red-e.red)*u/r+e.red,h=(o.green-e.green)*u/r+e.green,c=(o.blue-e.blue)*u/r+e.blue;return n.Color.getColor32(f,s,h,c)},interpolateColorWithRGB:function(t,i,r,u,f,e){var o=n.Color.getRGB(t),s=(i-o.red)*e/f+o.red,h=(r-o.green)*e/f+o.green,c=(u-o.blue)*e/f+o.blue;return n.Color.getColor(s,h,c)},interpolateRGB:function(t,i,r,u,f,e,o,s){var h=(u-t)*s/o+t,c=(f-i)*s/o+i,l=(e-r)*s/o+r;return n.Color.getColor(h,c,l)},getRandomColor:function(t,i,r){if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=255),typeof r=="undefined"&&(r=255),i>255||t>i)return n.Color.getColor(255,255,255);var u=t+Math.round(Math.random()*(i-t)),f=t+Math.round(Math.random()*(i-t)),e=t+Math.round(Math.random()*(i-t));return n.Color.getColor32(r,u,f,e)},getRGB:function(n){return n>16777215?{alpha:n>>>24,red:n>>16&255,green:n>>8&255,blue:n&255,a:n>>>24,r:n>>16&255,g:n>>8&255,b:n&255}:{alpha:255,red:n>>16&255,green:n>>8&255,blue:n&255,a:255,r:n>>16&255,g:n>>8&255,b:n&255}},getWebRGB:function(t){if(typeof t=="object")return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var i=n.Color.getRGB(t);return"rgba("+i.r.toString()+","+i.g.toString()+","+i.b.toString()+","+(i.a/255).toString()+")"},getAlpha:function(n){return n>>>24},getAlphaFloat:function(n){return(n>>>24)/255},getRed:function(n){return n>>16&255},getGreen:function(n){return n>>8&255},getBlue:function(n){return n&255}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};n.LinkedList.prototype={add:function(n){return this.total===0&&this.first===null&&this.last===null?(this.first=n,this.last=n,this.next=n,n.prev=this,this.total++,n):(this.last.next=n,n.prev=this.last,this.last=n,this.total++,n)},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(n){if(this.total===1){this.reset();n.next=n.prev=null;return}n===this.first?this.first=this.first.next:n===this.last&&(this.last=this.last.prev);n.prev&&(n.prev.next=n.next);n.next&&(n.next.prev=n.prev);n.next=n.prev=null;this.first===null&&(this.last=null);this.total--},callAll:function(n){if(this.first&&this.last){var t=this.first;do t&&t[n]&&t[n].call(t),t=t.next;while(t!=this.last.next)}}};n.LinkedList.prototype.constructor=n.LinkedList;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics=function(n,t){t=t||{};this.game=n;this.config=t;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};n.Physics.ARCADE=0;n.Physics.P2JS=1;n.Physics.NINJA=2;n.Physics.BOX2D=3;n.Physics.CHIPMUNK=4;n.Physics.prototype={parseConfig:function(){(!this.config.hasOwnProperty("arcade")||this.config.arcade===!0)&&n.Physics.hasOwnProperty("Arcade")&&(this.arcade=new n.Physics.Arcade(this.game),this.game.time.deltaCap=.2);this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&n.Physics.hasOwnProperty("Ninja")&&(this.ninja=new n.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&this.config.p2===!0&&n.Physics.hasOwnProperty("P2")&&(this.p2=new n.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&this.config.box2d===!0&&n.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new n.Physics.BOX2D(this.game,this.config))},startSystem:function(t){t===n.Physics.ARCADE?this.arcade=new n.Physics.Arcade(this.game):t===n.Physics.P2JS?this.p2===null?this.p2=new n.Physics.P2(this.game,this.config):this.p2.reset():t===n.Physics.NINJA?this.ninja=new n.Physics.Ninja(this.game):t===n.Physics.BOX2D&&(this.box2d===null?this.box2d=new n.Physics.Box2D(this.game,this.config):this.box2d.reset())},enable:function(t,i,r){typeof i=="undefined"&&(i=n.Physics.ARCADE);typeof r=="undefined"&&(r=!1);i===n.Physics.ARCADE?this.arcade.enable(t):i===n.Physics.P2JS&&this.p2?this.p2.enable(t,r):i===n.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):i===n.Physics.BOX2D&&this.box2d&&this.box2d.enable(t)},preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();this.box2d&&this.box2d.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null}};n.Physics.prototype.constructor=n.Physics;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade=function(t){this.game=t;this.gravity=new n.Point;this.bounds=new n.Rectangle(0,0,t.world.width,t.world.height);this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=!1;this.sortDirection=n.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};n.Physics.Arcade.prototype.constructor=n.Physics.Arcade;n.Physics.Arcade.SORT_NONE=0;n.Physics.Arcade.LEFT_RIGHT=1;n.Physics.Arcade.RIGHT_LEFT=2;n.Physics.Arcade.TOP_BOTTOM=3;n.Physics.Arcade.BOTTOM_TOP=4;n.Physics.Arcade.prototype={setBounds:function(n,t,i,r){this.bounds.setTo(n,t,i,r)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(t,i){typeof i=="undefined"&&(i=!0);var r=1;if(Array.isArray(t))for(r=t.length;r--;)t[r]instanceof n.Group?this.enable(t[r].children,i):(this.enableBody(t[r]),i&&t[r].hasOwnProperty("children")&&t[r].children.length>0&&this.enable(t[r],!0));else t instanceof n.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&t.body===null&&(t.body=new n.Physics.Arcade.Body(t))},updateMotion:function(n){var t=this.computeVelocity(0,n,n.angularVelocity,n.angularAcceleration,n.angularDrag,n.maxAngular)-n.angularVelocity;n.angularVelocity+=t;n.rotation+=n.angularVelocity*this.game.time.physicsElapsed;n.velocity.x=this.computeVelocity(1,n,n.velocity.x,n.acceleration.x,n.drag.x,n.maxVelocity.x);n.velocity.y=this.computeVelocity(2,n,n.velocity.y,n.acceleration.y,n.drag.y,n.maxVelocity.y)},computeVelocity:function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=1e4),n===1&&t.allowGravity?i+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:n===2&&t.allowGravity&&(i+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?i+=r*this.game.time.physicsElapsed:u&&(u*=this.game.time.physicsElapsed,i-u>0?i-=u:i+u<0?i+=u:i=0),i>f?i=f:i<-f&&(i=-f),i},overlap:function(n,t,i,r,u){var f,e;if(i=i||null,r=r||null,u=u||i,this._total=0,!Array.isArray(n)&&Array.isArray(t))for(f=0;f<t.length;f++)this.collideHandler(n,t[f],i,r,u,!0);else if(Array.isArray(n)&&!Array.isArray(t))for(f=0;f<n.length;f++)this.collideHandler(n[f],t,i,r,u,!0);else if(Array.isArray(n)&&Array.isArray(t))for(f=0;f<n.length;f++)for(e=0;e<t.length;e++)this.collideHandler(n[f],t[e],i,r,u,!0);else this.collideHandler(n,t,i,r,u,!0);return this._total>0},collide:function(n,t,i,r,u){var f,e;if(i=i||null,r=r||null,u=u||i,this._total=0,!Array.isArray(n)&&Array.isArray(t))for(f=0;f<t.length;f++)this.collideHandler(n,t[f],i,r,u,!1);else if(Array.isArray(n)&&!Array.isArray(t))for(f=0;f<n.length;f++)this.collideHandler(n[f],t,i,r,u,!1);else if(Array.isArray(n)&&Array.isArray(t))for(f=0;f<n.length;f++)for(e=0;e<t.length;e++)this.collideHandler(n[f],t[e],i,r,u,!1);else this.collideHandler(n,t,i,r,u,!1);return this._total>0},sort:function(t){this.sortDirection===n.Physics.Arcade.LEFT_RIGHT?t._hash.sort(function(n,t){return!n.body||!t.body?-1:n.body.x-t.body.x}):this.sortDirection===n.Physics.Arcade.RIGHT_LEFT?t._hash.sort(function(n,t){return!n.body||!t.body?-1:t.body.x-n.body.x}):this.sortDirection===n.Physics.Arcade.TOP_BOTTOM?t._hash.sort(function(n,t){return!n.body||!t.body?-1:n.body.y-t.body.y}):this.sortDirection===n.Physics.Arcade.BOTTOM_TOP&&t._hash.sort(function(n,t){return!n.body||!t.body?-1:t.body.y-n.body.y})},collideHandler:function(t,i,r,u,f,e){if(typeof i=="undefined"&&t.physicsType===n.GROUP){this.sort(t);this.collideGroupVsSelf(t,r,u,f,e);return}t&&i&&t.exists&&i.exists&&(this.sortDirection!==n.Physics.Arcade.SORT_NONE&&(t.physicsType===n.GROUP&&this.sort(t),i.physicsType===n.GROUP&&this.sort(i)),t.physicsType===n.SPRITE?i.physicsType===n.SPRITE?this.collideSpriteVsSprite(t,i,r,u,f,e):i.physicsType===n.GROUP?this.collideSpriteVsGroup(t,i,r,u,f,e):i.physicsType===n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,i,r,u,f):t.physicsType===n.GROUP?i.physicsType===n.SPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.physicsType===n.GROUP?this.collideGroupVsGroup(t,i,r,u,f,e):i.physicsType===n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f,e):t.physicsType===n.TILEMAPLAYER&&(i.physicsType===n.SPRITE?this.collideSpriteVsTilemapLayer(i,t,r,u,f,e):i.physicsType===n.GROUP&&this.collideGroupVsTilemapLayer(i,t,r,u,f,e)))},collideSpriteVsSprite:function(n,t,i,r,u,f){return!n.body||!t.body?!1:(this.separate(n.body,t.body,r,u,f)&&(i&&i.call(u,n,t),this._total++),!0)},collideSpriteVsGroup:function(t,i,r,u,f,e){var s,o;if(i.length!==0&&t.body)if(this.skipQuadTree||t.body.skipQuadTree){for(o=0;o<i._hash.length;o++)if(i._hash[o]&&i._hash[o].exists&&i._hash[o].body){if(this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(t.body.right<i._hash[o].body.x)break;else if(i._hash[o].body.right<t.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(t.body.x>i._hash[o].body.right)break;else if(i._hash[o].body.x>t.body.right)continue}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<i._hash[o].body.y)break;else if(i._hash[o].body.bottom<t.body.y)continue}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP)if(t.body.y>i._hash[o].body.bottom)break;else if(i._hash[o].body.y>t.body.bottom)continue;this.collideSpriteVsSprite(t,i._hash[o],r,u,f,e)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i),s=this.quadTree.retrieve(t),o=0;o<s.length;o++)this.separate(t.body,s[o],u,f,e)&&(r&&r.call(f,t,s[o].sprite),this._total++)},collideGroupVsSelf:function(t,i,r,u,f){var s,e,h,o;if(t.length!==0)for(s=0;s<t._hash.length;s++)if(t._hash[s]&&t._hash[s].exists&&t._hash[s].body)for(e=t._hash[s],h=s+1;h<t._hash.length;h++)if(t._hash[h]&&t._hash[h].exists&&t._hash[h].body){if(o=t._hash[h],this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(e.body.right<o.body.x)break;else if(o.body.right<e.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(e.body.x>o.body.right)continue;else if(o.body.x>e.body.right)break}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(e.body.bottom<o.body.y)continue;else if(o.body.bottom<e.body.y)break}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP)if(e.body.y>o.body.bottom)continue;else if(o.body.y>e.body.bottom)break;this.collideSpriteVsSprite(e,o,i,r,u,f)}},collideGroupVsGroup:function(t,i,r,u,f,e){if(t.length!==0&&i.length!==0)for(var o=0;o<t.children.length;o++)t.children[o].exists&&(t.children[o].physicsType===n.GROUP?this.collideGroupVsGroup(t.children[o],i,r,u,f,e):this.collideSpriteVsGroup(t.children[o],i,r,u,f,e))},separate:function(n,t,i,r,u){if(!n.enable||!t.enable||!this.intersects(n,t)||i&&i.call(r,n.sprite,t.sprite)===!1)return!1;var f=!1;return f=this.forceX||Math.abs(this.gravity.y+n.gravity.y)<Math.abs(this.gravity.x+n.gravity.x)?this.separateX(n,t,u)||this.separateY(n,t,u):this.separateY(n,t,u)||this.separateX(n,t,u),u?!0:f},intersects:function(n,t){return n.right<=t.position.x?!1:n.bottom<=t.position.y?!1:n.position.x>=t.right?!1:n.position.y>=t.bottom?!1:!0},separateX:function(n,t,i){var r,o,u,f;if(n.immovable&&t.immovable)return!1;if(r=0,this.intersects(n,t)&&(o=n.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS,n.deltaX()===0&&t.deltaX()===0?(n.embedded=!0,t.embedded=!0):n.deltaX()>t.deltaX()?(r=n.right-t.x,r>o||n.checkCollision.right===!1||t.checkCollision.left===!1?r=0:(n.touching.none=!1,n.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):n.deltaX()<t.deltaX()&&(r=n.x-t.width-t.x,-r>o||n.checkCollision.left===!1||t.checkCollision.right===!1?r=0:(n.touching.none=!1,n.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),n.overlapX=r,t.overlapX=r,r!==0)){if(i||n.customSeparateX||t.customSeparateX)return!0;if(u=n.velocity.x,f=t.velocity.x,n.immovable||t.immovable)n.immovable?t.immovable||(t.x+=r,t.velocity.x=u-f*t.bounce.x,n.moves&&(t.y+=(n.y-n.prev.y)*n.friction.y)):(n.x=n.x-r,n.velocity.x=f-u*n.bounce.x,t.moves&&(n.y+=(t.y-t.prev.y)*t.friction.y));else{r*=.5;n.x=n.x-r;t.x+=r;var s=Math.sqrt(f*f*t.mass/n.mass)*(f>0?1:-1),h=Math.sqrt(u*u*n.mass/t.mass)*(u>0?1:-1),e=(s+h)*.5;s-=e;h-=e;n.velocity.x=e+s*n.bounce.x;t.velocity.x=e+h*t.bounce.x}return!0}return!1},separateY:function(n,t,i){var r,o,u,f;if(n.immovable&&t.immovable)return!1;if(r=0,this.intersects(n,t)&&(o=n.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS,n.deltaY()===0&&t.deltaY()===0?(n.embedded=!0,t.embedded=!0):n.deltaY()>t.deltaY()?(r=n.bottom-t.y,r>o||n.checkCollision.down===!1||t.checkCollision.up===!1?r=0:(n.touching.none=!1,n.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):n.deltaY()<t.deltaY()&&(r=n.y-t.bottom,-r>o||n.checkCollision.up===!1||t.checkCollision.down===!1?r=0:(n.touching.none=!1,n.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),n.overlapY=r,t.overlapY=r,r!==0)){if(i||n.customSeparateY||t.customSeparateY)return!0;if(u=n.velocity.y,f=t.velocity.y,n.immovable||t.immovable)n.immovable?t.immovable||(t.y+=r,t.velocity.y=u-f*t.bounce.y,n.moves&&(t.x+=(n.x-n.prev.x)*n.friction.x)):(n.y=n.y-r,n.velocity.y=f-u*n.bounce.y,t.moves&&(n.x+=(t.x-t.prev.x)*t.friction.x));else{r*=.5;n.y=n.y-r;t.y+=r;var s=Math.sqrt(f*f*t.mass/n.mass)*(f>0?1:-1),h=Math.sqrt(u*u*n.mass/t.mass)*(u>0?1:-1),e=(s+h)*.5;s-=e;h-=e;n.velocity.y=e+s*n.bounce.y;t.velocity.y=e+h*t.bounce.y}return!0}return!1},getObjectsUnderPointer:function(n,t,i,r){if(t.length!==0&&n.exists)return this.getObjectsAtLocation(n.x,n.y,t,i,r,n)},getObjectsAtLocation:function(t,i,r,u,f,e){var o;this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(r);var c=new n.Rectangle(t,i,1,1),h=[],s=this.quadTree.retrieve(c);for(o=0;o<s.length;o++)s[o].hitTest(t,i)&&(u&&u.call(f,e,s[o].sprite),h.push(s[o].sprite));return h},moveToObject:function(n,t,i,r){typeof i=="undefined"&&(i=60);typeof r=="undefined"&&(r=0);var u=Math.atan2(t.y-n.y,t.x-n.x);return r>0&&(i=this.distanceBetween(n,t)/(r/1e3)),n.body.velocity.x=Math.cos(u)*i,n.body.velocity.y=Math.sin(u)*i,u},moveToPointer:function(n,t,i,r){typeof t=="undefined"&&(t=60);i=i||this.game.input.activePointer;typeof r=="undefined"&&(r=0);var u=this.angleToPointer(n,i);return r>0&&(t=this.distanceToPointer(n,i)/(r/1e3)),n.body.velocity.x=Math.cos(u)*t,n.body.velocity.y=Math.sin(u)*t,u},moveToXY:function(n,t,i,r,u){typeof r=="undefined"&&(r=60);typeof u=="undefined"&&(u=0);var f=Math.atan2(i-n.y,t-n.x);return u>0&&(r=this.distanceToXY(n,t,i)/(u/1e3)),n.body.velocity.x=Math.cos(f)*r,n.body.velocity.y=Math.sin(f)*r,f},velocityFromAngle:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(this.game.math.degToRad(t))*i,Math.sin(this.game.math.degToRad(t))*i)},velocityFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerationFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerateToObject:function(n,t,i,r,u){typeof i=="undefined"&&(i=60);typeof r=="undefined"&&(r=1e3);typeof u=="undefined"&&(u=1e3);var f=this.angleBetween(n,t);return n.body.acceleration.setTo(Math.cos(f)*i,Math.sin(f)*i),n.body.maxVelocity.setTo(r,u),f},accelerateToPointer:function(n,t,i,r,u){typeof i=="undefined"&&(i=60);typeof t=="undefined"&&(t=this.game.input.activePointer);typeof r=="undefined"&&(r=1e3);typeof u=="undefined"&&(u=1e3);var f=this.angleToPointer(n,t);return n.body.acceleration.setTo(Math.cos(f)*i,Math.sin(f)*i),n.body.maxVelocity.setTo(r,u),f},accelerateToXY:function(n,t,i,r,u,f){typeof r=="undefined"&&(r=60);typeof u=="undefined"&&(u=1e3);typeof f=="undefined"&&(f=1e3);var e=this.angleToXY(n,t,i);return n.body.acceleration.setTo(Math.cos(e)*r,Math.sin(e)*r),n.body.maxVelocity.setTo(u,f),e},distanceBetween:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)},distanceToXY:function(n,t,i){var r=n.x-t,u=n.y-i;return Math.sqrt(r*r+u*u)},distanceToPointer:function(n,t){t=t||this.game.input.activePointer;var i=n.x-t.worldX,r=n.y-t.worldY;return Math.sqrt(i*i+r*r)},angleBetween:function(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.atan2(r,i)},angleToXY:function(n,t,i){var r=t-n.x,u=i-n.y;return Math.atan2(u,r)},angleToPointer:function(n,t){t=t||this.game.input.activePointer;var i=t.worldX-n.x,r=t.worldY-n.y;return Math.atan2(r,i)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.type=n.Physics.ARCADE;this.enable=!0;this.offset=new n.Point;this.position=new n.Point(t.x,t.y);this.prev=new n.Point(this.position.x,this.position.y);this.allowRotation=!0;this.rotation=t.rotation;this.preRotation=t.rotation;this.width=t.width;this.height=t.height;this.sourceWidth=t.width;this.sourceHeight=t.height;t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height);this.halfWidth=Math.abs(t.width/2);this.halfHeight=Math.abs(t.height/2);this.center=new n.Point(t.x+this.halfWidth,t.y+this.halfHeight);this.velocity=new n.Point;this.newVelocity=new n.Point(0,0);this.deltaMax=new n.Point(0,0);this.acceleration=new n.Point;this.drag=new n.Point;this.allowGravity=!0;this.gravity=new n.Point(0,0);this.bounce=new n.Point;this.maxVelocity=new n.Point(1e4,1e4);this.friction=new n.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.angle=0;this.speed=0;this.facing=n.NONE;this.immovable=!1;this.moves=!0;this.customSeparateX=!1;this.customSeparateY=!1;this.overlapX=0;this.overlapY=0;this.embedded=!1;this.collideWorldBounds=!1;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={up:!1,down:!1,left:!1,right:!1};this.tilePadding=new n.Point;this.dirty=!1;this.skipQuadTree=!1;this._reset=!0;this._sx=t.scale.x;this._sy=t.scale.y;this._dx=0;this._dy=0};n.Physics.Arcade.Body.prototype={updateBounds:function(){var n=Math.abs(this.sprite.scale.x),t=Math.abs(this.sprite.scale.y);(n!==this._sx||t!==this._sy)&&(this.width=this.sourceWidth*n,this.height=this.sourceHeight*t,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=n,this._sy=t,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&this.dirty&&(this.dirty=!1,this.deltaX()<0?this.facing=n.LEFT:this.deltaX()>0&&(this.facing=n.RIGHT),this.deltaY()<0?this.facing=n.UP:this.deltaY()>0&&(this.facing=n.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this.deltaMax.x!==0&&this._dx!==0&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),this.deltaMax.y!==0&&this._dy!==0&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite.body=null;this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0);this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(n,t,i,r){typeof i=="undefined"&&(i=this.offset.x);typeof r=="undefined"&&(r=this.offset.y);this.sourceWidth=n;this.sourceHeight=t;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(i,r);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(n,t){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=n-this.sprite.anchor.x*this.width+this.offset.x;this.position.y=t-this.sprite.anchor.y*this.height+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(t,i){return n.Rectangle.contains(this,t,i)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(n.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.Physics.Arcade.Body.render=function(n,t,i,r){typeof r=="undefined"&&(r=!0);i=i||"rgba(0,255,0,0.4)";r?(n.fillStyle=i,n.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)):(n.strokeStyle=i,n.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height))};n.Physics.Arcade.Body.renderBodyInfo=function(n,t){n.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height);n.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2));n.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2));n.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2));n.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down);n.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)};n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade.TilemapCollision=function(){};n.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(n,t,i,r,u){var e,f;if(n.body&&(e=t.getTiles(n.body.position.x-n.body.tilePadding.x,n.body.position.y-n.body.tilePadding.y,n.body.width+n.body.tilePadding.x,n.body.height+n.body.tilePadding.y,!1,!1),e.length!==0))for(f=0;f<e.length;f++)r?r.call(u,n,e[f])&&this.separateTile(f,n.body,e[f])&&(this._total++,i&&i.call(u,n,e[f])):this.separateTile(f,n.body,e[f])&&(this._total++,i&&i.call(u,n,e[f]))},collideGroupVsTilemapLayer:function(n,t,i,r,u){if(n.length!==0)for(var f=0;f<n.children.length;f++)n.children[f].exists&&this.collideSpriteVsTilemapLayer(n.children[f],t,i,r,u)},separateTile:function(n,t,i){if(!t.enable||!i.intersects(t.position.x,t.position.y,t.right,t.bottom)||i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,t.sprite,i)||i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,t.sprite,i)||!i.faceLeft&&!i.faceRight&&!i.faceTop&&!i.faceBottom)return!1;var r=0,u=0,f=0,e=1;if(t.deltaAbsX()>t.deltaAbsY()?f=-1:t.deltaAbsX()<t.deltaAbsY()&&(e=-1),t.deltaX()!==0&&t.deltaY()!==0&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(f=Math.min(Math.abs(t.position.x-i.right),Math.abs(t.right-i.left)),e=Math.min(Math.abs(t.position.y-i.bottom),Math.abs(t.bottom-i.top))),f<e){if((i.faceLeft||i.faceRight)&&(r=this.tileCheckX(t,i),r!==0&&!i.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(i.faceTop||i.faceBottom)&&(u=this.tileCheckY(t,i))}else{if((i.faceTop||i.faceBottom)&&(u=this.tileCheckY(t,i),u!==0&&!i.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(i.faceLeft||i.faceRight)&&(r=this.tileCheckX(t,i))}return r!==0||u!==0},tileCheckX:function(n,t){var i=0;return n.deltaX()<0&&!n.blocked.left&&t.collideRight&&n.checkCollision.left?t.faceRight&&n.x<t.right&&(i=n.x-t.right,i<-this.TILE_BIAS&&(i=0)):n.deltaX()>0&&!n.blocked.right&&t.collideLeft&&n.checkCollision.right&&t.faceLeft&&n.right>t.left&&(i=n.right-t.left,i>this.TILE_BIAS&&(i=0)),i!==0&&(n.customSeparateX?n.overlapX=i:this.processTileSeparationX(n,i)),i},tileCheckY:function(n,t){var i=0;return n.deltaY()<0&&!n.blocked.up&&t.collideDown&&n.checkCollision.up?t.faceBottom&&n.y<t.bottom&&(i=n.y-t.bottom,i<-this.TILE_BIAS&&(i=0)):n.deltaY()>0&&!n.blocked.down&&t.collideUp&&n.checkCollision.down&&t.faceTop&&n.bottom>t.top&&(i=n.bottom-t.top,i>this.TILE_BIAS&&(i=0)),i!==0&&(n.customSeparateY?n.overlapY=i:this.processTileSeparationY(n,i)),i},processTileSeparationX:function(n,t){t<0?n.blocked.left=!0:t>0&&(n.blocked.right=!0);n.position.x-=t;n.velocity.x=n.bounce.x===0?0:-n.velocity.x*n.bounce.x},processTileSeparationY:function(n,t){t<0?n.blocked.up=!0:t>0&&(n.blocked.down=!0);n.position.y-=t;n.velocity.y=n.bounce.y===0?0:-n.velocity.y*n.bounce.y}};n.Utils.mixinPrototype(n.Physics.Arcade.prototype,n.Physics.Arcade.TilemapCollision.prototype);!function(n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define(n):"undefined"!=typeof window?window.p2=n():"undefined"!=typeof global?global.p2=n():"undefined"!=typeof self&&(self.p2=n())}(function(){return function n(t,i,r){function u(f,o){var h,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);throw new Error("Cannot find module '"+f+"'");}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){function i(){}var r=n("./Scalar");t.exports=i;i.lineInt=function(n,t,i){i=i||0;var h=[0,0],u,f,c,e,o,l,s;return u=n[1][1]-n[0][1],f=n[0][0]-n[1][0],c=u*n[0][0]+f*n[0][1],e=t[1][1]-t[0][1],o=t[0][0]-t[1][0],l=e*t[0][0]+o*t[0][1],s=u*o-e*f,r.eq(s,0,i)||(h[0]=(o*c-f*l)/s,h[1]=(u*l-e*c)/s),h};i.segmentsIntersect=function(n,t,i,r){var u=t[0]-n[0],f=t[1]-n[1],e=r[0]-i[0],o=r[1]-i[1],s,h;return e*f-o*u==0?!1:(s=(u*(i[1]-n[1])+f*(n[0]-i[0]))/(e*f-o*u),h=(e*(n[1]-i[1])+o*(i[0]-n[0]))/(o*u-e*f),s>=0&&s<=1&&h>=0&&h<=1)}},{"./Scalar":4}],2:[function(n,t){function i(){}t.exports=i;i.area=function(n,t,i){return(t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1])};i.left=function(n,t,r){return i.area(n,t,r)>0};i.leftOn=function(n,t,r){return i.area(n,t,r)>=0};i.right=function(n,t,r){return i.area(n,t,r)<0};i.rightOn=function(n,t,r){return i.area(n,t,r)<=0};var r=[],u=[];i.collinear=function(n,t,f,e){var o,s;if(e){o=r;s=u;o[0]=t[0]-n[0];o[1]=t[1]-n[1];s[0]=f[0]-t[0];s[1]=f[1]-t[1];var h=o[0]*s[0]+o[1]*s[1],c=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),a=Math.acos(h/(c*l));return a<e}return i.area(n,t,f)==0};i.sqdist=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r}},{}],3:[function(n,t){function i(){this.vertices=[]}function o(n,t,i,r,u){u=u||0;var f=t[1]-n[1],e=n[0]-t[0],l=f*n[0]+e*n[1],o=r[1]-i[1],h=i[0]-r[0],a=o*i[0]+h*i[1],c=f*h-o*e;return s.eq(c,0,u)?[0,0]:[(h*l-e*a)/c,(f*a-o*l)/c]}var u=n("./Line"),r=n("./Point"),s=n("./Scalar"),f,e;t.exports=i;i.prototype.at=function(n){var i=this.vertices,t=i.length;return i[n<0?n%t+t:n%t]};i.prototype.first=function(){return this.vertices[0]};i.prototype.last=function(){return this.vertices[this.vertices.length-1]};i.prototype.clear=function(){this.vertices.length=0};i.prototype.append=function(n,t,i){if(typeof t=="undefined")throw new Error("From is not given!");if(typeof i=="undefined")throw new Error("To is not given!");if(i-1<t)throw new Error("lol1");if(i>n.vertices.length)throw new Error("lol2");if(t<0)throw new Error("lol3");for(var r=t;r<i;r++)this.vertices.push(n.vertices[r])};i.prototype.makeCCW=function(){for(var n=0,t=this.vertices,i=1;i<this.vertices.length;++i)(t[i][1]<t[n][1]||t[i][1]==t[n][1]&&t[i][0]>t[n][0])&&(n=i);r.left(this.at(n-1),this.at(n),this.at(n+1))||this.reverse()};i.prototype.reverse=function(){for(var n=[],t=0,i=this.vertices.length;t!==i;t++)n.push(this.vertices.pop());this.vertices=n};i.prototype.isReflex=function(n){return r.right(this.at(n-1),this.at(n),this.at(n+1))};f=[];e=[];i.prototype.canSee=function(n,t){var h,c,o=f,s=e,i;if(r.leftOn(this.at(n+1),this.at(n),this.at(t))&&r.rightOn(this.at(n-1),this.at(n),this.at(t)))return!1;for(c=r.sqdist(this.at(n),this.at(t)),i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==n&&i!==n&&r.leftOn(this.at(n),this.at(t),this.at(i+1))&&r.rightOn(this.at(n),this.at(t),this.at(i))&&(o[0]=this.at(n),o[1]=this.at(t),s[0]=this.at(i),s[1]=this.at(i+1),h=u.lineInt(o,s),r.sqdist(this.at(n),h)<c))return!1;return!0};i.prototype.copy=function(n,t,r){var f=r||new i,u;if(f.clear(),n<t)for(u=n;u<=t;u++)f.vertices.push(this.vertices[u]);else{for(u=0;u<=t;u++)f.vertices.push(this.vertices[u]);for(u=n;u<this.vertices.length;u++)f.vertices.push(this.vertices[u])}return f};i.prototype.getCutEdges=function(){for(var t,u,f=[],r=[],e=[],o=new i,s=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(t=0;t<this.vertices.length;++t)if(this.canSee(n,t)){for(r=this.copy(n,t,o).getCutEdges(),e=this.copy(t,n,o).getCutEdges(),u=0;u<e.length;u++)r.push(e[u]);r.length<s&&(f=r,s=r.length,f.push([this.at(n),this.at(t)]))}return f};i.prototype.decomp=function(){var n=this.getCutEdges();return n.length>0?this.slice(n):[this]};i.prototype.slice=function(n){var r,i,u,t,e,f;if(n.length==0)return[this];if(n instanceof Array&&n.length&&n[0]instanceof Array&&n[0].length==2&&n[0][0]instanceof Array){for(r=[this],i=0;i<n.length;i++)for(u=n[i],t=0;t<r.length;t++)if(e=r[t],f=e.slice(u),f){r.splice(t,1);r.push(f[0],f[1]);break}return r}var u=n,i=this.vertices.indexOf(u[0]),t=this.vertices.indexOf(u[1]);return i!=-1&&t!=-1?[this.copy(i,t),this.copy(t,i)]:!1};i.prototype.isSimple=function(){for(var i,n=this.vertices,t=0;t<n.length-1;t++)for(i=0;i<t-1;i++)if(u.segmentsIntersect(n[t],n[t+1],n[i],n[i+1]))return!1;for(t=1;t<n.length-2;t++)if(u.segmentsIntersect(n[0],n[n.length-1],n[t],n[t+1]))return!1;return!0};i.prototype.quickDecomp=function(n,t,u,f,e,s){var c,l;e=e||100;s=s||0;f=f||25;n=typeof n!="undefined"?n:[];t=t||[];u=u||[];var d=[0,0],g=[0,0],a=[0,0],nt=0,tt=0,p=0,it=0,w=0,b=0,k=0,v=new i,y=new i,h=this,rt=this.vertices;if(rt.length<3)return n;if(s++,s>e)return console.warn("quickDecomp: max level ("+e+") reached."),n;for(c=0;c<this.vertices.length;++c)if(h.isReflex(c)){for(t.push(h.vertices[c]),nt=tt=Number.MAX_VALUE,l=0;l<this.vertices.length;++l)r.left(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c-1),h.at(c),h.at(l-1))&&(a=o(h.at(c-1),h.at(c),h.at(l),h.at(l-1)),r.right(h.at(c+1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<tt&&(tt=p,g=a,b=l))),r.left(h.at(c+1),h.at(c),h.at(l+1))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(a=o(h.at(c+1),h.at(c),h.at(l),h.at(l+1)),r.left(h.at(c-1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<nt&&(nt=p,d=a,w=l)));if(b==(w+1)%this.vertices.length)a[0]=(g[0]+d[0])/2,a[1]=(g[1]+d[1])/2,u.push(a),c<w?(v.append(h,c,w+1),v.vertices.push(a),y.vertices.push(a),b!=0&&y.append(h,b,h.vertices.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,h.vertices.length),v.append(h,0,w+1),v.vertices.push(a),y.vertices.push(a),y.append(h,b,c+1));else{if(b>w&&(w+=this.vertices.length),it=Number.MAX_VALUE,w<b)return n;for(l=b;l<=w;++l)r.leftOn(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(p=r.sqdist(h.at(c),h.at(l)),p<it&&(it=p,k=l%this.vertices.length));c<k?(v.append(h,c,k+1),k!=0&&y.append(h,k,rt.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,rt.length),v.append(h,0,k+1),y.append(h,k,c+1))}return v.vertices.length<y.vertices.length?(v.quickDecomp(n,t,u,f,e,s),y.quickDecomp(n,t,u,f,e,s)):(y.quickDecomp(n,t,u,f,e,s),v.quickDecomp(n,t,u,f,e,s)),n}return n.push(this),n};i.prototype.removeCollinearPoints=function(n){for(var i=0,t=this.vertices.length-1;this.vertices.length>3&&t>=0;--t)r.collinear(this.at(t-1),this.at(t),this.at(t+1),n)&&(this.vertices.splice(t%this.vertices.length,1),t--,i++);return i}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(n,t){function i(){}t.exports=i;i.eq=function(n,t,i){return i=i||0,Math.abs(n-t)<i}},{}],5:[function(n,t){t.exports={Polygon:n("./Polygon"),Point:n("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(n,t){t.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(n,t){function r(n){this.lowerBound=i.create();n&&n.lowerBound&&i.copy(this.lowerBound,n.lowerBound);this.upperBound=i.create();n&&n.upperBound&&i.copy(this.upperBound,n.upperBound)}var i=n("../math/vec2"),f=n("../utils/Utils"),u;t.exports=r;u=i.create();r.prototype.setFromPoints=function(n,t,r,f){var s=this.lowerBound,c=this.upperBound,l,a,h,o,v,y,e;for(typeof r!="number"&&(r=0),r!==0?i.rotate(s,n[0],r):i.copy(s,n[0]),i.copy(c,s),l=Math.cos(r),a=Math.sin(r),h=1;h<n.length;h++)for(o=n[h],r!==0&&(v=o[0],y=o[1],u[0]=l*v-a*y,u[1]=a*v+l*y,o=u),e=0;e<2;e++)o[e]>c[e]&&(c[e]=o[e]),o[e]<s[e]&&(s[e]=o[e]);t&&(i.add(this.lowerBound,this.lowerBound,t),i.add(this.upperBound,this.upperBound,t));f&&(this.lowerBound[0]-=f,this.lowerBound[1]-=f,this.upperBound[0]+=f,this.upperBound[1]+=f)};r.prototype.copy=function(n){i.copy(this.lowerBound,n.lowerBound);i.copy(this.upperBound,n.upperBound)};r.prototype.extend=function(n){for(var t=2,i,r;t--;)i=n.lowerBound[t],this.lowerBound[t]>i&&(this.lowerBound[t]=i),r=n.upperBound[t],this.upperBound[t]<r&&(this.upperBound[t]=r)};r.prototype.overlaps=function(n){var r=this.lowerBound,t=this.upperBound,u=n.lowerBound,i=n.upperBound;return(u[0]<=t[0]&&t[0]<=i[0]||r[0]<=i[0]&&i[0]<=t[0])&&(u[1]<=t[1]&&t[1]<=i[1]||r[1]<=i[1]&&i[1]<=t[1])}},{"../math/vec2":31,"../utils/Utils":50}],8:[function(n,t){function i(n){this.type=n;this.result=[];this.world=null;this.boundingVolumeType=i.AABB}var u=n("../math/vec2"),r=n("../objects/Body"),f;t.exports=i;i.AABB=1;i.BOUNDING_CIRCLE=2;i.prototype.setWorld=function(n){this.world=n};i.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!");};f=u.create();i.boundingRadiusCheck=function(n,t){u.sub(f,n.position,t.position);var r=u.squaredLength(f),i=n.boundingRadius+t.boundingRadius;return r<=i*i};i.aabbCheck=function(n,t){return n.getAABB().overlaps(t.getAABB())};i.prototype.boundingVolumeCheck=function(n,t){var r;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:r=i.boundingRadiusCheck(n,t);break;case i.AABB:r=i.aabbCheck(n,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return r};i.canCollide=function(n,t){return n.type===r.STATIC&&t.type===r.STATIC?!1:n.type===r.KINEMATIC&&t.type===r.STATIC||n.type===r.STATIC&&t.type===r.KINEMATIC?!1:n.type===r.KINEMATIC&&t.type===r.KINEMATIC?!1:n.sleepState===r.SLEEPING&&t.sleepState===r.SLEEPING?!1:n.sleepState===r.SLEEPING&&t.type===r.STATIC||t.sleepState===r.SLEEPING&&n.type===r.STATIC?!1:!0};i.NAIVE=1;i.SAP=2},{"../math/vec2":31,"../objects/Body":32}],9:[function(n,t){function i(n){r.apply(this);n=u.defaults(n,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=n.xmin;this.ymin=n.ymin;this.xmax=n.xmax;this.ymax=n.ymax;this.nx=n.nx;this.ny=n.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}var f=n("../shapes/Circle"),e=n("../shapes/Plane"),o=n("../shapes/Particle"),r=n("../collision/Broadphase"),s=n("../math/vec2"),u=n("../utils/Utils");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.getCollisionPairs=function(n){for(var y,p,h,i,tt,f,u,c,b=[],k=n.bodies,it=k.length,vt=this.binsizeX,yt=this.binsizeY,d=this.nx,l=this.ny,e=this.xmin,o=this.ymin,g=this.xmax,nt=this.ymax,a=[],v=d*l,t=0;t<v;t++)a.push([]);for(y=d/(g-e),p=l/(nt-o),t=0;t!==it;t++){var f=k[t],s=f.aabb,rt=Math.max(s.lowerBound[0],e),ut=Math.max(s.lowerBound[1],o),ft=Math.min(s.upperBound[0],g),et=Math.min(s.upperBound[1],nt),ot=Math.floor(y*(rt-e)),st=Math.floor(p*(ut-o)),ht=Math.floor(y*(ft-e)),ct=Math.floor(p*(et-o));for(i=ot;i<=ht;i++)for(u=st;u<=ct;u++){var lt=i,at=u,w=lt*(l-1)+at;w>=0&&w<v&&a[w].push(f)}}for(t=0;t!==v;t++)for(h=a[t],i=0,tt=h.length;i!==tt;i++)for(f=h[i],u=0;u!==i;u++)c=h[u],r.canCollide(f,c)&&this.boundingVolumeCheck(f,c)&&b.push(f,c);return b}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50}],10:[function(n,t){function i(){r.call(this,r.NAIVE)}var u=n("../shapes/Circle"),f=n("../shapes/Plane"),e=n("../shapes/Shape"),o=n("../shapes/Particle"),r=n("../collision/Broadphase"),s=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.getCollisionPairs=function(n){var e=n.bodies,o=this.result,t,s,i,u,f;for(o.length=0,t=0,s=e.length;t!==s;t++)for(i=e[t],u=0;u<t;u++)f=e[u],r.canCollide(i,f)&&this.boundingVolumeCheck(i,f)&&o.push(i,f);return o};i.prototype.aabbQuery=function(n,t,i){var f,u,r;for(i=i||[],f=n.bodies,u=0;u<f.length;u++)r=f[u],r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&i.push(r);return i}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45}],11:[function(n,t){function u(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=!0;this.enabledEquations=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.reuseObjects=!0;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=b.DEFAULT_STIFFNESS;this.relaxation=b.DEFAULT_RELAXATION;this.frictionStiffness=b.DEFAULT_STIFFNESS;this.frictionRelaxation=b.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new pt;this.contactSkinSize=.01}function ut(n,t){i.set(n.vertices[0],-t.length*.5,-t.radius);i.set(n.vertices[1],t.length*.5,-t.radius);i.set(n.vertices[2],t.length*.5,t.radius);i.set(n.vertices[3],-t.length*.5,t.radius)}function vt(n,t,u,f){for(var w,b,a,s=ui,h=fi,v=ei,y=oi,p=n,o=t.vertices,c=null,l=0;l!==o.length+1;l++){if(w=o[l%o.length],b=o[(l+1)%o.length],i.rotate(s,w,f),i.rotate(h,b,f),e(s,s,u),e(h,h,u),r(v,s,p),r(y,h,p),a=i.crossLength(v,y),c===null&&(c=a),a*c<=0)return!1;c=a}return!0}var i=n("../math/vec2"),r=i.sub,e=i.add,o=i.dot,ft=n("../utils/Utils"),pt=n("../utils/TupleDictionary"),b=n("../equations/Equation"),wt=n("../equations/ContactEquation"),bt=n("../equations/FrictionEquation"),kt=n("../shapes/Circle"),dt=n("../shapes/Convex"),f=n("../shapes/Shape"),lr=n("../objects/Body"),k=n("../shapes/Rectangle"),ht,ct,lt,at,yt;t.exports=u;var d=i.fromValues(0,1),s=i.fromValues(0,0),h=i.fromValues(0,0),c=i.fromValues(0,0),l=i.fromValues(0,0),a=i.fromValues(0,0),v=i.fromValues(0,0),y=i.fromValues(0,0),p=i.fromValues(0,0),w=i.fromValues(0,0),g=i.fromValues(0,0),nt=i.fromValues(0,0),tt=i.fromValues(0,0),it=i.fromValues(0,0),rt=i.fromValues(0,0),et=i.fromValues(0,0),ot=i.fromValues(0,0),gt=i.fromValues(0,0),ni=i.fromValues(0,0),st=[];ht=i.create();ct=i.create();u.prototype.bodiesOverlap=function(n,t){for(var i,s,e=ht,o=ct,r=0,h=n.shapes.length;r!==h;r++){var u=n.shapes[r],c=n.shapeOffsets[r],a=n.shapeAngles[r];for(n.toWorldFrame(e,c),i=0,s=t.shapes.length;i!==s;i++){var f=t.shapes[i],l=t.shapeOffsets[i],v=t.shapeAngles[i];if(t.toWorldFrame(o,l),this[u.type|f.type](n,u,e,u.angle+n.angle,t,f,o,f.angle+t.angle,!0))return!0}}return!1};u.prototype.collidedLastStep=function(n,t){var i=n.id|0,r=t.id|0;return!!this.collidingBodiesLastStep.get(i,r)};u.prototype.reset=function(){var n,t;for(this.collidingBodiesLastStep.reset(),n=this.contactEquations,t=n.length;t--;){var i=n[t],r=i.bodyA.id,u=i.bodyB.id;this.collidingBodiesLastStep.set(r,u,!0)}if(this.reuseObjects){var f=this.contactEquations,e=this.frictionEquations,o=this.reusableFrictionEquations,s=this.reusableContactEquations;ft.appendArray(s,f);ft.appendArray(o,e)}this.contactEquations.length=this.frictionEquations.length=0};u.prototype.createContactEquation=function(n,t,i,r){var u=this.reusableContactEquations.length?this.reusableContactEquations.pop():new wt(n,t);return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.restitution=this.restitution,u.firstImpact=!this.collidedLastStep(n,t),u.stiffness=this.stiffness,u.relaxation=this.relaxation,u.needsUpdate=!0,u.enabled=this.enabledEquations,u.offset=this.contactSkinSize,u};u.prototype.createFrictionEquation=function(n,t,i,r){var u=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new bt(n,t);return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.setSlipForce(this.slipForce),u.frictionCoefficient=this.frictionCoefficient,u.relativeVelocity=this.surfaceVelocity,u.enabled=this.enabledEquations,u.needsUpdate=!0,u.stiffness=this.frictionStiffness,u.relaxation=this.frictionRelaxation,u.contactEquations.length=0,u};u.prototype.createFrictionFromContact=function(n){var t=this.createFrictionEquation(n.bodyA,n.bodyB,n.shapeA,n.shapeB);return i.copy(t.contactPointA,n.contactPointA),i.copy(t.contactPointB,n.contactPointB),i.rotate90cw(t.t,n.normalA),t.contactEquations.push(n),t};u.prototype.createFrictionFromAverage=function(n){var r=this.contactEquations[this.contactEquations.length-1],t=this.createFrictionEquation(r.bodyA,r.bodyB,r.shapeA,r.shapeB),e=r.bodyA,o=r.bodyB,u,f;for(i.set(t.contactPointA,0,0),i.set(t.contactPointB,0,0),i.set(t.t,0,0),u=0;u!==n;u++)r=this.contactEquations[this.contactEquations.length-1-u],r.bodyA===e?(i.add(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointA),i.add(t.contactPointB,t.contactPointB,r.contactPointB)):(i.sub(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointB),i.add(t.contactPointB,t.contactPointB,r.contactPointA)),t.contactEquations.push(r);return f=1/n,i.scale(t.contactPointA,t.contactPointA,f),i.scale(t.contactPointB,t.contactPointB,f),i.normalize(t.t,t.t),i.rotate90cw(t.t,t.t),t};u.prototype[f.LINE|f.CONVEX]=u.prototype.convexLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.LINE|f.RECTANGLE]=u.prototype.lineRectangle=function(n,t,i,r,u,f,e,o,s){return s?!1:0};lt=new k(1,1);at=i.create();u.prototype[f.CAPSULE|f.CONVEX]=u.prototype[f.CAPSULE|f.RECTANGLE]=u.prototype.convexCapsule=function(n,t,r,u,f,e,o,s,h){var c=at,l,a,v,y;return(i.set(c,e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),l=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),i.set(c,-e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),a=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),h&&(l||a))?!0:(v=lt,ut(v,e),y=this.convexConvex(n,t,r,u,f,v,o,s,h),y+l+a)};u.prototype[f.CAPSULE|f.LINE]=u.prototype.lineCapsule=function(n,t,i,r,u,f,e,o,s){return s?!1:0};var ti=i.create(),ii=i.create(),ri=new k(1,1);u.prototype[f.CAPSULE|f.CAPSULE]=u.prototype.capsuleCapsule=function(n,t,r,u,f,e,o,s,h){for(var p,b,y,k,c,d,l=ti,a=ii,v=0,w=0;w<2;w++)for(i.set(l,(w===0?-1:1)*t.length/2,0),i.rotate(l,l,u),i.add(l,l,r),p=0;p<2;p++){if(i.set(a,(p===0?-1:1)*e.length/2,0),i.rotate(a,a,s),i.add(a,a,o),this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),b=this.circleCircle(n,t,l,u,f,e,a,s,h,t.radius,e.radius),this.enableFrictionReduction&&(this.enableFriction=c),h&&b)return!0;v+=b}return(this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),y=ri,ut(y,t),k=this.convexCapsule(n,y,r,u,f,e,o,s,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&k)?!0:(v+=k,this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),ut(y,e),d=this.convexCapsule(f,y,o,s,n,t,r,u,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&d)?!0:(v+=d,this.enableFrictionReduction&&v&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.LINE|f.LINE]=u.prototype.lineLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.PLANE|f.LINE]=u.prototype.planeLine=function(n,t,u,f,b,k,g,nt,tt){var rt=s,ut=h,ft=c,et=l,pt=a,wt=v,ot=y,ht=p,bt=w,ct=st,lt=0,at,vt,yt,it;for(i.set(rt,-k.length/2,0),i.set(ut,k.length/2,0),i.rotate(ft,rt,nt),i.rotate(et,ut,nt),e(ft,ft,g),e(et,et,g),i.copy(rt,ft),i.copy(ut,et),r(pt,ut,rt),i.normalize(wt,pt),i.rotate90cw(bt,wt),i.rotate(ht,d,f),ct[0]=rt,ct[1]=ut,at=0;at<ct.length;at++)if(vt=ct[at],r(ot,vt,u),yt=o(ot,ht),yt<0){if(tt)return!0;it=this.createContactEquation(n,b,t,k);lt++;i.copy(it.normalA,ht);i.normalize(it.normalA,it.normalA);i.scale(ot,ht,yt);r(it.contactPointA,vt,ot);r(it.contactPointA,it.contactPointA,n.position);r(it.contactPointB,vt,g);e(it.contactPointB,it.contactPointB,g);r(it.contactPointB,it.contactPointB,b.position);this.contactEquations.push(it);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(it))}return tt?!1:(this.enableFrictionReduction||lt&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(lt)),lt)};u.prototype[f.PARTICLE|f.CAPSULE]=u.prototype.particleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius,0)};u.prototype[f.CIRCLE|f.LINE]=u.prototype.circleLine=function(n,t,u,f,b,k,d,ut,ft,et,ot){var et=et||0,ot=typeof ot!="undefined"?ot:t.radius,ni=s,lt=h,vt=c,si=l,yt=a,ui=v,pt=y,ct=p,at=w,bt=g,kt=nt,wt=tt,fi=it,ei=rt,dt=st,ti,ii,gt,ri,ht;if(i.set(ct,-k.length/2,0),i.set(at,k.length/2,0),i.rotate(bt,ct,ut),i.rotate(kt,at,ut),e(bt,bt,d),e(kt,kt,d),i.copy(ct,bt),i.copy(at,kt),r(ui,at,ct),i.normalize(pt,ui),i.rotate90cw(yt,pt),r(wt,u,ct),ti=o(wt,yt),r(si,ct,d),r(fi,u,d),ii=ot+et,Math.abs(ti)<ii){i.scale(ni,yt,ti);r(vt,u,ni);i.scale(lt,yt,o(yt,fi));i.normalize(lt,lt);i.scale(lt,lt,et);e(vt,vt,lt);var oi=o(pt,vt),hi=o(pt,ct),ci=o(pt,at);if(oi>hi&&oi<ci)return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.scale(ht.normalA,ni,-1),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,ot),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,vt,d),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1)}for(dt[0]=ct,dt[1]=at,gt=0;gt<dt.length;gt++)if(ri=dt[gt],r(wt,ri,u),i.squaredLength(wt)<Math.pow(ii,2))return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.copy(ht.normalA,wt),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,ot),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,ri,d),i.scale(ei,ht.normalA,-et),e(ht.contactPointB,ht.contactPointB,ei),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1);return 0};u.prototype[f.CIRCLE|f.CAPSULE]=u.prototype.circleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius)};u.prototype[f.CIRCLE|f.CONVEX]=u.prototype[f.CIRCLE|f.RECTANGLE]=u.prototype.circleConvex=function(n,t,u,f,o,b,k,d,ut,ft){for(var fi,ei,kt,oi,st,ft=typeof ft=="number"?ft:t.radius,at=s,pt=h,gt=c,ni=l,wt=a,si=v,hi=y,ci=p,li=w,dt=g,yt=nt,ai=tt,bt=it,ct=rt,ti=et,ii=ot,ri=!1,ui=Number.MAX_VALUE,lt=b.vertices,ht=0;ht!==lt.length+1;ht++)fi=lt[ht%lt.length],ei=lt[(ht+1)%lt.length],i.rotate(at,fi,d),i.rotate(pt,ei,d),e(at,at,k),e(pt,pt,k),r(gt,pt,at),i.normalize(ni,gt),i.rotate90cw(wt,ni),i.scale(ct,wt,-t.radius),e(ct,ct,u),vt(ct,b,k,d)&&(i.sub(ti,at,ct),kt=Math.abs(i.dot(ti,wt)),kt<ui&&(i.copy(ii,ct),ui=kt,i.scale(bt,wt,kt),i.add(bt,bt,ct),ri=!0));if(ri)return ut?!0:(st=this.createContactEquation(n,o,t,b),i.sub(st.normalA,ii,u),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ft),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,bt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);if(ft>0)for(ht=0;ht<lt.length;ht++)if(oi=lt[ht],i.rotate(yt,oi,d),e(yt,yt,k),r(dt,yt,u),i.squaredLength(dt)<Math.pow(ft,2))return ut?!0:(st=this.createContactEquation(n,o,t,b),i.copy(st.normalA,dt),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ft),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,yt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);return 0};var ui=i.create(),fi=i.create(),ei=i.create(),oi=i.create();u.prototype[f.PARTICLE|f.CONVEX]=u.prototype[f.PARTICLE|f.RECTANGLE]=u.prototype.particleConvex=function(n,t,u,f,b,k,d,ut,ft){var ht=s,yt=h,bt=c,kt=l,ct=a,oi=v,si=y,li=p,ai=w,dt=g,vi=nt,yi=tt,pt=it,pi=rt,wi=et,bi=ot,ti=gt,ii=ni,ri=Number.MAX_VALUE,ui=!1,lt=k.vertices,hi,at,fi,ei,ci,wt,st;if(!vt(u,k,d,ut))return 0;if(ft)return!0;for(hi=null,at=0;at!==lt.length+1;at++)fi=lt[at%lt.length],ei=lt[(at+1)%lt.length],i.rotate(ht,fi,ut),i.rotate(yt,ei,ut),e(ht,ht,d),e(yt,yt,d),r(bt,yt,ht),i.normalize(kt,bt),i.rotate90cw(ct,kt),r(dt,u,ht),ci=o(dt,ct),r(oi,ht,d),r(si,u,d),i.sub(ti,ht,u),wt=Math.abs(i.dot(ti,ct)),wt<ri&&(ri=wt,i.scale(pt,ct,wt),i.add(pt,pt,u),i.copy(ii,ct),ui=!0);return ui?(st=this.createContactEquation(n,b,t,k),i.scale(st.normalA,ii,-1),i.normalize(st.normalA,st.normalA),i.set(st.contactPointA,0,0),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,pt,d),e(st.contactPointB,st.contactPointB,d),r(st.contactPointB,st.contactPointB,b.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1):0};u.prototype[f.CIRCLE]=u.prototype.circleCircle=function(n,t,u,f,o,h,c,l,a,v,y){var w=s,v=v||t.radius,y=y||h.radius,b,p;return(r(w,u,c),b=v+y,i.squaredLength(w)>Math.pow(b,2))?0:a?!0:(p=this.createContactEquation(n,o,t,h),r(p.normalA,c,u),i.normalize(p.normalA,p.normalA),i.scale(p.contactPointA,p.normalA,v),i.scale(p.contactPointB,p.normalA,-y),e(p.contactPointA,p.contactPointA,u),r(p.contactPointA,p.contactPointA,n.position),e(p.contactPointB,p.contactPointB,c),r(p.contactPointB,p.contactPointB,o.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1)};u.prototype[f.PLANE|f.CONVEX]=u.prototype[f.PLANE|f.RECTANGLE]=u.prototype.planeConvex=function(n,t,u,f,l,a,v,y,p){var b=s,tt=h,k=c,g=0,nt,it,w,rt;for(i.rotate(tt,d,f),nt=0;nt!==a.vertices.length;nt++)if(it=a.vertices[nt],i.rotate(b,it,y),e(b,b,v),r(k,b,u),o(k,tt)<=0){if(p)return!0;g++;w=this.createContactEquation(n,l,t,a);r(k,b,u);i.copy(w.normalA,tt);rt=o(k,w.normalA);i.scale(k,w.normalA,rt);r(w.contactPointB,b,l.position);r(w.contactPointA,b,k);r(w.contactPointA,w.contactPointA,n.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g};u.prototype[f.PARTICLE|f.PLANE]=u.prototype.particlePlane=function(n,t,u,f,e,c,l,a,v){var p=s,w=h,b,y;return(a=a||0,r(p,u,l),i.rotate(w,d,a),b=o(p,w),b>0)?0:v?!0:(y=this.createContactEquation(e,n,c,t),i.copy(y.normalA,w),i.scale(p,y.normalA,b),r(y.contactPointA,u,p),r(y.contactPointA,y.contactPointA,e.position),r(y.contactPointB,u,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1)};u.prototype[f.CIRCLE|f.PARTICLE]=u.prototype.circleParticle=function(n,t,u,f,o,h,c,l,a){var y=s,v;return(r(y,c,u),i.squaredLength(y)>Math.pow(t.radius,2))?0:a?!0:(v=this.createContactEquation(n,o,t,h),i.copy(v.normalA,y),i.normalize(v.normalA,v.normalA),i.scale(v.contactPointA,v.normalA,t.radius),e(v.contactPointA,v.contactPointA,u),r(v.contactPointA,v.contactPointA,n.position),r(v.contactPointB,c,o.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1)};var si=new kt(1),hi=i.create(),ci=i.create(),li=i.create();u.prototype[f.PLANE|f.CAPSULE]=u.prototype.planeCapsule=function(n,t,r,u,f,o,s,h,c){var l=hi,a=ci,y=si,k=li,b,p,w,v;return i.set(l,-o.length/2,0),i.rotate(l,l,h),e(l,l,s),i.set(a,o.length/2,0),i.rotate(a,a,h),e(a,a,s),y.radius=o.radius,this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1),p=this.circlePlane(f,y,l,0,n,t,r,u,c),w=this.circlePlane(f,y,a,0,n,t,r,u,c),this.enableFrictionReduction&&(this.enableFriction=b),c?p||w:(v=p+w,this.enableFrictionReduction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.CIRCLE|f.PLANE]=u.prototype.circlePlane=function(n,t,u,f,l,a,v,y,p){var tt=n,it=t,rt=u,ut=l,ot=a,ft=v,b=y,nt,w;b=b||0;var k=s,g=h,et=c;return(r(k,rt,ft),i.rotate(g,d,b),nt=o(g,k),nt>it.radius)?0:p?!0:(w=this.createContactEquation(ut,tt,a,t),i.copy(w.normalA,g),i.scale(w.contactPointB,w.normalA,-it.radius),e(w.contactPointB,w.contactPointB,rt),r(w.contactPointB,w.contactPointB,tt.position),i.scale(et,w.normalA,nt),r(w.contactPointA,k,et),e(w.contactPointA,w.contactPointA,ft),r(w.contactPointA,w.contactPointA,ut.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1)};u.prototype[f.CONVEX]=u.prototype[f.CONVEX|f.RECTANGLE]=u.prototype[f.RECTANGLE]=u.prototype.convexConvex=function(n,t,f,b,k,d,g,nt,tt,it){var at=s,ct=h,ft=c,ot=l,kt=a,yi=v,li=y,vt=p,dt=w,gt=0,it=typeof it=="number"?it:0,vi=u.findSeparatingAxis(t,f,b,d,g,nt,at),oi,si,ni,et,ui,ai,ci,lt,rt,fi,ei,bt;if(!vi||(r(vt,g,f),o(at,vt)>0&&i.scale(at,at,-1),oi=u.getClosestEdge(t,b,at,!0),si=u.getClosestEdge(d,nt,at),oi===-1||si===-1))return 0;for(ni=0;ni<2;ni++){var st=oi,ti=si,ut=t,yt=d,ht=f,wt=g,pt=b,hi=nt,ii=n,ri=k;for(ni===0&&(et=st,st=ti,ti=et,et=ut,ut=yt,yt=et,et=ht,ht=wt,wt=et,et=pt,pt=hi,hi=et,et=ii,ii=ri,ri=et),ui=ti;ui<ti+2;ui++){for(ai=yt.vertices[(ui+yt.vertices.length)%yt.vertices.length],i.rotate(ct,ai,hi),e(ct,ct,wt),ci=0,lt=st-1;lt<st+2;lt++)fi=ut.vertices[(lt+ut.vertices.length)%ut.vertices.length],ei=ut.vertices[(lt+1+ut.vertices.length)%ut.vertices.length],i.rotate(ft,fi,pt),i.rotate(ot,ei,pt),e(ft,ft,ht),e(ot,ot,ht),r(kt,ot,ft),i.rotate90cw(dt,kt),i.normalize(dt,dt),r(vt,ct,ft),bt=o(dt,vt),(lt===st&&bt<=it||lt!==st&&bt<=0)&&ci++;if(ci>=3){if(tt)return!0;rt=this.createContactEquation(ii,ri,ut,yt);gt++;fi=ut.vertices[st%ut.vertices.length];ei=ut.vertices[(st+1)%ut.vertices.length];i.rotate(ft,fi,pt);i.rotate(ot,ei,pt);e(ft,ft,ht);e(ot,ot,ht);r(kt,ot,ft);i.rotate90cw(rt.normalA,kt);i.normalize(rt.normalA,rt.normalA);r(vt,ct,ft);bt=o(rt.normalA,vt);i.scale(li,rt.normalA,bt);r(rt.contactPointA,ct,ht);r(rt.contactPointA,rt.contactPointA,li);e(rt.contactPointA,rt.contactPointA,ht);r(rt.contactPointA,rt.contactPointA,ii.position);r(rt.contactPointB,ct,wt);e(rt.contactPointB,rt.contactPointB,wt);r(rt.contactPointB,rt.contactPointB,ri.position);this.contactEquations.push(rt);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt))}}}return this.enableFrictionReduction&&this.enableFriction&&gt&&this.frictionEquations.push(this.createFrictionFromAverage(gt)),gt};yt=i.fromValues(0,0);u.projectConvexOntoAxis=function(n,t,r,u,f){var e=null,s=null,a,h,v=yt,c,y,l;for(i.rotate(v,u,-r),c=0;c<n.vertices.length;c++)a=n.vertices[c],h=o(a,v),(e===null||h>e)&&(e=h),(s===null||h<s)&&(s=h);s>e&&(y=s,s=e,e=y);l=o(t,u);i.set(f,s+l,e+l)};var ai=i.fromValues(0,0),vi=i.fromValues(0,0),yi=i.fromValues(0,0),pi=i.fromValues(0,0),wi=i.fromValues(0,0),bi=i.fromValues(0,0);u.findSeparatingAxis=function(n,t,f,e,o,s,h){var d=null,g=!1,it=!1,rt=ai,ut=vi,ft=yi,c=pi,a=wi,v=bi,y,p,w,l,b;if(n instanceof k&&e instanceof k)for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==2;l++){l===0?i.set(c,0,1):l===1&&i.set(c,1,0);w!==0&&i.rotate(c,c,w);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}else for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==p.vertices.length;l++){i.rotate(ut,p.vertices[l],w);i.rotate(ft,p.vertices[(l+1)%p.vertices.length],w);r(rt,ft,ut);i.rotate90cw(c,rt);i.normalize(c,c);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}return it};var ki=i.fromValues(0,0),di=i.fromValues(0,0),gi=i.fromValues(0,0);u.getClosestEdge=function(n,t,u,f){var s=ki,v=di,h=gi,e,a;i.rotate(s,u,-t);f&&i.scale(s,s,-1);var l=-1,c=n.vertices.length,y=-1;for(e=0;e!==c;e++)r(v,n.vertices[(e+1)%c],n.vertices[e%c]),i.rotate90cw(h,v),i.normalize(h,h),a=o(h,s),(l===-1||a>y)&&(l=e%c,y=a);return l};var nr=i.create(),tr=i.create(),ir=i.create(),rr=i.create(),ur=i.create(),fr=i.create(),er=i.create();u.prototype[f.CIRCLE|f.HEIGHTFIELD]=u.prototype.circleHeightfield=function(n,t,u,f,o,s,h,c,l,a){var p=s.data,a=a||t.radius,tt=s.elementWidth,k=tr,d=nr,ot=ur,st=er,b=fr,w=ir,it=rr,g=Math.floor((u[0]-a-h[0])/tt),nt=Math.ceil((u[0]+a-h[0])/tt),ut,ft,rt,et,y,v;for(g<0&&(g=0),nt>=p.length&&(nt=p.length-1),ut=p[g],ft=p[nt],y=g;y<nt;y++)p[y]<ft&&(ft=p[y]),p[y]>ut&&(ut=p[y]);if(u[1]-a>ut)return l?!1:0;for(rt=!1,y=g;y<nt;y++)if(i.set(w,y*tt,p[y]),i.set(it,(y+1)*tt,p[y+1]),i.add(w,w,h),i.add(it,it,h),i.sub(b,it,w),i.rotate(b,b,Math.PI/2),i.normalize(b,b),i.scale(d,b,-a),i.add(d,d,u),i.sub(k,d,w),et=i.dot(k,b),d[0]>=w[0]&&d[0]<it[0]&&et<=0){if(l)return!0;rt=!0;i.scale(k,b,-et);i.add(ot,d,k);i.copy(st,b);v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,st);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);i.copy(v.contactPointA,ot);i.sub(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}if(rt=!1,a>0)for(y=g;y<=nt;y++)if(i.set(w,y*tt,p[y]),i.add(w,w,h),i.sub(k,u,w),i.squaredLength(k)<Math.pow(a,2)){if(l)return!0;rt=!0;v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,k);i.normalize(v.normalA,v.normalA);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);r(v.contactPointA,w,h);e(v.contactPointA,v.contactPointA,h);r(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}return rt?1:0};var or=i.create(),sr=i.create(),hr=i.create(),cr=new dt([i.create(),i.create(),i.create(),i.create()]);u.prototype[f.RECTANGLE|f.HEIGHTFIELD]=u.prototype[f.CONVEX|f.HEIGHTFIELD]=u.prototype.convexHeightfield=function(n,t,r,u,f,e,o,s,h){var l=e.data,b=e.elementWidth,v=or,y=sr,k=hr,a=cr,p=Math.floor((n.aabb.lowerBound[0]-o[0])/b),w=Math.ceil((n.aabb.upperBound[0]-o[0])/b),d,nt,it,tt,c,g;for(p<0&&(p=0),w>=l.length&&(w=l.length-1),d=l[p],nt=l[w],c=p;c<w;c++)l[c]<nt&&(nt=l[c]),l[c]>d&&(d=l[c]);if(n.aabb.lowerBound[1]>d)return h?!1:0;for(it=!1,tt=0,c=p;c<w;c++)i.set(v,c*b,l[c]),i.set(y,(c+1)*b,l[c+1]),i.add(v,v,o),i.add(y,y,o),g=100,i.set(k,(y[0]+v[0])*.5,(y[1]+v[1]-g)*.5),i.sub(a.vertices[0],y,k),i.sub(a.vertices[1],v,k),i.copy(a.vertices[2],a.vertices[1]),i.copy(a.vertices[3],a.vertices[0]),a.vertices[2][1]-=g,a.vertices[3][1]-=g,tt+=this.convexConvex(n,t,r,u,f,a,k,0,h);return tt}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50}],12:[function(n,t){function r(n){n=n||{};this.from=n.from?i.fromValues(n.from[0],n.from[1]):i.create();this.to=n.to?i.fromValues(n.to[0],n.to[1]):i.create();this._direction=i.create();this.precision=.0001;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionMask=-1;this.collisionGroup=-1;this.mode=r.ANY;this.result=new e;this.hasHit=!1;this.callback=function(){}}function ft(n,t,r){var f;return i.sub(h,r,n),f=i.dot(h,t),i.scale(u,t,f),i.add(u,u,n),i.distance(r,u)}var s,f,c,l,h,u;t.exports=r;var i=n("../math/vec2"),e=n("../collision/RaycastResult"),o=n("../shapes/Shape"),a=n("../collision/AABB");r.prototype.constructor=r;r.CLOSEST=1;r.ANY=2;r.ALL=4;s=new a;f=[];r.prototype.intersectWorld=function(n,t){return this.mode=t.mode||r.ANY,this.result=t.result||new e,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=typeof t.collisionMask!="undefined"?t.collisionMask:-1,this.collisionGroup=typeof t.collisionGroup!="undefined"?t.collisionGroup:-1,t.from&&i.copy(this.from,t.from),t.to&&i.copy(this.to,t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(s),f.length=0,n.broadphase.aabbQuery(n,s,f),this.intersectBodies(f),this.hasHit};var et=i.create(),ot=i.create(),v=i.create();r.prototype.intersectBody=function(n,t){var f,r,u,o,e,s;if(t&&(this.result=t,this._updateDirection()),f=this.checkCollisionResponse,!f||n.collisionResponse)for(r=v,u=0,o=n.shapes.length;u<o;u++)if((e=n.shapes[u],!f||e.collisionResponse)&&(i.copy(r,n.shapeOffsets[u]),i.rotate(r,r,n.angle),i.add(r,r,n.position),s=n.shapeAngles[u]+n.angle,this.intersectShape(e,s,r,n),this.result._shouldStop))break};r.prototype.intersectBodies=function(n,t){t&&(this.result=t,this._updateDirection());for(var i=0,r=n.length;!this.result._shouldStop&&i<r;i++)this.intersectBody(n[i])};r.prototype._updateDirection=function(){var n=this._direction;i.sub(n,this.to,this.from);i.normalize(n,n)};r.prototype.intersectShape=function(n,t,i,r){var f=this.from,e=ft(f,this._direction,i),u;e>n.boundingSphereRadius||(u=this[n.type],u&&u.call(this,n,t,i,r))};var st=i.create(),ht=i.create(),ct=i.create(),lt=i.create(),at=i.create(),vt=i.create(),yt=i.create(),pt=new e,y=i.create(),p=i.create(),w=i.create(),b=i.create(),k=i.create(),d=i.create(),g=i.create();r.prototype.intersectRectangle=function(n,t,r,u){var f=-Number.MAX_VALUE,e=Number.MAX_VALUE,o=y,s=p,c=w,l=b,h=k,rt=d,ut=g,nt;if(i.set(rt,-n.width*.5,-n.height*.5),i.set(ut,n.width*.5,n.height*.5),i.rotate(o,this._direction,-t),u.toLocalFrame(s,this.from),o[0]!==0){var a=(rt[0]-s[0])/o[0],v=(ut[0]-s[0])/o[0],ft=f;f=Math.max(f,Math.min(a,v));f!==ft&&i.set(c,a>v?1:-1,0);nt=e;e=Math.min(e,Math.max(a,v));e!==nt&&i.set(l,a<v?1:-1,0)}if(o[1]!==0){var tt=(rt[1]-s[1])/o[1],it=(ut[1]-s[1])/o[1],ft=f;f=Math.max(f,Math.min(tt,it));f!==ft&&i.set(c,0,tt>it?1:-1);nt=e;e=Math.min(e,Math.max(tt,it));e!==nt&&i.set(l,0,tt<it?1:-1)}if(e>=f){if(i.set(h,s[0]+o[0]*f,s[1]+o[1]*f),i.rotate(c,c,t),u.toWorldFrame(h,h),this.reportIntersection(c,h,n,u,-1),this._shouldStop)return;i.rotate(l,l,t);i.set(h,s[0]+o[0]*e,s[1]+o[1]*e);u.toWorldFrame(h,h);this.reportIntersection(l,h,n,u,-1)}};r.prototype[o.RECTANGLE]=r.prototype.intersectRectangle;var nt=i.create(),tt=i.create(),it=i.create(),rt=i.create(),ut=i.create();r.prototype.intersectPlane=function(n,t,r,u){var e=this.from,h=this.to,c=this._direction,l=nt,a=tt,v=it,f=rt,o=ut,s,y,p,w;(i.set(f,0,1),i.rotate(f,f,t),i.sub(o,e,r),s=i.dot(o,f),i.sub(o,h,r),y=i.dot(o,f),s*y>0)||i.distance(e,h)<s||(p=i.dot(f,c),i.sub(l,e,r),w=-i.dot(f,l)/p,i.scale(a,c,w),i.add(v,e,a),this.reportIntersection(f,v,n,u,-1))};r.prototype[o.PLANE]=r.prototype.intersectPlane;c=i.create();l=i.create();r.prototype.intersectCircle=function(n,t,r,u){var e=this.from,s=this.to,w=n.radius,a=Math.pow(s[0]-e[0],2)+Math.pow(s[1]-e[1],2),v=2*((s[0]-e[0])*(e[0]-r[0])+(s[1]-e[1])*(e[1]-r[1])),b=Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)-Math.pow(w,2),h=Math.pow(v,2)-4*a*b,o=c,f=l,y,p;if(!(h<0))if(h===0)i.lerp(o,e,s,h),i.sub(f,o,r),i.normalize(f,f),this.reportIntersection(f,o,n,u,-1);else{if(y=(-v-Math.sqrt(h))/(2*a),p=(-v+Math.sqrt(h))/(2*a),i.lerp(o,e,s,y),i.sub(f,o,r),i.normalize(f,f),this.reportIntersection(f,o,n,u,-1),this.result._shouldStop)return;i.lerp(o,e,s,p);i.sub(f,o,r);i.normalize(f,f);this.reportIntersection(f,o,n,u,-1)}};r.prototype[o.CIRCLE]=r.prototype.intersectCircle;r.prototype.getAABB=function(n){var t=this.to,i=this.from;n.lowerBound[0]=Math.min(t[0],i[0]);n.lowerBound[1]=Math.min(t[1],i[1]);n.upperBound[0]=Math.max(t[0],i[0]);n.upperBound[1]=Math.max(t[1],i[1])};r.prototype.reportIntersection=function(n,t,u,f,e){var s=this.from,c=this.to,h=i.distance(s,t),o=this.result;if(!this.skipBackfaces||!(i.dot(n,this._direction)>0)){o.hitFaceIndex=typeof e!="undefined"?e:-1;switch(this.mode){case r.ALL:this.hasHit=!0;o.set(s,c,n,t,u,f,h);o.hasHit=!0;this.callback(o);break;case r.CLOSEST:(h<o.distance||!o.hasHit)&&(this.hasHit=!0,o.hasHit=!0,o.set(s,c,n,t,u,f,h));break;case r.ANY:this.hasHit=!0;o.hasHit=!0;o.set(s,c,n,t,u,f,h);o._shouldStop=!0}}};h=i.create();u=i.create()},{"../collision/AABB":7,"../collision/RaycastResult":13,"../math/vec2":31,"../shapes/Shape":45}],13:[function(n,t){function r(){this.rayFromWorld=i.create();this.rayToWorld=i.create();this.hitNormalWorld=i.create();this.hitPointWorld=i.create();this.hasHit=!1;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=!1}var i=n("../math/vec2");t.exports=r;r.prototype.reset=function(){i.set(this.rayFromWorld,0,0);i.set(this.rayToWorld,0,0);i.set(this.hitNormalWorld,0,0);i.set(this.hitPointWorld,0,0);this.hasHit=!1;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=!1};r.prototype.abort=function(){this._shouldStop=!0};r.prototype.set=function(n,t,r,u,f,e,o){i.copy(this.rayFromWorld,n);i.copy(this.rayToWorld,t);i.copy(this.hitNormalWorld,r);i.copy(this.hitPointWorld,u);this.shape=f;this.body=e;this.distance=o}},{"../math/vec2":31}],14:[function(n,t){function i(){r.call(this,r.SAP);this.axisList=[];this.axisIndex=0;var n=this;this._addBodyHandler=function(t){n.axisList.push(t.body)};this._removeBodyHandler=function(t){var i=n.axisList.indexOf(t.body);i!==-1&&n.axisList.splice(i,1)}}var u=n("../utils/Utils"),r=n("../collision/Broadphase");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.setWorld=function(n){this.axisList.length=0;u.appendArray(this.axisList,n.bodies);n.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);n.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=n};i.sortAxisList=function(n,t){var r,f,u,i;for(t=t|0,r=1,f=n.length;r<f;r++){for(u=n[r],i=r-1;i>=0;i--){if(n[i].aabb.lowerBound[t]<=u.aabb.lowerBound[t])break;n[i+1]=n[i]}n[i+1]=u}return n};i.prototype.sortList=function(){var n=this.axisList,t=this.axisIndex;i.sortAxisList(n,t)};i.prototype.getCollisionPairs=function(){var n=this.axisList,e=this.result,c=this.axisIndex,o,s,t,h,i,f,u,l;for(e.length=0,o=n.length;o--;)s=n[o],s.aabbNeedsUpdate&&s.updateAABB();for(this.sortList(),t=0,h=n.length|0;t!==h;t++)for(i=n[t],f=t+1;f<h;f++){if(u=n[f],l=u.aabb.lowerBound[c]<=i.aabb.upperBound[c],!l)break;r.canCollide(i,u)&&this.boundingVolumeCheck(i,u)&&e.push(i,u)}return e};i.prototype.aabbQuery=function(n,t,i){var e,r,f,u;i=i||[];this.sortList();e=this.axisIndex;r="x";e===1&&(r="y");e===2&&(r="z");var o=this.axisList,s=t.lowerBound[r],h=t.upperBound[r];for(f=0;f<o.length;f++)u=o[f],u.aabbNeedsUpdate&&u.updateAABB(),u.aabb.overlaps(t)&&i.push(u);return i}},{"../collision/Broadphase":8,"../utils/Utils":50}],15:[function(n,t){function i(n,t,i,u){this.type=i;u=r.defaults(u,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=n;this.bodyB=t;this.collideConnected=u.collideConnected;u.wakeUpBodies&&(n&&n.wakeUp(),t&&t.wakeUp())}t.exports=i;var r=n("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!");};i.DISTANCE=1;i.GEAR=2;i.LOCK=3;i.PRISMATIC=4;i.REVOLUTE=5;i.prototype.setStiffness=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.stiffness=n,i.needsUpdate=!0};i.prototype.setRelaxation=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.relaxation=n,i.needsUpdate=!0}},{"../utils/Utils":50}],16:[function(n,t){function u(n,t,r){var o,c,e,l;if(r=h.defaults(r,{localAnchorA:[0,0],localAnchorB:[0,0]}),f.call(this,n,t,f.DISTANCE,r),this.localAnchorA=i.fromValues(r.localAnchorA[0],r.localAnchorA[1]),this.localAnchorB=i.fromValues(r.localAnchorB[0],r.localAnchorB[1]),o=this.localAnchorA,c=this.localAnchorB,this.distance=0,typeof r.distance=="number")this.distance=r.distance;else{var a=i.create(),v=i.create(),u=i.create();i.rotate(a,o,n.angle);i.rotate(v,c,t.angle);i.add(u,t.position,v);i.sub(u,u,a);i.sub(u,u,n.position);this.distance=i.length(u)}e=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce;l=new s(n,t,-e,e);this.equations=[l];this.maxForce=e;var u=i.create(),y=i.create(),p=i.create(),w=this;l.computeGq=function(){var n=this.bodyA,t=this.bodyB,r=n.position,f=t.position;return i.rotate(y,o,n.angle),i.rotate(p,c,t.angle),i.add(u,f,p),i.sub(u,u,y),i.sub(u,u,r),i.length(u)-w.distance};this.setMaxForce(e);this.upperLimitEnabled=!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.lowerLimit=0;this.position=0}var f=n("./Constraint"),s=n("../equations/Equation"),i=n("../math/vec2"),h=n("../utils/Utils");t.exports=u;u.prototype=new f;u.prototype.constructor=u;var r=i.create(),e=i.create(),o=i.create();u.prototype.update=function(){var l=this.equations[0],f=this.bodyA,s=this.bodyB,y=this.distance,a=f.position,v=s.position,n=this.equations[0],t=l.G,u,h,c;if(i.rotate(e,this.localAnchorA,f.angle),i.rotate(o,this.localAnchorB,s.angle),i.add(r,v,o),i.sub(r,r,e),i.sub(r,r,a),this.position=i.length(r),u=!1,this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u){n.enabled=!1;return}n.enabled=!0;i.normalize(r,r);h=i.crossLength(e,r);c=i.crossLength(o,r);t[0]=-r[0];t[1]=-r[1];t[2]=-h;t[3]=r[0];t[4]=r[1];t[5]=c};u.prototype.setMaxForce=function(n){var t=this.equations[0];t.minForce=-n;t.maxForce=n};u.prototype.getMaxForce=function(){var n=this.equations[0];return n.maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15}],17:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,r.GEAR,i);this.ratio=typeof i.ratio=="number"?i.ratio:1;this.angle=typeof i.angle=="number"?i.angle:t.angle-this.ratio*n.angle;i.angle=this.angle;i.ratio=this.ratio;this.equations=[new u(n,t,i),];typeof i.maxTorque=="number"&&this.setMaxTorque(i.maxTorque)}var r=n("./Constraint"),f=n("../equations/Equation"),u=n("../equations/AngleLockEquation"),e=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.update=function(){var n=this.equations[0];n.ratio!==this.ratio&&n.setRatio(this.ratio);n.angle=this.angle};i.prototype.setMaxTorque=function(n){this.equations[0].setMaxTorque(n)};i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],18:[function(n,t){function u(n,t,r){var s,h;r=r||{};e.call(this,n,t,e.LOCK,r);var f=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce,p=r.localAngleB||0,a=new o(n,t,-f,f),v=new o(n,t,-f,f),y=new o(n,t,-f,f),c=i.create(),u=i.create(),l=this;a.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[0]};v.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[1]};s=i.create();h=i.create();y.computeGq=function(){return i.rotate(s,l.localOffsetB,t.angle-l.localAngleB),i.scale(s,s,-1),i.sub(u,n.position,t.position),i.add(u,u,s),i.rotate(h,s,-Math.PI/2),i.normalize(h,h),i.dot(u,h)};this.localOffsetB=i.create();r.localOffsetB?i.copy(this.localOffsetB,r.localOffsetB):(i.sub(this.localOffsetB,t.position,n.position),i.rotate(this.localOffsetB,this.localOffsetB,-n.angle));this.localAngleB=0;this.localAngleB=typeof r.localAngleB=="number"?r.localAngleB:t.angle-n.angle;this.equations.push(a,v,y);this.setMaxForce(f)}var e=n("./Constraint"),i=n("../math/vec2"),o=n("../equations/Equation");t.exports=u;u.prototype=new e;u.prototype.constructor=u;u.prototype.setMaxForce=function(n){for(var i=this.equations,t=0;t<this.equations.length;t++)i[t].maxForce=n,i[t].minForce=-n};u.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=i.create(),f=i.create(),r=i.create(),h=i.fromValues(1,0),c=i.fromValues(0,1);u.prototype.update=function(){var t=this.equations[0],u=this.equations[1],n=this.equations[2],e=this.bodyA,o=this.bodyB;i.rotate(s,this.localOffsetB,e.angle);i.rotate(f,this.localOffsetB,o.angle-this.localAngleB);i.scale(f,f,-1);i.rotate(r,f,Math.PI/2);i.normalize(r,r);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(s,h);t.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-i.crossLength(s,c);u.G[4]=1;n.G[0]=-r[0];n.G[1]=-r[1];n.G[3]=r[0];n.G[4]=r[1];n.G[5]=i.crossLength(f,r)}},{"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],19:[function(n,t){function u(n,t,r){var k;r=r||{};s.call(this,n,t,s.PRISMATIC,r);var o=i.fromValues(0,0),h=i.fromValues(1,0),c=i.fromValues(0,0);r.localAnchorA&&i.copy(o,r.localAnchorA);r.localAxisA&&i.copy(h,r.localAxisA);r.localAnchorB&&i.copy(c,r.localAnchorB);this.localAnchorA=o;this.localAnchorB=c;this.localAxisA=h;var e=this.maxForce=typeof r.maxForce!="undefined"?r.maxForce:Number.MAX_VALUE,y=new a(n,t,-e,e),p=new i.create,w=new i.create,f=new i.create,u=new i.create;y.computeGq=function(){return i.dot(f,u)};y.updateJacobian=function(){var r=this.G,e=n.position,s=t.position;i.rotate(p,o,n.angle);i.rotate(w,c,t.angle);i.add(f,s,w);i.sub(f,f,e);i.sub(f,f,p);i.rotate(u,h,n.angle+Math.PI/2);r[0]=-u[0];r[1]=-u[1];r[2]=-i.crossLength(p,u)+i.crossLength(u,f);r[3]=u[0];r[4]=u[1];r[5]=i.crossLength(w,u)};this.equations.push(y);r.disableRotationalLock||(k=new v(n,t,-e,e),this.equations.push(k));this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof r.lowerLimit!="undefined"?!0:!1;this.upperLimitEnabled=typeof r.upperLimit!="undefined"?!0:!1;this.lowerLimit=typeof r.lowerLimit!="undefined"?r.lowerLimit:0;this.upperLimit=typeof r.upperLimit!="undefined"?r.upperLimit:1;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.motorSpeed=0;var d=this,b=this.motorEquation,g=b.computeGW;b.computeGq=function(){return 0};b.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+d.motorSpeed}}var s=n("./Constraint"),l=n("../equations/ContactEquation"),a=n("../equations/Equation"),i=n("../math/vec2"),v=n("../equations/RotationalLockEquation");t.exports=u;u.prototype=new s;u.prototype.constructor=u;var r=i.create(),f=i.create(),e=i.create(),h=i.create(),c=i.create(),o=i.create();u.prototype.update=function(){var n=this.equations,b=n[0],p=this.upperLimit,w=this.lowerLimit,t=this.upperLimitEquation,u=this.lowerLimitEquation,a=this.bodyA,v=this.bodyB,k=this.localAxisA,d=this.localAnchorA,g=this.localAnchorB,y,s,l;b.updateJacobian();i.rotate(r,k,a.angle);i.rotate(h,d,a.angle);i.add(f,h,a.position);i.rotate(c,g,v.angle);i.add(e,c,v.position);y=this.position=i.dot(e,r)-i.dot(f,r);this.motorEnabled&&(s=this.motorEquation.G,s[0]=r[0],s[1]=r[1],s[2]=i.crossLength(r,c),s[3]=-r[0],s[4]=-r[1],s[5]=-i.crossLength(r,h));this.upperLimitEnabled&&y>p?(i.scale(t.normalA,r,-1),i.sub(t.contactPointA,f,a.position),i.sub(t.contactPointB,e,v.position),i.scale(o,r,p),i.add(t.contactPointA,t.contactPointA,o),n.indexOf(t)===-1&&n.push(t)):(l=n.indexOf(t),l!==-1&&n.splice(l,1));this.lowerLimitEnabled&&y<w?(i.scale(u.normalA,r,1),i.sub(u.contactPointA,f,a.position),i.sub(u.contactPointB,e,v.position),i.scale(o,r,w),i.sub(u.contactPointB,u.contactPointB,o),n.indexOf(u)===-1&&n.push(u)):(l=n.indexOf(u),l!==-1&&n.splice(l,1))};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15}],20:[function(n,t){function u(n,t,u){var v;u=u||{};o.call(this,n,t,o.REVOLUTE,u);v=this.maxForce=typeof u.maxForce!="undefined"?u.maxForce:Number.MAX_VALUE;this.pivotA=i.create();this.pivotB=i.create();u.worldPivot?(i.sub(this.pivotA,u.worldPivot,n.position),i.sub(this.pivotB,u.worldPivot,t.position),i.rotate(this.pivotA,this.pivotA,-n.angle),i.rotate(this.pivotB,this.pivotB,-t.angle)):(i.copy(this.pivotA,u.localPivotA),i.copy(this.pivotB,u.localPivotB));var b=this.equations=[new c(n,t,-v,v),new c(n,t,-v,v),],p=b[0],w=b[1],y=this;p.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,s)};w.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,h)};w.minForce=p.minForce=-v;w.maxForce=p.maxForce=v;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.angle=0;this.lowerLimitEnabled=!1;this.upperLimitEnabled=!1;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var o=n("./Constraint"),c=n("../equations/Equation"),a=n("../equations/RotationalVelocityEquation"),l=n("../equations/RotationalLockEquation"),i=n("../math/vec2");t.exports=u;var f=i.create(),e=i.create(),s=i.fromValues(1,0),h=i.fromValues(0,1),r=i.create();u.prototype=new o;u.prototype.constructor=u;u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)};u.prototype.update=function(){var l=this.bodyA,a=this.bodyB,w=this.pivotA,b=this.pivotB,n=this.equations,k=n[0],d=n[1],t=n[0],r=n[1],v=this.upperLimit,y=this.lowerLimit,o=this.upperLimitEquation,c=this.lowerLimitEquation,p=this.angle=a.angle-l.angle,u;this.upperLimitEnabled&&p>v?(o.angle=v,n.indexOf(o)===-1&&n.push(o)):(u=n.indexOf(o),u!==-1&&n.splice(u,1));this.lowerLimitEnabled&&p<y?(c.angle=y,n.indexOf(c)===-1&&n.push(c)):(u=n.indexOf(c),u!==-1&&n.splice(u,1));i.rotate(f,w,l.angle);i.rotate(e,b,a.angle);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(f,s);t.G[3]=1;t.G[4]=0;t.G[5]=i.crossLength(e,s);r.G[0]=0;r.G[1]=-1;r.G[2]=-i.crossLength(f,h);r.G[3]=0;r.G[4]=1;r.G[5]=i.crossLength(e,h)};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.motorIsEnabled=function(){return!!this.motorEnabled};u.prototype.setMotorSpeed=function(n){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=n}};u.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15}],21:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;this.ratio=typeof i.ratio=="number"?i.ratio:1;this.setRatio(this.ratio)}var r=n("./Equation"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};i.prototype.setRatio=function(n){var t=this.G;t[2]=n;t[5]=-1;this.ratio=n};i.prototype.setMaxTorque=function(n){this.maxForce=n;this.minForce=-n}},{"../math/vec2":31,"./Equation":23}],22:[function(n,t){function r(n,t){u.call(this,n,t,0,Number.MAX_VALUE);this.contactPointA=i.create();this.penetrationVec=i.create();this.contactPointB=i.create();this.normalA=i.create();this.restitution=0;this.firstImpact=!1;this.shapeA=null;this.shapeB=null}var u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeB=function(n,t,r){var v=this.bodyA,y=this.bodyB,h=this.contactPointA,c=this.contactPointB,p=v.position,w=y.position,f=this.penetrationVec,u=this.normalA,e=this.G,b=i.crossLength(h,u),k=i.crossLength(c,u),o,s,l,a;return e[0]=-u[0],e[1]=-u[1],e[2]=-b,e[3]=u[0],e[4]=u[1],e[5]=k,i.add(f,w,c),i.sub(f,f,p),i.sub(f,f,h),this.firstImpact&&this.restitution!==0?(s=0,o=1/t*(1+this.restitution)*this.computeGW()):(s=i.dot(u,f)+this.offset,o=this.computeGW()),l=this.computeGiMf(),a=-s*n-o*t-r*l,a}},{"../math/vec2":31,"./Equation":23}],23:[function(n,t){function i(n,t,r,u){this.minForce=typeof r=="undefined"?-Number.MAX_VALUE:r;this.maxForce=typeof u=="undefined"?Number.MAX_VALUE:u;this.bodyA=n;this.bodyB=t;this.stiffness=i.DEFAULT_STIFFNESS;this.relaxation=i.DEFAULT_RELAXATION;this.G=new s.ARRAY_TYPE(6);for(var f=0;f<6;f++)this.G[f]=0;this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=!0;this.multiplier=0;this.relativeVelocity=0;this.enabled=!0}var e,o,u,f;t.exports=i;var r=n("../math/vec2"),s=n("../utils/Utils"),p=n("../objects/Body");i.prototype.constructor=i;i.DEFAULT_STIFFNESS=1e6;i.DEFAULT_RELAXATION=4;i.prototype.update=function(){var i=this.stiffness,n=this.relaxation,t=this.timeStep;this.a=4/(t*(1+4*n));this.b=4*n/(1+4*n);this.epsilon=4/(t*t*i*(1+4*n));this.needsUpdate=!1};i.prototype.gmult=function(n,t,i,r,u){return n[0]*t[0]+n[1]*t[1]+n[2]*i+n[3]*r[0]+n[4]*r[1]+n[5]*u};i.prototype.computeB=function(n,t,i){var r=this.computeGW(),u=this.computeGq(),f=this.computeGiMf();return-u*n-r*t-f*i};e=r.create();o=r.create();i.prototype.computeGq=function(){var i=this.G,n=this.bodyA,t=this.bodyB,f=n.position,s=t.position,r=n.angle,u=t.angle;return this.gmult(i,e,r,o,u)+this.offset};i.prototype.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+this.relativeVelocity};i.prototype.computeGWlambda=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.vlambda,u=t.vlambda,f=n.wlambda,e=t.wlambda;return this.gmult(i,r,f,u,e)};u=r.create();f=r.create();i.prototype.computeGiMf=function(){var n=this.bodyA,t=this.bodyB,i=n.force,e=n.angularForce,o=t.force,s=t.angularForce,h=n.invMassSolve,c=t.invMassSolve,l=n.invInertiaSolve,a=t.invInertiaSolve,v=this.G;return r.scale(u,i,h),r.scale(f,o,c),this.gmult(v,u,e*l,f,s*a)};i.prototype.computeGiMGt=function(){var t=this.bodyA,i=this.bodyB,r=t.invMassSolve,u=i.invMassSolve,f=t.invInertiaSolve,e=i.invInertiaSolve,n=this.G;return n[0]*n[0]*r+n[1]*n[1]*r+n[2]*n[2]*f+n[3]*n[3]*u+n[4]*n[4]*u+n[5]*n[5]*e};var h=r.create(),c=r.create(),l=r.create(),a=r.create(),v=r.create(),y=r.create();i.prototype.addToWlambda=function(n){var i=this.bodyA,u=this.bodyB,f=h,e=c,o=l,k=a,d=v,s=i.invMassSolve,p=u.invMassSolve,w=i.invInertiaSolve,b=u.invInertiaSolve,g=y,t=this.G;e[0]=t[0];e[1]=t[1];o[0]=t[3];o[1]=t[4];r.scale(f,e,s*n);r.add(i.vlambda,i.vlambda,f);i.wlambda+=w*t[2]*n;r.scale(f,o,p*n);r.add(u.vlambda,u.vlambda,f);u.wlambda+=b*t[5]*n};i.prototype.computeInvC=function(n){return 1/(this.computeGiMGt()+n)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50}],24:[function(n,t){function i(n,t,i){u.call(this,n,t,-i,i);this.contactPointA=r.create();this.contactPointB=r.create();this.t=r.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}var r=n("../math/vec2"),u=n("./Equation"),f=n("../utils/Utils");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.setSlipForce=function(n){this.maxForce=n;this.minForce=-n};i.prototype.getSlipForce=function(){return this.maxForce};i.prototype.computeB=function(n,t,i){var c=this.bodyA,l=this.bodyB,e=this.contactPointA,o=this.contactPointB,u=this.t,f=this.G;f[0]=-u[0];f[1]=-u[1];f[2]=-r.crossLength(e,u);f[3]=u[0];f[4]=u[1];f[5]=r.crossLength(o,u);var s=this.computeGW(),h=this.computeGiMf();return-s*t-i*h}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23}],25:[function(n,t){function r(n,t,i){i=i||{};u.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;var r=this.G;r[2]=1;r[5]=-1}var u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;var f=i.create(),e=i.create(),o=i.fromValues(1,0),s=i.fromValues(0,1);r.prototype.computeGq=function(){return i.rotate(f,o,this.bodyA.angle+this.angle),i.rotate(e,s,this.bodyB.angle),i.dot(f,e)}},{"../math/vec2":31,"./Equation":23}],26:[function(n,t){function i(n,t){r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}var r=n("./Equation"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeB=function(n,t,i){var r=this.G;r[2]=-1;r[5]=this.ratio;var u=this.computeGiMf(),f=this.computeGW();return-f*t-i*u}},{"../math/vec2":31,"./Equation":23}],27:[function(n,t){var i=function(){};t.exports=i;i.prototype={constructor:i,on:function(n,t,i){t.context=i||this;this._listeners===undefined&&(this._listeners={});var r=this._listeners;return r[n]===undefined&&(r[n]=[]),r[n].indexOf(t)===-1&&r[n].push(t),this},has:function(n,t){if(this._listeners===undefined)return!1;var i=this._listeners;if(t){if(i[n]!==undefined&&i[n].indexOf(t)!==-1)return!0}else if(i[n]!==undefined)return!0;return!1},off:function(n,t){if(this._listeners===undefined)return this;var i=this._listeners,r=i[n].indexOf(t);return r!==-1&&i[n].splice(r,1),this},emit:function(n){var u,t,i,f,r;if(this._listeners===undefined)return this;if(u=this._listeners,t=u[n.type],t!==undefined)for(n.target=this,i=0,f=t.length;i<f;i++)r=t[i],r.call(r.context,n);return this}}},{}],28:[function(n,t){function r(n,t,f){if(f=f||{},!(n instanceof u)||!(t instanceof u))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++;this.materialA=n;this.materialB=t;this.friction=typeof f.friction!="undefined"?Number(f.friction):.3;this.restitution=typeof f.restitution!="undefined"?Number(f.restitution):0;this.stiffness=typeof f.stiffness!="undefined"?Number(f.stiffness):i.DEFAULT_STIFFNESS;this.relaxation=typeof f.relaxation!="undefined"?Number(f.relaxation):i.DEFAULT_RELAXATION;this.frictionStiffness=typeof f.frictionStiffness!="undefined"?Number(f.frictionStiffness):i.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof f.frictionRelaxation!="undefined"?Number(f.frictionRelaxation):i.DEFAULT_RELAXATION;this.surfaceVelocity=typeof f.surfaceVelocity!="undefined"?Number(f.surfaceVelocity):0;this.contactSkinSize=.005}var u=n("./Material"),i=n("../equations/Equation");t.exports=r;r.idCounter=0},{"../equations/Equation":23,"./Material":29}],29:[function(n,t){function i(n){this.id=n||i.idCounter++}t.exports=i;i.idCounter=0},{}],30:[function(n,t){var i={};i.GetArea=function(n){var i,r,t;if(n.length<6)return 0;for(i=n.length-2,r=0,t=0;t<i;t+=2)r+=(n[t+2]-n[t])*(n[t+1]+n[t+3]);return r+=(n[0]-n[i])*(n[i+1]+n[1]),-r*.5};i.Triangulate=function(n){var l=n.length>>1,e,r,t,u,c,f;if(l<3)return[];for(e=[],r=[],t=0;t<l;t++)r.push(t);for(t=0,u=l;u>3;){var o=r[(t+0)%u],s=r[(t+1)%u],h=r[(t+2)%u],v=n[2*o],y=n[2*o+1],p=n[2*s],w=n[2*s+1],b=n[2*h],k=n[2*h+1],a=!1;if(i._convex(v,y,p,w,b,k))for(a=!0,c=0;c<u;c++)if((f=r[c],f!=o&&f!=s&&f!=h)&&i._PointInTriangle(n[2*f],n[2*f+1],v,y,p,w,b,k)){a=!1;break}if(a)e.push(o,s,h),r.splice((t+1)%u,1),u--,t=0;else if(t++>3*u)break}return e.push(r[0],r[1],r[2]),e};i._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1};i._convex=function(n,t,i,r,u,f){return(t-r)*(u-i)+(i-n)*(f-r)>=0};t.exports=i},{}],31:[function(n,t){var i=t.exports={},r=n("../utils/Utils");i.crossLength=function(n,t){return n[0]*t[1]-n[1]*t[0]};i.crossVZ=function(n,t,r){return i.rotate(n,t,-Math.PI/2),i.scale(n,n,r),n};i.crossZV=function(n,t,r){return i.rotate(n,r,Math.PI/2),i.scale(n,n,t),n};i.rotate=function(n,t,i){if(i!==0){var r=Math.cos(i),u=Math.sin(i),f=t[0],e=t[1];n[0]=r*f-u*e;n[1]=u*f+r*e}else n[0]=t[0],n[1]=t[1]};i.rotate90cw=function(n,t){var i=t[0],r=t[1];n[0]=r;n[1]=-i};i.toLocalFrame=function(n,t,r,u){i.copy(n,t);i.sub(n,n,r);i.rotate(n,n,-u)};i.toGlobalFrame=function(n,t,r,u){i.copy(n,t);i.rotate(n,n,u);i.add(n,n,r)};i.centroid=function(n,t,r,u){return i.add(n,t,r),i.add(n,n,u),i.scale(n,n,1/3),n};i.create=function(){var n=new r.ARRAY_TYPE(2);return n[0]=0,n[1]=0,n};i.clone=function(n){var t=new r.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t};i.fromValues=function(n,t){var i=new r.ARRAY_TYPE(2);return i[0]=n,i[1]=t,i};i.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n};i.set=function(n,t,i){return n[0]=t,n[1]=i,n};i.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n};i.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n};i.sub=i.subtract;i.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n};i.mul=i.multiply;i.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n};i.div=i.divide;i.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n};i.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)};i.dist=i.distance;i.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r};i.sqrDist=i.squaredDistance;i.length=function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)};i.len=i.length;i.squaredLength=function(n){var t=n[0],i=n[1];return t*t+i*i};i.sqrLen=i.squaredLength;i.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n};i.normalize=function(n,t){var r=t[0],u=t[1],i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i),n};i.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]};i.str=function(n){return"vec2("+n[0]+", "+n[1]+")"};i.lerp=function(n,t,i,r){var u=t[0],f=t[1];return n[0]=u+r*(i[0]-u),n[1]=f+r*(i[1]-f),n}},{"../utils/Utils":50}],32:[function(n,t){function r(n){n=n||{};l.call(this);this.id=++r._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=n.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!n.fixedRotation;this.position=i.fromValues(0,0);n.position&&i.copy(this.position,n.position);this.interpolatedPosition=i.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=i.fromValues(0,0);this.previousAngle=0;this.velocity=i.fromValues(0,0);n.velocity&&i.copy(this.velocity,n.velocity);this.vlambda=i.fromValues(0,0);this.wlambda=0;this.angle=n.angle||0;this.angularVelocity=n.angularVelocity||0;this.force=i.create();n.force&&i.copy(this.force,n.force);this.angularForce=n.angularForce||0;this.damping=typeof n.damping=="number"?n.damping:.1;this.angularDamping=typeof n.angularDamping=="number"?n.angularDamping:.1;this.type=r.STATIC;this.type=typeof n.type!="undefined"?n.type:n.mass?r.DYNAMIC:r.STATIC;this.boundingRadius=0;this.aabb=new c;this.aabbNeedsUpdate=!0;this.allowSleep=!0;this.wantsToSleep=!1;this.sleepState=r.AWAKE;this.sleepSpeedLimit=.2;this.sleepTimeLimit=1;this.gravityScale=1;this.collisionResponse=!0;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=n.ccdSpeedThreshold!==undefined?n.ccdSpeedThreshold:-1;this.ccdIterations=n.ccdIterations!==undefined?n.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var i=n("../math/vec2"),y=n("poly-decomp"),p=n("../shapes/Convex"),c=n("../collision/AABB"),l=n("../events/EventEmitter"),o,a,v,s,u;t.exports=r;r.prototype=new l;r.prototype.constructor=r;r._idCounter=0;r.prototype.updateSolveMassProperties=function(){this.sleepState===r.SLEEPING||this.type===r.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};r.prototype.setDensity=function(n){var t=this.getArea();this.mass=t*n;this.updateMassProperties()};r.prototype.getArea=function(){for(var t=0,n=0;n<this.shapes.length;n++)t+=this.shapes[n].area;return t};r.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};o=new c;a=i.create();r.prototype.updateAABB=function(){for(var f,e,r=this.shapes,s=this.shapeOffsets,h=this.shapeAngles,c=r.length,t=a,u=this.angle,n=0;n!==c;n++)f=r[n],e=h[n]+u,i.rotate(t,s[n],u),i.add(t,t,this.position),f.computeAABB(o,t,e),n===0?this.aabb.copy(o):this.aabb.extend(o);this.aabbNeedsUpdate=!1};r.prototype.updateBoundingRadius=function(){for(var r=this.shapes,e=this.shapeOffsets,o=r.length,t=0,n=0;n!==o;n++){var s=r[n],u=i.length(e[n]),f=s.boundingRadius;u+f>t&&(t=u+f)}this.boundingRadius=t};r.prototype.addShape=function(n,t,r){r=r||0;t=t?i.fromValues(t[0],t[1]):i.fromValues(0,0);this.shapes.push(n);this.shapeOffsets.push(t);this.shapeAngles.push(r);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0};r.prototype.removeShape=function(n){var t=this.shapes.indexOf(n);return t!==-1?(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeAngles.splice(t,1),this.aabbNeedsUpdate=!0,!0):!1};r.prototype.updateMassProperties=function(){var n;if(this.type===r.STATIC||this.type===r.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var u=this.shapes,f=u.length,e=this.mass/f,t=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(n=0;n<f;n++){var o=u[n],s=i.squaredLength(this.shapeOffsets[n]),h=o.computeMomentOfInertia(e);t+=h+e*s}this.inertia=t;this.invInertia=t>0?1/t:0}this.invMass=1/this.mass}};v=i.create();r.prototype.applyForce=function(n,t){var r=v,u;i.sub(r,t,this.position);i.add(this.force,this.force,n);u=i.crossLength(r,n);this.angularForce+=u};r.prototype.toLocalFrame=function(n,t){i.toLocalFrame(n,t,this.position,this.angle)};r.prototype.toWorldFrame=function(n,t){i.toGlobalFrame(n,t,this.position,this.angle)};r.prototype.fromPolygon=function(n,t){var f,s,h,r,u,o,e;for(t=t||{},r=this.shapes.length;r>=0;--r)this.removeShape(this.shapes[r]);if(f=new y.Polygon,f.vertices=n,f.makeCCW(),typeof t.removeCollinearPoints=="number"&&f.removeCollinearPoints(t.removeCollinearPoints),typeof t.skipSimpleCheck=="undefined"&&!f.isSimple())return!1;for(this.concavePath=f.vertices.slice(0),r=0;r<this.concavePath.length;r++)e=[0,0],i.copy(e,this.concavePath[r]),this.concavePath[r]=e;for(s=t.optimalDecomp?f.decomp():f.quickDecomp(),h=i.create(),r=0;r!==s.length;r++){for(u=new p(s[r].vertices),o=0;o!==u.vertices.length;o++)e=u.vertices[o],i.sub(e,e,u.centerOfMass);i.scale(h,u.centerOfMass,1);u.updateTriangles();u.updateCenterOfMass();u.updateBoundingRadius();this.addShape(u,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var g=i.fromValues(0,0),w=i.fromValues(0,0),b=i.fromValues(0,0),k=i.fromValues(0,0);r.prototype.adjustCenterOfMass=function(){var e=w,r=b,u=k,o=0,f,t,n;for(i.set(r,0,0),n=0;n!==this.shapes.length;n++)f=this.shapes[n],t=this.shapeOffsets[n],i.scale(e,t,f.area),i.add(r,r,e),o+=f.area;for(i.scale(u,r,1/o),n=0;n!==this.shapes.length;n++)f=this.shapes[n],t=this.shapeOffsets[n],t||(t=this.shapeOffsets[n]=i.create()),i.sub(t,t,u);for(i.add(this.position,this.position,u),n=0;this.concavePath&&n<this.concavePath.length;n++)i.sub(this.concavePath[n],this.concavePath[n],u);this.updateMassProperties();this.updateBoundingRadius()};r.prototype.setZeroForce=function(){i.set(this.force,0,0);this.angularForce=0};r.prototype.resetConstraintVelocity=function(){var n=this,t=n.vlambda;i.set(t,0,0);n.wlambda=0};r.prototype.addConstraintVelocity=function(){var n=this,t=n.velocity;i.add(t,t,n.vlambda);n.angularVelocity+=n.wlambda};r.prototype.applyDamping=function(n){if(this.type===r.DYNAMIC){var t=this.velocity;i.scale(t,t,Math.pow(1-this.damping,n));this.angularVelocity*=Math.pow(1-this.angularDamping,n)}};r.prototype.wakeUp=function(){var n=this.sleepState;this.sleepState=r.AWAKE;this.idleTime=0;n!==r.AWAKE&&this.emit(r.wakeUpEvent)};r.prototype.sleep=function(){this.sleepState=r.SLEEPING;this.angularVelocity=0;this.angularForce=0;i.set(this.velocity,0,0);i.set(this.force,0,0);this.emit(r.sleepEvent)};r.prototype.sleepTick=function(n,t,u){if(this.allowSleep&&this.type!==r.SLEEPING){this.wantsToSleep=!1;var o=this.sleepState,f=i.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),e=Math.pow(this.sleepSpeedLimit,2);f>=e?(this.idleTime=0,this.sleepState=r.AWAKE):(this.idleTime+=u,this.sleepState=r.SLEEPY);this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep())}};r.prototype.getVelocityFromPosition=function(n,t){return n=n||i.create(),i.sub(n,this.position,this.previousPosition),i.scale(n,n,1/t),n};r.prototype.getAngularVelocityFromPosition=function(n){return(this.angle-this.previousAngle)/n};r.prototype.overlaps=function(n){return this.world.overlapKeeper.bodiesAreOverlapping(this,n)};s=i.create();u=i.create();r.prototype.integrate=function(n){var f=this.invMass,e=this.force,r=this.position,t=this.velocity;i.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*n);i.scale(s,e,n*f);i.add(t,s,t);this.integrateToTimeOfImpact(n)||(i.scale(u,t,n),i.add(r,r,u),this.fixedRotation||(this.angle+=this.angularVelocity*n));this.aabbNeedsUpdate=!0};var d=i.create(),f=i.create(),e=i.create(),h=i.create();r.prototype.integrateToTimeOfImpact=function(n){var s,p;if(this.ccdSpeedThreshold<0||i.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;i.normalize(d,this.velocity);i.scale(f,this.velocity,n);i.add(f,f,this.position);i.sub(e,f,this.position);var a=this.angularVelocity*n,w=i.length(e),t=1,r,v=this;if(this.world.raycastAll(this.position,f,{},function(n){n.body!==v&&(r=n.body,i.copy(f,n.hitPointWorld),i.sub(e,n.hitPointWorld,v.position),t=i.length(e)/w,n.abort())}),!r)return!1;s=this.angle;i.copy(h,this.position);for(var y=0,c=0,o=0,l=t;l>=c&&y<this.ccdIterations;)y++,o=(l-c)/2,i.scale(u,e,t),i.add(this.position,h,u),this.angle=s+a*t,this.updateAABB(),p=this.aabb.overlaps(r.aabb)&&this.world.narrowphase.bodiesOverlap(this,r),p?c=o:l=o;return t=o,i.copy(this.position,h),this.angle=s,i.scale(u,e,t),i.add(this.position,this.position,u),this.fixedRotation||(this.angle+=a*t),!0};r.sleepyEvent={type:"sleepy"};r.sleepEvent={type:"sleep"};r.wakeUpEvent={type:"wakeup"};r.DYNAMIC=1;r.STATIC=2;r.KINEMATIC=4;r.AWAKE=0;r.SLEEPY=1;r.SLEEPING=2},{"../collision/AABB":7,"../events/EventEmitter":27,"../math/vec2":31,"../shapes/Convex":39,"poly-decomp":5}],33:[function(n,t){function r(n,t,r){var f,e,o;r=r||{};u.call(this,n,t,r);this.localAnchorA=i.fromValues(0,0);this.localAnchorB=i.fromValues(0,0);r.localAnchorA&&i.copy(this.localAnchorA,r.localAnchorA);r.localAnchorB&&i.copy(this.localAnchorB,r.localAnchorB);r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA);r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB);f=i.create();e=i.create();this.getWorldAnchorA(f);this.getWorldAnchorB(e);o=i.distance(f,e);this.restLength=typeof r.restLength=="number"?r.restLength:o}var i=n("../math/vec2"),u=n("./Spring"),y=n("../utils/Utils");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.setWorldAnchorA=function(n){this.bodyA.toLocalFrame(this.localAnchorA,n)};r.prototype.setWorldAnchorB=function(n){this.bodyB.toLocalFrame(this.localAnchorB,n)};r.prototype.getWorldAnchorA=function(n){this.bodyA.toWorldFrame(n,this.localAnchorA)};r.prototype.getWorldAnchorB=function(n){this.bodyB.toWorldFrame(n,this.localAnchorB)};var f=i.create(),e=i.create(),o=i.create(),s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create();r.prototype.applyForce=function(){var rt=this.stiffness,ut=this.damping,ft=this.restLength,n=this.bodyA,t=this.bodyB,p=f,w=e,r=o,u=s,y=v,b=h,k=c,d=l,g=a,nt,tt,it;this.getWorldAnchorA(b);this.getWorldAnchorB(k);i.sub(d,b,n.position);i.sub(g,k,t.position);i.sub(p,k,b);nt=i.len(p);i.normalize(w,p);i.sub(r,t.velocity,n.velocity);i.crossZV(y,t.angularVelocity,g);i.add(r,r,y);i.crossZV(y,n.angularVelocity,d);i.sub(r,r,y);i.scale(u,w,-rt*(nt-ft)-ut*i.dot(r,w));i.sub(n.force,n.force,u);i.add(t.force,t.force,u);tt=i.crossLength(d,u);it=i.crossLength(g,u);n.angularForce-=tt;t.angularForce+=it}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35}],34:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,i);this.restAngle=typeof i.restAngle=="number"?i.restAngle:t.angle-n.angle}var u=n("../math/vec2"),r=n("./Spring");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.applyForce=function(){var r=this.stiffness,u=this.damping,f=this.restAngle,n=this.bodyA,t=this.bodyB,e=t.angle-n.angle,o=t.angularVelocity-n.angularVelocity,i=-r*(e-f)-u*o*0;n.angularForce-=i;t.angularForce+=i}},{"../math/vec2":31,"./Spring":35}],35:[function(n,t){function i(n,t,i){i=r.defaults(i,{stiffness:100,damping:1});this.stiffness=i.stiffness;this.damping=i.damping;this.bodyA=n;this.bodyB=t}var u=n("../math/vec2"),r=n("../utils/Utils");t.exports=i;i.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50}],36:[function(n,t){t.exports={AABB:n("./collision/AABB"),AngleLockEquation:n("./equations/AngleLockEquation"),Body:n("./objects/Body"),Broadphase:n("./collision/Broadphase"),Capsule:n("./shapes/Capsule"),Circle:n("./shapes/Circle"),Constraint:n("./constraints/Constraint"),ContactEquation:n("./equations/ContactEquation"),ContactMaterial:n("./material/ContactMaterial"),Convex:n("./shapes/Convex"),DistanceConstraint:n("./constraints/DistanceConstraint"),Equation:n("./equations/Equation"),EventEmitter:n("./events/EventEmitter"),FrictionEquation:n("./equations/FrictionEquation"),GearConstraint:n("./constraints/GearConstraint"),GridBroadphase:n("./collision/GridBroadphase"),GSSolver:n("./solver/GSSolver"),Heightfield:n("./shapes/Heightfield"),Line:n("./shapes/Line"),LockConstraint:n("./constraints/LockConstraint"),Material:n("./material/Material"),Narrowphase:n("./collision/Narrowphase"),NaiveBroadphase:n("./collision/NaiveBroadphase"),Particle:n("./shapes/Particle"),Plane:n("./shapes/Plane"),RevoluteConstraint:n("./constraints/RevoluteConstraint"),PrismaticConstraint:n("./constraints/PrismaticConstraint"),Ray:n("./collision/Ray"),RaycastResult:n("./collision/RaycastResult"),Rectangle:n("./shapes/Rectangle"),RotationalVelocityEquation:n("./equations/RotationalVelocityEquation"),SAPBroadphase:n("./collision/SAPBroadphase"),Shape:n("./shapes/Shape"),Solver:n("./solver/Solver"),Spring:n("./objects/Spring"),LinearSpring:n("./objects/LinearSpring"),RotationalSpring:n("./objects/RotationalSpring"),Utils:n("./utils/Utils"),World:n("./world/World"),vec2:n("./math/vec2"),version:n("../package.json").version}},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/GridBroadphase":9,"./collision/NaiveBroadphase":10,"./collision/Narrowphase":11,"./collision/Ray":12,"./collision/RaycastResult":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54}],37:[function(n,t){function r(n,t){this.length=n||1;this.radius=t||1;f.call(this,f.CAPSULE)}var f=n("./Shape"),u=n("../math/vec2"),i;t.exports=r;r.prototype=new f;r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(n){var t=this.radius,i=this.length+t,r=t*2;return n*(r*r+i*i)/12};r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};i=u.create();r.prototype.computeAABB=function(n,t,r){var f=this.radius;u.set(i,this.length/2,0);r!==0&&u.rotate(i,i,r);u.set(n.upperBound,Math.max(i[0]+f,-i[0]+f),Math.max(i[1]+f,-i[1]+f));u.set(n.lowerBound,Math.min(i[0]-f,-i[0]-f),Math.min(i[1]-f,-i[1]-f));u.add(n.lowerBound,n.lowerBound,t);u.add(n.upperBound,n.upperBound,t)}},{"../math/vec2":31,"./Shape":45}],38:[function(n,t){function i(n){this.radius=n||1;u.call(this,u.CIRCLE)}var u=n("./Shape"),r=n("../math/vec2");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(n){var t=this.radius;return n*t*t/2};i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};i.prototype.computeAABB=function(n,t){var i=this.radius;r.set(n.upperBound,i,i);r.set(n.lowerBound,-i,-i);t&&(r.add(n.lowerBound,n.lowerBound,t),r.add(n.upperBound,n.upperBound,t))}},{"../math/vec2":31,"./Shape":45}],39:[function(n,t){function r(n,t){var e,o,r;for(this.vertices=[],this.axes=[],r=0;r<n.length;r++)e=i.create(),i.copy(e,n[r]),this.vertices.push(e);if(t)for(r=0;r<t.length;r++)o=i.create(),i.copy(o,t[r]),this.axes.push(o);else for(r=0;r<n.length;r++){var s=n[r],h=n[(r+1)%n.length],f=i.create();i.sub(f,h,s);i.rotate90cw(f,f);i.normalize(f,f);this.axes.push(f)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,u.call(this,u.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.");}var u=n("./Shape"),i=n("../math/vec2"),o=n("../math/polyk"),b=n("poly-decomp"),f,e;t.exports=r;r.prototype=new u;r.prototype.constructor=r;f=i.create();e=i.create();r.prototype.projectOntoLocalAxis=function(n,t){for(var h,r=null,u=null,s,e,n=f,o=0;o<this.vertices.length;o++)s=this.vertices[o],e=i.dot(s,n),(r===null||e>r)&&(r=e),(u===null||e<u)&&(u=e);u>r&&(h=u,u=r,r=h);i.set(t,u,r)};r.prototype.projectOntoWorldAxis=function(n,t,r,u){var f=e,o;this.projectOntoLocalAxis(n,u);r!==0?i.rotate(f,n,r):f=n;o=i.dot(t,f);i.set(u,u[0]+o,u[1]+o)};r.prototype.updateTriangles=function(){var i,r,t,n;for(this.triangles.length=0,i=[],n=0;n<this.vertices.length;n++)r=this.vertices[n],i.push(r[0],r[1]);for(t=o.Triangulate(i),n=0;n<t.length;n+=3){var u=t[n],f=t[n+1],e=t[n+2];this.triangles.push([u,f,e])}};var s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create(),y=i.create(),p=i.create(),w=i.create();r.prototype.updateCenterOfMass=function(){var b=this.triangles,u=this.vertices,n=this.centerOfMass,k=s,it=w,d=c,g=l,nt=a,rt=v,ut=y,ft=p,tt=h,f,t,o;for(i.set(n,0,0),f=0,t=0;t!==b.length;t++){var e=b[t],d=u[e[0]],g=u[e[1]],nt=u[e[2]];i.centroid(k,d,g,nt);o=r.triangleArea(d,g,nt);f+=o;i.scale(tt,k,o);i.add(n,n,tt)}i.scale(n,n,1/f)};r.prototype.computeMomentOfInertia=function(n){for(var f=0,e=0,o=this.vertices.length,s=o-1,t=0;t<o;s=t,t++){var r=this.vertices[s],u=this.vertices[t],h=Math.abs(i.crossLength(r,u)),c=i.dot(u,u)+i.dot(u,r)+i.dot(r,r);f+=h*c;e+=h}return n/6*(f/e)};r.prototype.updateBoundingRadius=function(){for(var r,u=this.vertices,n=0,t=0;t!==u.length;t++)r=i.squaredLength(u[t]),r>n&&(n=r);this.boundingRadius=Math.sqrt(n)};r.triangleArea=function(n,t,i){return((t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1]))*.5};r.prototype.updateArea=function(){var i,n,t;for(this.updateTriangles(),this.area=0,i=this.triangles,n=this.vertices,t=0;t!==i.length;t++){var u=i[t],f=n[u[0]],e=n[u[1]],o=n[u[2]],s=r.triangleArea(f,e,o);this.area+=s}};r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,"poly-decomp":5}],40:[function(n,t){function i(n,t){var f,i;if(t=u.defaults(t,{maxValue:null,minValue:null,elementWidth:.1}),t.minValue===null||t.maxValue===null)for(t.maxValue=n[0],t.minValue=n[0],f=0;f!==n.length;f++)i=n[f],i>t.maxValue&&(t.maxValue=i),i<t.minValue&&(t.minValue=i);this.data=n;this.maxValue=t.maxValue;this.minValue=t.minValue;this.elementWidth=t.elementWidth;r.call(this,r.HEIGHTFIELD)}var r=n("./Shape"),f=n("../math/vec2"),u=n("../utils/Utils");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.updateArea=function(){for(var t=this.data,i=0,n=0;n<t.length-1;n++)i+=(t[n]+t[n+1])/2*this.elementWidth;this.area=i};i.prototype.computeAABB=function(n,t){n.upperBound[0]=this.elementWidth*this.data.length+t[0];n.upperBound[1]=this.maxValue+t[1];n.lowerBound[0]=t[0];n.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],41:[function(n,t){function i(n){this.length=n||1;f.call(this,f.LINE)}var f=n("./Shape"),r=n("../math/vec2"),u;t.exports=i;i.prototype=new f;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(n){return n*Math.pow(this.length,2)/12};i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};u=[r.create(),r.create()];i.prototype.computeAABB=function(n,t,i){var f=this.length/2;r.set(u[0],-f,0);r.set(u[1],f,0);n.setFromPoints(u,t,i,0)}},{"../math/vec2":31,"./Shape":45}],42:[function(n,t){function i(){r.call(this,r.PARTICLE)}var r=n("./Shape"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=0};i.prototype.computeAABB=function(n,t){u.copy(n.lowerBound,t);u.copy(n.upperBound,t)}},{"../math/vec2":31,"./Shape":45}],43:[function(n,t){function i(){r.call(this,r.PLANE)}var r=n("./Shape"),u=n("../math/vec2"),f=n("../utils/Utils");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.computeAABB=function(n,t,i){var f=0,r=u.set;typeof i=="number"&&(f=i%(2*Math.PI));f===0?(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,0)):f===Math.PI/2?(r(n.lowerBound,0,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===Math.PI?(r(n.lowerBound,-Number.MAX_VALUE,0),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===3*Math.PI/2?(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,0,Number.MAX_VALUE)):(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE));u.add(n.lowerBound,n.lowerBound,t);u.add(n.upperBound,n.upperBound,t)};i.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],44:[function(n,t){function r(n,t){this.width=n||1;this.height=t||1;var r=[i.fromValues(-n/2,-t/2),i.fromValues(n/2,-t/2),i.fromValues(n/2,t/2),i.fromValues(-n/2,t/2)],e=[i.fromValues(1,0),i.fromValues(0,1)];u.call(this,r,e);this.type=f.RECTANGLE}var i=n("../math/vec2"),f=n("./Shape"),u=n("./Convex");t.exports=r;r.prototype=new u([]);r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(n){var t=this.width,i=this.height;return n*(i*i+t*t)/12};r.prototype.updateBoundingRadius=function(){var n=this.width,t=this.height;this.boundingRadius=Math.sqrt(n*n+t*t)/2};var e=i.create(),o=i.create(),s=i.create(),h=i.create();r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)};r.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45}],45:[function(n,t){function i(n){this.type=n;this.id=i.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionResponse=!0;this.collisionMask=1;n&&this.updateBoundingRadius();this.material=null;this.area=0;this.sensor=!1;this.updateArea()}t.exports=i;i.idCounter=0;i.CIRCLE=1;i.PARTICLE=2;i.PLANE=4;i.CONVEX=8;i.LINE=16;i.RECTANGLE=32;i.CAPSULE=64;i.HEIGHTFIELD=128;i.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...");};i.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...");};i.prototype.updateArea=function(){};i.prototype.computeAABB=function(){}},{}],46:[function(n,t){function i(n){u.call(this,n,u.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-10;this.arrayStep=30;this.lambda=new r.ARRAY_TYPE(this.arrayStep);this.Bs=new r.ARRAY_TYPE(this.arrayStep);this.invCs=new r.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.frictionIterations=0;this.usedIterations=0}function o(n){for(var t=n.length;t--;)n[t]=0}var f=n("../math/vec2"),u=n("./Solver"),r=n("../utils/Utils"),e=n("../equations/FrictionEquation");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.solve=function(n,t){var s,v,u,h,b,y,w,d,k;this.sortEquations();var l=0,et=this.iterations,rt=this.frictionIterations,a=this.equations,c=a.length,ut=Math.pow(this.tolerance*c,2),g=t.bodies,nt=t.bodies.length,ot=f.add,st=f.set,ft=this.useZeroRHS,p=this.lambda;if(this.usedIterations=0,c)for(u=0;u!==nt;u++)b=g[u],b.updateSolveMassProperties();p.length<c&&(p=this.lambda=new r.ARRAY_TYPE(c+this.arrayStep),this.Bs=new r.ARRAY_TYPE(c+this.arrayStep),this.invCs=new r.ARRAY_TYPE(c+this.arrayStep));o(p);var tt=this.invCs,it=this.Bs,p=this.lambda;for(u=0;u!==a.length;u++)s=a[u],(s.timeStep!==n||s.needsUpdate)&&(s.timeStep=n,s.update()),it[u]=s.computeB(s.a,s.b,n),tt[u]=s.computeInvC(s.epsilon);if(c!==0){for(u=0;u!==nt;u++)b=g[u],b.resetConstraintVelocity();if(rt){for(l=0;l!==rt;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(i.updateMultipliers(a,p,1/n),h=0;h!==c;h++)if(y=a[h],y instanceof e){for(w=0,d=0;d!==y.contactEquations.length;d++)w+=y.contactEquations[d].multiplier;w*=y.frictionCoefficient/y.contactEquations.length;y.maxForce=w;y.minForce=-w}}for(l=0;l!==et;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(u=0;u!==nt;u++)g[u].addConstraintVelocity();i.updateMultipliers(a,p,1/n)}};i.updateMultipliers=function(n,t,i){for(var r=n.length;r--;)n[r].multiplier=t[r]*i};i.iterateEquation=function(n,t,i,r,u,f,e,o){var l=r[n],y=u[n],h=f[n],p=t.computeGWlambda(),a=t.maxForce,v=t.minForce,s,c;return e&&(l=0),s=y*(l-p-i*h),c=h+s,c<v*o?s=v*o-h:c>a*o&&(s=a*o-h),f[n]+=s,t.addToWlambda(s),s}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47}],47:[function(n,t){function i(n,t){n=n||{};u.call(this);this.type=t;this.equations=[];this.equationSortFunction=n.equationSortFunction||!1}var f=n("../utils/Utils"),u=n("../events/EventEmitter"),r;t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!");};r={bodies:[]};i.prototype.solveIsland=function(n,t){this.removeAllEquations();t.equations.length&&(this.addEquations(t.equations),r.bodies.length=0,t.getBodies(r.bodies),r.bodies.length&&this.solve(n,r))};i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};i.prototype.addEquation=function(n){n.enabled&&this.equations.push(n)};i.prototype.addEquations=function(n){for(var i,t=0,r=n.length;t!==r;t++)i=n[t],i.enabled&&this.equations.push(i)};i.prototype.removeEquation=function(n){var t=this.equations.indexOf(n);t!==-1&&this.equations.splice(t,1)};i.prototype.removeAllEquations=function(){this.equations.length=0};i.GS=1;i.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50}],48:[function(n,t){function i(){this.overlappingShapesLastState=new r;this.overlappingShapesCurrentState=new r;this.recordPool=[];this.tmpDict=new r;this.tmpArray1=[]}function u(n,t,i,r){this.shapeA=t;this.shapeB=r;this.bodyA=n;this.bodyB=i}var r=n("./TupleDictionary"),f=n("./Utils");t.exports=i;i.prototype.tick=function(){for(var n=this.overlappingShapesLastState,t=this.overlappingShapesCurrentState,i=n.keys.length;i--;){var r=n.keys[i],u=n.getByKey(r),f=t.getByKey(r);u&&!f&&this.recordPool.push(u)}n.reset();n.copy(t);t.reset()};i.prototype.setOverlapping=function(n,t,i,r){var o=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,f;e.get(t.id,r.id)||(this.recordPool.length?(f=this.recordPool.pop(),f.set(n,t,i,r)):f=new u(n,t,i,r),e.set(t.id,r.id,f))};i.prototype.getNewOverlaps=function(n){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,n)};i.prototype.getEndOverlaps=function(n){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,n)};i.prototype.bodiesAreOverlapping=function(n,t){for(var r=this.overlappingShapesCurrentState,u=r.keys.length,f,i;u--;)if(f=r.keys[u],i=r.data[f],i.bodyA===n&&i.bodyB===t||i.bodyA===t&&i.bodyB===n)return!0;return!1};i.prototype.getDiff=function(n,t,i){var i=i||[],s=n,u=t,f,r,e,o;for(i.length=0,f=u.keys.length;f--;){if(r=u.keys[f],e=u.data[r],!e)throw new Error("Key "+r+" had no data!");o=s.data[r];o||i.push(e)}return i};i.prototype.isNewOverlap=function(n,t){var i=n.id|0,r=t.id|0,u=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState;return!!!u.get(i,r)&&!!f.get(i,r)};i.prototype.getNewBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getEndBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getBodyDiff=function(n,t){var r,u,i;for(t=t||[],r=this.tmpDict,u=n.length;u--;)i=n[u],r.set(i.bodyA.id|0,i.bodyB.id|0,i);for(u=r.keys.length;u--;)i=r.getByKey(r.keys[u]),i&&t.push(i.bodyA,i.bodyB);return r.reset(),t};u.prototype.set=function(n,t,i,r){u.call(this,n,t,i,r)}},{"./TupleDictionary":49,"./Utils":50}],49:[function(n,t){function i(){this.data={};this.keys=[]}var r=n("./Utils");t.exports=i;i.prototype.getKey=function(n,t){return(n=n|0,t=t|0,(n|0)==(t|0))?-1:((n|0)>(t|0)?n<<16|t&65535:t<<16|n&65535)|0};i.prototype.getByKey=function(n){return n=n|0,this.data[n]};i.prototype.get=function(n,t){return this.data[this.getKey(n,t)]};i.prototype.set=function(n,t,i){if(!i)throw new Error("No data!");var r=this.getKey(n,t);return this.data[r]||this.keys.push(r),this.data[r]=i,r};i.prototype.reset=function(){for(var i=this.data,n=this.keys,t=n.length;t--;)delete i[n[t]];n.length=0};i.prototype.copy=function(n){var t,i;for(this.reset(),r.appendArray(this.keys,n.keys),t=n.keys.length;t--;)i=n.keys[t],this.data[i]=n.data[i]}},{"./Utils":50}],50:[function(n,t){function i(){}t.exports=i;i.appendArray=function(n,t){if(t.length<15e4)n.push.apply(n,t);else for(var i=0,r=t.length;i!==r;++i)n.push(t[i])};i.splice=function(n,t,i){i=i||1;for(var r=t,u=n.length-i;r<u;r++)n[r]=n[r+i];n.length=u};i.ARRAY_TYPE=window.Float32Array||Array;i.extend=function(n,t){for(var i in t)n[i]=t[i]};i.defaults=function(n,t){n=n||{};for(var i in t)i in n||(n[i]=t[i]);return n}},{}],51:[function(n,t){function r(){this.equations=[];this.bodies=[]}var u=n("../objects/Body"),i;t.exports=r;r.prototype.reset=function(){this.equations.length=this.bodies.length=0};i=[];r.prototype.getBodies=function(n){var u=n||[],f=this.equations,r,t;for(i.length=0,r=0;r!==f.length;r++)t=f[r],i.indexOf(t.bodyA.id)===-1&&(u.push(t.bodyA),i.push(t.bodyA.id)),i.indexOf(t.bodyB.id)===-1&&(u.push(t.bodyB),i.push(t.bodyB.id));return u};r.prototype.wantsToSleep=function(){for(var t,n=0;n<this.bodies.length;n++)if(t=this.bodies[n],t.type===u.DYNAMIC&&!t.wantsToSleep)return!1;return!0};r.prototype.sleep=function(){for(var t,n=0;n<this.bodies.length;n++)t=this.bodies[n],t.sleep();return!0}},{"../objects/Body":32}],52:[function(n,t){function i(){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}var e=n("../math/vec2"),u=n("./Island"),f=n("./IslandNode"),r=n("../objects/Body");t.exports=i;i.getUnvisitedNode=function(n){for(var t,u=n.length,i=0;i!==u;i++)if(t=n[i],!t.visited&&t.body.type===r.DYNAMIC)return t;return!1};i.prototype.visit=function(n,t,i){var f,r,u;for(t.push(n.body),f=n.equations.length,r=0;r!==f;r++)u=n.equations[r],i.indexOf(u)===-1&&i.push(u)};i.prototype.bfs=function(n,t,u){var f=this.queue,o,e;for(f.length=0,f.push(n),n.visited=!0,this.visit(n,t,u);f.length;)for(o=f.pop();e=i.getUnvisitedNode(o.neighbors);)e.visited=!0,this.visit(e,t,u),e.body.type===r.DYNAMIC&&f.push(e)};i.prototype.split=function(n){for(var o=n.bodies,t=this.nodes,y=this.equations,e,h,c,s,p,r;t.length;)this._nodePool.push(t.pop());for(e=0;e!==o.length;e++)this._nodePool.length?(h=this._nodePool.pop(),h.reset(),h.body=o[e],t.push(h)):t.push(new f(o[e]));for(c=0;c!==y.length;c++){var l=y[c],e=o.indexOf(l.bodyA),w=o.indexOf(l.bodyB),a=t[e],v=t[w];a.neighbors.push(v);v.neighbors.push(a);a.equations.push(l);v.equations.push(l)}for(s=this.islands;s.length;)r=s.pop(),r.reset(),this._islandPool.push(r);while(p=i.getUnvisitedNode(t))r=this._islandPool.length?this._islandPool.pop():new u,this.bfs(p,r.bodies,r.equations),s.push(r);return s}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53}],53:[function(n,t){function i(n){this.body=n;this.neighbors=[];this.equations=[];this.visited=!1}t.exports=i;i.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{}],54:[function(n,t){function r(n){y.apply(this);n=n||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=n.solver||new p;this.narrowphase=new it(this);this.islandManager=new ut;this.gravity=i.fromValues(0,-9.78);n.gravity&&i.copy(this.gravity,n.gravity);this.frictionGravity=i.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=!0;this.useFrictionGravityOnZeroGravity=!0;this.doProfiling=n.doProfiling||!1;this.lastStepTime=0;this.broadphase=n.broadphase||new tt;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new g;this.defaultContactMaterial=new nt(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=!0;this.applyDamping=!0;this.applyGravity=!0;this.solveConstraints=!0;this.contactMaterials=[];this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof n.islandSplit!="undefined"?!!n.islandSplit:!1;this.emitImpactEvent=!0;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=r.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new rt}var p=n("../solver/GSSolver"),lt=n("../solver/Solver"),at=n("../collision/NaiveBroadphase"),s=n("../collision/Ray"),i=n("../math/vec2"),w=n("../shapes/Circle"),vt=n("../shapes/Rectangle"),b=n("../shapes/Convex"),yt=n("../shapes/Line"),k=n("../shapes/Plane"),d=n("../shapes/Capsule"),v=n("../shapes/Particle"),y=n("../events/EventEmitter"),u=n("../objects/Body"),pt=n("../shapes/Shape"),wt=n("../objects/LinearSpring"),g=n("../material/Material"),nt=n("../material/ContactMaterial"),bt=n("../constraints/DistanceConstraint"),kt=n("../constraints/Constraint"),dt=n("../constraints/LockConstraint"),gt=n("../constraints/RevoluteConstraint"),ni=n("../constraints/PrismaticConstraint"),ti=n("../constraints/GearConstraint"),ii=n("../../package.json"),ri=n("../collision/Broadphase"),tt=n("../collision/SAPBroadphase"),it=n("../collision/Narrowphase"),f=n("../utils/Utils"),rt=n("../utils/OverlapKeeper"),ut=n("./IslandManager"),ui=n("../objects/RotationalSpring"),a,c,l;t.exports=r;typeof performance=="undefined"&&(performance={});performance.now||(a=Date.now(),performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),performance.now=function(){return Date.now()-a});r.prototype=new Object(y.prototype);r.prototype.constructor=r;r.NO_SLEEPING=1;r.BODY_SLEEPING=2;r.ISLAND_SLEEPING=4;r.prototype.addConstraint=function(n){this.constraints.push(n)};r.prototype.addContactMaterial=function(n){this.contactMaterials.push(n)};r.prototype.removeContactMaterial=function(n){var t=this.contactMaterials.indexOf(n);t!==-1&&f.splice(this.contactMaterials,t,1)};r.prototype.getContactMaterial=function(n,t){for(var i,u=this.contactMaterials,r=0,f=u.length;r!==f;r++)if(i=u[r],i.materialA.id===n.id&&i.materialB.id===t.id||i.materialA.id===t.id&&i.materialB.id===n.id)return i;return!1};r.prototype.removeConstraint=function(n){var t=this.constraints.indexOf(n);t!==-1&&f.splice(this.constraints,t,1)};var fi=i.create(),ei=i.create(),oi=i.create(),si=i.create(),ft=i.create(),et=i.create(),ot=i.create(),e=i.fromValues(0,0),o=i.fromValues(0,0),hi=i.fromValues(0,0),h=i.fromValues(0,0);r.prototype.step=function(n,t,r){var e,l,s,a,c,o,f;if(r=r||10,t=t||0,t===0)this.internalStep(n),this.time+=n;else{for(e=Math.floor((this.time+t)/n)-Math.floor(this.time/n),e=Math.min(e,r),l=performance.now(),s=0;s!==e;s++)if(this.internalStep(n),performance.now()-l>n*1e3)break;for(this.time+=t,a=this.time%n,c=a/n,o=0;o!==this.bodies.length;o++)f=this.bodies[o],f.type!==u.STATIC&&f.sleepState!==u.SLEEPING?(i.sub(h,f.position,f.previousPosition),i.scale(h,h,c),i.add(f.interpolatedPosition,f.position,h),f.interpolatedAngle=f.angle+(f.angle-f.previousAngle)*c):(i.copy(f.interpolatedPosition,f.position),f.interpolatedAngle=f.angle)}};c=[];r.prototype.internalStep=function(n){var at,vt,ni,h,e,g,tt,o,ti,it,rt,ut,ii,ri,wt,st,l,ct,lt,nt,a,b,k,ht,t;this.stepping=!0;var fi=this,bt=this.doProfiling,ei=this.springs.length,oi=this.springs,v=this.bodies,si=this.gravity,d=this.solver,y=this.bodies.length,hi=this.broadphase,s=this.narrowphase,p=this.constraints,kt,dt,pi=ft,wi=et,gt=ot,bi=i.scale,ci=i.add,ki=i.rotate,w=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=n,bt&&(kt=performance.now()),this.useWorldGravityAsFrictionGravity&&(at=i.length(this.gravity),at===0&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=at)),this.applyGravity)for(t=0;t!==y;t++)(h=v[t],vt=h.force,h.type===u.DYNAMIC&&h.sleepState!==u.SLEEPING)&&(i.scale(gt,si,h.mass*h.gravityScale),ci(vt,vt,gt));if(this.applySpringForces)for(t=0;t!==ei;t++)ni=oi[t],ni.applyForce();if(this.applyDamping)for(t=0;t!==y;t++)h=v[t],h.type===u.DYNAMIC&&h.applyDamping(n);for(e=hi.getCollisionPairs(this),g=this.disabledBodyCollisionPairs,t=g.length-2;t>=0;t-=2)for(o=e.length-2;o>=0;o-=2)(g[t]===e[o]&&g[t+1]===e[o+1]||g[t+1]===e[o]&&g[t]===e[o+1])&&e.splice(o,2);for(nt=p.length,t=0;t!==nt;t++)if(tt=p[t],!tt.collideConnected)for(o=e.length-2;o>=0;o-=2)(tt.bodyA===e[o]&&tt.bodyB===e[o+1]||tt.bodyB===e[o]&&tt.bodyA===e[o+1])&&e.splice(o,2);for(this.postBroadphaseEvent.pairs=e,this.emit(this.postBroadphaseEvent),s.reset(this),t=0,ti=e.length;t!==ti;t+=2)for(it=e[t],rt=e[t+1],ut=0,ii=it.shapes.length;ut!==ii;ut++){var yt=it.shapes[ut],li=it.shapeOffsets[ut],ai=it.shapeAngles[ut];for(l=0,ri=rt.shapes.length;l!==ri;l++){var pt=rt.shapes[l],vi=rt.shapeOffsets[l],yi=rt.shapeAngles[l],ui=this.defaultContactMaterial;yt.material&&pt.material&&(wt=this.getContactMaterial(yt.material,pt.material),wt&&(ui=wt));this.runNarrowphase(s,it,yt,li,ai,rt,pt,vi,yi,ui,this.frictionGravity)}}for(t=0;t!==y;t++)a=v[t],a._wakeUpAfterNarrowphase&&(a.wakeUp(),a._wakeUpAfterNarrowphase=!1);if(this.has("endContact"))for(this.overlapKeeper.getEndOverlaps(c),st=this.endContactEvent,l=c.length;l--;)ct=c[l],st.shapeA=ct.shapeA,st.shapeB=ct.shapeB,st.bodyA=ct.bodyA,st.bodyB=ct.bodyB,this.emit(st);for(lt=this.preSolveEvent,lt.contactEquations=s.contactEquations,lt.frictionEquations=s.frictionEquations,this.emit(lt),nt=p.length,t=0;t!==nt;t++)p[t].update();if(s.contactEquations.length||s.frictionEquations.length||p.length)if(this.islandSplit){for(w.equations.length=0,f.appendArray(w.equations,s.contactEquations),f.appendArray(w.equations,s.frictionEquations),t=0;t!==nt;t++)f.appendArray(w.equations,p[t].equations);for(w.split(this),t=0;t!==w.islands.length;t++)ht=w.islands[t],ht.equations.length&&d.solveIsland(n,ht)}else{for(d.addEquations(s.contactEquations),d.addEquations(s.frictionEquations),t=0;t!==nt;t++)d.addEquations(p[t].equations);this.solveConstraints&&d.solve(n,this);d.removeAllEquations()}for(t=0;t!==y;t++)a=v[t],a.sleepState!==u.SLEEPING&&a.type!==u.STATIC&&a.integrate(n);for(t=0;t!==y;t++)v[t].setZeroForce();if(bt&&(dt=performance.now(),fi.lastStepTime=dt-kt),this.emitImpactEvent&&this.has("impact"))for(b=this.impactEvent,t=0;t!==s.contactEquations.length;t++)k=s.contactEquations[t],k.firstImpact&&(b.bodyA=k.bodyA,b.bodyB=k.bodyB,b.shapeA=k.shapeA,b.shapeB=k.shapeB,b.contactEquation=k,this.emit(b));if(this.sleepMode===r.BODY_SLEEPING)for(t=0;t!==y;t++)v[t].sleepTick(this.time,!1,n);else if(this.sleepMode===r.ISLAND_SLEEPING&&this.islandSplit){for(t=0;t!==y;t++)v[t].sleepTick(this.time,!0,n);for(t=0;t<this.islandManager.islands.length;t++)ht=this.islandManager.islands[t],ht.wantsToSleep()&&ht.sleep()}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(t=0;t!==this.bodiesToBeRemoved.length;t++)this.removeBody(this.bodiesToBeRemoved[t]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};r.prototype.runNarrowphase=function(n,t,r,f,s,h,c,l,a,v,y){var g,nt,rt,k,b,tt,ut,d,ft,et,ot,st,p,w,it;if((r.collisionGroup&c.collisionMask)!=0&&(c.collisionGroup&r.collisionMask)!=0&&(i.rotate(e,f,t.angle),i.rotate(o,l,h.angle),i.add(e,e,t.position),i.add(o,o,h.position),g=s+t.angle,nt=a+h.angle,n.enableFriction=v.friction>0,n.frictionCoefficient=v.friction,rt=t.type===u.STATIC||t.type===u.KINEMATIC?h.mass:h.type===u.STATIC||h.type===u.KINEMATIC?t.mass:t.mass*h.mass/(t.mass+h.mass),n.slipForce=v.friction*y*rt,n.restitution=v.restitution,n.surfaceVelocity=v.surfaceVelocity,n.frictionStiffness=v.frictionStiffness,n.frictionRelaxation=v.frictionRelaxation,n.stiffness=v.stiffness,n.relaxation=v.relaxation,n.contactSkinSize=v.contactSkinSize,n.enabledEquations=t.collisionResponse&&h.collisionResponse&&r.collisionResponse&&c.collisionResponse,k=n[r.type|c.type],b=0,k&&(tt=r.sensor||c.sensor,ut=n.frictionEquations.length,b=r.type<c.type?k.call(n,t,r,e,g,h,c,o,nt,tt):k.call(n,h,c,o,nt,t,r,e,g,tt),d=n.frictionEquations.length-ut,b))){if(t.allowSleep&&t.type===u.DYNAMIC&&t.sleepState===u.SLEEPING&&h.sleepState===u.AWAKE&&h.type!==u.STATIC&&(ft=i.squaredLength(h.velocity)+Math.pow(h.angularVelocity,2),et=Math.pow(h.sleepSpeedLimit,2),ft>=et*2&&(t._wakeUpAfterNarrowphase=!0)),h.allowSleep&&h.type===u.DYNAMIC&&h.sleepState===u.SLEEPING&&t.sleepState===u.AWAKE&&t.type!==u.STATIC&&(ot=i.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),st=Math.pow(t.sleepSpeedLimit,2),ot>=st*2&&(h._wakeUpAfterNarrowphase=!0)),this.overlapKeeper.setOverlapping(t,r,h,c),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(r,c)){if(p=this.beginContactEvent,p.shapeA=r,p.shapeB=c,p.bodyA=t,p.bodyB=h,p.contactEquations.length=0,typeof b=="number")for(w=n.contactEquations.length-b;w<n.contactEquations.length;w++)p.contactEquations.push(n.contactEquations[w]);this.emit(p)}if(typeof b=="number"&&d>1)for(w=n.frictionEquations.length-d;w<n.frictionEquations.length;w++)it=n.frictionEquations[w],it.setSlipForce(it.getSlipForce()/d)}};r.prototype.addSpring=function(n){this.springs.push(n);this.addSpringEvent.spring=n;this.emit(this.addSpringEvent)};r.prototype.removeSpring=function(n){var t=this.springs.indexOf(n);t!==-1&&f.splice(this.springs,t,1)};r.prototype.addBody=function(n){this.bodies.indexOf(n)===-1&&(this.bodies.push(n),n.world=this,this.addBodyEvent.body=n,this.emit(this.addBodyEvent))};r.prototype.removeBody=function(n){if(this.stepping)this.bodiesToBeRemoved.push(n);else{n.world=null;var t=this.bodies.indexOf(n);t!==-1&&(f.splice(this.bodies,t,1),this.removeBodyEvent.body=n,n.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}};r.prototype.getBodyById=function(n){for(var i,r=this.bodies,t=0;t<r.length;t++)if(i=r[t],i.id===n)return i;return!1};r.prototype.disableBodyCollision=function(n,t){this.disabledBodyCollisionPairs.push(n,t)};r.prototype.enableBodyCollision=function(n,t){for(var r=this.disabledBodyCollisionPairs,i=0;i<r.length;i+=2)if(r[i]===n&&r[i+1]===t||r[i+1]===n&&r[i]===t){r.splice(i,2);return}};r.prototype.clear=function(){var t,i,u,f,n;for(this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations(),t=this.constraints,n=t.length-1;n>=0;n--)this.removeConstraint(t[n]);for(i=this.bodies,n=i.length-1;n>=0;n--)this.removeBody(i[n]);for(u=this.springs,n=u.length-1;n>=0;n--)this.removeSpring(u[n]);for(f=this.contactMaterials,n=f.length-1;n>=0;n--)this.removeContactMaterial(f[n]);r.apply(this)};r.prototype.clone=function(){var n=new r;return n.fromJSON(this.toJSON()),n};var st=i.create(),ht=i.fromValues(0,0),ct=i.fromValues(0,0);r.prototype.hitTest=function(n,t,r){var l,nt,g,tt,f,s,it,a;r=r||0;var h=new u({position:n}),c=new v,y=n,p=0,o=st,rt=ht,ut=ct;for(h.addShape(c),l=this.narrowphase,nt=[],g=0,tt=t.length;g!==tt;g++)for(f=t[g],s=0,it=f.shapes.length;s!==it;s++){var e=f.shapes[s],ft=f.shapeOffsets[s]||rt,et=f.shapeAngles[s]||0;i.rotate(o,ft,f.angle);i.add(o,o,f.position);a=et+f.angle;(e instanceof w&&l.circleParticle(f,e,o,a,h,c,y,p,!0)||e instanceof b&&l.particleConvex(h,c,y,p,f,e,o,a,!0)||e instanceof k&&l.particlePlane(h,c,y,p,f,e,o,a,!0)||e instanceof d&&l.particleCapsule(h,c,y,p,f,e,o,a,!0)||e instanceof v&&i.squaredLength(i.sub(ut,o,n))<r*r)&&nt.push(f)}return nt};r.prototype.setGlobalEquationParameters=function(n){var r,u,i,t;for(n=n||{},i=0;i!==this.constraints.length;i++)for(t=this.constraints[i],r=0;r!==t.equations.length;r++)u=t.equations[r],typeof n.stiffness!="undefined"&&(u.stiffness=n.stiffness),typeof n.relaxation!="undefined"&&(u.relaxation=n.relaxation),u.needsUpdate=!0;for(i=0;i!==this.contactMaterials.length;i++)t=this.contactMaterials[i],typeof n.stiffness!="undefined"&&(t.stiffness=n.stiffness,t.frictionStiffness=n.stiffness),typeof n.relaxation!="undefined"&&(t.relaxation=n.relaxation,t.frictionRelaxation=n.relaxation);t=this.defaultContactMaterial;typeof n.stiffness!="undefined"&&(t.stiffness=n.stiffness,t.frictionStiffness=n.stiffness);typeof n.relaxation!="undefined"&&(t.relaxation=n.relaxation,t.frictionRelaxation=n.relaxation)};r.prototype.setGlobalStiffness=function(n){this.setGlobalEquationParameters({stiffness:n})};r.prototype.setGlobalRelaxation=function(n){this.setGlobalEquationParameters({relaxation:n})};l=new s;r.prototype.raycastAll=function(n,t,i,r){return i.mode=s.ALL,i.from=n,i.to=t,i.callback=r,l.intersectWorld(this,i)};r.prototype.raycastAny=function(n,t,i,r){return i.mode=s.ANY,i.from=n,i.to=t,i.result=r,l.intersectWorld(this,i)};r.prototype.raycastClosest=function(n,t,i,r){return i.mode=s.CLOSEST,i.from=n,i.to=t,i.result=r,l.intersectWorld(this,i)}},{"../../package.json":6,"../collision/Broadphase":8,"../collision/NaiveBroadphase":10,"../collision/Narrowphase":11,"../collision/Ray":12,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,"../utils/Utils":50,"./IslandManager":52}]},{},[36])(36)});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;n.Physics.P2=function(t,i){this.game=t;typeof i=="undefined"?i={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(i.hasOwnProperty("gravity")||(i.gravity=[0,0]),i.hasOwnProperty("broadphase")||(i.broadphase=new p2.SAPBroadphase));this.config=i;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=!1;this.paused=!1;this.materials=[];this.gravity=new n.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new n.Signal;this.onBodyRemoved=new n.Signal;this.onSpringAdded=new n.Signal;this.onSpringRemoved=new n.Signal;this.onConstraintAdded=new n.Signal;this.onConstraintRemoved=new n.Signal;this.onContactMaterialAdded=new n.Signal;this.onContactMaterialRemoved=new n.Signal;this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new n.Signal;this.onEndContact=new n.Signal;i.hasOwnProperty("mpx")&&i.hasOwnProperty("pxm")&&i.hasOwnProperty("mpxi")&&i.hasOwnProperty("pxmi")&&(this.mpx=i.mpx,this.mpxi=i.mpxi,this.pxm=i.pxm,this.pxmi=i.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=!0;this._boundsRight=!0;this._boundsTop=!0;this._boundsBottom=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)};n.Physics.P2.prototype={removeBodyNextStep:function(n){this._toRemove.push(n)},preUpdate:function(){for(var n=this._toRemove.length;n--;)this.removeBody(this._toRemove[n]);this._toRemove.length=0},enable:function(t,i,r){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!0);var u=1;if(Array.isArray(t))for(u=t.length;u--;)t[u]instanceof n.Group?this.enable(t[u].children,i,r):(this.enableBody(t[u],i),r&&t[u].hasOwnProperty("children")&&t[u].children.length>0&&this.enable(t[u],i,!0));else t instanceof n.Group?this.enable(t.children,i,r):(this.enableBody(t,i),r&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,i,!0))},enableBody:function(t,i){t.hasOwnProperty("body")&&t.body===null&&(t.body=new n.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=i,t.anchor.set(.5))},setImpactEvents:function(n){if(n)this.world.on("impact",this.impactHandler,this);else this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(n,t){if(this.postBroadphaseCallback=n,this.callbackContext=t,n!==null)this.world.on("postBroadphase",this.postBroadphaseHandler,this);else this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(n){if(this.postBroadphaseCallback&&n.pairs.length!==0)for(var t=n.pairs.length-2;t>=0;t-=2)n.pairs[t].parent&&n.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,n.pairs[t].parent,n.pairs[t+1].parent)&&n.pairs.splice(t,2)},impactHandler:function(n){if(n.bodyA.parent&&n.bodyB.parent){var t=n.bodyA.parent,i=n.bodyB.parent;t._bodyCallbacks[n.bodyB.id]&&t._bodyCallbacks[n.bodyB.id].call(t._bodyCallbackContext[n.bodyB.id],t,i,n.shapeA,n.shapeB);i._bodyCallbacks[n.bodyA.id]&&i._bodyCallbacks[n.bodyA.id].call(i._bodyCallbackContext[n.bodyA.id],i,t,n.shapeB,n.shapeA);t._groupCallbacks[n.shapeB.collisionGroup]&&t._groupCallbacks[n.shapeB.collisionGroup].call(t._groupCallbackContext[n.shapeB.collisionGroup],t,i,n.shapeA,n.shapeB);i._groupCallbacks[n.shapeA.collisionGroup]&&i._groupCallbacks[n.shapeA.collisionGroup].call(i._groupCallbackContext[n.shapeA.collisionGroup],i,t,n.shapeB,n.shapeA)}},beginContactHandler:function(n){this.onBeginContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB,n.contactEquations);n.bodyA.parent&&n.bodyA.parent.onBeginContact.dispatch(n.bodyB.parent,n.shapeA,n.shapeB,n.contactEquations);n.bodyB.parent&&n.bodyB.parent.onBeginContact.dispatch(n.bodyA.parent,n.shapeB,n.shapeA,n.contactEquations)},endContactHandler:function(n){this.onEndContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB);n.bodyA.parent&&n.bodyA.parent.onEndContact.dispatch(n.bodyB.parent,n.shapeA,n.shapeB);n.bodyB.parent&&n.bodyB.parent.onEndContact.dispatch(n.bodyA.parent,n.shapeB,n.shapeA)},setBoundsToWorld:function(n,t,i,r,u){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,n,t,i,r,u)},setWorldMaterial:function(n,t,i,r,u){typeof t=="undefined"&&(t=!0);typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=!0);t&&this.walls.left&&(this.walls.left.shapes[0].material=n);i&&this.walls.right&&(this.walls.right.shapes[0].material=n);r&&this.walls.top&&(this.walls.top.shapes[0].material=n);u&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=n)},updateBoundsCollisionGroup:function(n){var t=this.everythingCollisionGroup.mask;typeof n=="undefined"&&(t=this.boundsCollisionGroup.mask);this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t)},setBounds:function(n,t,i,r,u,f,e,o,s){typeof u=="undefined"&&(u=this._boundsLeft);typeof f=="undefined"&&(f=this._boundsRight);typeof e=="undefined"&&(e=this._boundsTop);typeof o=="undefined"&&(o=this._boundsBottom);typeof s=="undefined"&&(s=this._boundsOwnGroup);this.walls.left&&this.world.removeBody(this.walls.left);this.walls.right&&this.world.removeBody(this.walls.right);this.walls.top&&this.world.removeBody(this.walls.top);this.walls.bottom&&this.world.removeBody(this.walls.bottom);u&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),s&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left));f&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(n+i),this.pxmi(t)],angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),s&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right));e&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t)],angle:-3.1415926535897931}),this.walls.top.addShape(new p2.Plane),s&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top));o&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t+r)]}),this.walls.bottom.addShape(new p2.Plane),s&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom));this._boundsLeft=u;this._boundsRight=f;this._boundsTop=e;this._boundsBottom=o;this._boundsOwnGroup=s},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){var t,i,r,u,n;for(this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations(),t=this.world.constraints,n=t.length-1;n>=0;n--)this.world.removeConstraint(t[n]);for(i=this.world.bodies,n=i.length-1;n>=0;n--)this.world.removeBody(i[n]);for(r=this.world.springs,n=r.length-1;n>=0;n--)this.world.removeSpring(r[n]);for(u=this.world.contactMaterials,n=u.length-1;n>=0;n--)this.world.removeContactMaterial(u[n]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(n){return n.data.world?!1:(this.world.addBody(n.data),this.onBodyAdded.dispatch(n),!0)},removeBody:function(n){return n.data.world==this.world&&(this.world.removeBody(n.data),this.onBodyRemoved.dispatch(n)),n},addSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,i,r,u,f,e){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.DistanceConstraint(this,t,i,r,u,f,e));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(t,i,r,u){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.GearConstraint(this,t,i,r,u));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(t,i,r,u,f,e){if(t=this.getBody(t),r=this.getBody(r),t&&r)return this.addConstraint(new n.Physics.P2.RevoluteConstraint(this,t,i,r,u,f,e));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(t,i,r,u,f){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.LockConstraint(this,t,i,r,u,f));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(t,i,r,u,f,e,o){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.PrismaticConstraint(this,t,i,r,u,f,e,o));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(n){return this.world.addConstraint(n),this.onConstraintAdded.dispatch(n),n},removeConstraint:function(n){return this.world.removeConstraint(n),this.onConstraintRemoved.dispatch(n),n},addContactMaterial:function(n){return this.world.addContactMaterial(n),this.onContactMaterialAdded.dispatch(n),n},removeContactMaterial:function(n){return this.world.removeContactMaterial(n),this.onContactMaterialRemoved.dispatch(n),n},getContactMaterial:function(n,t){return this.world.getContactMaterial(n,t)},setMaterial:function(n,t){for(var i=t.length;i--;)t[i].setMaterial(n)},createMaterial:function(t,i){t=t||"";var r=new n.Physics.P2.Material(t);return this.materials.push(r),typeof i!="undefined"&&i.setMaterial(r),r},createContactMaterial:function(t,i,r){typeof t=="undefined"&&(t=this.createMaterial());typeof i=="undefined"&&(i=this.createMaterial());var u=new n.Physics.P2.ContactMaterial(t,i,r);return this.addContactMaterial(u)},getBodies:function(){for(var n=[],t=this.world.bodies.length;t--;)n.push(this.world.bodies[t].parent);return n},getBody:function(t){return t instanceof p2.Body?t:t instanceof n.Physics.P2.Body?t.data:t.body&&t.body.type===n.Physics.P2JS?t.body.data:null},getSprings:function(){for(var n=[],t=this.world.springs.length;t--;)n.push(this.world.springs[t].parent);return n},getConstraints:function(){for(var n=[],t=this.world.constraints.length;t--;)n.push(this.world.constraints[t].parent);return n},hitTest:function(t,i,r,u){typeof i=="undefined"&&(i=this.world.bodies);typeof r=="undefined"&&(r=5);typeof u=="undefined"&&(u=!1);for(var o=[this.pxmi(t.x),this.pxmi(t.y)],e=[],f=i.length;f--;)i[f]instanceof n.Physics.P2.Body&&!(u&&i[f].data.type===p2.Body.STATIC)?e.push(i[f].data):i[f]instanceof p2.Body&&i[f].parent&&!(u&&i[f].type===p2.Body.STATIC)?e.push(i[f]):i[f]instanceof n.Sprite&&i[f].hasOwnProperty("body")&&!(u&&i[f].body.data.type===p2.Body.STATIC)&&e.push(i[f].body.data);return this.world.hitTest(o,e,r)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var i=Math.pow(2,this._collisionGroupID),r;return this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|i),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|i),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|i),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|i),this._collisionGroupID++,r=new n.Physics.P2.CollisionGroup(i),this.collisionGroups.push(r),t&&this.setCollisionGroup(t,r),r},setCollisionGroup:function(t,i){if(t instanceof n.Group)for(var r=0;r<t.total;r++)t.children[r].body&&t.children[r].body.type===n.Physics.P2JS&&t.children[r].body.setCollisionGroup(i);else t.body.setCollisionGroup(i)},createSpring:function(t,i,r,u,f,e,o,s,h){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addSpring(new n.Physics.P2.Spring(this,t,i,r,u,f,e,o,s,h));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(t,i,r,u,f){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addSpring(new n.Physics.P2.RotationalSpring(this,t,i,r,u,f));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(t,i,r,u,f,e){var o,s;return(typeof u=="undefined"&&(u=!1),o=new n.Physics.P2.Body(this.game,null,t,i,r),e&&(s=o.addPolygon(f,e),!s))?!1:(u&&this.world.addBody(o.data),o)},createParticle:function(t,i,r,u,f,e){var o,s;return(typeof u=="undefined"&&(u=!1),o=new n.Physics.P2.Body(this.game,null,t,i,r),e&&(s=o.addPolygon(f,e),!s))?!1:(u&&this.world.addBody(o.data),o)},convertCollisionObjects:function(n,t,i){var f,r,o,u,e;for(typeof i=="undefined"&&(i=!0),f=[],r=0,o=n.collision[t].length;r<o;r++)u=n.collision[t][r],e=this.createBody(u.x,u.y,0,i,{},u.polyline),e&&f.push(e);return f},clearTilemapLayerBodies:function(n,t){t=n.getLayer(t);for(var i=n.layers[t].bodies.length;i--;)n.layers[t].bodies[i].destroy();n.layers[t].bodies.length=0},convertTilemap:function(n,t,i,r){var o,a,s,v,u,h,f;t=n.getLayer(t);typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!0);this.clearTilemapLayerBodies(n,t);var e=0,c=0,l=0;for(o=0,a=n.layers[t].height;o<a;o++)for(e=0,s=0,v=n.layers[t].width;s<v;s++)u=n.layers[t].data[o][s],u&&u.index>-1&&u.collides&&(r?(h=n.getTileRight(t,s,o),e===0&&(c=u.x*u.width,l=u.y*u.height,e=u.width),h&&h.collides?e+=u.width:(f=this.createBody(c,l,0,!1),f.addRectangle(e,u.height,e/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f),e=0)):(f=this.createBody(u.x*u.width,u.y*u.height,0,!1),f.addRectangle(u.width,u.height,u.width/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f)));return n.layers[t].bodies},mpx:function(n){return n*20},pxm:function(n){return n*.05},mpxi:function(n){return n*-20},pxmi:function(n){return n*-.05}};Object.defineProperty(n.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(n){this.world.defaultContactMaterial.friction=n}});Object.defineProperty(n.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(n){this.world.defaultContactMaterial.restitution=n}});Object.defineProperty(n.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(n){this.world.defaultContactMaterial=n}});Object.defineProperty(n.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(n){this.world.applySpringForces=n}});Object.defineProperty(n.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(n){this.world.applyDamping=n}});Object.defineProperty(n.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(n){this.world.applyGravity=n}});Object.defineProperty(n.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(n){this.world.solveConstraints=n}});Object.defineProperty(n.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(n.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(n){this.world.emitImpactEvent=n}});Object.defineProperty(n.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(n){this.world.sleepMode=n}});Object.defineProperty(n.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});
/**
* @author       Georgios Kaleadis https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.FixtureList=function(n){Array.isArray(n)||(n=[n]);this.rawList=n;this.init();this.parse(this.rawList)};n.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(n,t){var i=function(t){t.collisionGroup=n};this.getFixtures(t).forEach(i)},setMask:function(n,t){var i=function(t){t.collisionMask=n};this.getFixtures(t).forEach(i)},setSensor:function(n,t){var i=function(t){t.sensor=n};this.getFixtures(t).forEach(i)},setMaterial:function(n,t){var i=function(t){t.material=n};this.getFixtures(t).forEach(i)},getFixtures:function(n){var i=[],t;return n?(n instanceof Array||(n=[n]),t=this,n.forEach(function(n){t.namedFixtures[n]&&i.push(t.namedFixtures[n])}),this.flatten(i)):this.allFixtures},getFixtureByKey:function(n){return this.namedFixtures[n]},getGroup:function(n){return this.groupedFixtures[n]},parse:function(){var n,t,i,r;i=this.rawList;r=[];for(n in i)t=i[n],isNaN(+n)?this.namedFixtures[n]=this.flatten(t):(this.groupedFixtures[n]=this.groupedFixtures[n]||[],this.groupedFixtures[n]=this.groupedFixtures[n].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(n){var t,i;return t=[],i=arguments.callee,n.forEach(function(n){return Array.prototype.push.apply(t,Array.isArray(n)?i(n):[n])}),t}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.PointProxy=function(n,t){this.world=n;this.destination=t};n.Physics.P2.PointProxy.prototype.constructor=n.Physics.P2.PointProxy;Object.defineProperty(n.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(n){this.destination[0]=this.world.pxm(n)}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(n){this.destination[1]=this.world.pxm(n)}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=n}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.InversePointProxy=function(n,t){this.world=n;this.destination=t};n.Physics.P2.InversePointProxy.prototype.constructor=n.Physics.P2.InversePointProxy;Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(n){this.destination[0]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(n){this.destination[1]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=-n}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=-n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Body=function(t,i,r,u,f){i=i||null;r=r||0;u=u||0;typeof f=="undefined"&&(f=1);this.game=t;this.world=t.physics.p2;this.sprite=i;this.type=n.Physics.P2JS;this.offset=new n.Point;this.data=new p2.Body({position:[this.world.pxmi(r),this.world.pxmi(u)],mass:f});this.data.parent=this;this.velocity=new n.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new n.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new n.Point;this.onBeginContact=new n.Signal;this.onEndContact=new n.Signal;this.collidesWith=[];this.removeNextStep=!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;i&&(this.setRectangleFromSprite(i),i.exists&&this.game.physics.p2.addBody(this))};n.Physics.P2.Body.prototype={createBodyCallback:function(n,t,i){var r=-1;n.id?r=n.id:n.body&&(r=n.body.id);r>-1&&(t===null?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=i))},createGroupCallback:function(n,t,i){t===null?(delete this._groupCallbacks[n.mask],delete this._groupCallbacksContext[n.mask]):(this._groupCallbacks[n.mask]=t,this._groupCallbackContext[n.mask]=i)},getCollisionMask:function(){var n=0,t;for(this._collideWorldBounds&&(n=this.game.physics.p2.boundsCollisionGroup.mask),t=0;t<this.collidesWith.length;t++)n=n|this.collidesWith[t].mask;return n},updateCollisionMask:function(n){var i=this.getCollisionMask(),t;if(typeof n=="undefined")for(t=this.data.shapes.length-1;t>=0;t--)this.data.shapes[t].collisionMask=i;else n.collisionMask=i},setCollisionGroup:function(n,t){var r=this.getCollisionMask(),i;if(typeof t=="undefined")for(i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionGroup=n.mask,this.data.shapes[i].collisionMask=r;else t.collisionGroup=n.mask,t.collisionMask=r},clearCollision:function(n,t,i){if(typeof n=="undefined"&&(n=!0),typeof t=="undefined"&&(t=!0),typeof i=="undefined")for(var r=this.data.shapes.length-1;r>=0;r--)n&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else n&&(i.collisionGroup=null),t&&(i.collisionMask=null);n&&(this.collidesWith.length=0)},collides:function(n,t,i,r){var f,u;if(Array.isArray(n))for(u=0;u<n.length;u++)this.collidesWith.indexOf(n[u])===-1&&(this.collidesWith.push(n[u]),t&&this.createGroupCallback(n[u],t,i));else this.collidesWith.indexOf(n)===-1&&(this.collidesWith.push(n),t&&this.createGroupCallback(n,t,i));if(f=this.getCollisionMask(),typeof r=="undefined")for(u=this.data.shapes.length-1;u>=0;u--)this.data.shapes[u].collisionMask=f;else r.collisionMask=f},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},applyDamping:function(n){this.data.applyDamping(n)},applyForce:function(n,t,i){this.data.applyForce(n,[this.world.pxmi(t),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(n,t){return this.data.toLocalFrame(n,t)},toWorldFrame:function(n,t){return this.data.toWorldFrame(n,t)},rotateLeft:function(n){this.data.angularVelocity=this.world.pxm(-n)},rotateRight:function(n){this.data.angularVelocity=this.world.pxm(n)},moveForward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=t*Math.cos(i);this.data.velocity[1]=t*Math.sin(i)},moveBackward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(t*Math.cos(i));this.data.velocity[1]=-(t*Math.sin(i))},thrust:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]+=t*Math.cos(i);this.data.force[1]+=t*Math.sin(i)},reverse:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]-=t*Math.cos(i);this.data.force[1]-=t*Math.sin(i)},moveLeft:function(n){this.data.velocity[0]=this.world.pxmi(-n)},moveRight:function(n){this.data.velocity[0]=this.world.pxmi(n)},moveUp:function(n){this.data.velocity[1]=this.world.pxmi(-n)},moveDown:function(n){this.data.velocity[1]=this.world.pxmi(n)},preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(n,t,i,r){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();i&&this.setZeroDamping();r&&(this.mass=1);this.x=n;this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var n=0;n<this.game.physics.p2._toRemove.length;n++)this.game.physics.p2._toRemove[n]===this&&this.game.physics.p2._toRemove.splice(n,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite.body=null;this.sprite=null},clearShapes:function(){for(var n=this.data.shapes.length;n--;)this.data.removeShape(this.data.shapes[n]);this.shapeChanged()},addShape:function(n,t,i,r){return typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=0),this.data.addShape(n,[this.world.pxmi(t),this.world.pxmi(i)],r),this.shapeChanged(),n},addCircle:function(n,t,i,r){var u=new p2.Circle(this.world.pxm(n));return this.addShape(u,t,i,r)},addRectangle:function(n,t,i,r,u){var f=new p2.Rectangle(this.world.pxm(n),this.world.pxm(t));return this.addShape(f,i,r,u)},addPlane:function(n,t,i){var r=new p2.Plane;return this.addShape(r,n,t,i)},addParticle:function(n,t,i){var r=new p2.Particle;return this.addShape(r,n,t,i)},addLine:function(n,t,i,r){var u=new p2.Line(this.world.pxm(n));return this.addShape(u,t,i,r)},addCapsule:function(n,t,i,r,u){var f=new p2.Capsule(this.world.pxm(n),this.world.pxm(t));return this.addShape(f,i,r,u)},addPolygon:function(n,t){var i,u,e,f,r,o;if(n=n||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),i=[],t.length===1&&Array.isArray(t[0]))i=t[0].slice(0);else if(Array.isArray(t[0]))i=t.slice();else if(typeof t[0]=="number")for(u=0,e=t.length;u<e;u+=2)i.push([t[u],t[u+1]]);for(f=i.length-1,i[f][0]===i[0][0]&&i[f][1]===i[0][1]&&i.pop(),r=0;r<i.length;r++)i[r][0]=this.world.pxmi(i[r][0]),i[r][1]=this.world.pxmi(i[r][1]);return o=this.data.fromPolygon(i,n),this.shapeChanged(),o},removeShape:function(n){var t=this.data.removeShape(n);return this.shapeChanged(),t},setCircle:function(n,t,i,r){return this.clearShapes(),this.addCircle(n,t,i,r)},setRectangle:function(n,t,i,r,u){return typeof n=="undefined"&&(n=16),typeof t=="undefined"&&(t=16),this.clearShapes(),this.addRectangle(n,t,i,r,u)},setRectangleFromSprite:function(n){return typeof n=="undefined"&&(n=this.sprite),this.clearShapes(),this.addRectangle(n.width,n.height,0,0,n.rotation)},setMaterial:function(n,t){if(typeof t=="undefined")for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=n;else t.material=n},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(n,t){for(var i,f,e=this.game.cache.getPhysicsData(n,t),r=[],u=0;u<e.length;u++)i=e[u],f=this.addFixture(i),r[i.filter.group]=r[i.filter.group]||[],r[i.filter.group]=r[i.filter.group].concat(f),i.fixtureKey&&(r[i.fixtureKey]=f);return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),r},addFixture:function(n){var s=[],u,h,i,f,e,c,r,t,o,l;if(n.circle)t=new p2.Circle(this.world.pxm(n.circle.radius)),t.collisionGroup=n.filter.categoryBits,t.collisionMask=n.filter.maskBits,t.sensor=n.isSensor,u=p2.vec2.create(),u[0]=this.world.pxmi(n.circle.position[0]-this.sprite.width/2),u[1]=this.world.pxmi(n.circle.position[1]-this.sprite.height/2),this.data.addShape(t,u),s.push(t);else for(h=n.polygons,i=p2.vec2.create(),f=0;f<h.length;f++){for(e=h[f],c=[],r=0;r<e.length;r+=2)c.push([this.world.pxmi(e[r]),this.world.pxmi(e[r+1])]);for(t=new p2.Convex(c),o=0;o!==t.vertices.length;o++)l=t.vertices[o],p2.vec2.sub(l,l,t.centerOfMass);p2.vec2.scale(i,t.centerOfMass,1);i[0]-=this.world.pxmi(this.sprite.width/2);i[1]-=this.world.pxmi(this.sprite.height/2);t.updateTriangles();t.updateCenterOfMass();t.updateBoundingRadius();t.collisionGroup=n.filter.categoryBits;t.collisionMask=n.filter.maskBits;t.sensor=n.isSensor;this.data.addShape(t,i);s.push(t)}return s},loadPolygon:function(n,t){for(var s,u,i,o,h,f=this.game.cache.getPhysicsData(n,t),e=p2.vec2.create(),r=0;r<f.length;r++){for(s=[],u=0;u<f[r].shape.length;u+=2)s.push([this.world.pxmi(f[r].shape[u]),this.world.pxmi(f[r].shape[u+1])]);for(i=new p2.Convex(s),o=0;o!==i.vertices.length;o++)h=i.vertices[o],p2.vec2.sub(h,h,i.centerOfMass);p2.vec2.scale(e,i.centerOfMass,1);e[0]-=this.world.pxmi(this.sprite.width/2);e[1]-=this.world.pxmi(this.sprite.height/2);i.updateTriangles();i.updateCenterOfMass();i.updateBoundingRadius();this.data.addShape(i,e)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}};n.Physics.P2.Body.prototype.constructor=n.Physics.P2.Body;n.Physics.P2.Body.DYNAMIC=1;n.Physics.P2.Body.STATIC=2;n.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(n.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===n.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.STATIC?(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==n.Physics.P2.Body.STATIC||(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass===0&&(this.mass=1))}});Object.defineProperty(n.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===n.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.DYNAMIC?(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass===0&&(this.mass=1)):t||this.data.type!==n.Physics.P2.Body.DYNAMIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(n.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===n.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.KINEMATIC?(this.data.type=n.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==n.Physics.P2.Body.KINEMATIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(n.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(n){n!==this.data.allowSleep&&(this.data.allowSleep=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(n){this.data.angularDamping=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(n){this.data.angularForce=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(n){this.data.angularVelocity=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(n){this.data.damping=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(n){n!==this.data.fixedRotation&&(this.data.fixedRotation=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(n){this.data.inertia=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(n){n!==this.data.mass&&(this.data.mass=n,this.data.updateMassProperties())}});Object.defineProperty(n.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(n){n!==this.data.type&&(this.data.type=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(n){this.data.angle=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(n){this.data.sleepSpeedLimit=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(n){this.data.position[0]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(n){this.data.position[1]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(n.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(t){t&&!this.debugBody?this.debugBody=new n.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(n.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(n){n&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!n&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}});
/**
* @author       George https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.BodyDebug=function(t,i,r){n.Group.call(this,t);this.settings=n.Utils.extend({pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,alpha:.5},r);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=i;this.canvas=new n.Graphics(t);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};n.Physics.P2.BodyDebug.prototype=Object.create(n.Group.prototype);n.Physics.P2.BodyDebug.prototype.constructor=n.Physics.P2.BodyDebug;n.Utils.extend(n.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var r,n,e,o,a,s,i,f,t,u,y,v,l,h,c,p;if(f=this.body,u=this.canvas,u.clear(),e=parseInt(this.randomPastelHex(),16),s=16711680,i=this.lineWidth,f instanceof p2.Body&&f.shapes.length)for(p=f.shapes.length,o=0;o!==p;){if(n=f.shapes[o],t=f.shapeOffsets[o],r=f.shapeAngles[o],t=t||0,r=r||0,n instanceof p2.Circle)this.drawCircle(u,t[0]*this.ppu,t[1]*this.ppu,r,n.radius*this.ppu,e,i);else if(n instanceof p2.Capsule)this.drawCapsule(u,t[0]*this.ppu,t[1]*this.ppu,r,n.length*this.ppu,n.radius*this.ppu,s,e,i);else if(n instanceof p2.Plane)this.drawPlane(u,t[0]*this.ppu,-t[1]*this.ppu,e,s,i*5,i*10,i*10,this.ppu*100,r);else if(n instanceof p2.Line)this.drawLine(u,n.length*this.ppu,s,i);else if(n instanceof p2.Rectangle)this.drawRectangle(u,t[0]*this.ppu,t[1]*this.ppu,r,n.width*this.ppu,n.height*this.ppu,s,e,i);else if(n instanceof p2.Convex){for(v=[],l=p2.vec2.create(),a=h=0,c=n.vertices.length;0<=c?h<c:h>c;a=0<=c?++h:--h)y=n.vertices[a],p2.vec2.rotate(l,y,r),v.push([(l[0]+t[0])*this.ppu,-(l[1]+t[1])*this.ppu]);this.drawConvex(u,v,n.triangles,s,e,i,this.settings.debugPolygons,[t[0]*this.ppu,-t[1]*this.ppu])}o++}},drawRectangle:function(n,t,i,r,u,f,e,o,s){typeof s=="undefined"&&(s=1);typeof e=="undefined"&&(e=0);n.lineStyle(s,e,1);n.beginFill(o);n.drawRect(t-u/2,i-f/2,u,f)},drawCircle:function(n,t,i,r,u,f,e){typeof e=="undefined"&&(e=1);typeof f=="undefined"&&(f=16777215);n.lineStyle(e,0,1);n.beginFill(f,1);n.drawCircle(t,i,-u*2);n.endFill();n.moveTo(t,i);n.lineTo(t+u*Math.cos(-r),i+u*Math.sin(-r))},drawLine:function(n,t,i,r){typeof r=="undefined"&&(r=1);typeof i=="undefined"&&(i=0);n.lineStyle(r*5,i,1);n.moveTo(-t/2,0);n.lineTo(t/2,0)},drawConvex:function(n,t,i,r,u,f,e,o){var h,s,c,l,a,v,y,b,p,w,k;if(typeof f=="undefined"&&(f=1),typeof r=="undefined"&&(r=0),e){for(h=[16711680,65280,255],s=0;s!==t.length+1;)l=t[s%t.length],a=t[(s+1)%t.length],y=l[0],w=l[1],b=a[0],k=a[1],n.lineStyle(f,h[s%h.length],1),n.moveTo(y,-w),n.lineTo(b,-k),n.drawCircle(y,-w,f*2),s++;return n.lineStyle(f,0,1),n.drawCircle(o[0],o[1],f*2)}for(n.lineStyle(f,r,1),n.beginFill(u),s=0;s!==t.length;)c=t[s],v=c[0],p=c[1],s===0?n.moveTo(v,-p):n.lineTo(v,-p),s++;if(n.endFill(),t.length>2)return n.moveTo(t[t.length-1][0],-t[t.length-1][1]),n.lineTo(t[0][0],-t[0][1])},drawPath:function(n,t,i,r,u){var v,f,s,h,c,l,y,p,w,b,a,e,o;for(typeof u=="undefined"&&(u=1),typeof i=="undefined"&&(i=0),n.lineStyle(u,i,1),typeof r=="number"&&n.beginFill(r),s=null,h=null,f=0;f<t.length;)a=t[f],e=a[0],o=a[1],(e!==s||o!==h)&&(f===0?n.moveTo(e,o):(c=s,l=h,y=e,p=o,w=t[(f+1)%t.length][0],b=t[(f+1)%t.length][1],v=(y-c)*(b-l)-(w-c)*(p-l),v!==0&&n.lineTo(e,o)),s=e,h=o),f++;typeof r=="number"&&n.endFill();t.length>2&&typeof r=="number"&&(n.moveTo(t[t.length-1][0],t[t.length-1][1]),n.lineTo(t[0][0],t[0][1]))},drawPlane:function(n,t,i,r,u,f,e,o,s,h){var a,c,l;typeof f=="undefined"&&(f=1);typeof r=="undefined"&&(r=16777215);n.lineStyle(f,u,11);n.beginFill(r);a=s;n.moveTo(t,-i);c=t+Math.cos(h)*this.game.width;l=i+Math.sin(h)*this.game.height;n.lineTo(c,-l);n.moveTo(t,-i);c=t+Math.cos(h)*-this.game.width;l=i+Math.sin(h)*-this.game.height;n.lineTo(c,-l)},drawCapsule:function(n,t,i,r,u,f,e,o,s){typeof s=="undefined"&&(s=1);typeof e=="undefined"&&(e=0);n.lineStyle(s,e,1);var h=Math.cos(r),c=Math.sin(r);n.beginFill(o,1);n.drawCircle(-u/2*h+t,-u/2*c+i,-f*2);n.drawCircle(u/2*h+t,u/2*c+i,-f*2);n.endFill();n.lineStyle(s,e,0);n.beginFill(o,1);n.moveTo(-u/2*h+f*c+t,-u/2*c+f*h+i);n.lineTo(u/2*h+f*c+t,u/2*c+f*h+i);n.lineTo(u/2*h-f*c+t,u/2*c-f*h+i);n.lineTo(-u/2*h-f*c+t,-u/2*c-f*h+i);n.endFill();n.lineStyle(s,e,1);n.moveTo(-u/2*h+f*c+t,-u/2*c+f*h+i);n.lineTo(u/2*h+f*c+t,u/2*c+f*h+i);n.moveTo(-u/2*h-f*c+t,-u/2*c-f*h+i);n.lineTo(u/2*h-f*c+t,u/2*c-f*h+i)},randomPastelHex:function(){var n,t,i,r;return i=[255,255,255],r=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor((r+3*i[0])/4),t=Math.floor((t+3*i[1])/4),n=Math.floor((n+3*i[2])/4),this.rgbToHex(r,t,n)},rgbToHex:function(n,t,i){return this.componentToHex(n)+this.componentToHex(t)+this.componentToHex(i)},componentToHex:function(n){var t;return t=n.toString(16),t.len===2?t:t+"0"}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Spring=function(n,t,i,r,u,f,e,o,s,h){this.game=n.game;this.world=n;typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=100);typeof f=="undefined"&&(f=1);r=n.pxm(r);var c={restLength:r,stiffness:u,damping:f};typeof e!="undefined"&&e!==null&&(c.worldAnchorA=[n.pxm(e[0]),n.pxm(e[1])]);typeof o!="undefined"&&o!==null&&(c.worldAnchorB=[n.pxm(o[0]),n.pxm(o[1])]);typeof s!="undefined"&&s!==null&&(c.localAnchorA=[n.pxm(s[0]),n.pxm(s[1])]);typeof h!="undefined"&&h!==null&&(c.localAnchorB=[n.pxm(h[0]),n.pxm(h[1])]);this.data=new p2.LinearSpring(t,i,c);this.data.parent=this};n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.RotationalSpring=function(n,t,i,r,u,f){this.game=n.game;this.world=n;typeof r=="undefined"&&(r=null);typeof u=="undefined"&&(u=100);typeof f=="undefined"&&(f=1);r&&(r=n.pxm(r));var e={restAngle:r,stiffness:u,damping:f};this.data=new p2.RotationalSpring(t,i,e);this.data.parent=this};n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Material=function(n){this.name=n;p2.Material.call(this)};n.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);n.Physics.P2.Material.prototype.constructor=n.Physics.P2.Material;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.ContactMaterial=function(n,t,i){p2.ContactMaterial.call(this,n,t,i)};n.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);n.Physics.P2.ContactMaterial.prototype.constructor=n.Physics.P2.ContactMaterial;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.CollisionGroup=function(n){this.mask=n};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.DistanceConstraint=function(n,t,i,r,u,f,e){typeof r=="undefined"&&(r=100);typeof u=="undefined"&&(u=[0,0]);typeof f=="undefined"&&(f=[0,0]);typeof e=="undefined"&&(e=Number.MAX_VALUE);this.game=n.game;this.world=n;r=n.pxm(r);u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var o={distance:r,localAnchorA:u,localAnchorB:f,maxForce:e};p2.DistanceConstraint.call(this,t,i,o)};n.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);n.Physics.P2.DistanceConstraint.prototype.constructor=n.Physics.P2.DistanceConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.GearConstraint=function(n,t,i,r,u){typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=1);this.game=n.game;this.world=n;var f={angle:r,ratio:u};p2.GearConstraint.call(this,t,i,f)};n.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);n.Physics.P2.GearConstraint.prototype.constructor=n.Physics.P2.GearConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.LockConstraint=function(n,t,i,r,u,f){typeof r=="undefined"&&(r=[0,0]);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=Number.MAX_VALUE);this.game=n.game;this.world=n;r=[n.pxm(r[0]),n.pxm(r[1])];var e={localOffsetB:r,localAngleB:u,maxForce:f};p2.LockConstraint.call(this,t,i,e)};n.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);n.Physics.P2.LockConstraint.prototype.constructor=n.Physics.P2.LockConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.PrismaticConstraint=function(n,t,i,r,u,f,e,o){typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=[0,0]);typeof f=="undefined"&&(f=[0,0]);typeof e=="undefined"&&(e=[0,0]);typeof o=="undefined"&&(o=Number.MAX_VALUE);this.game=n.game;this.world=n;u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var s={localAnchorA:u,localAnchorB:f,localAxisA:e,maxForce:o,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,t,i,s)};n.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);n.Physics.P2.PrismaticConstraint.prototype.constructor=n.Physics.P2.PrismaticConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.RevoluteConstraint=function(n,t,i,r,u,f,e){typeof f=="undefined"&&(f=Number.MAX_VALUE);typeof e=="undefined"&&(e=null);this.game=n.game;this.world=n;i=[n.pxmi(i[0]),n.pxmi(i[1])];u=[n.pxmi(u[0]),n.pxmi(u[1])];e&&(e=[n.pxmi(e[0]),n.pxmi(e[1])]);var o={worldPivot:e,localPivotA:i,localPivotB:u,maxForce:f};p2.RevoluteConstraint.call(this,t,r,o)};n.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);n.Physics.P2.RevoluteConstraint.prototype.constructor=n.Physics.P2.RevoluteConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tile=function(n,t,i,r,u,f){this.layer=n;this.index=t;this.x=i;this.y=r;this.rotation=0;this.flipped=!1;this.worldX=i*u;this.worldY=r*f;this.width=u;this.height=f;this.centerX=Math.abs(u/2);this.centerY=Math.abs(f/2);this.alpha=1;this.properties={};this.scanned=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1;this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.collisionCallback=null;this.collisionCallbackContext=this};n.Tile.prototype={containsPoint:function(n,t){return!(n<this.worldX||t<this.worldY||n>this.right||t>this.bottom)},intersects:function(n,t,i,r){return i<=this.worldX?!1:r<=this.worldY?!1:n>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(n,t){this.collisionCallback=n;this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(n,t,i,r){this.collideLeft=n;this.collideRight=t;this.collideUp=i;this.collideDown=r;this.faceLeft=n;this.faceRight=t;this.faceTop=i;this.faceBottom=r},resetCollision:function(){this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1},isInteresting:function(n,t){return n&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:n?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(n){this.index=n.index;this.alpha=n.alpha;this.properties=n.properties;this.collideUp=n.collideUp;this.collideDown=n.collideDown;this.collideLeft=n.collideLeft;this.collideRight=n.collideRight;this.collisionCallback=n.collisionCallback;this.collisionCallbackContext=n.collisionCallbackContext}};n.Tile.prototype.constructor=n.Tile;Object.defineProperty(n.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tilemap=function(t,i,r,u,f,e){this.game=t;this.key=i;var o=n.TilemapParser.parse(this.game,i,r,u,f,e);o!==null&&(this.width=o.width,this.height=o.height,this.tileWidth=o.tileWidth,this.tileHeight=o.tileHeight,this.orientation=o.orientation,this.format=o.format,this.version=o.version,this.properties=o.properties,this.widthInPixels=o.widthInPixels,this.heightInPixels=o.heightInPixels,this.layers=o.layers,this.tilesets=o.tilesets,this.tiles=o.tiles,this.objects=o.objects,this.collideIndexes=[],this.collision=o.collision,this.images=o.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)};n.Tilemap.CSV=0;n.Tilemap.TILED_JSON=1;n.Tilemap.NORTH=0;n.Tilemap.EAST=1;n.Tilemap.SOUTH=2;n.Tilemap.WEST=3;n.Tilemap.prototype={create:function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=this.game.world),this.width=t,this.height=i,this.setTileSize(r,u),this.layers.length=0,this.createBlankLayer(n,t,i,r,u,f)},setTileSize:function(n,t){this.tileWidth=n;this.tileHeight=t;this.widthInPixels=this.width*n;this.heightInPixels=this.height*t},addTilesetImage:function(t,i,r,u,f,e,o){var s,h;if(typeof r=="undefined"&&(r=this.tileWidth),typeof u=="undefined"&&(u=this.tileHeight),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),typeof o=="undefined"&&(o=0),r===0&&(r=32),u===0&&(u=32),typeof i=="undefined")if(typeof t=="string"){if(i=t,!this.game.cache.checkImageKey(i))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+i+'"'),null}else return null;if(typeof t=="string"&&(t=this.getTilesetIndex(t),t===null&&this.format===n.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+i+'"'),null;if(this.tilesets[t])return this.tilesets[t].setImage(this.game.cache.getImage(i)),this.tilesets[t];s=new n.Tileset(i,o,r,u,f,e,{});s.setImage(this.game.cache.getImage(i));this.tilesets.push(s);var p=this.tilesets.length-1,c=f,a=f,v=0,l=0,y=0;for(h=o;h<o+s.total;h++){if(this.tiles[h]=[c,a,p],c+=r+e,v++,v===s.total)break;if(l++,l===s.columns&&(c=f,a+=u+e,l=0,y++,y===s.rows))break}return s},createFromObjects:function(t,i,r,u,f,e,o,s,h){var l,c,v,a;if(typeof f=="undefined"&&(f=!0),typeof e=="undefined"&&(e=!1),typeof o=="undefined"&&(o=this.game.world),typeof s=="undefined"&&(s=n.Sprite),typeof h=="undefined"&&(h=!0),!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);return}for(c=0,v=this.objects[t].length;c<v;c++)if(this.objects[t][c].gid===i){l=new s(this.game,this.objects[t][c].x,this.objects[t][c].y,r,u);l.name=this.objects[t][c].name;l.visible=this.objects[t][c].visible;l.autoCull=e;l.exists=f;this.objects[t][c].rotation&&(l.angle=this.objects[t][c].rotation);h&&(l.y-=l.height);o.add(l);for(a in this.objects[t][c].properties)o.set(l,a,this.objects[t][c].properties[a],!1,!1,0,!0)}},createFromTiles:function(t,i,r,u,f,e){var s,h,c,l,o,v,a;if(typeof t=="number"&&(t=[t]),typeof i=="undefined"||i===null?i=[]:typeof i=="number"&&(i=[i]),u=this.getLayer(u),typeof f=="undefined"&&(f=this.game.world),typeof e=="undefined"&&(e={}),e.customClass===undefined&&(e.customClass=n.Sprite),e.adjustY===undefined&&(e.adjustY=!0),s=this.layers[u].width,h=this.layers[u].height,this.copy(0,0,s,h,u),this._results.length<2)return 0;for(c=0,o=1,v=this._results.length;o<v;o++)if(t.indexOf(this._results[o].index)!==-1){l=new e.customClass(this.game,this._results[o].worldX,this._results[o].worldY,r);for(a in e)l[a]=e[a];f.add(l);c++}if(i.length===1)for(o=0;o<t.length;o++)this.replace(t[o],i[0],0,0,s,h,u);else if(i.length>1)for(o=0;o<t.length;o++)this.replace(t[o],i[o],0,0,s,h,u);return c},createLayer:function(t,i,r,u){typeof i=="undefined"&&(i=this.game.width);typeof r=="undefined"&&(r=this.game.height);typeof u=="undefined"&&(u=this.game.world);var f=t;if(typeof t=="string"&&(f=this.getLayerIndex(t)),f===null||f>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+f);return}return u.add(new n.TilemapLayer(this.game,this,f,i,r))},createBlankLayer:function(t,i,r,u,f,e){var o,v,h,c,l,a,s;if(typeof e=="undefined"&&(e=this.game.world),this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}for(o={name:t,x:0,y:0,width:i,height:r,widthInPixels:i*u,heightInPixels:r*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},s=[],h=0;h<r;h++){for(v=[],c=0;c<i;c++)v.push(new n.Tile(o,-1,c,h,u,f));s.push(v)}return o.data=s,this.layers.push(o),this.currentLayer=this.layers.length-1,l=o.widthInPixels,a=o.heightInPixels,l>this.game.width&&(l=this.game.width),a>this.game.height&&(a=this.game.height),s=new n.TilemapLayer(this.game,this,this.layers.length-1,l,a),s.name=t,e.add(s)},getIndex:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return i;return null},getLayerIndex:function(n){return this.getIndex(this.layers,n)},getTilesetIndex:function(n){return this.getIndex(this.tilesets,n)},getImageIndex:function(n){return this.getIndex(this.images,n)},getObjectIndex:function(n){return this.getIndex(this.objects,n)},setTileIndexCallback:function(n,t,i,r){if(r=this.getLayer(r),typeof n=="number")this.layers[r].callbacks[n]={callback:t,callbackContext:i};else for(var u=0,f=n.length;u<f;u++)this.layers[r].callbacks[n[u]]={callback:t,callbackContext:i}},setTileLocationCallback:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(n,t,i,r,e),!(this._results.length<2))for(var o=1;o<this._results.length;o++)this._results[o].setCollisionCallback(u,f)},setCollision:function(n,t,i,r){if(typeof t=="undefined"&&(t=!0),typeof r=="undefined"&&(r=!0),i=this.getLayer(i),typeof n=="number")return this.setCollisionByIndex(n,t,i,!0);if(Array.isArray(n)){for(var u=0;u<n.length;u++)this.setCollisionByIndex(n[u],t,i,!1);r&&this.calculateFaces(i)}},setCollisionBetween:function(n,t,i,r,u){if(typeof i=="undefined"&&(i=!0),typeof u=="undefined"&&(u=!0),r=this.getLayer(r),!(n>t)){for(var f=n;f<=t;f++)this.setCollisionByIndex(f,i,r,!1);u&&this.calculateFaces(r)}},setCollisionByExclusion:function(n,t,i,r){typeof t=="undefined"&&(t=!0);typeof r=="undefined"&&(r=!0);i=this.getLayer(i);for(var u=0,f=this.tiles.length;u<f;u++)n.indexOf(u)===-1&&this.setCollisionByIndex(u,t,i,!1);r&&this.calculateFaces(i)},setCollisionByIndex:function(n,t,i,r){var o,f,e,u;for(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=this.currentLayer),typeof r=="undefined"&&(r=!0),t?this.collideIndexes.push(n):(o=this.collideIndexes.indexOf(n),o>-1&&this.collideIndexes.splice(o,1)),f=0;f<this.layers[i].height;f++)for(e=0;e<this.layers[i].width;e++)u=this.layers[i].data[f][e],u&&u.index===n&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t);return r&&this.calculateFaces(i),i},getLayer:function(t){return typeof t=="undefined"?t=this.currentLayer:typeof t=="string"?t=this.getLayerIndex(t):t instanceof n.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(n){if(n===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),n===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(n){var i,s,r,h,t;if(this.preventingRecalculate){this.needToRecalculate[n]=!0;return}var u=null,f=null,e=null,o=null;for(i=0,s=this.layers[n].height;i<s;i++)for(r=0,h=this.layers[n].width;r<h;r++)t=this.layers[n].data[i][r],t&&(u=this.getTileAbove(n,r,i),f=this.getTileBelow(n,r,i),e=this.getTileLeft(n,r,i),o=this.getTileRight(n,r,i),t.collides&&(t.faceTop=!0,t.faceBottom=!0,t.faceLeft=!0,t.faceRight=!0),u&&u.collides&&(t.faceTop=!1),f&&f.collides&&(t.faceBottom=!1),e&&e.collides&&(t.faceLeft=!1),o&&o.collides&&(t.faceRight=!1))},getTileAbove:function(n,t,i){return i>0?this.layers[n].data[i-1][t]:null},getTileBelow:function(n,t,i){return i<this.layers[n].height-1?this.layers[n].data[i+1][t]:null},getTileLeft:function(n,t,i){return t>0?this.layers[n].data[i][t-1]:null},getTileRight:function(n,t,i){return t<this.layers[n].width-1?this.layers[n].data[i][t+1]:null},setLayer:function(n){n=this.getLayer(n);this.layers[n]&&(this.currentLayer=n)},hasTile:function(n,t,i){return i=this.getLayer(i),this.layers[i].data[t][n].index>-1},removeTile:function(t,i,r){if(r=this.getLayer(r),t>=0&&t<this.layers[r].width&&i>=0&&i<this.layers[r].height&&this.hasTile(t,i,r)){var u=this.layers[r].data[i][t];return this.layers[r].data[i][t]=new n.Tile(this.layers[r],-1,t,i,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),u}},removeTileWorldXY:function(n,t,i,r,u){return u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(n,t,u)},putTile:function(t,i,r,u){if(t===null)return this.removeTile(i,r,u);if(u=this.getLayer(u),i>=0&&i<this.layers[u].width&&r>=0&&r<this.layers[u].height){var f;return t instanceof n.Tile?(f=t.index,this.hasTile(i,r,u)?this.layers[u].data[r][i].copy(t):this.layers[u].data[r][i]=new n.Tile(u,f,i,r,t.width,t.height)):(f=t,this.hasTile(i,r,u)?this.layers[u].data[r][i].index=f:this.layers[u].data[r][i]=new n.Tile(this.layers[u],f,i,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(f)>-1?this.layers[u].data[r][i].setCollision(!0,!0,!0,!0):this.layers[u].data[r][i].resetCollision(),this.layers[u].dirty=!0,this.calculateFaces(u),this.layers[u].data[r][i]}return null},putTileWorldXY:function(n,t,i,r,u,f){return f=this.getLayer(f),t=this.game.math.snapToFloor(t,r)/r,i=this.game.math.snapToFloor(i,u)/u,this.putTile(n,t,i,f)},searchTileIndex:function(n,t,i,r){var e,u,f;if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=!1),r=this.getLayer(r),e=0,i){for(u=this.layers[r].height-1;u>=0;u--)for(f=this.layers[r].width-1;f>=0;f--)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}}else for(u=0;u<this.layers[r].height;u++)for(f=0;f<this.layers[r].width;f++)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}return null},getTile:function(n,t,i,r){return typeof r=="undefined"&&(r=!1),i=this.getLayer(i),n>=0&&n<this.layers[i].width&&t>=0&&t<this.layers[i].height?this.layers[i].data[t][n].index===-1?r?this.layers[i].data[t][n]:null:this.layers[i].data[t][n]:null},getTileWorldXY:function(n,t,i,r,u){return typeof i=="undefined"&&(i=this.tileWidth),typeof r=="undefined"&&(r=this.tileHeight),u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.getTile(n,t,u)},copy:function(n,t,i,r,u){var f,e;if(u=this.getLayer(u),!this.layers[u]){this._results.length=0;return}for(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=this.layers[u].width),typeof r=="undefined"&&(r=this.layers[u].height),n<0&&(n=0),t<0&&(t=0),i>this.layers[u].width&&(i=this.layers[u].width),r>this.layers[u].height&&(r=this.layers[u].height),this._results.length=0,this._results.push({x:n,y:t,width:i,height:r,layer:u}),f=t;f<t+r;f++)for(e=n;e<n+i;e++)this._results.push(this.layers[u].data[f][e]);return this._results},paste:function(n,t,i,r){var f,e,u;if(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),r=this.getLayer(r),i&&!(i.length<2)){for(f=n-i[1].x,e=t-i[1].y,u=1;u<i.length;u++)this.layers[r].data[e+i[u].y][f+i[u].x].copy(i[u]);this.layers[r].dirty=!0;this.calculateFaces(r)}},swap:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._tempA=n,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(i,r,this._results,e))},swapHandler:function(n){n.index===this._tempA?n.index=this._tempB:n.index===this._tempB&&(n.index=this._tempA)},forEach:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._results.forEach(n,t),this.paste(i,r,this._results,e))},replace:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(i,r,u,f,e),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index===n&&(this._results[o].index=t);this.paste(i,r,this._results,e)}},random:function(n,t,i,r,u){var e,f,s,o;if(u=this.getLayer(u),this.copy(n,t,i,r,u),!(this._results.length<2)){for(e=[],f=1;f<this._results.length;f++)this._results[f].index&&(s=this._results[f].index,e.indexOf(s)===-1&&e.push(s));for(o=1;o<this._results.length;o++)this._results[o].index=this.game.rnd.pick(e);this.paste(n,t,this._results,u)}},shuffle:function(t,i,r,u,f){var s,e,o;if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(s=[],e=1;e<this._results.length;e++)this._results[e].index&&s.push(this._results[e].index);for(n.Utils.shuffle(s),o=1;o<this._results.length;o++)this._results[o].index=s[o-1];this.paste(t,i,this._results,f)}},fill:function(n,t,i,r,u,f){if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(var e=1;e<this._results.length;e++)this._results[e].index=n;this.paste(t,i,this._results,f)}},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){for(var n,r="",t=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(n=0;n<this.layers[this.currentLayer].width;n++)r+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");r+="\n"}t[0]=r;console.log.apply(console,t)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};n.Tilemap.prototype.constructor=n.Tilemap;Object.defineProperty(n.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(n){n!==this.currentLayer&&this.setLayer(n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapLayer=function(t,i,r,u,f){u|=0;f|=0;PIXI.Sprite.call(this,PIXI.TextureCache.__default);n.Component.Core.init.call(this,t,0,0,null,null);this.map=i;this.index=r;this.layer=i.layers[r];this.canvas=n.Canvas.create(u,f);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,u,f,"tilemapLayer",t.rnd.uuid());this.type=n.TILEMAPLAYER;this.physicsType=n.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=!0;this.rayStepRate=4;this._wrap=!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:i.tileWidth,tileHeight:i.tileHeight,cw:i.tileWidth,ch:i.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=n.TilemapLayer.ensureSharedCopyCanvas());this.fixedToCamera=!0};n.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);n.TilemapLayer.prototype.constructor=n.TilemapLayer;l=["Bounds","Destroy","FixedToCamera","Reset","Smoothed"];n.Component.Core.install.call(n.TilemapLayer.prototype,l);n.TilemapLayer.sharedCopyCanvas=null;n.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=n.Canvas.create(2,2)),this.sharedCopyCanvas};n.TilemapLayer.prototype.preUpdate=function(){return n.Component.Core.preUpdate.call(this),!0};n.TilemapLayer.prototype.postUpdate=function(){n.Component.Core.prototype.postUpdate.call(this);var t=this.game.camera;this.scrollX=t.x*this.scrollFactorX/this.scale.x;this.scrollY=t.y*this.scrollFactorY/this.scale.y;this.render()};n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};n.TilemapLayer.prototype._fixX=function(n){return(n<0&&(n=0),this.scrollFactorX===1)?n:this._scrollX+(n-this._scrollX/this.scrollFactorX)};n.TilemapLayer.prototype._unfixX=function(n){return this.scrollFactorX===1?n:this._scrollX/this.scrollFactorX+(n-this._scrollX)};n.TilemapLayer.prototype._fixY=function(n){return(n<0&&(n=0),this.scrollFactorY===1)?n:this._scrollY+(n-this._scrollY/this.scrollFactorY)};n.TilemapLayer.prototype._unfixY=function(n){return this.scrollFactorY===1?n:this._scrollY/this.scrollFactorY+(n-this._scrollY)};n.TilemapLayer.prototype.getTileX=function(n){return Math.floor(this._fixX(n)/this._mc.tileWidth)};n.TilemapLayer.prototype.getTileY=function(n){return Math.floor(this._fixY(n)/this._mc.tileHeight)};n.TilemapLayer.prototype.getTileXY=function(n,t,i){return i.x=this.getTileX(n),i.y=this.getTileY(t),i};n.TilemapLayer.prototype.getRayCastTiles=function(n,t,i,r){var u,o,s,f,e,h,c;if(t||(t=this.rayStepRate),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=!1),u=this.getTiles(n.x,n.y,n.width,n.height,i,r),u.length===0)return[];for(o=n.coordinatesOnLine(t),s=[],f=0;f<u.length;f++)for(e=0;e<o.length;e++)if(h=u[f],c=o[e],h.containsPoint(c[0],c[1])){s.push(h);break}return s};n.TilemapLayer.prototype.getTiles=function(n,t,i,r,u,f){var l,s,e,o;typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!1);l=!(u||f);n=this._fixX(n);t=this._fixY(t);for(var h=Math.floor(n/(this._mc.cw*this.scale.x)),c=Math.floor(t/(this._mc.ch*this.scale.y)),a=Math.ceil((n+i)/(this._mc.cw*this.scale.x))-h,v=Math.ceil((t+r)/(this._mc.ch*this.scale.y))-c;this._results.length;)this._results.pop();for(s=c;s<c+v;s++)for(e=h;e<h+a;e++)o=this.layer.data[s],o&&o[e]&&(l||o[e].isInteresting(u,f))&&this._results.push(o[e]);return this._results.slice()};Object.defineProperty(n.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(n){this.debugSettings.missingImageFill=n}});Object.defineProperty(n.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(n){this._wrap=n;this.dirty=!0}});n.TilemapLayer.prototype.resolveTileset=function(n){var i=this._mc.tilesets,r,t;if(n<2e3)while(i.length<n)i.push(undefined);return i[n]=(r=this.map.tiles[n]&&this.map.tiles[n][2],r!=null&&(t=this.map.tilesets[r],t&&t.containsTileIndex(n)))?t:null};n.TilemapLayer.prototype.resetTilesetCache=function(){for(var n=this._mc.tilesets;n.length;)n.pop()};n.TilemapLayer.prototype.setScale=function(n,t){var r,f,u,i;for(n=n||1,t=t||n,r=0;r<this.layer.data.length;r++)for(f=this.layer.data[r],u=0;u<f.length;u++)i=f[u],i.width=this.map.tileWidth*n,i.height=this.map.tileHeight*t,i.worldX=i.x*i.width,i.worldY=i.y*i.height;this.scale.setTo(n,t)};n.TilemapLayer.prototype.shiftCanvas=function(n,t,i){var e=n.canvas,r=e.width-Math.abs(t),u=e.height-Math.abs(i),h=0,c=0,o=t,s=i,f,l;t<0&&(h=-t,o=0);i<0&&(c=-i,s=0);f=this.renderSettings.copyCanvas;f?((f.width<r||f.height<u)&&(f.width=r,f.height=u),l=f.getContext("2d"),l.clearRect(0,0,r,u),l.drawImage(e,h,c,r,u,0,0,r,u),n.clearRect(o,s,r,u),n.drawImage(f,0,0,r,u,o,s,r,u)):(n.save(),n.globalCompositeOperation="copy",n.drawImage(e,h,c,r,u,o,s,r,u),n.restore())};n.TilemapLayer.prototype.renderRegion=function(n,t,i,r,u,f){var o=this.context,l=this.layer.width,a=this.layer.height,w=this._mc.tileWidth,b=this._mc.tileHeight,tt=this._mc.tilesets,g=NaN,nt,e,p,c;this._wrap||(i<=u&&(i=Math.max(0,i),u=Math.min(l-1,u)),r<=f&&(r=Math.max(0,r),f=Math.min(a-1,f)));var it=i*w-n,rt=r*b-t,ut=(i+1048576*l)%l,ft=(r+1048576*a)%a,s,h,v,y,k,d;for(o.fillStyle=this.tileColor,y=ft,d=f-r,h=rt;d>=0;y++,d--,h+=b)for(y>=a&&(y-=a),nt=this.layer.data[y],v=ut,k=u-i,s=it;k>=0;v++,k--,s+=w)(v>=l&&(v-=l),e=nt[v],!e||e.index<0)||(p=e.index,c=tt[p],c===undefined&&(c=this.resolveTileset(p)),e.alpha===g||this.debug||(o.globalAlpha=e.alpha,g=e.alpha),c?e.rotation||e.flipped?(o.save(),o.translate(s+e.centerX,h+e.centerY),o.rotate(e.rotation),e.flipped&&o.scale(-1,1),c.draw(o,-e.centerX,-e.centerY,p),o.restore()):c.draw(o,s,h,p):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(s,h,w,b)),e.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(s,h,w,b)))};n.TilemapLayer.prototype.renderDeltaScroll=function(n,t){var i=this._mc.scrollX,r=this._mc.scrollY,c=this.canvas.width,l=this.canvas.height,u=this._mc.tileWidth,f=this._mc.tileHeight,e=0,o=-u,s=0,h=-f,a,v,y,p;n<0?(e=c+n,o=c-1):n>0&&(o=n);t<0?(s=l+t,h=l-1):t>0&&(h=t);this.shiftCanvas(this.context,n,t);e=Math.floor((e+i)/u);o=Math.floor((o+i)/u);s=Math.floor((s+r)/f);h=Math.floor((h+r)/f);e<=o&&(this.context.clearRect(e*u-i,0,(o-e+1)*u,l),a=Math.floor((0+r)/f),v=Math.floor((l-1+r)/f),this.renderRegion(i,r,e,a,o,v));s<=h&&(this.context.clearRect(0,s*f-r,c,(h-s+1)*f),y=Math.floor((0+i)/u),p=Math.floor((c-1+i)/u),this.renderRegion(i,r,y,s,p,h))};n.TilemapLayer.prototype.renderFull=function(){var n=this._mc.scrollX,t=this._mc.scrollY,i=this.canvas.width,r=this.canvas.height,u=this._mc.tileWidth,f=this._mc.tileHeight,e=Math.floor(n/u),o=Math.floor((i-1+n)/u),s=Math.floor(t/f),h=Math.floor((r-1+t)/f);this.context.clearRect(0,0,i,r);this.renderRegion(n,t,e,s,o,h)};n.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){this.context.save();(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,t=!0);var i=this.canvas.width,r=this.canvas.height,e=this._scrollX|0,o=this._scrollY|0,n=this._mc,u=n.scrollX-e,f=n.scrollY-o;if(t||u!==0||f!==0||n.renderWidth!==i||n.renderHeight!==r)return n.scrollX=e,n.scrollY=o,(n.renderWidth!==i||n.renderHeight!==r)&&(n.renderWidth=i,n.renderHeight=r),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(u)+Math.abs(f)<Math.min(i,r)?this.renderDeltaScroll(u,f):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}};n.TilemapLayer.prototype.renderDebug=function(){var c=this._mc.scrollX,l=this._mc.scrollY,n=this.context,b=this.canvas.width,k=this.canvas.height,e=this.layer.width,o=this.layer.height,s=this._mc.tileWidth,h=this._mc.tileHeight,a=Math.floor(c/s),d=Math.floor((b-1+c)/s),v=Math.floor(l/h),g=Math.floor((k-1+l)/h),nt=a*s-c,tt=v*h-l,it=(a+1048576*e)%e,rt=(v+1048576*o)%o,t,i,u,f,y,p,w,r;for(n.strokeStyle=this.debugSettings.facingEdgeStroke,f=rt,p=g-v,i=tt;p>=0;f++,p--,i+=h)for(f>=o&&(f-=o),w=this.layer.data[f],u=it,y=d-a,t=nt;y>=0;u++,y--,t+=s)(u>=e&&(u-=e),r=w[u],!r||r.index<0||!r.collides)||(this.debugSettings.collidingTileOverfill&&(n.fillStyle=this.debugSettings.collidingTileOverfill,n.fillRect(t,i,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(n.beginPath(),r.faceTop&&(n.moveTo(t,i),n.lineTo(t+this._mc.cw,i)),r.faceBottom&&(n.moveTo(t,i+this._mc.ch),n.lineTo(t+this._mc.cw,i+this._mc.ch)),r.faceLeft&&(n.moveTo(t,i),n.lineTo(t,i+this._mc.ch)),r.faceRight&&(n.moveTo(t+this._mc.cw,i),n.lineTo(t+this._mc.cw,i+this._mc.ch)),n.stroke()))};Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(n){this._scrollX=n}});Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(n){this._scrollY=n}});Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(n){this._mc.cw=n|0;this.dirty=!0}});Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(n){this._mc.ch=n|0;this.dirty=!0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapParser={parse:function(t,i,r,u,f,e){if(typeof r=="undefined"&&(r=32),typeof u=="undefined"&&(u=32),typeof f=="undefined"&&(f=10),typeof e=="undefined"&&(e=10),typeof i=="undefined")return this.getEmptyData();if(i===null)return this.getEmptyData(r,u,f,e);var o=t.cache.getTilemapData(i);if(o){if(o.format===n.Tilemap.CSV)return this.parseCSV(i,o.data,r,u);if(!o.format||o.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(o.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+i)},parseCSV:function(t,i,r,u){var f=this.getEmptyData(),e,h,o;i=i.trim();var c=[],l=i.split("\n"),a=l.length,s=0;for(e=0;e<l.length;e++){for(c[e]=[],h=l[e].split(","),o=0;o<h.length;o++)c[e][o]=new n.Tile(f.layers[0],parseInt(h[o],10),o,e,r,u);s===0&&(s=h.length)}return f.format=n.Tilemap.CSV,f.name=t,f.width=s,f.height=a,f.tileWidth=r,f.tileHeight=u,f.widthInPixels=s*r,f.heightInPixels=a*u,f.layers[0].width=s,f.layers[0].height=a,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=c,f},getEmptyData:function(n,t,i,r){var u={},f,e;return u.width=0,u.height=0,u.tileWidth=0,u.tileHeight=0,typeof n!="undefined"&&n!==null&&(u.tileWidth=n),typeof t!="undefined"&&t!==null&&(u.tileHeight=t),typeof i!="undefined"&&i!==null&&(u.width=i),typeof r!="undefined"&&r!==null&&(u.height=r),u.orientation="orthogonal",u.version="1",u.properties={},u.widthInPixels=0,u.heightInPixels=0,f=[],e={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]},f.push(e),u.layers=f,u.images=[],u.objects={},u.collision={},u.tilesets=[],u.tiles=[],u},parseTiledJSON:function(t){function ot(n,t){var r={},u,i;for(u in t)i=t[u],n[i]&&(r[i]=n[i]);return r}var f,rt,ut,ft,et,g,y,nt,r,d,h,e,v,c,p,at,u,i,tt,it;if(t.orientation!=="orthogonal")return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(f={},f.width=t.width,f.height=t.height,f.tileWidth=t.tilewidth,f.tileHeight=t.tileheight,f.orientation=t.orientation,f.format=n.Tilemap.TILED_JSON,f.version=t.version,f.properties=t.properties,f.widthInPixels=f.width*f.tileWidth,f.heightInPixels=f.height*f.tileHeight,rt=[],i=0;i<t.layers.length;i++)if(t.layers[i].type==="tilelayer"){c={name:t.layers[i].name,x:t.layers[i].x,y:t.layers[i].y,width:t.layers[i].width,height:t.layers[i].height,widthInPixels:t.layers[i].width*t.tilewidth,heightInPixels:t.layers[i].height*t.tileheight,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{},indexes:[],callbacks:[],bodies:[]};t.layers[i].properties&&(c.properties=t.layers[i].properties);var a=0,o=[],k=[],l,w,b,s;for(v=0,d=t.layers[i].data.length;v<d;v++){if(l=0,w=!1,s=t.layers[i].data[v],s>536870912){b=0;s>2147483648&&(s-=2147483648,b+=4);s>1073741824&&(s-=1073741824,b+=2);s>536870912&&(s-=536870912,b+=1);switch(b){case 5:l=Math.PI/2;break;case 6:l=Math.PI;break;case 3:l=3*Math.PI/2;break;case 4:l=0;w=!0;break;case 7:l=Math.PI/2;w=!0;break;case 2:l=Math.PI;w=!0;break;case 1:l=3*Math.PI/2;w=!0}}s>0?(o.push(new n.Tile(c,s,a,k.length,t.tilewidth,t.tileheight)),o[o.length-1].rotation=l,o[o.length-1].flipped=w):o.push(new n.Tile(c,-1,a,k.length,t.tilewidth,t.tileheight));a++;a===t.layers[i].width&&(k.push(o),a=0,o=[])}c.data=k;rt.push(c)}for(f.layers=rt,ut=[],i=0;i<t.layers.length;i++)t.layers[i].type==="imagelayer"&&(ft={name:t.layers[i].name,image:t.layers[i].image,x:t.layers[i].x,y:t.layers[i].y,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{}},t.layers[i].properties&&(ft.properties=t.layers[i].properties),ut.push(ft));for(f.images=ut,et=[],i=0;i<t.tilesets.length;i++)u=t.tilesets[i],u.image?(g=new n.Tileset(u.name,u.firstgid,u.tilewidth,u.tileheight,u.margin,u.spacing,u.properties),u.tileproperties&&(g.tileProperties=u.tileproperties),g.updateTileData(u.imagewidth,u.imageheight),et.push(g)):console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support");for(f.tilesets=et,y={},nt={},i=0;i<t.layers.length;i++)if(t.layers[i].type==="objectgroup")for(y[t.layers[i].name]=[],nt[t.layers[i].name]=[],r=0,d=t.layers[i].objects.length;r<d;r++)if(t.layers[i].objects[r].gid)e={gid:t.layers[i].objects[r].gid,name:t.layers[i].objects[r].name,type:t.layers[i].objects[r].hasOwnProperty("type")?t.layers[i].objects[r].type:"",x:t.layers[i].objects[r].x,y:t.layers[i].objects[r].y,visible:t.layers[i].objects[r].visible,properties:t.layers[i].objects[r].properties},t.layers[i].objects[r].rotation&&(e.rotation=t.layers[i].objects[r].rotation),y[t.layers[i].name].push(e);else if(t.layers[i].objects[r].polyline){for(e={name:t.layers[i].objects[r].name,type:t.layers[i].objects[r].type,x:t.layers[i].objects[r].x,y:t.layers[i].objects[r].y,width:t.layers[i].objects[r].width,height:t.layers[i].objects[r].height,visible:t.layers[i].objects[r].visible,properties:t.layers[i].objects[r].properties},t.layers[i].objects[r].rotation&&(e.rotation=t.layers[i].objects[r].rotation),e.polyline=[],h=0;h<t.layers[i].objects[r].polyline.length;h++)e.polyline.push([t.layers[i].objects[r].polyline[h].x,t.layers[i].objects[r].polyline[h].y]);nt[t.layers[i].name].push(e);y[t.layers[i].name].push(e)}else if(t.layers[i].objects[r].polygon){for(e=ot(t.layers[i].objects[r],["name","type","x","y","visible","rotation","properties"]),e.polygon=[],h=0;h<t.layers[i].objects[r].polygon.length;h++)e.polygon.push([t.layers[i].objects[r].polygon[h].x,t.layers[i].objects[r].polygon[h].y]);y[t.layers[i].name].push(e)}else t.layers[i].objects[r].ellipse?(e=ot(t.layers[i].objects[r],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]),y[t.layers[i].name].push(e)):(e=ot(t.layers[i].objects[r],["name","type","x","y","width","height","visible","rotation","properties"]),e.rectangle=!0,y[t.layers[i].name].push(e));for(f.objects=y,f.collision=nt,f.tiles=[],i=0;i<f.tilesets.length;i++){var u=f.tilesets[i],a=u.tileMargin,ht=u.tileMargin,ct=0,st=0,lt=0;for(v=u.firstgid;v<u.firstgid+u.total;v++){if(f.tiles[v]=[a,ht,i],a+=u.tileWidth+u.tileSpacing,ct++,ct===u.total)break;if(st++,st===u.columns&&(a=u.tileMargin,ht+=u.tileHeight+u.tileSpacing,st=0,lt++,lt===u.rows))break}}for(i=0;i<f.layers.length;i++)for(c=f.layers[i],tt=0;tt<c.data.length;tt++)for(o=c.data[tt],it=0;it<o.length;it++)(p=o[it],p.index<0)||(at=f.tiles[p.index][2],u=f.tilesets[at],u.tileProperties&&u.tileProperties[p.index-u.firstgid]&&(p.properties=n.Utils.mixin(u.tileProperties[p.index-u.firstgid],p.properties)));return f}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tileset=function(n,t,i,r,u,f,e){(typeof i=="undefined"||i<=0)&&(i=32);(typeof r=="undefined"||r<=0)&&(r=32);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=0);this.name=n;this.firstgid=t|0;this.tileWidth=i|0;this.tileHeight=r|0;this.tileMargin=u|0;this.tileSpacing=f|0;this.properties=e||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};n.Tileset.prototype={draw:function(n,t,i,r){var u=r-this.firstgid<<1;u>=0&&u+1<this.drawCoords.length&&n.drawImage(this.image,this.drawCoords[u],this.drawCoords[u+1],this.tileWidth,this.tileHeight,t,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(n){return n>=this.firstgid&&n<this.firstgid+this.total},setImage:function(n){this.image=n;this.updateTileData(n.width,n.height)},setSpacing:function(n,t){this.tileMargin=n|0;this.tileSpacing=t|0;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(n,t){var i=(t-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing),r=(n-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing),u,f,e,o;for((i%1!=0||r%1!=0)&&console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size"),i=Math.floor(i),r=Math.floor(r),(this.rows&&this.rows!==i||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=i,this.columns=r,this.total=i*r,this.drawCoords.length=0,u=this.tileMargin,f=this.tileMargin,e=0;e<this.rows;e++){for(o=0;o<this.columns;o++)this.drawCoords.push(u),this.drawCoords.push(f),u+=this.tileWidth+this.tileSpacing;u=this.tileMargin;f+=this.tileHeight+this.tileSpacing}}};n.Tileset.prototype.constructor=n.Tileset;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles=function(n){this.game=n;this.emitters={};this.ID=0};n.Particles.prototype={add:function(n){return this.emitters[n.name]=n,n},remove:function(n){delete this.emitters[n.name]},update:function(){for(var n in this.emitters)this.emitters[n].exists&&this.emitters[n].update()}};n.Particles.prototype.constructor=n.Particles;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles.Arcade={};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles.Arcade.Emitter=function(t,i,r,u){this.maxParticles=u||50;n.Group.call(this,t);this.name="emitter"+this.game.particles.ID++;this.type=n.EMITTER;this.physicsType=n.GROUP;this.area=new n.Rectangle(i,r,1,1);this.minParticleSpeed=new n.Point(-100,-100);this.maxParticleSpeed=new n.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=n.Particle;this.particleDrag=new n.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new n.Point;this.on=!1;this.particleAnchor=new n.Point(.5,.5);this.blendMode=n.blendModes.NORMAL;this.emitX=i;this.emitY=r;this.autoScale=!1;this.autoAlpha=!1;this.particleBringToTop=!1;this.particleSendToBack=!1;this._minParticleScale=new n.Point(1,1);this._maxParticleScale=new n.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=!0;this._frames=null};n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype);n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter;n.Particles.Arcade.Emitter.prototype.update=function(){var n;if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,this._flowTotal!==0)if(this._flowQuantity>0){for(n=0;n<this._flowQuantity;n++)if(this.emitParticle()&&(this._counter++,this._flowTotal!==-1&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,this._flowTotal!==-1&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1));for(n=this.children.length;n--;)this.children[n].exists&&this.children[n].update()};n.Particles.Arcade.Emitter.prototype.makeParticles=function(n,t,i,r,u){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=this.maxParticles);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);var f,e=0,o=n,s=t;for(this._frames=t,i>this.maxParticles&&(this.maxParticles=i);e<i;)Array.isArray(n)&&(o=this.game.rnd.pick(n)),Array.isArray(t)&&(s=this.game.rnd.pick(t)),f=new this.particleClass(this.game,0,0,o,s),this.game.physics.arcade.enable(f,!1),r?(f.body.checkCollision.any=!0,f.body.checkCollision.none=!1):f.body.checkCollision.none=!0,f.body.collideWorldBounds=u,f.body.skipQuadTree=!0,f.exists=!1,f.visible=!1,f.anchor.copyFrom(this.particleAnchor),this.add(f),e++;return this};n.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1;this.alive=!1;this.exists=!1};n.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0;this.exists=!0};n.Particles.Arcade.Emitter.prototype.explode=function(n,t){this._flowTotal=0;this.start(!0,n,0,t,!1)};n.Particles.Arcade.Emitter.prototype.flow=function(n,t,i,r,u){(typeof i=="undefined"||i===0)&&(i=1);typeof r=="undefined"&&(r=-1);typeof u=="undefined"&&(u=!0);i>this.maxParticles&&(i=this.maxParticles);this._counter=0;this._flowQuantity=i;this._flowTotal=r;u?(this.start(!0,n,t,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+t*this.game.time.slowMotion):this.start(!1,n,t,i)};n.Particles.Arcade.Emitter.prototype.start=function(n,t,i,r,u){if(typeof n=="undefined"&&(n=!0),typeof t=="undefined"&&(t=0),(typeof i=="undefined"||i===null)&&(i=250),typeof r=="undefined"&&(r=0),typeof u=="undefined"&&(u=!1),r>this.maxParticles&&(r=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=t,this.frequency=i,n||u)for(var f=0;f<r;f++)this.emitParticle();else this.on=!0,this._quantity+=r,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion};n.Particles.Arcade.Emitter.prototype.emitParticle=function(){var n=this.getFirstExists(!1);return n===null?!1:(this.width>1||this.height>1?n.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):n.reset(this.emitX,this.emitY),n.angle=0,n.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(n):this.particleSendToBack&&this.sendToBack(n),this.autoScale?n.setScaleData(this.scaleData):this.minParticleScale!==1||this.maxParticleScale!==1?n.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&n.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),n.frame=Array.isArray(this._frames==="object")?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?n.setAlphaData(this.alphaData):n.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),n.blendMode=this.blendMode,n.body.updateBounds(),n.body.bounce.setTo(this.bounce.x,this.bounce.y),n.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),n.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),n.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation),n.body.gravity.y=this.gravity,n.body.drag.x=this.particleDrag.x,n.body.drag.y=this.particleDrag.y,n.body.angularDrag=this.angularDrag,n.onEmit(),!0)};n.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);n.Group.prototype.destroy.call(this,!0,!1)};n.Particles.Arcade.Emitter.prototype.setSize=function(n,t){this.area.width=n;this.area.height=t};n.Particles.Arcade.Emitter.prototype.setXSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.x=n;this.maxParticleSpeed.x=t};n.Particles.Arcade.Emitter.prototype.setYSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.y=n;this.maxParticleSpeed.y=t};n.Particles.Arcade.Emitter.prototype.setRotation=function(n,t){n=n||0;t=t||0;this.minRotation=n;this.maxRotation=t};n.Particles.Arcade.Emitter.prototype.setAlpha=function(t,i,r,u,f){if(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),typeof r=="undefined"&&(r=0),typeof u=="undefined"&&(u=n.Easing.Linear.None),typeof f=="undefined"&&(f=!1),this.minParticleAlpha=t,this.maxParticleAlpha=i,this.autoAlpha=!1,r>0&&t!==i){var o={v:t},e=this.game.make.tween(o).to({v:i},r,u);e.yoyo(f);this.alphaData=e.generateData(60);this.alphaData.reverse();this.autoAlpha=!0}};n.Particles.Arcade.Emitter.prototype.setScale=function(t,i,r,u,f,e,o){if(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),typeof r=="undefined"&&(r=1),typeof u=="undefined"&&(u=1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=n.Easing.Linear.None),typeof o=="undefined"&&(o=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,r),this._maxParticleScale.set(i,u),this.autoScale=!1,f>0&&(t!==i||r!==u)){var h={x:t,y:r},s=this.game.make.tween(h).to({x:i,y:u},f,e);s.yoyo(o);this.scaleData=s.generateData(60);this.scaleData.reverse();this.autoScale=!0}};n.Particles.Arcade.Emitter.prototype.at=function(n){n.center?(this.emitX=n.center.x,this.emitY=n.center.y):(this.emitX=n.world.x+n.anchor.x*n.width,this.emitY=n.world.y+n.anchor.y*n.height)};Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(n){this.area.width=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(n){this.area.height=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(n){this.emitX=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(n){this.emitY=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
PIXI.blendModes===undefined&&(PIXI.blendModes=n.blendModes);PIXI.scaleModes===undefined&&(PIXI.scaleModes=n.scaleModes);PIXI.Texture.emptyTexture===undefined&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture));PIXI.DisplayObject._tempMatrix===undefined&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix);PIXI.RenderTexture.tempMatrix===undefined&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix);PIXI.Graphics.POLY===undefined&&(PIXI.Graphics.POLY=n.POLYGON,PIXI.Graphics.RECT=n.RECTANGLE,PIXI.Graphics.CIRC=n.CIRCLE,PIXI.Graphics.ELIP=n.ELLIPSE,PIXI.Graphics.RREC=n.ROUNDEDRECTANGLE);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.Phaser=n):typeof define!="undefined"&&define.amd?define("Phaser",function(){return s.Phaser=n}()):s.Phaser=n}).call(this);
//# sourceMappingURL=phaser.min.js.map
